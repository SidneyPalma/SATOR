/*! Rappid - the diagramming toolkit

 Copyright (c) 2013 client IO

 2015-02-04 


 This Source Code Form is subject to the terms of the Rappid License
 , v. 2.0. If a copy of the Rappid License was not distributed with this
 file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/
/*!
 * jQuery JavaScript Library v2.0.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-07-03T13:30Z
 */
(function(window,undefined){var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else{if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}}else{if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else{if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num])},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return !isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else{if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&(length-1) in obj)}rootjQuery=jQuery(document);
/*!
	 * Sizzle CSS Selector Engine v1.9.4-pre
	 * http://sizzlejs.com/
	 *
	 * Copyright 2013 jQuery Foundation, Inc. and other contributors
	 * Released under the MIT license
	 * http://jquery.org/license
	 *
	 * Date: 2013-06-03
	 */
(function(window,undefined){var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-(new Date()),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return -1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else{if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else{if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return(cache[key]=value)}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return !!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while((cur=cur.nextSibling)){if(cur===b){return -1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j])}}})})}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent.attachEvent&&parent!==parent.top){parent.attachEvent("onbeforeunload",function(){setDocument()})}support.attributes=assert(function(div){div.className="i";return !div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return !div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return !doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find.ID;Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(doc.querySelectorAll))){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if((support.matchesSelector=rnative.test((matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true}}}return false};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===doc||contains(preferredDoc,a)){return -1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else{if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0}else{if(aup===bup){return siblingCheck(a,b)}}}cur=a;while((cur=cur.parentNode)){ap.unshift(cur)}cur=b;while((cur=cur.parentNode)){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;(node=elem[i]);i++){ret+=getText(node)}}else{if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd")}else{if(match[3]){Sizzle.error(match[0])}}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr.CHILD.test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else{if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return !!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else{if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0)}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return !results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected)},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return !Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos.nth=Expr.pseudos.eq;for(i in {radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in {submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem))}}postFinder(null,(matcherOut=[]),temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1);if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while((matcher=elementMatchers[j++])){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if((elem=!matcher&&elem)){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}})}jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else{if(memory){list=[]}else{self.disable()}}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else{if(arg&&arg.length&&type!=="string"){add(arg)}}})})(arguments);if(firing){firingLength=list.length}else{if(memory){firingStart=start;fire(memory)}}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return !list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return !stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return !!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else{if(!(--remaining)){deferred.resolveWith(contexts,values)}}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=(function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));if(!input.type){return support}input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;support.reliableMarginRight=true;support.boxSizingReliable=true;support.pixelPosition=false;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment.appendChild(input);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.focusinBubbles="onfocusin" in window;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="";div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}body.removeChild(container)});return support})({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=function(owner){return owner.nodeType?owner.nodeType===1||owner.nodeType===9:true};Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||((key&&typeof key==="string")&&value===undefined)){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:(name.match(core_rnotwhite)||[])}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return !jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};data_user=new Data();data_priv=new Data();jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else{if(type===core_strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else{if(typeof val==="number"){val+=""}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}}}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return !val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if((option.selected=jQuery.inArray(jQuery(option).val(),values)>=0)){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else{if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem[name]=value)}else{return hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}});if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0)}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)))}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}}if(fn===false){fn=returnFalse}else{if(!fn){return this}}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return !!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=(rneedsContext.test(selectors)||typeof selectors!=="string")?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1}if(typeof elem==="string"){return core_indexOf.call(jQuery(elem),this[0])}return core_indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return !!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return(core_indexOf.call(qualifier,elem)>=0)!==not})}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){if(next&&next.parentNode!==parent){next=this.nextSibling}jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!jQuery.support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else{if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}}fragment.textContent="";i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,events,type,key,j,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(Data.accepts(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){events=Object.keys(data.events||{});if(events.length){for(j=0;(type=events[j])!==undefined;j++){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var l=elems.length,i=0;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.checked=src.checked}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}}jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get" in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret};function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else{if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else{if(seekingTransport){return !(selected=dataTypeOrTransport)}}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else{if(params&&typeof params==="object"){type="POST"}}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data);delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else{if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else{if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else{if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(ajax_nonce++));this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else{if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest()}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}xhrCallbacks=undefined})}jQuery.support.cors=!!xhrSupported&&("withCredentials" in xhrSupported);jQuery.support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(jQuery.support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,id,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else{if(type==="error"){complete(xhr.status||404,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[(id=xhrId++)]=callback("abort");xhr.send(options.hasContent&&options.data||null)},abort:function(){if(callback){callback()}}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return(fxNow=jQuery.now())}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand" in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height" in props||"width" in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden" in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return !result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else{if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft}if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}if(typeof window==="object"&&typeof window.document==="object"){window.jQuery=window.$=jQuery}})(window);(function(){var o;var j=[],u=[];var K=0;var a=+new Date+"";var b=75;var m=40;var H=(" \t\x0B\f\xA0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000");var z=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,f=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var C=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var F=/\w*$/;var s=/^function[ \n\r\t]+\w/;var p=/<%=([\s\S]+?)%>/g;var ab=RegExp("^["+H+"]*0+(?=.$)");var S=/($^)/;var l=/\bthis\b/;var Y=/['\n\r\t\u2028\u2029\\]/g;var A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"];var ae=0;var X="[object Arguments]",w="[object Array]",D="[object Boolean]",L="[object Date]",ag="[object Function]",I="[object Number]",c="[object Object]",M="[object RegExp]",J="[object String]";var x={};x[ag]=false;x[X]=x[w]=x[D]=x[L]=x[I]=x[c]=x[M]=x[J]=true;var P={leading:false,maxWait:0,trailing:false};var n={configurable:false,enumerable:false,value:null,writable:false};var G={"boolean":false,"function":true,object:true,number:false,string:false,"undefined":false};var O={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"};var E=(G[typeof window]&&window)||this;var Z=G[typeof exports]&&exports&&!exports.nodeType&&exports;var B=G[typeof module]&&module&&!module.nodeType&&module;var R=B&&B.exports===Z&&Z;var y=G[typeof global]&&global;if(y&&(y.global===y||y.window===y)){E=y}function k(al,ak,ai){var ah=(ai||0)-1,aj=al?al.length:0;while(++ah<aj){if(al[ah]===ak){return ah}}return -1}function Q(ah,ak){var aj=typeof ak;ah=ah.cache;if(aj=="boolean"||ak==null){return ah[ak]?0:-1}if(aj!="number"&&aj!="string"){aj="object"}var ai=aj=="number"?ak:a+ak;ah=(ah=ah[aj])&&ah[ai];return aj=="object"?(ah&&k(ah,ak)>-1?0:-1):(ah?0:-1)}function N(al){var ai=this.cache,ak=typeof al;if(ak=="boolean"||al==null){ai[al]=true}else{if(ak!="number"&&ak!="string"){ak="object"}var aj=ak=="number"?al:a+al,ah=ai[ak]||(ai[ak]={});if(ak=="object"){(ah[aj]||(ah[aj]=[])).push(al)}else{ah[aj]=true}}}function r(ah){return ah.charCodeAt(0)}function aa(ai,ah){var aj=ai.criteria,ak=ah.criteria;if(aj!==ak){if(aj>ak||typeof aj=="undefined"){return 1}if(aj<ak||typeof ak=="undefined"){return -1}}return ai.index-ah.index}function ad(ao){var ak=-1,am=ao.length,an=ao[0],aj=ao[(am/2)|0],al=ao[am-1];if(an&&typeof an=="object"&&aj&&typeof aj=="object"&&al&&typeof al=="object"){return false}var ai=t();ai["false"]=ai["null"]=ai["true"]=ai["undefined"]=false;var ah=t();ah.array=ao;ah.cache=ai;ah.push=N;while(++ak<am){ah.push(ao[ak])}return ah}function h(ah){return"\\"+O[ah]}function d(){return j.pop()||[]}function t(){return u.pop()||{array:null,cache:null,criteria:null,"false":false,index:0,"null":false,number:null,object:null,push:null,string:null,"true":false,"undefined":false,value:null}}function W(){}function T(ah){ah.length=0;if(j.length<m){j.push(ah)}}function q(ai){var ah=ai.cache;if(ah){q(ah)}ai.array=ai.cache=ai.criteria=ai.object=ai.number=ai.string=ai.value=null;if(u.length<m){u.push(ai)}}function v(am,al,ai){al||(al=0);if(typeof ai=="undefined"){ai=am?am.length:0}var aj=-1,ak=ai-al||0,ah=Array(ak<0?0:ak);while(++aj<ak){ah[aj]=am[al+aj]}return ah}function ac(al){al=al?af.defaults(E.Object(),al,af.pick(E,A)):E;var aI=al.Array,cf=al.Boolean,cg=al.Date,a2=al.Function,b5=al.Math,bi=al.Number,c1=al.Object,cG=al.RegExp,cq=al.String,aJ=al.TypeError;var b9=[];var cK=c1.prototype;var cV=al._;var b2=cG("^"+cq(cK.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$");var aZ=b5.ceil,bU=al.clearTimeout,cN=b5.floor,bE=a2.prototype.toString,aw=b2.test(aw=c1.getPrototypeOf)&&aw,a3=cK.hasOwnProperty,ch=b2.test(ch=cg.now)&&ch||function(){return +new cg},az=b9.push,b0=al.setImmediate,a0=al.setTimeout,co=b9.splice,aC=cK.toString,cJ=b9.unshift;var cH=(function(){try{var dg={},de=b2.test(de=c1.defineProperty)&&de,at=de(dg,dg,dg)&&de}catch(df){}return at}());var b7=b2.test(b7=aC.bind)&&b7,ay=b2.test(ay=c1.create)&&ay,bj=b2.test(bj=aI.isArray)&&bj,aM=al.isFinite,bG=al.isNaN,ck=b2.test(ck=c1.keys)&&ck,cl=b5.max,aq=b5.min,da=al.parseInt,bM=b5.random,aL=b9.slice;var a4=b2.test(al.attachEvent),au=b7&&!/\n|true/.test(b7+a4);var cL={};cL[w]=aI;cL[D]=cf;cL[L]=cg;cL[ag]=a2;cL[c]=c1;cL[I]=bi;cL[M]=cG;cL[J]=cq;function aX(at){return(at&&typeof at=="object"&&!bF(at)&&a3.call(at,"__wrapped__"))?at:new cP(at)}function cP(de,at){this.__chain__=!!at;this.__wrapped__=de}cP.prototype=aX.prototype;var aH=aX.support={};aH.fastBind=b7&&!au;aH.funcDecomp=!b2.test(al.WinRTError)&&l.test(ac);aH.funcNames=typeof a2.name=="string";aX.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:p,variable:"",imports:{_:aX}};function bm(dl,dm,dn,dh,df){if(dn){var dp=dn(dl);if(typeof dp!="undefined"){return dp}}var dg=dc(dl);if(dg){var dj=aC.call(dl);if(!x[dj]){return dl}var dk=cL[dj];switch(dj){case D:case L:return new dk(+dl);case I:case J:return new dk(dl);case M:dp=dk(dl.source,F.exec(dl));dp.lastIndex=dl.lastIndex;return dp}}else{return dl}var di=bF(dl);if(dm){var de=!dh;dh||(dh=d());df||(df=d());var at=dh.length;while(at--){if(dh[at]==dl){return df[at]}}dp=di?dk(dl.length):{}}else{dp=di?v(dl):bu({},dl)}if(di){if(a3.call(dl,"index")){dp.index=dl.index}if(a3.call(dl,"input")){dp.input=dl.input}}if(!dm){return dp}dh.push(dl);df.push(dp);(di?bD:bQ)(dl,function(dq,dr){dp[dr]=bm(dq,dm,dn,dh,df)});if(de){T(dh);T(df)}return dp}function cv(de,at,dh){if(typeof de!="function"){return bn}if(typeof at=="undefined"){return de}var dg=de.__bindData__||(aH.funcNames&&!de.name);if(typeof dg=="undefined"){var df=l&&bE.call(de);if(!aH.funcNames&&df&&!s.test(df)){dg=true}if(aH.funcNames||!dg){dg=!aH.funcDecomp||l.test(df);ai(de,dg)}}if(dg!==true&&(dg&&dg[1]&1)){return de}switch(dh){case 1:return function(di){return de.call(at,di)};case 2:return function(dj,di){return de.call(at,dj,di)};case 3:return function(dj,di,dk){return de.call(at,dj,di,dk)};case 4:return function(di,dk,dj,dl){return de.call(at,di,dk,dj,dl)}}return b1(de,at)}function bW(dg,di,de,dj){var df=(dj||0)-1,at=dg?dg.length:0,dn=[];while(++df<at){var dk=dg[df];if(dk&&typeof dk=="object"&&typeof dk.length=="number"&&(bF(dk)||a8(dk))){if(!di){dk=bW(dk,di,de)}var dm=-1,dh=dk.length,dl=dn.length;dn.length+=dh;while(++dm<dh){dn[dl++]=dk[dm]}}else{if(!de){dn.push(dk)}}}return dn}function bf(du,dt,dj,dq,dw,dv){if(dj){var dp=dj(du,dt);if(typeof dp!="undefined"){return !!dp}}if(du===dt){return du!==0||(1/du==1/dt)}var dh=typeof du,df=typeof dt;if(du===du&&!(du&&G[dh])&&!(dt&&G[df])){return false}if(du==null||dt==null){return du===dt}var at=aC.call(du),dm=aC.call(dt);if(at==X){at=c}if(dm==X){dm=c}if(at!=dm){return false}switch(at){case D:case L:return +du==+dt;case I:return(du!=+du)?dt!=+dt:(du==0?(1/du==1/dt):du==+dt);case M:case J:return du==cq(dt)}var dk=at==w;if(!dk){if(a3.call(du,"__wrapped__ ")||a3.call(dt,"__wrapped__")){return bf(du.__wrapped__||du,dt.__wrapped__||dt,dj,dq,dw,dv)}if(at!=c){return false}var dg=du.constructor,de=dt.constructor;if(dg!=de&&!(aA(dg)&&dg instanceof dg&&aA(de)&&de instanceof de)){return false}}var dn=!dw;dw||(dw=d());dv||(dv=d());var di=dw.length;while(di--){if(dw[di]==du){return dv[di]==dt}}var dr=0;dp=true;dw.push(du);dv.push(dt);if(dk){di=du.length;dr=dt.length;dp=dr==du.length;if(!dp&&!dq){return dp}while(dr--){var dl=di,ds=dt[dr];if(dq){while(dl--){if((dp=bf(du[dl],ds,dj,dq,dw,dv))){break}}}else{if(!(dp=bf(du[dr],ds,dj,dq,dw,dv))){break}}}return dp}am(dt,function(dz,dy,dx){if(a3.call(dx,dy)){dr++;return(dp=a3.call(du,dy)&&bf(du[dy],dz,dj,dq,dw,dv))}});if(dp&&!dq){am(du,function(dz,dy,dx){if(a3.call(dx,dy)){return(dp=--dr>-1)}})}if(dn){T(dw);T(dv)}return dp}function ak(de,df,dh,at,dg){(bF(df)?bD:bQ)(df,function(dp,dk){var dn,dl,dj=dp,dm=de[dk];if(dp&&((dl=bF(dp))||aR(dp))){var dq=at.length;while(dq--){if((dn=at[dq]==dp)){dm=dg[dq];break}}if(!dn){var di;if(dh){dj=dh(dm,dp);if((di=typeof dj!="undefined")){dm=dj}}if(!di){dm=dl?(bF(dm)?dm:[]):(aR(dm)?dm:{})}at.push(dp);dg.push(dm);if(!di){ak(dm,dp,dh,at,dg)}}}else{if(dh){dj=dh(dm,dp);if(typeof dj=="undefined"){dj=dp}}if(typeof dj!="undefined"){dm=dj}}de[dk]=dm})}function aj(dj,dg,dn){var di=-1,dk=b6(),df=dj?dj.length:0,dp=[];var dl=!dg&&df>=b&&dk===k,de=(dn||dl)?d():dp;if(dl){var at=ad(de);if(at){dk=Q;de=at}else{dl=false;de=dn?de:(T(de),dp)}}while(++di<df){var dm=dj[di],dh=dn?dn(dm,di,dj):dm;if(dg?!di||de[de.length-1]!==dh:dk(de,dh)<0){if(dn||dl){de.push(dh)}dp.push(dm)}}if(dl){T(de.array);q(de)}else{if(dn){T(de)}}return dp}function bV(at){return function(dj,dk,df){var de={};dk=aX.createCallback(dk,df,3);var dg=-1,dh=dj?dj.length:0;if(typeof dh=="number"){while(++dg<dh){var di=dj[dg];at(de,di,dk(di,dg,dj),dj)}}else{bQ(dj,function(dm,dl,dn){at(de,dm,dk(dm,dl,dn),dn)})}return de}}function aT(dj,dg,dl,df,dr,at){var di=dg&1,dt=dg&2,dq=dg&4,dn=dg&8,de=dg&16,dm=dg&32,ds=dj;if(!dt&&!aA(dj)){throw new aJ}if(de&&!dl.length){dg&=~16;de=dl=false}if(dm&&!df.length){dg&=~32;dm=df=false}var dh=dj&&dj.__bindData__;if(dh){if(di&&!(dh[1]&1)){dh[4]=dr}if(!di&&dh[1]&1){dg|=8}if(dq&&!(dh[1]&4)){dh[5]=at}if(de){az.apply(dh[2]||(dh[2]=[]),dl)}if(dm){az.apply(dh[3]||(dh[3]=[]),df)}dh[1]|=dg;return aT.apply(null,dh)}if(di&&!(dt||dq||dm)&&(aH.fastBind||(b7&&de))){if(de){var dp=[dr];az.apply(dp,dl)}var dk=de?b7.apply(dj,dp):b7.call(dj,dr)}else{dk=function(){var dw=arguments,dv=di?dr:this;if(dq||de||dm){dw=aL.call(dw);if(de){cJ.apply(dw,dl)}if(dm){az.apply(dw,df)}if(dq&&dw.length<at){dg|=16&~32;return aT(dj,(dn?dg:dg&~3),dw,null,dr,at)}}if(dt){dj=dv[ds]}if(this instanceof dk){dv=bh(dj.prototype);var du=dj.apply(dv,dw);return dc(du)?du:dv}return dj.apply(dv,dw)}}ai(dk,aL.call(arguments));return dk}function bh(at){return dc(at)?ay(at):{}}if(!ay){bh=function(de){if(dc(de)){W.prototype=de;var at=new W;W.prototype=null}return at||{}}}function bq(at){return aW[at]}function b6(){var at=(at=aX.indexOf)===c4?k:at;return at}var ai=!cH?W:function(at,de){n.value=de;cH(at,"__bindData__",n)};function aO(df){var de,at;if(!(df&&aC.call(df)==c)||(de=df.constructor,aA(de)&&!(de instanceof de))){return false}am(df,function(dh,dg){at=dg});return typeof at=="undefined"||a3.call(df,at)}function br(at){return bX[at]}function a8(at){return at&&typeof at=="object"&&typeof at.length=="number"&&aC.call(at)==X||false}var bF=bj||function(at){return at&&typeof at=="object"&&typeof at.length=="number"&&aC.call(at)==w||false};var bg=function(df){var de,dg=df,at=[];if(!dg){return at}if(!(G[typeof df])){return at}for(de in dg){if(a3.call(dg,de)){at.push(de)}}return at};var cb=!ck?bg:function(at){if(!dc(at)){return[]}return ck(at)};var aW={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var bX=b8(aW);var cc=cG("("+cb(bX).join("|")+")","g"),ci=cG("["+cb(aW).join("")+"]","g");var bu=function(dh,at,dk){var dj,dg=dh,dq=dg;if(!dg){return dq}var dm=arguments,de=0,di=typeof dk=="number"?2:dm.length;if(di>3&&typeof dm[di-2]=="function"){var dp=cv(dm[--di-1],dm[di--],2)}else{if(di>2&&typeof dm[di-1]=="function"){dp=dm[--di]}}while(++de<di){dg=dm[de];if(dg&&G[typeof dg]){var dl=-1,dn=G[typeof dg]&&cb(dg),df=dn?dn.length:0;while(++dl<df){dj=dn[dl];dq[dj]=dp?dp(dq[dj],dg[dj]):dg[dj]}}}return dq};function cC(df,de,dg,at){if(typeof de!="boolean"&&de!=null){at=dg;dg=de;de=false}return bm(df,de,typeof dg=="function"&&cv(dg,at,1))}function c9(de,df,at){return bm(de,true,typeof df=="function"&&cv(df,at,1))}var bv=function(dh,at,dk){var dj,dg=dh,dp=dg;if(!dg){return dp}var dm=arguments,de=0,di=typeof dk=="number"?2:dm.length;while(++de<di){dg=dm[de];if(dg&&G[typeof dg]){var dl=-1,dn=G[typeof dg]&&cb(dg),df=dn?dn.length:0;while(++dl<df){dj=dn[dl];if(typeof dp[dj]=="undefined"){dp[dj]=dg[dj]}}}}return dp};function ct(df,dg,de){var at;dg=aX.createCallback(dg,de,3);bQ(df,function(dj,di,dh){if(dg(dj,di,dh)){at=di;return false}});return at}function bP(df,dg,de){var at;dg=aX.createCallback(dg,de,3);c0(df,function(dj,di,dh){if(dg(dj,di,dh)){at=di;return false}});return at}var am=function(dh,di,de){var df,dg=dh,at=dg;if(!dg){return at}if(!G[typeof dg]){return at}di=di&&typeof de=="undefined"?di:cv(di,de,3);for(df in dg){if(di(dg[df],df,dh)===false){return at}}return at};function cu(de,dh,at){var dg=[];am(de,function(dj,di){dg.push(di,dj)});var df=dg.length;dh=cv(dh,at,3);while(df--){if(dh(dg[df--],dg[df],de)===false){break}}return de}var bQ=function(df,dk,di){var dg,de=df,dl=de;if(!de){return dl}if(!G[typeof de]){return dl}dk=dk&&typeof di=="undefined"?dk:cv(dk,di,3);var dh=-1,dj=G[typeof de]&&cb(de),at=dj?dj.length:0;while(++dh<at){dg=dj[dh];if(dk(de[dg],dg,df)===false){return dl}}return dl};function c0(de,di,at){var dg=cb(de),dh=dg.length;di=cv(di,at,3);while(dh--){var df=dg[dh];if(di(de[df],df,de)===false){break}}return de}function cI(de){var at=[];am(de,function(dg,df){if(aA(dg)){at.push(df)}});return at.sort()}function cX(at,de){return at?a3.call(at,de):false}function b8(df){var de=-1,dh=cb(df),di=dh.length,at={};while(++de<di){var dg=dh[de];at[df[dg]]=dg}return at}function bJ(at){return at===true||at===false||aC.call(at)==D}function bb(at){return at?(typeof at=="object"&&aC.call(at)==L):false}function b3(at){return at?at.nodeType===1:false}function cr(dg){var at=true;if(!dg){return at}var de=aC.call(dg),df=dg.length;if((de==w||de==J||de==X)||(de==c&&typeof df=="number"&&aA(dg.splice))){return !df}bQ(dg,function(){return(at=false)});return at}function b4(df,at,dg,de){return bf(df,at,typeof dg=="function"&&cv(dg,de,2))}function aN(at){return aM(at)&&!bG(parseFloat(at))}function aA(at){return typeof at=="function"}function dc(at){return !!(at&&G[typeof at])}function bS(at){return bt(at)&&at!=+at}function c3(at){return at===null}function bt(at){return typeof at=="number"||aC.call(at)==I}var aR=function(df){if(!(df&&aC.call(df)==c)){return false}var at=df.valueOf,de=typeof at=="function"&&(de=aw(at))&&aw(de);return de?(df==de||aw(df)==de):aO(df)};function cR(at){return at?(typeof at=="object"&&aC.call(at)==M):false}function cz(at){return typeof at=="string"||aC.call(at)==J}function bZ(at){return typeof at=="undefined"}function bL(dh){var dg=arguments,di=2;if(!dc(dh)){return dh}if(typeof dg[2]!="number"){di=dg.length}if(di>3&&typeof dg[di-2]=="function"){var dk=cv(dg[--di-1],dg[di--],2)}else{if(di>2&&typeof dg[di-1]=="function"){dk=dg[--di]}}var df=aL.call(arguments,1,di),de=-1,at=d(),dj=d();while(++de<di){ak(dh,df[de],dk,at,dj)}T(at);T(dj);return dh}function cw(df,dj,de){var dh=b6(),di=typeof dj=="function",at={};if(di){dj=aX.createCallback(dj,de,3)}else{var dg=bW(arguments,true,false,1)}am(df,function(dm,dl,dk){if(di?!dj(dm,dl,dk):dh(dg,dl)<0){at[dl]=dm}});return at}function bB(df){var de=-1,dh=cb(df),di=dh.length,at=aI(di);while(++de<di){var dg=dh[de];at[de]=[dg,df[dg]]}return at}function bN(dg,dk,de){var at={};if(typeof dk!="function"){var df=-1,di=bW(arguments,true,false,1),dj=dc(dg)?di.length:0;while(++df<dj){var dh=di[df];if(dh in dg){at[dh]=dg[dh]}}}else{dk=aX.createCallback(dk,de,3);am(dg,function(dn,dm,dl){if(dk(dn,dm,dl)){at[dm]=dn}})}return at}function cW(df,dj,de,at){var di=bF(df);dj=cv(dj,at,4);if(de==null){if(di){de=[]}else{var dh=df&&df.constructor,dg=dh&&dh.prototype;de=bh(dg)}}(di?bD:bQ)(df,function(dm,dl,dk){return dj(de,dm,dl,dk)});return de}function by(df){var de=-1,dg=cb(df),dh=dg.length,at=aI(dh);while(++de<dh){at[de]=df[dg[de]]}return at}function cM(di){var df=arguments,de=-1,dg=bW(df,true,false,1),dh=(df[2]&&df[2][df[1]]===di)?1:dg.length,at=aI(dh);while(++de<dh){at[de]=di[dg[de]]}return at}function a7(dj,di,dg){var de=-1,df=b6(),dh=dj?dj.length:0,at=false;dg=(dg<0?cl(0,dh+dg):dg)||0;if(bF(dj)){at=df(dj,di,dg)>-1}else{if(typeof dh=="number"){at=(cz(dj)?dj.indexOf(di,dg):df(dj,di,dg))>-1}else{bQ(dj,function(dk){if(++de>=dg){return !(at=dk===di)}})}}return at}var bK=bV(function(at,df,de){(a3.call(at,de)?at[de]++:at[de]=1)});function aB(dh,di,de){var at=true;di=aX.createCallback(di,de,3);var df=-1,dg=dh?dh.length:0;if(typeof dg=="number"){while(++df<dg){if(!(at=!!di(dh[df],df,dh))){break}}}else{bQ(dh,function(dk,dj,dl){return(at=!!di(dk,dj,dl))})}return at}function bR(di,dj,de){var at=[];dj=aX.createCallback(dj,de,3);var df=-1,dg=di?di.length:0;if(typeof dg=="number"){while(++df<dg){var dh=di[df];if(dj(dh,df,di)){at.push(dh)}}}else{bQ(di,function(dl,dk,dm){if(dj(dl,dk,dm)){at.push(dl)}})}return at}function bI(di,dj,de){dj=aX.createCallback(dj,de,3);var df=-1,dg=di?di.length:0;if(typeof dg=="number"){while(++df<dg){var dh=di[df];if(dj(dh,df,di)){return dh}}}else{var at;bQ(di,function(dl,dk,dm){if(dj(dl,dk,dm)){at=dl;return false}});return at}}function c7(df,dg,de){var at;dg=aX.createCallback(dg,de,3);av(df,function(di,dh,dj){if(dg(di,dh,dj)){at=di;return false}});return at}function bD(dg,dh,at){var de=-1,df=dg?dg.length:0;dh=dh&&typeof at=="undefined"?dh:cv(dh,at,3);if(typeof df=="number"){while(++de<df){if(dh(dg[de],de,dg)===false){break}}}else{bQ(dg,dh)}return dg}function av(dg,dh,at){var df=dg?dg.length:0;dh=dh&&typeof at=="undefined"?dh:cv(dh,at,3);if(typeof df=="number"){while(df--){if(dh(dg[df],df,dg)===false){break}}}else{var de=cb(dg);df=de.length;bQ(dg,function(dj,di,dk){di=de?de[--df]:--df;return dh(dk[di],di,dk)})}return dg}var bs=bV(function(at,df,de){(a3.call(at,de)?at[de]:at[de]=[]).push(df)});var c5=bV(function(at,df,de){at[de]=df});function aK(dj,de){var dg=aL.call(arguments,2),df=-1,di=typeof de=="function",dh=dj?dj.length:0,at=aI(typeof dh=="number"?dh:0);bD(dj,function(dk){at[++df]=(di?de:dk[de]).apply(dk,dg)});return at}function bo(dh,di,de){var df=-1,dg=dh?dh.length:0;di=aX.createCallback(di,de,3);if(typeof dg=="number"){var at=aI(dg);while(++df<dg){at[df]=di(dh[df],df,dh)}}else{at=[];bQ(dh,function(dk,dj,dl){at[++df]=di(dk,dj,dl)})}return at}function bl(dj,dk,de){var dh=-Infinity,at=dh;if(!dk&&bF(dj)){var df=-1,dg=dj.length;while(++df<dg){var di=dj[df];if(di>at){at=di}}}else{dk=(!dk&&cz(dj))?r:aX.createCallback(dk,de,3);bD(dj,function(dm,dl,dp){var dn=dk(dm,dl,dp);if(dn>dh){dh=dn;at=dm}})}return at}function cn(dj,dk,de){var dh=Infinity,at=dh;if(!dk&&bF(dj)){var df=-1,dg=dj.length;while(++df<dg){var di=dj[df];if(di<at){at=di}}}else{dk=(!dk&&cz(dj))?r:aX.createCallback(dk,de,3);bD(dj,function(dm,dl,dp){var dn=dk(dm,dl,dp);if(dn<dh){dh=dn;at=dm}})}return at}function c8(dh,dg){var de=-1,df=dh?dh.length:0;if(typeof df=="number"){var at=aI(df);while(++de<df){at[de]=dh[de][dg]}}return at||bo(dh,dg)}function cp(di,dj,de,at){if(!di){return de}var dg=arguments.length<3;dj=cv(dj,at,4);var df=-1,dh=di.length;if(typeof dh=="number"){if(dg){de=di[++df]}while(++df<dh){de=dj(de,di[df],df,di)}}else{bQ(di,function(dl,dk,dm){de=dg?(dg=false,dl):dj(de,dl,dk,dm)})}return de}function cT(dg,dh,de,at){var df=arguments.length<3;dh=cv(dh,at,4);av(dg,function(dj,di,dk){de=df?(df=false,dj):dh(de,dj,di,dk)});return de}function aD(de,df,at){df=aX.createCallback(df,at,3);return bR(de,function(dh,dg,di){return !df(dh,dg,di)})}function cS(dg,dh,df){var de=dg?dg.length:0;if(typeof de!="number"){dg=by(dg)}if(dh==null||df){return dg?dg[ce(de-1)]:o}var at=bz(dg);at.length=aq(cl(0,dh),at.length);return at}function bz(dg){var de=-1,df=dg?dg.length:0,at=aI(typeof df=="number"?df:0);bD(dg,function(di){var dh=ce(++de);at[de]=at[dh];at[dh]=di});return at}function ba(de){var at=de?de.length:0;return typeof at=="number"?at:cb(de).length}function a9(dh,di,de){var at;di=aX.createCallback(di,de,3);var df=-1,dg=dh?dh.length:0;if(typeof dg=="number"){while(++df<dg){if((at=di(dh[df],df,dh))){break}}}else{bQ(dh,function(dk,dj,dl){return !(at=di(dk,dj,dl))})}return !!at}function bc(di,dj,de){var dg=-1,dh=di?di.length:0,at=aI(typeof dh=="number"?dh:0);dj=aX.createCallback(dj,de,3);bD(di,function(dm,dl,dn){var dk=at[++dg]=t();dk.criteria=dj(dm,dl,dn);dk.index=dg;dk.value=dm});dh=at.length;at.sort(aa);while(dh--){var df=at[dh];at[dh]=df.value;q(df)}return at}function aF(at){if(at&&typeof at.length=="number"){return v(at)}return by(at)}var an=bR;function aS(dh){var de=-1,df=dh?dh.length:0,at=[];while(++de<df){var dg=dh[de];if(dg){at.push(dg)}}return at}function ah(dh){var dg=-1,di=b6(),df=dh?dh.length:0,at=bW(arguments,true,true,1),dl=[];var dj=df>=b&&di===k;if(dj){var de=ad(at);if(de){di=Q;at=de}else{dj=false}}while(++dg<df){var dk=dh[dg];if(di(at,dk)<0){dl.push(dk)}}if(dj){q(at)}return dl}function c2(dh,dg,at){var de=-1,df=dh?dh.length:0;dg=aX.createCallback(dg,at,3);while(++de<df){if(dg(dh[de],de,dh)){return de}}return -1}function aP(dg,df,at){var de=dg?dg.length:0;df=aX.createCallback(df,at,3);while(de--){if(df(dg[de],de,dg)){return de}}return -1}function bk(di,dh,at){var dg=0,df=di?di.length:0;if(typeof dh!="number"&&dh!=null){var de=-1;dh=aX.createCallback(dh,at,3);while(++de<df&&dh(di[de],de,di)){dg++}}else{dg=dh;if(dg==null||at){return di?di[0]:o}}return v(di,0,aq(cl(0,dg),df))}function cB(dg,at,df,de){if(typeof at!="boolean"&&at!=null){de=df;df=!(de&&de[at]===dg)?at:null;at=false}if(df!=null){dg=bo(dg,df,de)}return bW(dg,at)}function c4(dh,dg,de){if(typeof de=="number"){var df=dh?dh.length:0;de=(de<0?cl(0,df+de):de||0)}else{if(de){var at=bd(dh,dg);return dh[at]===dg?at:-1}}return k(dh,dg,de)}function c6(di,dh,at){var dg=0,df=di?di.length:0;if(typeof dh!="number"&&dh!=null){var de=df;dh=aX.createCallback(dh,at,3);while(de--&&dh(di[de],de,di)){dg++}}else{dg=(dh==null||at)?1:dh||dg}return v(di,0,aq(cl(0,df-dg),df))}function cy(dj){var dl=arguments,dh=dl.length,df=-1,dk=d(),di=-1,dm=b6(),dg=dj?dj.length:0,dp=[],de=d();while(++df<dh){var dn=dl[df];dk[df]=dm===k&&(dn?dn.length:0)>=b&&ad(df?dl[df]:de)}outer:while(++di<dg){var at=dk[0];dn=dj[di];if((at?Q(at,dn):dm(de,dn))<0){df=dh;(at||de).push(dn);while(--df){at=dk[df];if((at?Q(at,dn):dm(dl[df],dn))<0){continue outer}}dp.push(dn)}}while(dh--){at=dk[dh];if(at){q(at)}}T(dk);T(de);return dp}function bw(di,dh,at){var dg=0,df=di?di.length:0;if(typeof dh!="number"&&dh!=null){var de=df;dh=aX.createCallback(dh,at,3);while(de--&&dh(di[de],de,di)){dg++}}else{dg=dh;if(dg==null||at){return di?di[df-1]:o}}return v(di,cl(0,df-dg))}function dd(dg,df,de){var at=dg?dg.length:0;if(typeof de=="number"){at=(de<0?cl(0,at+de):aq(de,at-1))+1}while(at--){if(dg[at]===df){return at}}return -1}function cd(dj){var df=arguments,at=0,dh=df.length,dg=dj?dj.length:0;while(++at<dh){var de=-1,di=df[at];while(++de<dg){if(dj[de]===di){co.call(dj,de--,1);dg--}}}return dj}function a1(di,de,dh){di=+di||0;dh=typeof dh=="number"?dh:(+dh||1);if(de==null){de=di;di=0}var df=-1,dg=cl(0,aZ((de-di)/(dh||1))),at=aI(dg);while(++df<dg){at[df]=di;di+=dh}return at}function aQ(dj,di,de){var df=-1,dg=dj?dj.length:0,at=[];di=aX.createCallback(di,de,3);while(++df<dg){var dh=dj[df];if(di(dh,df,dj)){at.push(dh);co.call(dj,df--,1);dg--}}return at}function ca(di,dh,at){if(typeof dh!="number"&&dh!=null){var dg=0,de=-1,df=di?di.length:0;dh=aX.createCallback(dh,at,3);while(++de<df&&dh(di[de],de,di)){dg++}}else{dg=(dh==null||at)?1:cl(0,dh)}return v(di,dg)}function bd(dj,dh,di,de){var at=0,dg=dj?dj.length:at;di=di?aX.createCallback(di,de,1):bn;dh=di(dh);while(at<dg){var df=(at+dg)>>>1;(di(dj[df])<dh)?at=df+1:dg=df}return at}function ax(at){return aj(bW(arguments,true,true))}function bT(dg,df,de,at){if(typeof df!="boolean"&&df!=null){at=de;de=!(at&&at[df]===dg)?df:null;df=false}if(de!=null){de=aX.createCallback(de,at,3)}return aj(dg,df,de)}function cZ(at){return ah(at,aL.call(arguments,1))}function ar(){var dg=arguments.length>1?arguments:arguments[0],de=-1,df=dg?bl(c8(dg,"length")):0,at=aI(df<0?0:df);while(++de<df){at[de]=c8(dg,de)}return at}function cD(di,de){var df=-1,dh=di?di.length:0,at={};while(++df<dh){var dg=di[df];if(de){at[dg]=de[df]}else{if(dg){at[dg[0]]=dg[1]}}}return at}function aV(de,at){if(!aA(at)){throw new aJ}return function(){if(--de<1){return at.apply(this,arguments)}}}function b1(de,at){return arguments.length>2?aT(de,17,aL.call(arguments,2),null,at):aT(de,1,null,null,at)}function bx(df){var at=arguments.length>1?bW(arguments,true,false,1):cI(df),de=-1,dh=at.length;while(++de<dh){var dg=at[de];df[dg]=aT(df[dg],1,null,null,df)}return df}function cQ(at,de){return arguments.length>2?aT(de,19,aL.call(arguments,2),null,at):aT(de,3,null,null,at)}function cF(){var at=arguments,de=at.length;while(de--){if(!aA(at[de])){throw new aJ}}return function(){var df=arguments,dg=at.length;while(dg--){df=[at[dg].apply(this,df)]}return df[0]}}function aG(di,de,dj){var dh=typeof di;if(di==null||dh=="function"){return cv(di,de,dj)}if(dh!="object"){return function(dk){return dk[di]}}var dg=cb(di),df=dg[0],at=di[df];if(dg.length==1&&at===at&&!dc(at)){return function(dl){var dk=dl[df];return at===dk&&(at!==0||(1/at==1/dk))}}return function(dl){var dm=dg.length,dk=false;while(dm--){if(!(dk=bf(dl[dg[dm]],di[dg[dm]],null,true))){break}}return dk}}function cO(at,de){de=typeof de=="number"?de:(+de||at.length);return aT(at,4,null,null,null,de)}function cE(dg,dl,ds){var dn,dj,dt,at,dq,dr,dp,dk=0,di=false,dm=true;if(!aA(dg)){throw new aJ}dl=cl(0,dl)||0;if(ds===true){var df=true;dm=false}else{if(dc(ds)){df=ds.leading;di="maxWait" in ds&&(cl(dl,ds.maxWait)||0);dm="trailing" in ds?ds.trailing:dm}}var dh=function(){var dv=dl-(ch()-at);if(dv<=0){if(dj){bU(dj)}var du=dp;dj=dr=dp=o;if(du){dk=ch();dt=dg.apply(dq,dn)}}else{dr=a0(dh,dv)}};var de=function(){if(dr){bU(dr)}dj=dr=dp=o;if(dm||(di!==dl)){dk=ch();dt=dg.apply(dq,dn)}};return function(){dn=arguments;at=ch();dq=this;dp=dm&&(dr||!df);if(di===false){var du=df&&!dr}else{if(!dj&&!df){dk=at}var dv=di-(at-dk);if(dv<=0){if(dj){dj=bU(dj)}dk=at;dt=dg.apply(dq,dn)}else{if(!dj){dj=a0(de,dv)}}}if(!dr&&dl!==di){dr=a0(dh,dl)}if(du){dt=dg.apply(dq,dn)}return dt}}function a5(de){if(!aA(de)){throw new aJ}var at=aL.call(arguments,1);return a0(function(){de.apply(o,at)},1)}if(au&&R&&typeof b0=="function"){a5=function(at){if(!aA(at)){throw new aJ}return b0.apply(al,arguments)}}function bO(de,df){if(!aA(de)){throw new aJ}var at=aL.call(arguments,2);return a0(function(){de.apply(o,at)},df)}function a6(de,df){if(!aA(de)){throw new aJ}var at=function(){var dg=at.cache,dh=df?df.apply(this,arguments):a+arguments[0];return a3.call(dg,dh)?dg[dh]:(dg[dh]=de.apply(this,arguments))};at.cache={};return at}function cx(df){var de,at;if(!aA(df)){throw new aJ}return function(){if(de){return at}de=true;at=df.apply(this,arguments);df=null;return at}}function cU(at){return aT(at,16,aL.call(arguments,1))}function cs(at){return aT(at,32,null,aL.call(arguments,1))}function cm(df,dg,de){var di=true,dh=true;if(!aA(df)){throw new aJ}if(de===false){di=false}else{if(dc(de)){di="leading" in de?de.leading:di;dh="trailing" in de?de.trailing:dh}}P.leading=di;P.maxWait=dg;P.trailing=dh;var at=cE(df,dg,P);return at}function bY(at,de){if(!aA(de)){throw new aJ}return function(){var df=[at];az.apply(df,arguments);return de.apply(this,df)}}function be(at){return at==null?"":cq(at).replace(ci,bq)}function bn(at){return at}function aE(at,dg){var de=at,df=!dg||aA(de);if(!dg){de=cP;dg=at;at=aX}bD(cI(dg),function(dh){var di=at[dh]=dg[dh];if(df){de.prototype[dh]=function(){var dl=this.__wrapped__,dk=[dl];az.apply(dk,arguments);var dj=di.apply(at,dk);if(dl&&typeof dl=="object"&&dl===dj){return this}dj=new de(dj);dj.__chain__=this.__chain__;return dj}}})}function cY(){al._=cV;return this}var db=da(H+"08")==8?da:function(de,at){return da(cz(de)?de.replace(ab,""):de,at||0)};function ce(df,at,di){var dh=df==null,de=at==null;if(di==null){if(typeof df=="boolean"&&de){di=df;df=1}else{if(!de&&typeof at=="boolean"){di=at;de=true}}}if(dh&&de){at=1}df=+df||0;if(de){at=df;df=0}else{at=+at||0}var dg=bM();return(di||df%1||at%1)?aq(df+(dg*(at-df+parseFloat("1e-"+((dg+"").length-1)))),at):df+cN(dg*(at-df+1))}function aU(at,df){if(at){var de=at[df];return aA(de)?at[df]():de}}function bH(dr,dk,du){var dh=aX.templateSettings;dr||(dr="");du=bv({},du,dh);var df=bv({},du.imports,dh.imports),dl=cb(df),dg=by(df);var dq,dm=0,dp=du.interpolate||S,de="__p += '";var dt=cG((du.escape||S).source+"|"+dp.source+"|"+(dp===p?C:S).source+"|"+(du.evaluate||S).source+"|$","g");dr.replace(dt,function(dv,dz,dx,dw,dy,dA){dx||(dx=dw);de+=dr.slice(dm,dA).replace(Y,h);if(dz){de+="' +\n__e("+dz+") +\n'"}if(dy){dq=true;de+="';\n"+dy+";\n__p += '"}if(dx){de+="' +\n((__t = ("+dx+")) == null ? '' : __t) +\n'"}dm=dA+dv.length;return dv});de+="';\n";var di=du.variable,dj=di;if(!dj){di="obj";de="with ("+di+") {\n"+de+"\n}\n"}de=(dq?de.replace(z,""):de).replace(U,"$1").replace(f,"$1;");de="function("+di+") {\n"+(dj?"":di+" || ("+di+" = {});\n")+"var __t, __p = '', __e = _.escape"+(dq?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+de+"return __p\n}";var at="\n/*\n//# sourceURL="+(du.sourceURL||"/lodash/template/source["+(ae++)+"]")+"\n*/";try{var ds=a2(dl,"return "+de+at).apply(o,dg)}catch(dn){dn.source=de;throw dn}if(dk){return ds(dk)}ds.source=de;return ds}function ao(dh,dg,de){dh=(dh=+dh)>-1?dh:0;var df=-1,at=aI(dh);dg=cv(dg,de,1);while(++df<dh){at[df]=dg(df)}return at}function ap(at){return at==null?"":cq(at).replace(cc,br)}function cj(at){var de=++K;return cq(at==null?"":at)+de}function bA(at){at=new cP(at);at.__chain__=true;return at}function cA(at,de){de(at);return at}function bC(){this.__chain__=true;return this}function bp(){return cq(this.__wrapped__)}function aY(){return this.__wrapped__}aX.after=aV;aX.assign=bu;aX.at=cM;aX.bind=b1;aX.bindAll=bx;aX.bindKey=cQ;aX.chain=bA;aX.compact=aS;aX.compose=cF;aX.countBy=bK;aX.createCallback=aG;aX.curry=cO;aX.debounce=cE;aX.defaults=bv;aX.defer=a5;aX.delay=bO;aX.difference=ah;aX.filter=bR;aX.flatten=cB;aX.forEach=bD;aX.forEachRight=av;aX.forIn=am;aX.forInRight=cu;aX.forOwn=bQ;aX.forOwnRight=c0;aX.functions=cI;aX.groupBy=bs;aX.indexBy=c5;aX.initial=c6;aX.intersection=cy;aX.invert=b8;aX.invoke=aK;aX.keys=cb;aX.map=bo;aX.max=bl;aX.memoize=a6;aX.merge=bL;aX.min=cn;aX.omit=cw;aX.once=cx;aX.pairs=bB;aX.partial=cU;aX.partialRight=cs;aX.pick=bN;aX.pluck=c8;aX.pull=cd;aX.range=a1;aX.reject=aD;aX.remove=aQ;aX.rest=ca;aX.shuffle=bz;aX.sortBy=bc;aX.tap=cA;aX.throttle=cm;aX.times=ao;aX.toArray=aF;aX.transform=cW;aX.union=ax;aX.uniq=bT;aX.values=by;aX.where=an;aX.without=cZ;aX.wrap=bY;aX.zip=ar;aX.zipObject=cD;aX.collect=bo;aX.drop=ca;aX.each=bD;aX.eachRight=av;aX.extend=bu;aX.methods=cI;aX.object=cD;aX.select=bR;aX.tail=ca;aX.unique=bT;aX.unzip=ar;aE(aX);aX.clone=cC;aX.cloneDeep=c9;aX.contains=a7;aX.escape=be;aX.every=aB;aX.find=bI;aX.findIndex=c2;aX.findKey=ct;aX.findLast=c7;aX.findLastIndex=aP;aX.findLastKey=bP;aX.has=cX;aX.identity=bn;aX.indexOf=c4;aX.isArguments=a8;aX.isArray=bF;aX.isBoolean=bJ;aX.isDate=bb;aX.isElement=b3;aX.isEmpty=cr;aX.isEqual=b4;aX.isFinite=aN;aX.isFunction=aA;aX.isNaN=bS;aX.isNull=c3;aX.isNumber=bt;aX.isObject=dc;aX.isPlainObject=aR;aX.isRegExp=cR;aX.isString=cz;aX.isUndefined=bZ;aX.lastIndexOf=dd;aX.mixin=aE;aX.noConflict=cY;aX.parseInt=db;aX.random=ce;aX.reduce=cp;aX.reduceRight=cT;aX.result=aU;aX.runInContext=ac;aX.size=ba;aX.some=a9;aX.sortedIndex=bd;aX.template=bH;aX.unescape=ap;aX.uniqueId=cj;aX.all=aB;aX.any=a9;aX.detect=bI;aX.findWhere=bI;aX.foldl=cp;aX.foldr=cT;aX.include=a7;aX.inject=cp;bQ(aX,function(de,at){if(!aX.prototype[at]){aX.prototype[at]=function(){var dh=[this.__wrapped__],dg=this.__chain__;az.apply(dh,arguments);var df=de.apply(aX,dh);return dg?new cP(df,dg):df}}});aX.first=bk;aX.last=bw;aX.sample=cS;aX.take=bk;aX.head=bk;bQ(aX,function(df,de){var at=de!=="sample";if(!aX.prototype[de]){aX.prototype[de]=function(dj,di){var dh=this.__chain__,dg=df(this.__wrapped__,dj,di);return !dh&&(dj==null||(di&&!(at&&typeof dj=="function")))?dg:new cP(dg,dh)}}});aX.VERSION="2.2.1";aX.prototype.chain=bC;aX.prototype.toString=bp;aX.prototype.value=aY;aX.prototype.valueOf=aY;bD(["join","pop","shift"],function(at){var de=b9[at];aX.prototype[at]=function(){var dg=this.__chain__,df=de.apply(this.__wrapped__,arguments);return dg?new cP(df,dg):df}});bD(["push","reverse","sort","unshift"],function(at){var de=b9[at];aX.prototype[at]=function(){de.apply(this.__wrapped__,arguments);return this}});bD(["concat","slice","splice"],function(at){var de=b9[at];aX.prototype[at]=function(){return new cP(de.apply(this.__wrapped__,arguments),this.__chain__)}});return aX}var af=ac();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){E._=af;define(function(){return af})}else{if(Z&&B){if(R){(B.exports=af)._=af}else{Z._=af}}else{E._=af}}}.call(this));(function(a,b){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(f,h,d){a.Backbone=b(a,d,f,h)})}else{if(typeof exports!=="undefined"){var c=require("underscore");b(a,exports,c)}else{a.Backbone=b(a,{},a._,(a.jQuery||a.Zepto||a.ender||a.$))}}}(this,function(y,E,Q,C){var G=y.Backbone;var j=[];var I=j.push;var r=j.slice;var x=j.splice;E.VERSION="1.1.2";E.$=C;E.noConflict=function(){y.Backbone=G;return this};E.emulateHTTP=false;E.emulateJSON=false;var O=E.Events={on:function(R,U,T){if(!B(this,"on",R,[U,T])||!U){return this}this._events||(this._events={});var S=this._events[R]||(this._events[R]=[]);S.push({callback:U,context:T,ctx:T||this});return this},once:function(S,W,T){if(!B(this,"once",S,[W,T])||!W){return this}var R=this;var U=Q.once(function(){R.off(S,U);W.apply(this,arguments)});U._callback=W;return this.on(S,U,T)},off:function(R,ab,S){var Z,aa,ac,Y,X,T,W,U;if(!this._events||!B(this,"off",R,[ab,S])){return this}if(!R&&!ab&&!S){this._events=void 0;return this}Y=R?[R]:Q.keys(this._events);for(X=0,T=Y.length;X<T;X++){R=Y[X];if(ac=this._events[R]){this._events[R]=Z=[];if(ab||S){for(W=0,U=ac.length;W<U;W++){aa=ac[W];if((ab&&ab!==aa.callback&&ab!==aa.callback._callback)||(S&&S!==aa.context)){Z.push(aa)}}}if(!Z.length){delete this._events[R]}}}return this},trigger:function(T){if(!this._events){return this}var S=r.call(arguments,1);if(!B(this,"trigger",T,S)){return this}var U=this._events[T];var R=this._events.all;if(U){b(U,S)}if(R){b(R,arguments)}return this},stopListening:function(U,S,X){var T=this._listeningTo;if(!T){return this}var R=!S&&!X;if(!X&&typeof S==="object"){X=this}if(U){(T={})[U._listenId]=U}for(var W in T){U=T[W];U.off(S,X,this);if(R||Q.isEmpty(U._events)){delete this._listeningTo[W]}}return this}};var A=/\s+/;var B=function(Z,X,S,W){if(!S){return true}if(typeof S==="object"){for(var U in S){Z[X].apply(Z,[U,S[U]].concat(W))}return false}if(A.test(S)){var Y=S.split(A);for(var T=0,R=Y.length;T<R;T++){Z[X].apply(Z,[Y[T]].concat(W))}return false}return true};var b=function(X,U){var Y,W=-1,T=X.length,S=U[0],R=U[1],Z=U[2];switch(U.length){case 0:while(++W<T){(Y=X[W]).callback.call(Y.ctx)}return;case 1:while(++W<T){(Y=X[W]).callback.call(Y.ctx,S)}return;case 2:while(++W<T){(Y=X[W]).callback.call(Y.ctx,S,R)}return;case 3:while(++W<T){(Y=X[W]).callback.call(Y.ctx,S,R,Z)}return;default:while(++W<T){(Y=X[W]).callback.apply(Y.ctx,U)}return}};var H={listenTo:"on",listenToOnce:"once"};Q.each(H,function(R,S){O[S]=function(W,T,Y){var U=this._listeningTo||(this._listeningTo={});var X=W._listenId||(W._listenId=Q.uniqueId("l"));U[X]=W;if(!Y&&typeof T==="object"){Y=this}W[R](T,Y,this);return this}});O.bind=O.on;O.unbind=O.off;Q.extend(E,O);var J=E.Model=function(R,T){var S=R||{};T||(T={});this.cid=Q.uniqueId("c");this.attributes={};if(T.collection){this.collection=T.collection}if(T.parse){S=this.parse(S,T)||{}}S=Q.defaults({},S,Q.result(this,"defaults"));this.set(S,T);this.changed={};this.initialize.apply(this,arguments)};Q.extend(J.prototype,O,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(R){return Q.clone(this.attributes)},sync:function(){return E.sync.apply(this,arguments)},get:function(R){return this.attributes[R]},escape:function(R){return Q.escape(this.get(R))},has:function(R){return this.get(R)!=null},set:function(aa,R,ae){var Y,ab,ac,Z,X,ad,T,W;if(aa==null){return this}if(typeof aa==="object"){ab=aa;ae=R}else{(ab={})[aa]=R}ae||(ae={});if(!this._validate(ab,ae)){return false}ac=ae.unset;X=ae.silent;Z=[];ad=this._changing;this._changing=true;if(!ad){this._previousAttributes=Q.clone(this.attributes);this.changed={}}W=this.attributes,T=this._previousAttributes;if(this.idAttribute in ab){this.id=ab[this.idAttribute]}for(Y in ab){R=ab[Y];if(!Q.isEqual(W[Y],R)){Z.push(Y)}if(!Q.isEqual(T[Y],R)){this.changed[Y]=R}else{delete this.changed[Y]}ac?delete W[Y]:W[Y]=R}if(!X){if(Z.length){this._pending=ae}for(var U=0,S=Z.length;U<S;U++){this.trigger("change:"+Z[U],this,W[Z[U]],ae)}}if(ad){return this}if(!X){while(this._pending){ae=this._pending;this._pending=false;this.trigger("change",this,ae)}}this._pending=false;this._changing=false;return this},unset:function(R,S){return this.set(R,void 0,Q.extend({},S,{unset:true}))},clear:function(S){var R={};for(var T in this.attributes){R[T]=void 0}return this.set(R,Q.extend({},S,{unset:true}))},hasChanged:function(R){if(R==null){return !Q.isEmpty(this.changed)}return Q.has(this.changed,R)},changedAttributes:function(T){if(!T){return this.hasChanged()?Q.clone(this.changed):false}var W,U=false;var S=this._changing?this._previousAttributes:this.attributes;for(var R in T){if(Q.isEqual(S[R],(W=T[R]))){continue}(U||(U={}))[R]=W}return U},previous:function(R){if(R==null||!this._previousAttributes){return null}return this._previousAttributes[R]},previousAttributes:function(){return Q.clone(this._previousAttributes)},fetch:function(S){S=S?Q.clone(S):{};if(S.parse===void 0){S.parse=true}var R=this;var T=S.success;S.success=function(U){if(!R.set(R.parse(U,S),S)){return false}if(T){T(R,U,S)}R.trigger("sync",R,U,S)};M(this,S);return this.sync("read",this,S)},save:function(W,S,aa){var X,R,Z,T=this.attributes;if(W==null||typeof W==="object"){X=W;aa=S}else{(X={})[W]=S}aa=Q.extend({validate:true},aa);if(X&&!aa.wait){if(!this.set(X,aa)){return false}}else{if(!this._validate(X,aa)){return false}}if(X&&aa.wait){this.attributes=Q.extend({},T,X)}if(aa.parse===void 0){aa.parse=true}var U=this;var Y=aa.success;aa.success=function(ac){U.attributes=T;var ab=U.parse(ac,aa);if(aa.wait){ab=Q.extend(X||{},ab)}if(Q.isObject(ab)&&!U.set(ab,aa)){return false}if(Y){Y(U,ac,aa)}U.trigger("sync",U,ac,aa)};M(this,aa);R=this.isNew()?"create":(aa.patch?"patch":"update");if(R==="patch"){aa.attrs=X}Z=this.sync(R,this,aa);if(X&&aa.wait){this.attributes=T}return Z},destroy:function(S){S=S?Q.clone(S):{};var R=this;var W=S.success;var T=function(){R.trigger("destroy",R,R.collection,S)};S.success=function(X){if(S.wait||R.isNew()){T()}if(W){W(R,X,S)}if(!R.isNew()){R.trigger("sync",R,X,S)}};if(this.isNew()){S.success();return false}M(this,S);var U=this.sync("delete",this,S);if(!S.wait){T()}return U},url:function(){var R=Q.result(this,"urlRoot")||Q.result(this.collection,"url")||v();if(this.isNew()){return R}return R.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(S,R){return S},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(R){return this._validate({},Q.extend(R||{},{validate:true}))},_validate:function(T,S){if(!S.validate||!this.validate){return true}T=Q.extend({},this.attributes,T);var R=this.validationError=this.validate(T,S)||null;if(!R){return true}this.trigger("invalid",this,R,Q.extend(S,{validationError:R}));return false}});var a=["keys","values","pairs","invert","pick","omit"];Q.each(a,function(R){J.prototype[R]=function(){var S=r.call(arguments);S.unshift(this.attributes);return Q[R].apply(Q,S)}});var c=E.Collection=function(S,R){R||(R={});if(R.model){this.model=R.model}if(R.comparator!==void 0){this.comparator=R.comparator}this._reset();this.initialize.apply(this,arguments);if(S){this.reset(S,Q.extend({silent:true},R))}};var s={add:true,remove:true,merge:true};var P={add:true,remove:false};Q.extend(c.prototype,O,{model:J,initialize:function(){},toJSON:function(R){return this.map(function(S){return S.toJSON(R)})},sync:function(){return E.sync.apply(this,arguments)},add:function(S,R){return this.set(S,Q.extend({merge:false},R,P))},remove:function(Y,U){var X=!Q.isArray(Y);Y=X?[Y]:Q.clone(Y);U||(U={});var W,R,T,S;for(W=0,R=Y.length;W<R;W++){S=Y[W]=this.get(Y[W]);if(!S){continue}delete this._byId[S.id];delete this._byId[S.cid];T=this.indexOf(S);this.models.splice(T,1);this.length--;if(!U.silent){U.index=T;S.trigger("remove",S,this,U)}this._removeReference(S,U)}return X?Y[0]:Y},set:function(al,S){S=Q.defaults({},S,s);if(S.parse){al=this.parse(al,S)}var W=!Q.isArray(al);al=W?(al?[al]:[]):Q.clone(al);var ah,af,ab,T,ad,aa,ak;var Y=S.at;var aj=this.model;var R=this.comparator&&(Y==null)&&S.sort!==false;var ai=Q.isString(this.comparator)?this.comparator:null;var an=[],ae=[],ac={};var Z=S.add,U=S.merge,am=S.remove;var ag=!R&&Z&&am?[]:false;for(ah=0,af=al.length;ah<af;ah++){ad=al[ah]||{};if(ad instanceof J){ab=T=ad}else{ab=ad[aj.prototype.idAttribute||"id"]}if(aa=this.get(ab)){if(am){ac[aa.cid]=true}if(U){ad=ad===T?T.attributes:ad;if(S.parse){ad=aa.parse(ad,S)}aa.set(ad,S);if(R&&!ak&&aa.hasChanged(ai)){ak=true}}al[ah]=aa}else{if(Z){T=al[ah]=this._prepareModel(ad,S);if(!T){continue}an.push(T);this._addReference(T,S)}}T=aa||T;if(ag&&(T.isNew()||!ac[T.id])){ag.push(T)}ac[T.id]=true}if(am){for(ah=0,af=this.length;ah<af;++ah){if(!ac[(T=this.models[ah]).cid]){ae.push(T)}}if(ae.length){this.remove(ae,S)}}if(an.length||(ag&&ag.length)){if(R){ak=true}this.length+=an.length;if(Y!=null){for(ah=0,af=an.length;ah<af;ah++){this.models.splice(Y+ah,0,an[ah])}}else{if(ag){this.models.length=0}var X=ag||an;for(ah=0,af=X.length;ah<af;ah++){this.models.push(X[ah])}}}if(ak){this.sort({silent:true})}if(!S.silent){for(ah=0,af=an.length;ah<af;ah++){(T=an[ah]).trigger("add",T,this,S)}if(ak||(ag&&ag.length)){this.trigger("sort",this,S)}}return W?al[0]:al},reset:function(U,S){S||(S={});for(var T=0,R=this.models.length;T<R;T++){this._removeReference(this.models[T],S)}S.previousModels=this.models;this._reset();U=this.add(U,Q.extend({silent:true},S));if(!S.silent){this.trigger("reset",this,S)}return U},push:function(S,R){return this.add(S,Q.extend({at:this.length},R))},pop:function(S){var R=this.at(this.length-1);this.remove(R,S);return R},unshift:function(S,R){return this.add(S,Q.extend({at:0},R))},shift:function(S){var R=this.at(0);this.remove(R,S);return R},slice:function(){return r.apply(this.models,arguments)},get:function(R){if(R==null){return void 0}return this._byId[R]||this._byId[R.id]||this._byId[R.cid]},at:function(R){return this.models[R]},where:function(R,S){if(Q.isEmpty(R)){return S?void 0:[]}return this[S?"find":"filter"](function(T){for(var U in R){if(R[U]!==T.get(U)){return false}}return true})},findWhere:function(R){return this.where(R,true)},sort:function(R){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}R||(R={});if(Q.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(Q.bind(this.comparator,this))}if(!R.silent){this.trigger("sort",this,R)}return this},pluck:function(R){return Q.invoke(this.models,"get",R)},fetch:function(R){R=R?Q.clone(R):{};if(R.parse===void 0){R.parse=true}var T=R.success;var S=this;R.success=function(U){var W=R.reset?"reset":"set";S[W](U,R);if(T){T(S,U,R)}S.trigger("sync",S,U,R)};M(this,R);return this.sync("read",this,R)},create:function(S,R){R=R?Q.clone(R):{};if(!(S=this._prepareModel(S,R))){return false}if(!R.wait){this.add(S,R)}var U=this;var T=R.success;R.success=function(W,X){if(R.wait){U.add(W,R)}if(T){T(W,X,R)}};S.save(null,R);return S},parse:function(S,R){return S},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(T,S){if(T instanceof J){return T}S=S?Q.clone(S):{};S.collection=this;var R=new this.model(T,S);if(!R.validationError){return R}this.trigger("invalid",this,R.validationError,S);return false},_addReference:function(S,R){this._byId[S.cid]=S;if(S.id!=null){this._byId[S.id]=S}if(!S.collection){S.collection=this}S.on("all",this._onModelEvent,this)},_removeReference:function(S,R){if(this===S.collection){delete S.collection}S.off("all",this._onModelEvent,this)},_onModelEvent:function(T,S,U,R){if((T==="add"||T==="remove")&&U!==this){return}if(T==="destroy"){this.remove(S,R)}if(S&&T==="change:"+S.idAttribute){delete this._byId[S.previous(S.idAttribute)];if(S.id!=null){this._byId[S.id]=S}}this.trigger.apply(this,arguments)}});var D=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];Q.each(D,function(R){c.prototype[R]=function(){var S=r.call(arguments);S.unshift(this.models);return Q[R].apply(Q,S)}});var o=["groupBy","countBy","sortBy","indexBy"];Q.each(o,function(R){c.prototype[R]=function(U,S){var T=Q.isFunction(U)?U:function(W){return W.get(U)};return Q[R](this.models,T,S)}});var L=E.View=function(R){this.cid=Q.uniqueId("view");R||(R={});Q.extend(this,Q.pick(R,f));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var z=/^(\S+)\s*(.*)$/;var f=["model","collection","el","id","attributes","className","tagName","events"];Q.extend(L.prototype,O,{tagName:"div",$:function(R){return this.$el.find(R)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(R,S){if(this.$el){this.undelegateEvents()}this.$el=R instanceof E.$?R:E.$(R);this.el=this.$el[0];if(S!==false){this.delegateEvents()}return this},delegateEvents:function(W){if(!(W||(W=Q.result(this,"events")))){return this}this.undelegateEvents();for(var U in W){var X=W[U];if(!Q.isFunction(X)){X=this[W[U]]}if(!X){continue}var T=U.match(z);var S=T[1],R=T[2];X=Q.bind(X,this);S+=".delegateEvents"+this.cid;if(R===""){this.$el.on(S,X)}else{this.$el.on(S,R,X)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var R=Q.extend({},Q.result(this,"attributes"));if(this.id){R.id=Q.result(this,"id")}if(this.className){R["class"]=Q.result(this,"className")}var S=E.$("<"+Q.result(this,"tagName")+">").attr(R);this.setElement(S,false)}else{this.setElement(Q.result(this,"el"),false)}}});E.sync=function(Y,S,R){var U=n[Y];Q.defaults(R||(R={}),{emulateHTTP:E.emulateHTTP,emulateJSON:E.emulateJSON});var X={type:U,dataType:"json"};if(!R.url){X.url=Q.result(S,"url")||v()}if(R.data==null&&S&&(Y==="create"||Y==="update"||Y==="patch")){X.contentType="application/json";X.data=JSON.stringify(R.attrs||S.toJSON(R))}if(R.emulateJSON){X.contentType="application/x-www-form-urlencoded";X.data=X.data?{model:X.data}:{}}if(R.emulateHTTP&&(U==="PUT"||U==="DELETE"||U==="PATCH")){X.type="POST";if(R.emulateJSON){X.data._method=U}var T=R.beforeSend;R.beforeSend=function(Z){Z.setRequestHeader("X-HTTP-Method-Override",U);if(T){return T.apply(this,arguments)}}}if(X.type!=="GET"&&!R.emulateJSON){X.processData=false}if(X.type==="PATCH"&&m){X.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var W=R.xhr=E.ajax(Q.extend(X,R));S.trigger("request",S,W,R);return W};var m=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var n={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};E.ajax=function(){return E.$.ajax.apply(E.$,arguments)};var t=E.Router=function(R){R||(R={});if(R.routes){this.routes=R.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var u=/\((.*?)\)/g;var w=/(\(\?)?:\w+/g;var d=/\*\w+/g;var k=/[\-{}\[\]+?.,\\\^$|#\s]/g;Q.extend(t.prototype,O,{initialize:function(){},route:function(S,T,U){if(!Q.isRegExp(S)){S=this._routeToRegExp(S)}if(Q.isFunction(T)){U=T;T=""}if(!U){U=this[T]}var R=this;E.history.route(S,function(X){var W=R._extractParameters(S,X);R.execute(U,W);R.trigger.apply(R,["route:"+T].concat(W));R.trigger("route",T,W);E.history.trigger("route",R,T,W)});return this},execute:function(S,R){if(S){S.apply(this,R)}},navigate:function(S,R){E.history.navigate(S,R);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=Q.result(this,"routes");var S,R=Q.keys(this.routes);while((S=R.pop())!=null){this.route(S,this.routes[S])}},_routeToRegExp:function(R){R=R.replace(k,"\\$&").replace(u,"(?:$1)?").replace(w,function(T,S){return S?T:"([^/?]+)"}).replace(d,"([^?]*?)");return new RegExp("^"+R+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(R,S){var T=R.exec(S).slice(1);return Q.map(T,function(W,U){if(U===T.length-1){return W||null}return W?decodeURIComponent(W):null})}});var l=E.History=function(){this.handlers=[];Q.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var F=/^[#\/]|\s+$/g;var h=/^\/+|\/+$/g;var N=/msie [\w.]+/;var q=/\/$/;var K=/#.*$/;l.started=false;Q.extend(l.prototype,O,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(S){var R=(S||this).location.href.match(/#(.*)$/);return R?R[1]:""},getFragment:function(T,S){if(T==null){if(this._hasPushState||!this._wantsHashChange||S){T=decodeURI(this.location.pathname+this.location.search);var R=this.root.replace(q,"");if(!T.indexOf(R)){T=T.slice(R.length)}}else{T=this.getHash()}}return T.replace(F,"")},start:function(T){if(l.started){throw new Error("Backbone.history has already been started")}l.started=true;this.options=Q.extend({root:"/"},this.options,T);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var S=this.getFragment();var R=document.documentMode;var U=(N.exec(navigator.userAgent.toLowerCase())&&(!R||R<=7));this.root=("/"+this.root+"/").replace(h,"/");if(U&&this._wantsHashChange){var X=E.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=X.hide().appendTo("body")[0].contentWindow;this.navigate(S)}if(this._hasPushState){E.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!U){E.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=S;var W=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else{if(this._hasPushState&&this.atRoot()&&W.hash){this.fragment=this.getHash().replace(F,"");this.history.replaceState({},document.title,this.root+this.fragment)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){E.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}l.started=false},route:function(R,S){this.handlers.unshift({route:R,callback:S})},checkUrl:function(S){var R=this.getFragment();if(R===this.fragment&&this.iframe){R=this.getFragment(this.getHash(this.iframe))}if(R===this.fragment){return false}if(this.iframe){this.navigate(R)}this.loadUrl()},loadUrl:function(R){R=this.fragment=this.getFragment(R);return Q.any(this.handlers,function(S){if(S.route.test(R)){S.callback(R);return true}})},navigate:function(T,S){if(!l.started){return false}if(!S||S===true){S={trigger:!!S}}var R=this.root+(T=this.getFragment(T||""));T=T.replace(K,"");if(this.fragment===T){return}this.fragment=T;if(T===""&&R!=="/"){R=R.slice(0,-1)}if(this._hasPushState){this.history[S.replace?"replaceState":"pushState"]({},document.title,R)}else{if(this._wantsHashChange){this._updateHash(this.location,T,S.replace);if(this.iframe&&(T!==this.getFragment(this.getHash(this.iframe)))){if(!S.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,T,S.replace)}}else{return this.location.assign(R)}}if(S.trigger){return this.loadUrl(T)}},_updateHash:function(R,T,U){if(U){var S=R.href.replace(/(javascript:|#).*$/,"");R.replace(S+"#"+T)}else{R.hash="#"+T}}});E.history=new l;var p=function(R,T){var S=this;var W;if(R&&Q.has(R,"constructor")){W=R.constructor}else{W=function(){return S.apply(this,arguments)}}Q.extend(W,S,T);var U=function(){this.constructor=W};U.prototype=S.prototype;W.prototype=new U;if(R){Q.extend(W.prototype,R)}W.__super__=S.prototype;return W};J.extend=c.extend=t.extend=L.extend=l.extend=p;var v=function(){throw new Error('A "url" property or function must be specified')};var M=function(T,S){var R=S.error;S.error=function(U){if(R){R(T,U,S)}T.trigger("error",T,U,S)}};return E}));(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{a.Vectorizer=a.V=b()}}(this,function(){var k=!!(window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));var o={xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var r="1.1";var h=0;function n(){var s=++h+"";return"v-"+s}function l(t){var s='<svg xmlns="'+o.xmlns+'" xmlns:xlink="'+o.xlink+'" version="'+r+'">'+(t||"")+"</svg>";var u=new DOMParser();u.async=false;return u.parseFromString(s,"text/xml").documentElement}function f(u,A,v){if(!u){return undefined}if(typeof u==="object"){return new m(u)}A=A||{};if(u.toLowerCase()==="svg"){return new m(l())}else{if(u[0]==="<"){var B=l(u);if(B.childNodes.length>1){var y=[];for(var w=0,x=B.childNodes.length;w<x;w++){var s=B.childNodes[w];y.push(new m(document.importNode(s,true)))}return y}return new m(document.importNode(B.firstChild,true))}}u=document.createElementNS(o.xmlns,u);for(var z in A){b(u,z,A[z])}if(Object.prototype.toString.call(v)!="[object Array]"){v=[v]}var w=0,x=(v[0]&&v.length)||0,t;for(;w<x;w++){t=v[w];u.appendChild(t instanceof m?t.node:t)}return new m(u)}function b(u,t,v){if(t.indexOf(":")>-1){var s=t.split(":");u.setAttributeNS(o[s[0]],s[1],v)}else{if(t==="id"){u.id=v}else{u.setAttribute(t,v)}}}function q(s){var t,w,u;if(s){var x=/[ ,]+/;var A=s.match(/translate\((.*)\)/);if(A){t=A[1].split(x)}var y=s.match(/rotate\((.*)\)/);if(y){w=y[1].split(x)}var v=s.match(/scale\((.*)\)/);if(v){u=v[1].split(x)}}var z=(u&&u[0])?parseFloat(u[0]):1;return{translate:{tx:(t&&t[0])?parseInt(t[0],10):0,ty:(t&&t[1])?parseInt(t[1],10):0},rotate:{angle:(w&&w[0])?parseInt(w[0],10):0,cx:(w&&w[1])?parseInt(w[1],10):undefined,cy:(w&&w[2])?parseInt(w[2],10):undefined},scale:{sx:z,sy:(u&&u[1])?parseFloat(u[1]):z}}}function p(v,s){var u=s.x*v.a+s.y*v.c+0;var t=s.x*v.b+s.y*v.d+0;return{x:u,y:t}}function a(s){var w=p(s,{x:0,y:1});var u=p(s,{x:1,y:0});var v=((180/Math.PI)*Math.atan2(w.y,w.x)-90);var t=((180/Math.PI)*Math.atan2(u.y,u.x));return{translateX:s.e,translateY:s.f,scaleX:Math.sqrt(s.a*s.a+s.b*s.b),scaleY:Math.sqrt(s.c*s.c+s.d*s.d),skewX:v,skewY:t,rotation:v}}function m(s){this.node=s;if(!this.node.id){this.node.id=n()}}m.prototype={translate:function(u,s,y){y=y||{};s=s||0;var t=this.attr("transform")||"",v=q(t);if(typeof u==="undefined"){return v.translate}t=t.replace(/translate\([^\)]*\)/g,"").trim();var z=y.absolute?u:v.translate.tx+u,x=y.absolute?s:v.translate.ty+s,w="translate("+z+","+x+")";this.attr("transform",(w+" "+t).trim());return this},rotate:function(w,x,v,s){s=s||{};var u=this.attr("transform")||"",t=q(u);if(typeof w==="undefined"){return t.rotate}u=u.replace(/rotate\([^\)]*\)/g,"").trim();w%=360;var z=s.absolute?w:t.rotate.angle+w,A=(x!==undefined&&v!==undefined)?","+x+","+v:"",y="rotate("+z+A+")";this.attr("transform",(u+" "+y).trim());return this},scale:function(w,u){u=(typeof u==="undefined")?w:u;var s=this.attr("transform")||"",t=q(s);if(typeof w==="undefined"){return t.scale}s=s.replace(/scale\([^\)]*\)/g,"").trim();var v="scale("+w+","+u+")";this.attr("transform",(s+" "+v).trim());return this},bbox:function(u,w){if(!this.node.ownerSVGElement){return{x:0,y:0,width:0,height:0}}var t;try{t=this.node.getBBox();t={x:t.x|0,y:t.y|0,width:t.width|0,height:t.height|0}}catch(v){t={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(u){return t}if(!this.node.getTransformToElement){SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(x){return x.getScreenCTM().inverse().multiply(this.getScreenCTM())}}var s=this.node.getTransformToElement(w||this.node.ownerSVGElement);return c.transformRect(t,s)},text:function(x,t){t=t||{};var B=x.split("\n");var w=0;var z;this.attr("y","0.8em");this.attr("display",x?null:"none");this.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");this.node.textContent="";var u=this.node;if(t.textPath){var v=this.find("defs");if(v.length===0){v=f("defs");this.append(v)}var y=Object(t.textPath)===t.textPath?t.textPath.d:t.textPath;if(y){var A=f("path",{d:y});v.append(A)}var s=f("textPath");if(!t.textPath["xlink:href"]&&A){s.attr("xlink:href","#"+A.node.id)}if(Object(t.textPath)===t.textPath){s.attr(t.textPath)}this.append(s);u=s.node}if(B.length===1){u.textContent=x;return this}for(;w<B.length;w++){z=c("tspan",{dy:(w==0?"0em":t.lineHeight||"1em"),x:this.attr("x")||0});z.addClass("line");if(!B[w]){z.addClass("empty-line")}z.node.textContent=B[w]||" ";c(u).append(z)}return this},attr:function(s,u){if(typeof s==="string"&&typeof u==="undefined"){return this.node.getAttribute(s)}if(typeof s==="object"){for(var t in s){if(s.hasOwnProperty(t)){b(this.node,t,s[t])}}}else{b(this.node,s,u)}return this},remove:function(){if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}},append:function(v){var u=v;if(Object.prototype.toString.call(v)!=="[object Array]"){u=[v]}for(var t=0,s=u.length;t<s;t++){v=u[t];this.node.appendChild(v instanceof m?v.node:v)}return this},prepend:function(s){this.node.insertBefore(s instanceof m?s.node:s,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:c(this.node.ownerSVGElement)},defs:function(){var s=this.svg().node.getElementsByTagName("defs");return(s&&s.length)?c(s[0]):undefined},clone:function(){var s=c(this.node.cloneNode(true));s.node.id=n();return s},findOne:function(s){var t=this.node.querySelector(s);return t?c(t):undefined},find:function(t){var u=this.node.querySelectorAll(t);for(var v=0,s=u.length;v<s;v++){u[v]=c(u[v])}return u},toLocalPoint:function(t,A){var u=this.svg().node;var z=u.createSVGPoint();z.x=t;z.y=A;try{var w=z.matrixTransform(u.getScreenCTM().inverse());var s=this.node.getTransformToElement(u).inverse()}catch(v){return z}return w.matrixTransform(s)},translateCenterToPoint:function(t){var u=this.bbox();var s=g.rect(u).center();this.translate(t.x-s.x,t.y-s.y)},translateAndAutoOrient:function(B,x,C){var G=this.scale();this.attr("transform","");this.scale(G.sx,G.sy);var A=this.svg().node;var E=this.bbox(false,C);var z=A.createSVGTransform();z.setTranslate(-E.x-E.width/2,-E.y-E.height/2);var v=A.createSVGTransform();var w=g.point(B).changeInAngle(B.x-x.x,B.y-x.y,x);v.setRotate(w,0,0);var D=A.createSVGTransform();var F=g.point(B).move(x,E.width/2);D.setTranslate(B.x+(B.x-F.x),B.y+(B.y-F.y));var y=this.node.getTransformToElement(C);var u=A.createSVGTransform();u.setMatrix(D.matrix.multiply(v.matrix.multiply(z.matrix.multiply(y))));var t=a(u.matrix);this.translate(t.translateX,t.translateY);this.rotate(t.rotation);return this},animateAlongPath:function(C,D){var y=c("animateMotion",C);var w=c("mpath",{"xlink:href":"#"+c(D).node.id});y.append(w);this.append(y);try{y.node.beginElement()}catch(B){if(document.documentElement.getAttribute("smiling")==="fake"){var u=y.node;u.animators=[];var t=u.getAttribute("id");if(t){id2anim[t]=u}var z=getTargets(u);for(var v=0,x=z.length;v<x;v++){var A=z[v];var s=new Animator(u,A,v);animators.push(s);u.animators[v]=s;s.register()}}}},hasClass:function(s){return new RegExp("(\\s|^)"+s+"(\\s|$)").test(this.node.getAttribute("class"))},addClass:function(t){if(!this.hasClass(t)){var s=this.node.getAttribute("class")||"";this.node.setAttribute("class",(s+" "+t).trim())}return this},removeClass:function(s){if(this.hasClass(s)){var t=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+s+"(\\s|$)","g"),"$2");this.node.setAttribute("class",t)}return this},toggleClass:function(u,s){var t=typeof s==="undefined"?this.hasClass(u):!s;if(t){this.removeClass(u)}else{this.addClass(u)}return this}};function d(w){var v=w.rx||w["top-rx"]||0;var u=w.rx||w["bottom-rx"]||0;var t=w.ry||w["top-ry"]||0;var s=w.ry||w["bottom-ry"]||0;return["M",w.x,w.y+t,"v",w.height-t-s,"a",u,s,0,0,0,u,s,"h",w.width-2*u,"a",u,s,0,0,0,u,-s,"v",-(w.height-s-t),"a",v,t,0,0,0,-v,-t,"h",-(w.width-2*v),"a",v,t,0,0,0,-v,t].join(" ")}var c=f;c.decomposeMatrix=a;c.rectToPath=d;var j=c("svg").node;c.createSVGMatrix=function(s){var u=j.createSVGMatrix();for(var t in s){u[t]=s[t]}return u};c.createSVGTransform=function(){return j.createSVGTransform()};c.createSVGPoint=function(s,u){var t=j.createSVGPoint();t.x=s;t.y=u;return t};c.transformRect=function(t,C){var v=j.createSVGPoint();v.x=t.x;v.y=t.y;var B=v.matrixTransform(C);v.x=t.x+t.width;v.y=t.y;var z=v.matrixTransform(C);v.x=t.x+t.width;v.y=t.y+t.height;var y=v.matrixTransform(C);v.x=t.x;v.y=t.y+t.height;var w=v.matrixTransform(C);var A=Math.min(B.x,z.x,y.x,w.x);var u=Math.max(B.x,z.x,y.x,w.x);var x=Math.min(B.y,z.y,y.y,w.y);var s=Math.max(B.y,z.y,y.y,w.y);return{x:A,y:x,width:u-A,height:s-x}};return c}));(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.g=b()}}}(this,function(){var h=Math;var p=h.abs;var d=h.cos;var a=h.sin;var z=h.sqrt;var x=h.min;var A=h.max;var j=h.atan;var f=h.atan2;var o=h.acos;var u=h.round;var t=h.floor;var r=h.PI;var b=h.random;var v=function(B){return(180*B/r)%360};var k=function(B,C){C=C||false;B=C?B:(B%360);return B*r/180};var q=function(C,B){return B*Math.round(C/B)};var n=function(B){return(B%360)+(B<0?360:0)};function s(B,D){if(!(this instanceof s)){return new s(B,D)}var C;if(D===undefined&&Object(B)!==B){C=B.split(B.indexOf("@")===-1?" ":"@");this.x=parseInt(C[0],10);this.y=parseInt(C[1],10)}else{if(Object(B)===B){this.x=B.x;this.y=B.y}else{this.x=B;this.y=D}}}s.prototype={toString:function(){return this.x+"@"+this.y},adhereToRect:function(B){if(B.containsPoint(this)){return this}this.x=x(A(this.x,B.x),B.x+B.width);this.y=x(A(this.y,B.y),B.y+B.height);return this},theta:function(E){E=s(E);var F=-(E.y-this.y);var C=E.x-this.x;var D=10;var B=(F.toFixed(D)==0&&C.toFixed(D)==0)?0:f(F,C);if(B<0){B=2*r+B}return 180*B/r},distance:function(B){return l(this,B).length()},manhattanDistance:function(B){return p(B.x-this.x)+p(B.y-this.y)},offset:function(C,B){this.x+=C||0;this.y+=B||0;return this},magnitude:function(){return z((this.x*this.x)+(this.y*this.y))||0.01},update:function(B,C){this.x=B||0;this.y=C||0;return this},round:function(B){this.x=B?this.x.toFixed(B):u(this.x);this.y=B?this.y.toFixed(B):u(this.y);return this},normalize:function(B){var C=(B||1)/this.magnitude();this.x=C*this.x;this.y=C*this.y;return this},difference:function(B){return s(this.x-B.x,this.y-B.y)},bearing:function(B){return l(this,B).bearing()},toPolar:function(C){C=(C&&s(C))||s(0,0);var B=this.x;var D=this.y;this.x=z((B-C.x)*(B-C.x)+(D-C.y)*(D-C.y));this.y=k(C.theta(s(B,D)));return this},rotate:function(D,C){C=(C+360)%360;this.toPolar(D);this.y+=k(C);var B=s.fromPolar(this.x,this.y,D);this.x=B.x;this.y=B.y;return this},move:function(C,D){var B=k(s(C).theta(this));return this.offset(d(B)*D,-a(B)*D)},changeInAngle:function(C,B,D){return s(this).offset(-C,-B).theta(D)-this.theta(D)},equals:function(B){return this.x===B.x&&this.y===B.y},snapToGrid:function(C,B){this.x=q(this.x,C);this.y=q(this.y,B||C);return this},reflection:function(B){return s(B).move(this,this.distance(B))}};s.fromPolar=function(D,F,E){E=(E&&s(E))||s(0,0);var B=p(D*d(F));var G=p(D*a(F));var C=n(v(F));if(C<90){G=-G}else{if(C<180){B=-B;G=-G}else{if(C<270){B=-B}}}return s(E.x+B,E.y+G)};s.random=function(C,B,E,D){return s(t(b()*(B-C+1)+C),t(b()*(D-E+1)+E))};function l(C,B){if(!(this instanceof l)){return new l(C,B)}this.start=s(C);this.end=s(B)}l.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return z(this.squaredLength())},squaredLength:function(){var C=this.start.x;var E=this.start.y;var B=this.end.x;var D=this.end.y;return(C-=B)*C+(E-=D)*E},midpoint:function(){return s((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(B){var H=s(this.end.x-this.start.x,this.end.y-this.start.y);var E=s(B.end.x-B.start.x,B.end.y-B.start.y);var C=(H.x*E.y)-(H.y*E.x);var D=s(B.start.x-this.start.x,B.start.y-this.start.y);var G=(D.x*E.y)-(D.y*E.x);var F=(D.x*H.y)-(D.y*H.x);if(C===0||G*C<0||F*C<0){return null}if(C>0){if(G>C||F>C){return null}}else{if(G<C||F<C){return null}}return s(this.start.x+(G*H.x/C),this.start.y+(G*H.y/C))},bearing:function(){var D=k(this.start.y);var C=k(this.end.y);var H=this.start.x;var F=this.end.x;var B=k(F-H);var J=a(B)*d(C);var K=d(D)*a(C)-a(D)*d(C)*d(B);var E=v(f(J,K));var I=["NE","E","SE","S","SW","W","NW","N"];var G=E-22.5;if(G<0){G+=360}G=parseInt(G/45);return I[G]},pointAt:function(C){var B=(1-C)*this.start.x+C*this.end.x;var D=(1-C)*this.start.y+C*this.end.y;return s(B,D)}};function c(B,E,C,D){if(!(this instanceof c)){return new c(B,E,C,D)}if(E===undefined){E=B.y;C=B.width;D=B.height;B=B.x}this.x=B;this.y=E;this.width=C;this.height=D}c.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},origin:function(){return s(this.x,this.y)},corner:function(){return s(this.x+this.width,this.y+this.height)},topRight:function(){return s(this.x+this.width,this.y)},bottomLeft:function(){return s(this.x,this.y+this.height)},center:function(){return s(this.x+this.width/2,this.y+this.height/2)},intersect:function(D){var C=this.origin();var F=this.corner();var B=D.origin();var E=D.corner();if(E.x<=C.x||E.y<=C.y||B.x>=F.x||B.y>=F.y){return false}return true},sideNearestToPoint:function(H){H=s(H);var C=H.x-this.x;var G=(this.x+this.width)-H.x;var E=H.y-this.y;var B=(this.y+this.height)-H.y;var F=C;var D="left";if(G<F){F=G;D="right"}if(E<F){F=E;D="top"}if(B<F){F=B;D="bottom"}return D},containsPoint:function(B){B=s(B);if(B.x>=this.x&&B.x<=this.x+this.width&&B.y>=this.y&&B.y<=this.y+this.height){return true}return false},containsRect:function(B){var J=c(B).normalize();var E=J.width;var L=J.height;var D=J.x;var C=J.y;var K=this.width;var F=this.height;if((K|F|E|L)<0){return false}var I=this.x;var G=this.y;if(D<I||C<G){return false}K+=I;E+=D;if(E<=D){if(K>=I||E>K){return false}}else{if(K>=I&&E>K){return false}}F+=G;L+=C;if(L<=C){if(F>=G||L>F){return false}}else{if(F>=G&&L>F){return false}}return true},pointNearestToPoint:function(C){C=s(C);if(this.containsPoint(C)){var B=this.sideNearestToPoint(C);switch(B){case"right":return s(this.x+this.width,C.y);case"left":return s(this.x,C.y);case"bottom":return s(C.x,this.y+this.height);case"top":return s(C.x,this.y)}}return C.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(G,H){G=s(G);var C=s(this.x+this.width/2,this.y+this.height/2);var B;if(H){G.rotate(C,H)}var F=[l(this.origin(),this.topRight()),l(this.topRight(),this.corner()),l(this.corner(),this.bottomLeft()),l(this.bottomLeft(),this.origin())];var D=l(C,G);for(var E=F.length-1;E>=0;--E){var I=F[E].intersection(D);if(I!==null){B=I;break}}if(B&&H){B.rotate(C,-H)}return B},moveAndExpand:function(B){this.x+=B.x;this.y+=B.y;this.width+=B.width;this.height+=B.height;return this},round:function(B){this.x=B?this.x.toFixed(B):u(this.x);this.y=B?this.y.toFixed(B):u(this.y);this.width=B?this.width.toFixed(B):u(this.width);this.height=B?this.height.toFixed(B):u(this.height);return this},normalize:function(){var E=this.x;var D=this.y;var B=this.width;var C=this.height;if(this.width<0){E=this.x+this.width;B=-this.width}if(this.height<0){D=this.y+this.height;C=-this.height}this.x=E;this.y=D;this.width=B;this.height=C;return this},bbox:function(G){var E=k(G||0);var C=p(a(E));var D=p(d(E));var B=this.width*D+this.height*C;var F=this.width*C+this.height*D;return c(this.x+(this.width-B)/2,this.y+(this.height-F)/2,B,F)}};function w(D,C,B){if(!(this instanceof w)){return new w(D,C,B)}D=s(D);this.x=D.x;this.y=D.y;this.a=C;this.b=B}w.prototype={toString:function(){return s(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return c(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},intersectionWithLineFromCenterToPoint:function(C,E){C=s(C);if(E){C.rotate(s(this.x,this.y),E)}var K=C.x-this.x;var I=C.y-this.y;var L;if(K===0){L=this.bbox().pointNearestToPoint(C);if(E){return L.rotate(s(this.x,this.y),-E)}return L}var D=I/K;var J=D*D;var B=this.a*this.a;var H=this.b*this.b;var G=z(1/((1/B)+(J/H)));G=K<0?-G:G;var F=D*G;L=s(this.x+G,this.y+F);if(E){return L.rotate(s(this.x,this.y),-E)}return L}};var m={curveThroughPoints:function(D){var B=this.getCurveControlPoints(D);var E=["M",D[0].x,D[0].y];for(var C=0;C<B[0].length;C++){E.push("C",B[0][C].x,B[0][C].y,B[1][C].x,B[1][C].y,D[C+1].x,D[C+1].y)}return E},getCurveControlPoints:function(E){var C=[];var I=[];var H=E.length-1;var D;if(H==1){C[0]=s((2*E[0].x+E[1].x)/3,(2*E[0].y+E[1].y)/3);I[0]=s(2*C[0].x-E[0].x,2*C[0].y-E[0].y);return[C,I]}var G=[];for(D=1;D<H-1;D++){G[D]=4*E[D].x+2*E[D+1].x}G[0]=E[0].x+2*E[1].x;G[H-1]=(8*E[H-1].x+E[H].x)/2;var B=this.getFirstControlPoints(G);for(D=1;D<H-1;++D){G[D]=4*E[D].y+2*E[D+1].y}G[0]=E[0].y+2*E[1].y;G[H-1]=(8*E[H-1].y+E[H].y)/2;var F=this.getFirstControlPoints(G);for(D=0;D<H;D++){C.push(s(B[D],F[D]));if(D<H-1){I.push(s(2*E[D+1].x-B[D+1],2*E[D+1].y-F[D+1]))}else{I.push(s((E[H].x+B[H-1])/2,(E[H].y+F[H-1])/2))}}return[C,I]},getFirstControlPoints:function(G){var F=G.length;var C=[];var E=[];var B=2;C[0]=G[0]/B;for(var D=1;D<F;D++){E[D]=1/B;B=(D<F-1?4:3.5)-E[D];C[D]=(G[D]-C[D-1])/B}for(D=1;D<F;D++){C[F-D-1]-=E[F-D]*C[F-D]}return C},getInversionSolver:function(H,G,E,D){var F=arguments;function B(J,I){var L=F[J],K=F[I];return function(O){var N=(J%3?3:1)*(I%3?3:1);var M=O.x*(L.y-K.y)+O.y*(K.x-L.x)+L.x*K.y-L.y*K.x;return N*M}}return function C(N){var J=3*B(2,3)(G);var K=B(1,3)(H)/J;var I=-B(2,3)(H)/J;var M=K*B(3,1)(N)+I*(B(3,0)(N)+B(2,1)(N))+B(2,0)(N);var L=K*B(3,0)(N)+I*B(2,0)(N)+B(1,0)(N);return L/(L-M)}},getCurveDivider:function(F,E,D,C){return function B(I){var H=l(F,E).pointAt(I);var G=l(E,D).pointAt(I);var M=l(D,C).pointAt(I);var L=l(H,G).pointAt(I);var K=l(G,M).pointAt(I);var J=l(L,K).pointAt(I);return[{p0:F,p1:H,p2:L,p3:J},{p0:J,p1:K,p2:M,p3:C}]}}};var y={linear:function(E,B,D){var C=E[1]-E[0];var F=B[1]-B[0];return(((D-E[0])/C)*F+B[0])||0}};return{toDeg:v,toRad:k,snapToGrid:q,normalizeAngle:n,point:s,line:l,rect:c,ellipse:w,bezier:m,scale:y}}));if(typeof exports==="object"){var _=require("lodash")}var joint={version:"0.9.3",dia:{},ui:{},layout:{},shapes:{},format:{},connectors:{},routers:{},util:{hashCode:function(d){var b=0;if(d.length==0){return b}for(var a=0;a<d.length;a++){var f=d.charCodeAt(a);b=((b<<5)-b)+f;b=b&b}return b},getByPath:function(d,c,f){f=f||".";var b=c.split(f);var a;while(b.length){a=b.shift();if(Object(d)===d&&a in d){d=d[a]}else{return undefined}}return d},setByPath:function(h,f,d,j){j=j||".";var c=f.split(j);var k=h;var b=0;if(f.indexOf(j)>-1){for(var a=c.length;b<a-1;b++){k=k[c[b]]||(k[c[b]]={})}k[c[a-1]]=d}else{h[f]=d}return h},unsetByPath:function(d,c,f){f=f||".";var a=c.lastIndexOf(f);if(a>-1){var b=joint.util.getByPath(d,c.substr(0,a),f);if(b){delete b[c.slice(a+1)]}}else{delete d[c]}return d},flattenObject:function(h,k,d){k=k||".";var b={};for(var c in h){if(!h.hasOwnProperty(c)){continue}var a=typeof h[c]==="object";if(a&&d&&d(h[c])){a=false}if(a){var f=this.flattenObject(h[c],k,d);for(var j in f){if(!f.hasOwnProperty(j)){continue}b[c+k+j]=f[j]}}else{b[c]=h[c]}}return b},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})},guid:function(a){this.guid.id=this.guid.id||1;a.id=(a.id===undefined?"j_"+this.guid.id++:a.id);return a.id},mixin:function(){var c=arguments[0];for(var b=1,a=arguments.length;b<a;b++){var d=arguments[b];if((Object(d)!==d)&&!_.isFunction(d)&&(d===null||d===undefined)){continue}_.each(d,function(h,f){if(this.mixin.deep&&(Object(h)===h)){if(!c[f]){c[f]=_.isArray(h)?[]:{}}this.mixin(c[f],h);return}if(c[f]!==h){if(!this.mixin.supplement||!c.hasOwnProperty(f)){c[f]=h}}},this)}return c},supplement:function(){this.mixin.supplement=true;var a=this.mixin.apply(this,arguments);this.mixin.supplement=false;return a},deepMixin:function(){this.mixin.deep=true;var a=this.mixin.apply(this,arguments);this.mixin.deep=false;return a},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=true;var a=this.mixin.apply(this,arguments);this.mixin.deep=this.mixin.supplement=false;return a},normalizeEvent:function(a){return(a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches.length)?a.originalEvent.changedTouches[0]:a},nextFrame:(function(){var c;var a=typeof window!="undefined";if(a){c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}if(!c){var b=0;c=function(j){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var h=setTimeout(function(){j(d+f)},f);b=d+f;return h}}return a?_.bind(c,window):c})(),cancelFrame:(function(){var b;var a=typeof window!="undefined";if(a){b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame}b=b||clearTimeout;return a?_.bind(b,window):b})(),findIntersection:function(c,b){var l=g.rect(V(c).bbox()).moveAndExpand(g.rect(-5,-5,10,10));var a=l.center();var k=g.rect(l).intersectionWithLineFromCenterToPoint(b);if(!k){return undefined}if(!_.contains(["PATH","CIRCLE","ELLIPSE","RECT","POLYGON","LINE","POLYLINE"],c.localName.toUpperCase())){return k}if(!c.isPointInStroke||!c.isPointInFill){return k}var f=k;var d=c.getCTM();var h=V.createSVGPoint(0,0);var j=k.distance(a);while(j>1){k=k.move(a,-1);j=k.distance(a);h.x=k.x;h.y=k.y;h=h.matrixTransform(d.inverse());if(c.isPointInStroke(h)||c.isPointInFill(h)){return f}f=g.point(k)}return undefined},shapePerimeterConnectionPoint:function(f,c,k,b){var j=g.rect(c.getBBox());var d;if(!k){var a=c.$(".scalable")[0];var h=c.$(".rotatable")[0];if(a&&a.firstChild){k=a.firstChild}else{if(h&&h.firstChild){k=h.firstChild}}}if(k){d=joint.util.findIntersection(k,b)}else{d=j.intersectionWithLineFromCenterToPoint(b)}return d||j.center()},breakText:function(j,m,f,b){b=b||{};var s=m.width;var n=m.height;var h=b.svgDocument||V("svg").node;var y=V("<text><tspan></tspan></text>").attr(f||{}).node;var u=y.firstChild;var r=document.createTextNode("");u.appendChild(r);h.appendChild(y);if(!b.svgDocument){document.body.appendChild(h)}var o=j.split(" ");var d=[];var a=[];var q;for(var v=0,t=0,w=o.length;v<w;v++){var x=o[v];r.data=a[t]?a[t]+" "+x:x;if(u.getComputedTextLength()<=s){a[t]=r.data;if(q){d[t++]=true;q=0}}else{if(!a[t]||q){var c=!!q;q=x.length-1;if(c||!q){if(!q){if(!a[t]){a=[];break}o.splice(v,2,x+o[v+1]);w--;d[t++]=true;v--;continue}o[v]=x.substring(0,q);o[v+1]=x.substring(q)+o[v+1]}else{o.splice(v,1,x.substring(0,q),x.substring(q));w++;if(t&&!d[t-1]){t--}}v--;continue}t++;v--}if(typeof n!=="undefined"){var k=k||y.getBBox().height*1.25;if(k*a.length>n){a.splice(Math.floor(n/k));break}}}if(b.svgDocument){h.removeChild(y)}else{document.body.removeChild(h)}return a.join("\n")},imageToDataUri:function(c,d){if(!c||c.substr(0,"data:".length)==="data:"){return setTimeout(function(){d(null,c)},0)}var b=document.createElement("canvas");var a=document.createElement("img");a.onload=function(){var h=b.getContext("2d");b.width=a.width;b.height=a.height;h.drawImage(a,0,0);try{var m=(c.split(".").pop())||"png";var k="image/"+(m==="jpg")?"jpeg":m;var f=b.toDataURL(k)}catch(l){if(/\.svg$/.test(c)){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("GET",c,false);n.send(null);var j=n.responseText;return d(null,"data:image/svg+xml,"+encodeURIComponent(j))}console.error(a.src,"fails to convert",l)}d(null,f)};a.ononerror=function(){d(new Error("Failed to load image."))};a.src=c},timing:{linear:function(a){return a},quad:function(a){return a*a},cubic:function(a){return a*a*a},inout:function(b){if(b<=0){return 0}if(b>=1){return 1}var c=b*b,a=c*b;return 4*(b<0.5?a:3*(b-c)+a-0.75)},exponential:function(a){return Math.pow(2,10*(a-1))},bounce:function(f){for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){var h=(11-6*d-11*f)/4;return -h*h+c*c}}},reverse:function(a){return function(b){return 1-a(1-b)}},reflect:function(a){return function(b){return 0.5*(b<0.5?a(2*b):(2-a(2-2*b)))}},clamp:function(b,c,a){c=c||0;a=a||1;return function(d){var f=b(d);return f<c?c:f>a?a:f}},back:function(a){if(!a){a=1.70158}return function(b){return b*b*((a+1)*b-a)}},elastic:function(a){if(!a){a=1.5}return function(b){return Math.pow(2,10*(b-1))*Math.cos(20*Math.PI*a/3*b)}}},interpolate:{number:function(f,c){var h=c-f;return function(a){return f+h*a}},object:function(d,c){var f=_.keys(d);return function(b){var a,j,h={};for(a=f.length-1;a!=-1;a--){j=f[a];h[j]=d[j]+(c[j]-d[j])*b}return h}},hexColor:function(l,k){var f=parseInt(l.slice(1),16),d=parseInt(k.slice(1),16);var c=f&255,o=(d&255)-c;var n=f&65280,m=(d&65280)-n;var j=f&16711680,h=(d&16711680)-j;return function(p){var s=(c+o*p)&255;var q=(n+m*p)&65280;var a=(j+h*p)&16711680;return"#"+(1<<24|s|q|a).toString(16).slice(1)}},unit:function(m,l){var c=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;var o=c.exec(m),n=c.exec(l);var h=n[1].indexOf("."),j=h>0?n[1].length-h-1:0;var m=+o[1],k=+n[1]-m,q=o[2];return function(a){return(m+k*a).toFixed(j)+q}}},filter:{blur:function(b){var a=_.isFinite(b.x)?b.x:2;return _.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>',{stdDeviation:_.isFinite(b.y)?[a,b.y]:a})},dropShadow:function(b){var a="SVGFEDropShadowElement" in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return _.template(a,{dx:b.dx||0,dy:b.dy||0,opacity:_.isFinite(b.opacity)?b.opacity:1,color:b.color||"black",blur:_.isFinite(b.blur)?b.blur:4})},grayscale:function(a){var b=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>',{a:0.2126+0.7874*(1-b),b:0.7152-0.7152*(1-b),c:0.0722-0.0722*(1-b),d:0.2126-0.2126*(1-b),e:0.7152+0.2848*(1-b),f:0.0722-0.0722*(1-b),g:0.2126-0.2126*(1-b),h:0.0722+0.9278*(1-b)})},sepia:function(a){var b=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>',{a:0.393+0.607*(1-b),b:0.769-0.769*(1-b),c:0.189-0.189*(1-b),d:0.349-0.349*(1-b),e:0.686+0.314*(1-b),f:0.168-0.168*(1-b),g:0.272-0.272*(1-b),h:0.534-0.534*(1-b),i:0.131+0.869*(1-b)})},saturate:function(a){var b=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>',{amount:1-b})},hueRotate:function(a){return _.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>',{angle:a.angle||0})},invert:function(a){var b=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>',{amount:b,amount2:1-b})},brightness:function(a){return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>',{amount:_.isFinite(a.amount)?a.amount:1})},contrast:function(a){var b=_.isFinite(a.amount)?a.amount:1;return _.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>',{amount:b,amount2:0.5-b/2})}},format:{number:function(h,q,u){u=u||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var o=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var j=o.exec(h);var t=j[1]||" ";var v=j[2]||">";var A=j[3]||"";var r=j[4]||"";var a=j[5];var p=+j[6];var C=j[7];var z=j[8];var f=j[9];var E=1;var w="";var b="";var y=false;if(z){z=+z.substring(1)}if(a||t==="0"&&v==="="){a=t="0";v="=";if(C){p-=Math.floor((p-1)/4)}}switch(f){case"n":C=true;f="g";break;case"%":E=100;b="%";f="f";break;case"p":E=100;b="%";f="r";break;case"b":case"o":case"x":case"X":if(r==="#"){w="0"+f.toLowerCase()}case"c":case"d":y=true;z=0;break;case"s":E=-1;f="r";break}if(r==="$"){w=u.currency[0];b=u.currency[1]}if(f=="r"&&!z){f="g"}if(z!=null){if(f=="g"){z=Math.max(1,Math.min(21,z))}else{if(f=="e"||f=="f"){z=Math.max(0,Math.min(20,z))}}}var D=a&&C;if(y&&(q%1)){return""}var s=q<0||q===0&&1/q<0?(q=-q,"-"):A;var l=b;if(E<0){var n=this.prefix(q,z);q=n.scale(q);l=n.symbol+b}else{q*=E}q=this.convert(f,q,z);var x=q.lastIndexOf(".");var k=x<0?q:q.substring(0,x);var c=x<0?"":u.decimal+q.substring(x+1);function B(J){var H=J.length;var G=[];var F=0;var I=u.grouping[0];while(H>0&&I>0){G.push(J.substring(H-=I,H+I));I=u.grouping[F=(F+1)%u.grouping.length]}return G.reverse().join(u.thousands)}if(!a&&C&&u.grouping){k=B(k)}var d=w.length+k.length+c.length+(D?0:s.length);var m=d<p?new Array(d=p-d+1).join(t):"";if(D){k=B(m+k)}s+=w;q=k+c;return(v==="<"?s+q+m:v===">"?m+s+q:v==="^"?m.substring(0,d>>=1)+s+q+m.substring(d):s+(D?q:m+q))+l},string:function(c,j){var l;var h="{";var b=false;var m=[];while((l=c.indexOf(h))!==-1){var a,f,k;a=c.slice(0,l);if(b){f=a.split(":");k=f.shift().split(".");a=j;for(var d=0;d<k.length;d++){a=a[k[d]]}if(f.length){a=this.number(f,a)}}m.push(a);c=c.slice(l+1);h=(b=!b)?"}":"{"}m.push(c);return m.join("")},convert:function(b,c,a){switch(b){case"b":return c.toString(2);case"c":return String.fromCharCode(c);case"o":return c.toString(8);case"x":return c.toString(16);case"X":return c.toString(16).toUpperCase();case"g":return c.toPrecision(a);case"e":return c.toExponential(a);case"f":return c.toFixed(a);case"r":return(c=this.round(c,this.precision(c,a))).toFixed(Math.max(0,Math.min(20,this.precision(c*(1+1e-15),a))));default:return c+""}},round:function(b,a){return a?Math.round(b*(a=Math.pow(10,a)))/a:Math.round(b)},precision:function(b,a){return a-(b?Math.ceil(Math.log(b)/Math.LN10):1)},prefix:function(d,a){var c=_.map(["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],function(j,h){var f=Math.pow(10,abs(8-h)*3);return{scale:h>8?function(k){return k/f}:function(k){return k*f},symbol:j}});var b=0;if(d){if(d<0){d*=-1}if(a){d=this.round(d,this.precision(d,a))}b=1+Math.floor(1e-12+Math.log(d)/Math.LN10);b=Math.max(-24,Math.min(24,Math.floor((b<=0?b+1:b-1)/3)*3))}return c[8+b/3]}}}};if(typeof exports==="object"){module.exports=joint}if(typeof exports==="object"){var joint={dia:{Link:require("./joint.dia.link").Link,Element:require("./joint.dia.element").Element},shapes:require("../plugins/shapes")};var Backbone=require("backbone");var _=require("lodash");var g=require("./geometry")}joint.dia.GraphCells=Backbone.Collection.extend({initialize:function(){this.on("change:z",this.sort,this)},model:function(c,b){if(c.type==="link"){return new joint.dia.Link(c,b)}var d=c.type.split(".")[0];var a=c.type.split(".")[1];if(joint.shapes[d]&&joint.shapes[d][a]){return new joint.shapes[d][a](c,b)}return new joint.dia.Element(c,b)},comparator:function(a){return a.get("z")||0},getConnectedLinks:function(b,c){c=c||{};if(_.isUndefined(c.inbound)&&_.isUndefined(c.outbound)){c.inbound=c.outbound=true}var a=this.filter(function(f){var h=f.get("source");var j=f.get("target");return(h&&h.id===b.id&&c.outbound)||(j&&j.id===b.id&&c.inbound)});if(c.deep){var d=b.getEmbeddedCells({deep:true});_.each(this.difference(a,d),function(f){if(c.outbound){var h=f.get("source");if(h&&h.id&&_.find(d,{id:h.id})){a.push(f);return}}if(c.inbound){var j=f.get("target");if(j&&j.id&&_.find(d,{id:j.id})){a.push(f)}}})}return a},getCommonAncestor:function(){var b=_.map(arguments,function(c){var d=[c.id];var f=c.get("parent");while(f){d.push(f);f=this.get(f).get("parent")}return d},this);b=_.sortBy(b,"length");var a=_.find(b.shift(),function(c){return _.every(b,function(d){return _.contains(d,c)})});return this.get(a)}});joint.dia.Graph=Backbone.Model.extend({initialize:function(a,b){this.set("cells",new joint.dia.GraphCells([],{model:b&&b.cellModel}));this.get("cells").on("all",this.trigger,this);this.get("cells").on("remove",this.removeCell,this)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);a.cells=this.get("cells").toJSON();return a},fromJSON:function(b,a){if(!b.cells){throw new Error("Graph JSON must contain cells array.")}this.set(_.omit(b,"cells"),a);this.resetCells(b.cells,a)},clear:function(a){this.trigger("batch:start");this.get("cells").remove(this.get("cells").models,a);this.trigger("batch:stop")},_prepareCell:function(a){if(a instanceof Backbone.Model&&_.isUndefined(a.get("z"))){a.set("z",this.maxZIndex()+1,{silent:true})}else{if(_.isUndefined(a.z)){a.z=this.maxZIndex()+1}}return a},maxZIndex:function(){var a=this.get("cells").last();return a?(a.get("z")||0):0},addCell:function(a,b){if(_.isArray(a)){return this.addCells(a,b)}this.get("cells").add(this._prepareCell(a),b||{});return this},addCells:function(b,a){a=a||{};a.position=b.length;_.each(b,function(c){a.position--;this.addCell(c,a)},this);return this},resetCells:function(a,b){this.get("cells").reset(_.map(a,this._prepareCell,this),b);return this},removeCell:function(a,c,b){if(b&&b.disconnectLinks){this.disconnectLinks(a,b)}else{this.removeLinks(a,b)}this.get("cells").remove(a,{silent:true})},getCell:function(a){return this.get("cells").get(a)},getElements:function(){return this.get("cells").filter(function(a){return a instanceof joint.dia.Element})},getLinks:function(){return this.get("cells").filter(function(a){return a instanceof joint.dia.Link})},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(a,b){return this.get("cells").getConnectedLinks(a,b)},getNeighbors:function(d){var a=this.getConnectedLinks(d);var c=[];var b=this.get("cells");_.each(a,function(j){var k=j.get("source");var l=j.get("target");if(!k.x){var h=b.get(k.id);if(h!==d){c.push(h)}}if(!l.x){var f=b.get(l.id);if(f!==d){c.push(f)}}});return c},disconnectLinks:function(b,a){_.each(this.getConnectedLinks(b),function(c){c.set(c.get("source").id===b.id?"source":"target",g.point(0,0),a)})},removeLinks:function(b,a){_.invoke(this.getConnectedLinks(b),"remove",a)},findModelsFromPoint:function(a){return _.filter(this.getElements(),function(b){return b.getBBox().containsPoint(a)})},findModelsInArea:function(a){return _.filter(this.getElements(),function(b){return b.getBBox().intersect(a)})},getBBox:function(c){var a={x:Infinity,y:Infinity};var b={x:0,y:0};_.each(c,function(d){var f=d.getBBox();a.x=Math.min(a.x,f.x);a.y=Math.min(a.y,f.y);b.x=Math.max(b.x,f.x+f.width);b.y=Math.max(b.y,f.y+f.height)});return g.rect(a.x,a.y,b.x-a.x,b.y-a.y)},getCommonAncestor:function(){var a=this.get("cells");return a.getCommonAncestor.apply(a,arguments)}});if(typeof exports==="object"){module.exports.Graph=joint.dia.Graph}if(typeof exports==="object"){var joint={util:require("./core").util,dia:{Link:require("./joint.dia.link").Link}};var Backbone=require("backbone");var _=require("lodash")}joint.dia.Cell=Backbone.Model.extend({constructor:function(a,c){var d;var b=a||{};this.cid=_.uniqueId("c");this.attributes={};if(c&&c.collection){this.collection=c.collection}if(c&&c.parse){b=this.parse(b,c)||{}}if(d=_.result(this,"defaults")){b=_.merge({},d,b)}this.set(b,c);this.changed={};this.initialize.apply(this,arguments)},toJSON:function(){var d=this.constructor.prototype.defaults.attrs||{};var b=this.attributes.attrs;var c={};_.each(b,function(h,f){var j=d[f];_.each(h,function(l,k){if(_.isObject(l)&&!_.isArray(l)){_.each(l,function(m,n){if(!j||!j[k]||!_.isEqual(j[k][n],m)){c[f]=c[f]||{};(c[f][k]||(c[f][k]={}))[n]=m}})}else{if(!j||!_.isEqual(j[k],l)){c[f]=c[f]||{};c[f][k]=l}}})});var a=_.cloneDeep(_.omit(this.attributes,"attrs"));a.attrs=c;return a},initialize:function(a){if(!a||!a.id){this.set("id",joint.util.uuid(),{silent:true})}this._transitionIds={};this.processPorts();this.on("change:attrs",this.processPorts,this)},processPorts:function(){var c=this.ports;var f={};_.each(this.get("attrs"),function(j,h){if(j&&j.port){if(!_.isUndefined(j.port.id)){f[j.port.id]=j.port}else{f[j.port]={id:j.port}}}});var d={};_.each(c,function(h,j){if(!f[j]){d[j]=true}});if(this.collection&&!_.isEmpty(d)){var a=this.collection.getConnectedLinks(this,{inbound:true});_.each(a,function(h){if(d[h.get("target").port]){h.remove()}});var b=this.collection.getConnectedLinks(this,{outbound:true});_.each(b,function(h){if(d[h.get("source").port]){h.remove()}})}this.ports=f},remove:function(b){var d=this.collection;if(d){d.trigger("batch:start")}var a=this.get("parent");if(a){var c=this.collection&&this.collection.get(a);c.unembed(this)}_.invoke(this.getEmbeddedCells(),"remove",b);this.trigger("remove",this,this.collection,b);if(d){d.trigger("batch:stop")}return this},toFront:function(b){if(this.collection){b=b||{};var c=(this.collection.last().get("z")||0)+1;this.trigger("batch:start").set("z",c,b);if(b.deep){var a=this.getEmbeddedCells({deep:true,breadthFirst:true});_.each(a,function(d){d.set("z",++c,b)})}this.trigger("batch:stop")}return this},toBack:function(b){if(this.collection){b=b||{};var c=(this.collection.first().get("z")||0)-1;this.trigger("batch:start");if(b.deep){var a=this.getEmbeddedCells({deep:true,breadthFirst:true});_.eachRight(a,function(d){d.set("z",c--,b)})}this.set("z",c,b).trigger("batch:stop")}return this},embed:function(a,b){if(this==a||this.isEmbeddedIn(a)){throw new Error("Recursive embedding not allowed.")}else{this.trigger("batch:start");var c=_.clone(this.get("embeds")||[]);c[a.isLink()?"unshift":"push"](a.id);a.set("parent",this.id,b);this.set("embeds",_.uniq(c),b);this.trigger("batch:stop")}return this},unembed:function(a,b){this.trigger("batch:start");a.unset("parent",b);this.set("embeds",_.without(this.get("embeds"),a.id),b);this.trigger("batch:stop");return this},getEmbeddedCells:function(c){c=c||{};if(this.collection){var b;if(c.deep){if(c.breadthFirst){b=[];var a=this.getEmbeddedCells();while(a.length>0){var d=a.shift();b.push(d);a.push.apply(a,d.getEmbeddedCells())}}else{b=this.getEmbeddedCells();_.each(b,function(f){b.push.apply(b,f.getEmbeddedCells(c))})}}else{b=_.map(this.get("embeds"),this.collection.get,this.collection)}return b}return[]},isEmbeddedIn:function(a,b){var c=_.isString(a)?a:a.id;b=_.defaults({deep:true},b);var d=this.get("parent");if(this.collection&&b.deep){while(d){if(d==c){return true}d=this.collection.get(d).get("parent")}return false}else{return d==c}},clone:function(a){a=a||{};var f=Backbone.Model.prototype.clone.apply(this,arguments);f.set("id",joint.util.uuid(),{silent:true});f.set("embeds","");if(!a.deep){return f}var d=_.sortBy(this.getEmbeddedCells(),function(h){return h instanceof joint.dia.Element});var c=[f];var b={};_.each(d,function(j){var h=j.clone({deep:true});f.embed(h[0]);_.each(h,function(m){if(m instanceof joint.dia.Link){if(m.get("source").id==this.id){m.prop("source",{id:f.id})}if(m.get("target").id==this.id){m.prop("target",{id:f.id})}b[j.id]=m;return}c.push(m);var k=this.collection.getConnectedLinks(j,{inbound:true});_.each(k,function(n){var o=b[n.id]||n.clone();b[n.id]=o;o.prop("target",{id:m.id})});var l=this.collection.getConnectedLinks(j,{outbound:true});_.each(l,function(n){var o=b[n.id]||n.clone();b[n.id]=o;o.prop("source",{id:m.id})})},this)},this);c=c.concat(_.values(b));return c},prop:function(l,m,a){var b="/";if(_.isString(l)){if(typeof m!=="undefined"){var o=l;var c=o.split("/");var n=c[0];a=a||{};a.propertyPath=o;a.propertyValue=m;if(c.length==1){return this.set(n,m,a)}var h={};var k=h;var j=n;_.each(_.rest(c),function(p){k=k[j]=(_.isFinite(Number(p))?[]:{});j=p});h=joint.util.setByPath(h,o,m,"/");var d=_.merge({},this.attributes);a.rewrite&&joint.util.unsetByPath(d,o,"/");var f=_.merge(d,h);return this.set(n,f[n],a)}else{return joint.util.getByPath(this.attributes,l,b)}}return this.set(_.merge({},this.attributes,l),m)},attr:function(a,c,b){if(_.isString(a)){return this.prop("attrs/"+a,c,b)}return this.prop({attrs:a},c)},removeAttr:function(c,b){if(_.isArray(c)){_.each(c,function(d){this.removeAttr(d,b)},this);return this}var a=joint.util.unsetByPath(_.merge({},this.get("attrs")),c,"/");return this.set("attrs",a,_.extend({dirty:true},b))},transition:function(l,k,b,d){d=d||"/";var j={duration:100,delay:10,timingFunction:joint.util.timing.linear,valueFunction:joint.util.interpolate.number};b=_.extend(j,b);var c=0;var a;var h=_.bind(function(p){var q,o,n,m;c=c||p;p-=c;o=p/b.duration;if(o<1){this._transitionIds[l]=q=joint.util.nextFrame(h)}else{o=1;delete this._transitionIds[l]}n=a(b.timingFunction(o));b.transitionId=q;this.prop(l,n,b);if(!q){this.trigger("transition:end",this,l)}},this);var f=_.bind(function(m){this.stopTransitions(l);a=b.valueFunction(joint.util.getByPath(this.attributes,l,d),k);this._transitionIds[l]=joint.util.nextFrame(m);this.trigger("transition:start",this,l)},this);return _.delay(f,b.delay,h)},getTransitions:function(){return _.keys(this._transitionIds)},stopTransitions:function(b,c){c=c||"/";var a=b&&b.split(c);_(this._transitionIds).keys().filter(a&&function(d){return _.isEqual(a,d.split(c).slice(0,a.length))}).each(function(d){joint.util.cancelFrame(this._transitionIds[d]);delete this._transitionIds[d];this.trigger("transition:end",this,d)},this);return this},addTo:function(a){a.addCell(this);return this},findView:function(a){return a.findViewByModel(this)},isLink:function(){return false}});joint.dia.CellView=Backbone.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},constructor:function(a){this._configure(a);Backbone.View.apply(this,arguments)},_configure:function(a){if(this.options){a=_.extend({},_.result(this,"options"),a)}this.options=a;this.options.id=this.options.id||joint.util.guid(this)},initialize:function(){_.bindAll(this,"remove","update");this.$el.data("view",this);this.listenTo(this.model,"remove",this.remove);this.listenTo(this.model,"change:attrs",this.onChangeAttrs)},onChangeAttrs:function(a,b,c){if(c.dirty){return this.render()}return this.update()},_ensureElement:function(){var b;if(!this.el){var a=_.extend({id:this.id},_.result(this,"attributes"));if(this.className){a["class"]=_.result(this,"className")}b=V(_.result(this,"tagName"),a).node}else{b=_.result(this,"el")}this.setElement(b,false)},findBySelector:function(a){var b=a==="."?this.$el:this.$el.find(a);return b},notify:function(a){if(this.paper){var b=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[a].concat(b));this.paper.trigger.apply(this.paper,[a,this].concat(b))}},getStrokeBBox:function(a){var b=!!a;a=a||this.el;var c=V(a).bbox(false,this.paper.viewport);var d;if(b){d=V(a).attr("stroke-width")}else{d=this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width")}d=parseFloat(d)||0;return g.rect(c).moveAndExpand({x:-d/2,y:-d/2,width:d,height:d})},getBBox:function(){return V(this.el).bbox()},highlight:function(b,a){b=!b?this.el:this.$(b)[0]||this.el;a=a||{};a.partial=b!=this.el;this.notify("cell:highlight",b,a);return this},unhighlight:function(b,a){b=!b?this.el:this.$(b)[0]||this.el;a=a||{};a.partial=b!=this.el;this.notify("cell:unhighlight",b,a);return this},findMagnet:function(c){var b=this.$(c);if(b.length===0||b[0]===this.el){var a=this.model.get("attrs")||{};if(a["."]&&a["."]["magnet"]===false){return undefined}return this.el}if(b.attr("magnet")){return b[0]}return this.findMagnet(b.parent())},applyFilter:function(a,d){var c=this.findBySelector(a);var b=d.name+this.paper.svg.id+joint.util.hashCode(JSON.stringify(d));if(!this.paper.svg.getElementById(b)){var h=joint.util.filter[d.name]&&joint.util.filter[d.name](d.args||{});if(!h){throw new Error("Non-existing filter "+d.name)}var f=V(h);f.attr({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3});if(d.attrs){f.attr(d.attrs)}f.node.id=b;V(this.paper.svg).defs().append(f)}c.each(function(){V(this).attr("filter","url(#"+b+")")})},applyGradient:function(b,a,j){var c=this.findBySelector(b);var f=j.type+this.paper.svg.id+joint.util.hashCode(JSON.stringify(j));if(!this.paper.svg.getElementById(f)){var d=["<"+j.type+">",_.map(j.stops,function(k){return'<stop offset="'+k.offset+'" stop-color="'+k.color+'" stop-opacity="'+(_.isFinite(k.opacity)?k.opacity:1)+'" />'}).join(""),"</"+j.type+">"].join("");var h=V(d);if(j.attrs){h.attr(j.attrs)}h.node.id=f;V(this.paper.svg).defs().append(h)}c.each(function(){V(this).attr(a,"url(#"+f+")")})},getSelector:function(c,a){if(c===this.el){return a}var b=$(c).index();a=c.tagName+":nth-child("+(b+1)+") "+(a||"");return this.getSelector($(c).parent()[0],a+" ")},pointerdblclick:function(b,a,c){this.notify("cell:pointerdblclick",b,a,c)},pointerclick:function(b,a,c){this.notify("cell:pointerclick",b,a,c)},pointerdown:function(b,a,c){if(this.model.collection){this.model.trigger("batch:start");this._collection=this.model.collection}this.notify("cell:pointerdown",b,a,c)},pointermove:function(b,a,c){this.notify("cell:pointermove",b,a,c)},pointerup:function(b,a,c){this.notify("cell:pointerup",b,a,c);if(this._collection){this._collection.trigger("batch:stop");delete this._collection}},mouseover:function(a){this.notify("cell:mouseover",a)},mouseout:function(a){this.notify("cell:mouseout",a)}});if(typeof exports==="object"){module.exports.Cell=joint.dia.Cell;module.exports.CellView=joint.dia.CellView}if(typeof exports==="object"){var joint={util:require("./core").util,dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}};var Backbone=require("backbone");var _=require("lodash")}joint.dia.Element=joint.dia.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},position:function(a,j,b){var f=_.isNumber(j);b=(f?b:a)||{};if(b.parentRelative){if(!this.collection){throw new Error("Element must be part of a collection.")}var c=this.collection.get(this.get("parent"));var h=c&&!c.isLink()?c.get("position"):{x:0,y:0}}if(f){if(b.parentRelative){a+=h.x;j+=h.y}return this.set("position",{x:a,y:j},b)}else{var d=g.point(this.get("position"));return b.parentRelative?d.difference(h):d}},translate:function(c,b,f){b=b||0;if(c===0&&b===0){return this}f=f||{};f.translateBy=f.translateBy||this.id;f.tx=c;f.ty=b;var a=this.get("position")||{x:0,y:0};var d={x:a.x+c||0,y:a.y+b||0};if(f.transition){if(!_.isObject(f.transition)){f.transition={}}this.transition("position",d,_.extend({},f.transition,{valueFunction:joint.util.interpolate.object}))}else{this.set("position",d,f);_.invoke(this.getEmbeddedCells(),"translate",c,b,f)}return this},resize:function(b,a){this.trigger("batch:start");this.set("size",{width:b,height:a});this.trigger("batch:stop");return this},rotate:function(j,k,f){if(f){var b=this.getBBox().center();var h=this.get("size");var a=this.get("position");b.rotate(f,(this.get("angle")||0)-j);var d=b.x-h.width/2-a.x;var c=b.y-h.height/2-a.y;this.trigger("batch:start");this.translate(d,c);this.rotate(j,k);this.trigger("batch:stop")}else{this.set("angle",k?j:((this.get("angle")||0)+j)%360)}return this},getBBox:function(){var a=this.get("position");var b=this.get("size");return g.rect(a.x,a.y,b.width,b.height)}});joint.dia.ElementView=joint.dia.CellView.extend({className:function(){return"element "+this.model.get("type").split(".").join(" ")},initialize:function(){_.bindAll(this,"translate","resize","rotate");joint.dia.CellView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:position",this.translate);this.listenTo(this.model,"change:size",this.resize);this.listenTo(this.model,"change:angle",this.rotate)},update:function(a,d){var f=this.model.get("attrs");var j=V(this.$(".rotatable")[0]);if(j){var b=j.attr("transform");j.attr("transform","")}var c=[];_.each(d||f,function(n,k){var m=this.findBySelector(k);if(m.length===0){return}var o=["style","text","html","ref-x","ref-y","ref-dx","ref-dy","ref-width","ref-height","ref","x-alignment","y-alignment","port"];if(_.isObject(n.filter)){o.push("filter");this.applyFilter(k,n.filter)}if(_.isObject(n.fill)){o.push("fill");this.applyGradient(k,"fill",n.fill)}if(_.isObject(n.stroke)){o.push("stroke");this.applyGradient(k,"stroke",n.stroke)}if(!_.isUndefined(n.text)){m.each(function(){V(this).text(n.text+"",{lineHeight:n.lineHeight,textPath:n.textPath})});o.push("lineHeight","textPath")}var l=_.omit(n,o);m.each(function(){V(this).attr(l)});if(n.port){m.attr("port",_.isUndefined(n.port.id)?n.port:n.port.id)}if(n.style){m.css(n.style)}if(!_.isUndefined(n.html)){m.each(function(){$(this).html(n.html+"")})}if(!_.isUndefined(n["ref-x"])||!_.isUndefined(n["ref-y"])||!_.isUndefined(n["ref-dx"])||!_.isUndefined(n["ref-dy"])||!_.isUndefined(n["x-alignment"])||!_.isUndefined(n["y-alignment"])||!_.isUndefined(n["ref-width"])||!_.isUndefined(n["ref-height"])){_.each(m,function(r,p,s){var q=$(r);q.selector=s.selector;c.push(q)})}},this);var h=this.el.getBBox();d=d||{};_.each(c,function(m){var l=d[m.selector];var k=l?_.merge({},f[m.selector],l):f[m.selector];this.positionRelative(m,h,k)},this);if(j){j.attr("transform",b||"")}},positionRelative:function(v,a,m){var f=m.ref;var o=parseFloat(m["ref-x"]);var n=parseFloat(m["ref-y"]);var k=parseFloat(m["ref-dx"]);var j=parseFloat(m["ref-dy"]);var l=m["y-alignment"];var d=m["x-alignment"];var q=parseFloat(m["ref-width"]);var p=parseFloat(m["ref-height"]);var c=_.contains(_.pluck(_.pluck(v.parents("g"),"className"),"baseVal"),"scalable");if(f){a=V(this.findBySelector(f)[0]).bbox(false,this.el)}var h=V(v[0]);if(h.attr("transform")){h.attr("transform",h.attr("transform").replace(/translate\([^)]*\)/g,"").trim()||"")}function b(w){return _.isNumber(w)&&!_.isNaN(w)}var t=0;var s=0;if(b(q)){if(q>=0&&q<=1){h.attr("width",q*a.width)}else{h.attr("width",Math.max(q+a.width,0))}}if(b(p)){if(p>=0&&p<=1){h.attr("height",p*a.height)}else{h.attr("height",Math.max(p+a.height,0))}}if(b(k)){if(c){var u=V(this.$(".scalable")[0]).scale();t=a.x+a.width+k/u.sx}else{t=a.x+a.width+k}}if(b(j)){if(c){var u=V(this.$(".scalable")[0]).scale();s=a.y+a.height+j/u.sy}else{s=a.y+a.height+j}}if(b(o)){if(o>0&&o<1){t=a.x+a.width*o}else{if(c){var u=V(this.$(".scalable")[0]).scale();t=a.x+o/u.sx}else{t=a.x+o}}}if(b(n)){if(n>0&&n<1){s=a.y+a.height*n}else{if(c){var u=V(this.$(".scalable")[0]).scale();s=a.y+n/u.sy}else{s=a.y+n}}}var r=h.bbox(false,this.paper.viewport);if(l==="middle"){s-=r.height/2}else{if(b(l)){s+=(l>-1&&l<1)?r.height*l:l}}if(d==="middle"){t-=r.width/2}else{if(b(d)){t+=(d>-1&&d<1)?r.width*d:d}}h.translate(t,s)},renderMarkup:function(){var b=this.model.markup||this.model.get("markup");if(b){var a=V(b);V(this.el).append(a)}else{throw new Error("properties.markup is missing while the default render() implementation is used.")}},render:function(){this.$el.empty();this.renderMarkup();this.update();this.resize();this.rotate();this.translate();return this},scale:function(b,a){V(this.el).scale(b,a)},resize:function(){var d=this.model.get("size")||{width:1,height:1};var j=this.model.get("angle")||0;var a=V(this.$(".scalable")[0]);if(!a){return}var f=a.bbox(true);a.attr("transform","scale("+(d.width/(f.width||1))+","+(d.height/(f.height||1))+")");var h=V(this.$(".rotatable")[0]);var c=h&&h.attr("transform");if(c&&c!=="null"){h.attr("transform",c+" rotate("+(-j)+","+(d.width/2)+","+(d.height/2)+")");var b=a.bbox(false,this.paper.viewport);this.model.set("position",{x:b.x,y:b.y});this.rotate()}this.update()},translate:function(b,d,c){var a=this.model.get("position")||{x:0,y:0};V(this.el).attr("transform","translate("+a.x+","+a.y+")")},rotate:function(){var f=V(this.$(".rotatable")[0]);if(!f){return}var d=this.model.get("angle")||0;var c=this.model.get("size")||{width:1,height:1};var b=c.width/2;var a=c.height/2;f.attr("transform","rotate("+d+","+b+","+a+")")},getBBox:function(a){if(a&&a.useModelGeometry){var b=this.model.getBBox().bbox(this.model.get("angle"));var c=this.paper.viewport.getCTM();return V.transformRect(b,c)}return joint.dia.CellView.prototype.getBBox.apply(this,arguments)},findParentsByKey:function(a){var b=this.model.getBBox();return a=="bbox"?this.paper.model.findModelsInArea(b):this.paper.model.findModelsFromPoint(b[a]())},prepareEmbedding:function(){this.model.toFront({deep:true,ui:true});_.invoke(this.paper.model.getConnectedLinks(this.model,{deep:true}),"toFront",{ui:true});var a=this.model.get("parent");a&&this.paper.model.getCell(a).unembed(this.model,{ui:true})},processEmbedding:function(c){c=c||this.paper.options;var j=this.findParentsByKey(c.findParentBy);j=_.reject(j,function(k){return this.model.id==k.id||k.isEmbeddedIn(this.model)},this);if(c.frontParentOnly){j=j.slice(-1)}var h=null;var f=this._candidateEmbedView;for(var b=j.length-1;b>=0;b--){var d=j[b];if(f&&f.model.id==d.id){h=f;break}else{var a=d.findView(this.paper);if(c.validateEmbedding.call(this.paper,this,a)){h=a;break}}}if(h&&h!=f){f&&f.unhighlight(null,{embedding:true});this._candidateEmbedView=h.highlight(null,{embedding:true})}if(!h&&f){f.unhighlight(null,{embedding:true});delete this._candidateEmbedView}},finalizeEmbedding:function(){var a=this._candidateEmbedView;if(a){a.model.embed(this.model,{ui:true});a.unhighlight(null,{embedding:true});delete this._candidateEmbedView}_.invoke(this.paper.model.getConnectedLinks(this.model,{deep:true}),"reparent",{ui:true})},pointerdown:function(b,a,d){this.model.trigger("batch:start");if(b.target.getAttribute("magnet")&&this.paper.options.validateMagnet.call(this.paper,this,b.target)){var c=this.paper.getDefaultLink(this,b.target);c.set({source:{id:this.model.id,selector:this.getSelector(b.target),port:$(b.target).attr("port")},target:{x:a,y:d}});this.paper.model.addCell(c);this._linkView=this.paper.findViewByModel(c);this._linkView.startArrowheadMove("target")}else{this._dx=a;this._dy=d;joint.dia.CellView.prototype.pointerdown.apply(this,arguments)}},pointermove:function(c,b,h){if(this._linkView){this._linkView.pointermove(c,b,h)}else{var f=this.paper.options.gridSize;var d=_.isFunction(this.options.interactive)?this.options.interactive(this,"pointermove"):this.options.interactive;if(d!==false){var a=this.model.get("position");this.model.translate(g.snapToGrid(a.x,f)-a.x+g.snapToGrid(b-this._dx,f),g.snapToGrid(a.y,f)-a.y+g.snapToGrid(h-this._dy,f));if(this.paper.options.embeddingMode){if(!this._inProcessOfEmbedding){this.prepareEmbedding();this._inProcessOfEmbedding=true}this.processEmbedding()}}this._dx=g.snapToGrid(b,f);this._dy=g.snapToGrid(h,f);joint.dia.CellView.prototype.pointermove.apply(this,arguments)}},pointerup:function(b,a,c){if(this._linkView){this._linkView.pointerup(b,a,c);delete this._linkView}else{if(this._inProcessOfEmbedding){this.finalizeEmbedding();this._inProcessOfEmbedding=false}joint.dia.CellView.prototype.pointerup.apply(this,arguments)}this.model.trigger("batch:stop")}});if(typeof exports==="object"){module.exports.Element=joint.dia.Element;module.exports.ElementView=joint.dia.ElementView}if(typeof exports==="object"){var joint={dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}};var Backbone=require("backbone");var _=require("lodash");var g=require("./geometry")}joint.dia.Link=joint.dia.Cell.extend({markup:['<path class="connection" stroke="black"/>','<path class="marker-source" fill="black" stroke="black" />','<path class="marker-target" fill="black" stroke="black" />','<path class="connection-wrap"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),labelMarkup:['<g class="label">',"<rect />","<text />","</g>"].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z"/>',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaults:{type:"link",source:{},target:{}},disconnect:function(){return this.set({source:g.point(0,0),target:g.point(0,0)})},label:function(b,c){b=b||0;var f=this.get("labels")||[];if(arguments.length===0||arguments.length===1){return f[b]}var d=_.merge({},f[b],c);var a=f.slice();a[b]=d;return this.set({labels:a})},translate:function(b,a,f){var d={};var h=this.get("source");var j=this.get("target");var c=this.get("vertices");if(!h.id){d.source={x:h.x+b,y:h.y+a}}if(!j.id){d.target={x:j.x+b,y:j.y+a}}if(c&&c.length){d.vertices=_.map(c,function(k){return{x:k.x+b,y:k.y+a}})}return this.set(d,f)},reparent:function(b){var c;if(this.collection){var d=this.collection.get(this.get("source").id);var f=this.collection.get(this.get("target").id);var a=this.collection.get(this.get("parent"));if(d&&f){c=this.collection.getCommonAncestor(d,f)}if(a&&(!c||c.id!=a.id)){a.unembed(this,b)}if(c){c.embed(this,b)}}return c},isLink:function(){return true},hasLoop:function(){var b=this.get("source").id;var a=this.get("target").id;return b&&a&&b==a}});joint.dia.LinkView=joint.dia.CellView.extend({className:function(){return _.unique(this.model.get("type").split(".").concat("link")).join(" ")},options:{shortLinkLength:100,doubleLinkTools:false,longLinkLength:160,linkToolsOffset:40,doubleLinkToolsOffset:60},initialize:function(a){joint.dia.CellView.prototype.initialize.apply(this,arguments);if(typeof this.constructor.prototype.watchSource!=="function"){this.constructor.prototype.watchSource=this.createWatcher("source");this.constructor.prototype.watchTarget=this.createWatcher("target")}this._labelCache={};this._markerCache={};this.startListening()},startListening:function(){this.listenTo(this.model,"change:markup",this.render);this.listenTo(this.model,"change:smooth change:manhattan change:router change:connector",this.update);this.listenTo(this.model,"change:toolMarkup",function(){this.renderTools().updateToolsPosition()});this.listenTo(this.model,"change:labels change:labelMarkup",function(){this.renderLabels().updateLabelPositions()});this.listenTo(this.model,"change:vertices change:vertexMarkup",function(a,c,b){this.renderVertexMarkers();if(!b.translateBy||(b.translateBy==this.model.id||this.model.hasLoop())){this.update()}});this.listenTo(this.model,"change:source",function(a,b){this.watchSource(a,b).update()});this.listenTo(this.model,"change:target",function(a,b){this.watchTarget(a,b).update()})},render:function(){this.$el.empty();var a=V(this.model.get("markup")||this.model.markup);if(!_.isArray(a)){a=[a]}this._V={};_.each(a,function(d){var b=d.attr("class");b&&(this._V[$.camelCase(b)]=d)},this);if(!this._V.connection){throw new Error("link: no connection path in the markup")}this.renderTools();this.renderVertexMarkers();this.renderArrowheadMarkers();V(this.el).append(a);this.renderLabels();this.watchSource(this.model,this.model.get("source")).watchTarget(this.model,this.model.get("target")).update();return this},renderLabels:function(){if(!this._V.labels){return this}this._labelCache={};var a=$(this._V.labels.node).empty();var d=this.model.get("labels")||[];if(!d.length){return this}var b=_.template(this.model.get("labelMarkup")||this.model.labelMarkup);var c=V(b());_.each(d,function(l,f){var k=c.clone().node;this._labelCache[f]=V(k);var m=$(k).find("text");var j=$(k).find("rect");var n=_.extend({"text-anchor":"middle","font-size":14},joint.util.getByPath(l,"attrs/text","/"));m.attr(_.omit(n,"text"));if(!_.isUndefined(n.text)){V(m[0]).text(n.text+"")}a.append(k);var h=V(m[0]).bbox(true,a[0]);V(m[0]).translate(0,-h.height/2);var o=_.extend({fill:"white",rx:3,ry:3},joint.util.getByPath(l,"attrs/rect","/"));j.attr(_.extend(o,{x:h.x,y:h.y-h.height/2,width:h.width,height:h.height}))},this);return this},renderTools:function(){if(!this._V.linkTools){return this}var c=$(this._V.linkTools.node).empty();var a=_.template(this.model.get("toolMarkup")||this.model.toolMarkup);var b=V(a());c.append(b.node);this._toolCache=b;if(this.options.doubleLinkTools){var d=b.clone();c.append(d.node);this._tool2Cache=d}return this},renderVertexMarkers:function(){if(!this._V.markerVertices){return this}var a=$(this._V.markerVertices.node).empty();var b=_.template(this.model.get("vertexMarkup")||this.model.vertexMarkup);_.each(this.model.get("vertices"),function(d,c){a.append(V(b(_.extend({idx:c},d))).node)});return this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads){return this}var a=$(this._V.markerArrowheads.node);a.empty();var b=_.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);this._V.sourceArrowhead=V(b({end:"source"}));this._V.targetArrowhead=V(b({end:"target"}));a.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node);return this},update:function(){_.each(this.model.get("attrs"),function(d,c){var f=[];if(_.isObject(d.fill)){this.applyGradient(c,"fill",d.fill);f.push("fill")}if(_.isObject(d.stroke)){this.applyGradient(c,"stroke",d.stroke);f.push("stroke")}if(_.isObject(d.filter)){this.applyFilter(c,d.filter);f.push("filter")}if(f.length>0){f.unshift(d);d=_.omit.apply(_,f)}this.findBySelector(c).attr(d)},this);var a=this.route=this.findRoute(this.model.get("vertices")||[]);this._findConnectionPoints(a);var b=this.getPathData(a);this._V.connection.attr("d",b);this._V.connectionWrap&&this._V.connectionWrap.attr("d",b);this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget);this.updateLabelPositions();this.updateToolsPosition();this.updateArrowheadMarkers();delete this.options.perpendicular;this.updatePostponed=false;return this},_findConnectionPoints:function(f){var h,k,c,b;var j=_.first(f);h=this.getConnectionPoint("source",this.model.get("source"),j||this.model.get("target")).round();var d=_.last(f);k=this.getConnectionPoint("target",this.model.get("target"),d||h).round();var a=this._markerCache;if(this._V.markerSource){a.sourceBBox=a.sourceBBox||this._V.markerSource.bbox(true);c=g.point(h).move(j||k,a.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()}if(this._V.markerTarget){a.targetBBox=a.targetBBox||this._V.markerTarget.bbox(true);b=g.point(k).move(d||h,a.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()}a.sourcePoint=c||h;a.targetPoint=b||k;this.sourcePoint=h;this.targetPoint=k},updateLabelPositions:function(){if(!this._V.labels){return this}var c=this.model.get("labels")||[];if(!c.length){return this}var b=this._V.connection.node;var a=b.getTotalLength();if(!_.isNaN(a)){_.each(c,function(j,h){var f=j.position;f=(f>a)?a:f;f=(f<0)?a+f:f;f=f>1?f:a*f;var d=b.getPointAtLength(f);this._labelCache[h].attr("transform","translate("+d.x+", "+d.y+")")},this)}return this},updateToolsPosition:function(){if(!this._V.linkTools){return this}var f="";var d=this.options.linkToolsOffset;var c=this.getConnectionLength();if(c<this.options.shortLinkLength){f="scale(.5)";d/=2}var b=this.getPointAtLength(d);this._toolCache.attr("transform","translate("+b.x+", "+b.y+") "+f);if(this.options.doubleLinkTools&&c>=this.options.longLinkLength){var a=this.options.doubleLinkToolsOffset||d;b=this.getPointAtLength(c-a);this._tool2Cache.attr("transform","translate("+b.x+", "+b.y+") "+f);this._tool2Cache.attr("visibility","visible")}else{if(this.options.doubleLinkTools){this._tool2Cache.attr("visibility","hidden")}}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads){return this}if($.css(this._V.markerArrowheads.node,"display")==="none"){return this}var a=this.getConnectionLength()<this.options.shortLinkLength?0.5:1;this._V.sourceArrowhead.scale(a);this._V.targetArrowhead.scale(a);this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead);return this},createWatcher:function(c){var a=_.partial(this.onEndModelChange,c);function b(h,d){d=d||{};var j=null;var f=h.previous(c)||{};if(f.id){this.stopListening(this.paper.getModelById(f.id),"change",a)}if(d.id){j=this.paper.getModelById(d.id);this.listenTo(j,"change",a)}a.call(this,j,{cacheOnly:true});return this}return b},onEndModelChange:function(o,j,b){var n=!b.cacheOnly;var h=this.model.get(o)||{};if(j){var f=this.constructor.makeSelector(h);var l=o=="source"?"target":"source";var p=this.model.get(l)||{};var c=p.id&&this.constructor.makeSelector(p);if(b.isLoop&&f==c){this[o+"BBox"]=this[l+"BBox"];this[o+"View"]=this[l+"View"];this[o+"Magnet"]=this[l+"Magnet"]}else{if(b.translateBy){var m=this[o+"BBox"];m.x+=b.tx;m.y+=b.ty}else{var k=this.paper.findViewByModel(h.id);var a=k.el.querySelector(f);this[o+"BBox"]=k.getStrokeBBox(a);this[o+"View"]=k;this[o+"Magnet"]=a}}if(b.isLoop&&b.translateBy&&this.model.isEmbeddedIn(j)&&!_.isEmpty(this.model.get("vertices"))){n=false}if(!this.updatePostponed&&p.id){var d=this.paper.getModelById(p.id);b.isLoop=h.id==p.id;if(b.isLoop||(b.translateBy&&d.isEmbeddedIn(b.translateBy))){this.updatePostponed=true;n=false}}}else{this[o+"BBox"]=g.rect(h.x||0,h.y||0,1,1);this[o+"View"]=this[o+"Magnet"]=null}this.lastEndChange=o;n&&this.update()},_translateAndAutoOrientArrows:function(a,b){if(a){a.translateAndAutoOrient(this.sourcePoint,_.first(this.route)||this.targetPoint,this.paper.viewport)}if(b){b.translateAndAutoOrient(this.targetPoint,_.last(this.route)||this.sourcePoint,this.paper.viewport)}},removeVertex:function(a){var b=_.clone(this.model.get("vertices"));if(b&&b.length){b.splice(a,1);this.model.set("vertices",b,{ui:true})}return this},addVertex:function(d){var b=(this.model.get("vertices")||[]).slice();var h=b.slice();var f=this._V.connection.node.cloneNode(false);var j=f.getTotalLength();var c;var k=20;var a=b.length+1;while(a--){b.splice(a,0,d);V(f).attr("d",this.getPathData(this.findRoute(b)));c=f.getTotalLength();if(c-j>k){b=h.slice()}else{break}}if(a===-1){a=0;b.splice(a,0,d)}this.model.set("vertices",b,{ui:true});return a},sendToken:function(a,b,c){b=b||1000;V(this.paper.viewport).append(a);V(a).animateAlongPath({dur:b+"ms",repeatCount:1},this._V.connection.node);_.delay(function(){V(a).remove();c&&c()},b)},findRoute:function(d){var a=this.model.get("router");if(!a){if(this.model.get("manhattan")){a={name:"orthogonal"}}else{return d}}var b=joint.routers[a.name];if(!_.isFunction(b)){throw"unknown router: "+a.name}var c=b.call(this,d||[],a.args||{},this);return c},getPathData:function(b){var a=this.model.get("connector");if(!a){a=this.model.get("smooth")?{name:"smooth"}:{name:"normal"}}if(!_.isFunction(joint.connectors[a.name])){throw"unknown connector: "+a.name}var c=joint.connectors[a.name].call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,b||(this.model.get("vertices")||{}),a.args||{},this);return c},getConnectionPoint:function(d,n,o){var k;_.isEmpty(n)&&(n={x:0,y:0});_.isEmpty(o)&&(o={x:0,y:0});if(!n.id){k=g.point(n)}else{var f=d==="source"?this.sourceBBox:this.targetBBox;var c;if(!o.id){c=g.point(o)}else{var b=d==="source"?this.targetBBox:this.sourceBBox;c=g.rect(b).intersectionWithLineFromCenterToPoint(g.rect(f).center());c=c||g.rect(b).center()}if(this.paper.options.perpendicularLinks||this.options.perpendicular){var h=g.rect(0,c.y,this.paper.options.width,1);var j=g.rect(c.x,0,1,this.paper.options.height);var a;if(h.intersect(g.rect(f))){a=g.rect(f).sideNearestToPoint(c);switch(a){case"left":k=g.point(f.x,c.y);break;case"right":k=g.point(f.x+f.width,c.y);break;default:k=g.rect(f).center();break}}else{if(j.intersect(g.rect(f))){a=g.rect(f).sideNearestToPoint(c);switch(a){case"top":k=g.point(c.x,f.y);break;case"bottom":k=g.point(c.x,f.y+f.height);break;default:k=g.rect(f).center();break}}else{k=g.rect(f).intersectionWithLineFromCenterToPoint(c);k=k||g.rect(f).center()}}}else{if(this.paper.options.linkConnectionPoint){var l=d==="target"?this.targetView:this.sourceView;var m=d==="target"?this.targetMagnet:this.sourceMagnet;k=this.paper.options.linkConnectionPoint(this,l,m,c)}else{k=g.rect(f).intersectionWithLineFromCenterToPoint(c);k=k||g.rect(f).center()}}}return k},getConnectionLength:function(){return this._V.connection.node.getTotalLength()},getPointAtLength:function(a){return this._V.connection.node.getPointAtLength(a)},_beforeArrowheadMove:function(){this.model.trigger("batch:start");this._z=this.model.get("z");this.model.toFront();this.el.style.pointerEvents="none";if(this.paper.options.markAvailable){this._markAvailableMagnets()}},_afterArrowheadMove:function(){if(this._z){this.model.set("z",this._z,{ui:true});delete this._z}this.el.style.pointerEvents="visiblePainted";if(this.paper.options.markAvailable){this._unmarkAvailableMagnets()}this.model.trigger("batch:stop")},_createValidateConnectionArgs:function(k){var d=[];d[4]=k;d[5]=this;var a,f=0,c=0;if(k==="source"){f=2;a="target"}else{c=2;a="source"}var b=this.model.get(a);if(b.id){d[f]=this.paper.findViewByModel(b.id);d[f+1]=b.selector&&d[f].el.querySelector(b.selector)}function h(j,l){d[c]=j;d[c+1]=j.el===l?undefined:l;return d}return h},_markAvailableMagnets:function(){var a=this.paper.model.getElements();var b=this.paper.options.validateConnection;_.chain(a).map(this.paper.findViewByModel,this.paper).each(function(c){var d=c.el.getAttribute("magnet")!=="false"&&b.apply(this.paper,this._validateConnectionArgs(c,null));var f=_.filter(c.el.querySelectorAll("[magnet]"),function(h){return b.apply(this.paper,this._validateConnectionArgs(c,h))},this);if(d){V(c.el).addClass("available-magnet")}_.each(f,function(h){V(h).addClass("available-magnet")});if(d||f.length){V(c.el).addClass("available-cell")}},this)},_unmarkAvailableMagnets:function(){_.each(this.paper.el.querySelectorAll(".available-cell, .available-magnet"),function(a){V(a).removeClass("available-magnet").removeClass("available-cell")})},startArrowheadMove:function(a){this._action="arrowhead-move";this._arrowhead=a;this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead);this._beforeArrowheadMove()},pointerdown:function(c,a,j){joint.dia.CellView.prototype.pointerdown.apply(this,arguments);this._dx=a;this._dy=j;var d=_.isFunction(this.options.interactive)?this.options.interactive(this,"pointerdown"):this.options.interactive;if(d===false){return}function h(k){if(!_.isObject(d)||d[k]!==false){return true}return false}var f=c.target.getAttribute("class");switch(f){case"marker-vertex":if(h("vertexMove")){this._action="vertex-move";this._vertexIdx=c.target.getAttribute("idx")}break;case"marker-vertex-remove":case"marker-vertex-remove-area":if(h("vertexRemove")){this.removeVertex(c.target.getAttribute("idx"))}break;case"marker-arrowhead":if(h("arrowheadMove")){this.startArrowheadMove(c.target.getAttribute("end"))}break;default:var b=c.target.parentNode.getAttribute("event");if(b){if(b==="remove"){this.model.remove()}else{this.paper.trigger(b,c,this,a,j)}}else{if(h("vertexAdd")){this._vertexIdx=this.addVertex({x:a,y:j});this._action="vertex-move"}}}this.paper.trigger("link:pointerdown",c,this,a,j)},pointermove:function(m,k,j){joint.dia.CellView.prototype.pointermove.apply(this,arguments);switch(this._action){case"vertex-move":var h=_.clone(this.model.get("vertices"));h[this._vertexIdx]={x:k,y:j};this.model.set("vertices",h,{ui:true});break;case"arrowhead-move":if(this.paper.options.snapLinks){var b=this.paper.options.snapLinks.radius||50;var d=this.paper.findViewsInArea({x:k-b,y:j-b,width:2*b,height:2*b});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:true,snapping:true});this._closestView=this._closestEnd=null;var a=g.point(k,j);var c,l=Number.MAX_VALUE;_.each(d,function(n){if(n.el.getAttribute("magnet")!=="false"){c=n.model.getBBox().center().distance(a);if(c<b&&c<l){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(n,null))){l=c;this._closestView=n;this._closestEnd={id:n.model.id}}}}n.$("[magnet]").each(_.bind(function(o,q){var p=V(q).bbox(false,this.paper.viewport);c=a.distance({x:p.x+p.width/2,y:p.y+p.height/2});if(c<b&&c<l){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(n,q))){l=c;this._closestView=n;this._closestEnd={id:n.model.id,selector:n.getSelector(q),port:q.getAttribute("port")}}}},this))},this);this._closestView&&this._closestView.highlight(this._closestEnd.selector,{connecting:true,snapping:true});this.model.set(this._arrowhead,this._closestEnd||{x:k,y:j},{ui:true})}else{var f=(m.type==="mousemove")?m.target:document.elementFromPoint(m.clientX,m.clientY);if(this._targetEvent!==f){this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:true});this._viewUnderPointer=this.paper.findView(f);if(this._viewUnderPointer){this._magnetUnderPointer=this._viewUnderPointer.findMagnet(f);if(this._magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))){this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer,{connecting:true})}else{this._magnetUnderPointer=null}}else{this._magnetUnderPointer=null}}this._targetEvent=f;this.model.set(this._arrowhead,{x:k,y:j},{ui:true})}break}this._dx=k;this._dy=j},pointerup:function(a){joint.dia.CellView.prototype.pointerup.apply(this,arguments);if(this._action==="arrowhead-move"){if(this.paper.options.snapLinks){this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:true,snapping:true});this._closestView=this._closestEnd=null}else{if(this._magnetUnderPointer){this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:true});this.model.set(this._arrowhead,{id:this._viewUnderPointer.model.id,selector:this._viewUnderPointer.getSelector(this._magnetUnderPointer),port:$(this._magnetUnderPointer).attr("port")},{ui:true})}delete this._viewUnderPointer;delete this._magnetUnderPointer}if(this.paper.options.embeddingMode&&this.model.reparent()){delete this._z}this._afterArrowheadMove()}delete this._action}},{makeSelector:function(b){var a='[model-id="'+b.id+'"]';if(b.port){a+=' [port="'+b.port+'"]'}else{if(b.selector){a+=" "+b.selector}}return a}});if(typeof exports==="object"){module.exports.Link=joint.dia.Link;module.exports.LinkView=joint.dia.LinkView}joint.dia.Paper=Backbone.View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:50,perpendicularLinks:false,elementView:joint.dia.ElementView,linkView:joint.dia.LinkView,snapLinks:false,markAvailable:false,defaultLink:new joint.dia.Link,validateMagnet:function(a,b){return b.getAttribute("magnet")!=="passive"},validateConnection:function(a,d,h,c,b,f){return(b==="target"?h:a) instanceof joint.dia.ElementView},embeddingMode:false,validateEmbedding:function(b,a){return true},findParentBy:"bbox",frontParentOnly:true},events:{mousedown:"pointerdown",dblclick:"mousedblclick",click:"mouseclick",touchstart:"pointerdown",mousemove:"pointermove",touchmove:"pointermove","mouseover .element":"cellMouseover","mouseover .link":"cellMouseover","mouseout .element":"cellMouseout","mouseout .link":"cellMouseout"},constructor:function(a){this._configure(a);Backbone.View.apply(this,arguments)},_configure:function(a){if(this.options){a=_.extend({},_.result(this,"options"),a)}this.options=a},initialize:function(){_.bindAll(this,"addCell","sortCells","resetCells","pointerup","asyncRenderCells");this.svg=V("svg").node;this.viewport=V("g").addClass("viewport").node;this.defs=V("defs").node;V(this.svg).append([this.viewport,this.defs]);this.$el.append(this.svg);this.setOrigin();this.setDimensions();this.listenTo(this.model,"add",this.onAddCell);this.listenTo(this.model,"reset",this.resetCells);this.listenTo(this.model,"sort",this.sortCells);$(document).on("mouseup touchend",this.pointerup);this._mousemoved=false;this.on({"cell:highlight":this.onCellHighlight,"cell:unhighlight":this.onCellUnhighlight})},remove:function(){this.removeCells();$(document).off("mouseup touchend",this.pointerup);Backbone.View.prototype.remove.call(this)},setDimensions:function(b,a){b=this.options.width=b||this.options.width;a=this.options.height=a||this.options.height;V(this.svg).attr({width:b,height:a});this.trigger("resize",b,a)},setOrigin:function(b,a){this.options.origin.x=b||0;this.options.origin.y=a||0;V(this.viewport).translate(b,a,{absolute:true});this.trigger("translate",b,a)},fitToContent:function(j,b,m,a){if(_.isObject(j)){a=j;j=a.gridWidth||1;b=a.gridHeight||1;m=a.padding||0}else{a=a||{};j=j||1;b=b||1;m=m||0}var n=V(this.viewport).bbox(true,this.svg);var d=V(this.viewport).scale();n.x*=d.sx;n.y*=d.sy;n.width*=d.sx;n.height*=d.sy;var c=Math.max(Math.ceil((n.width+n.x)/j),1)*j;var o=Math.max(Math.ceil((n.height+n.y)/b),1)*b;var h=0;var f=0;if((a.allowNewOrigin=="negative"&&n.x<0)||(a.allowNewOrigin=="positive"&&n.x>=0)||a.allowNewOrigin=="any"){h=Math.ceil(-n.x/j)*j;h+=m;c+=h}if((a.allowNewOrigin=="negative"&&n.y<0)||(a.allowNewOrigin=="positive"&&n.y>=0)||a.allowNewOrigin=="any"){f=Math.ceil(-n.y/b)*b;f+=m;o+=f}c+=m;o+=m;c=Math.max(c,a.minWidth||0);o=Math.max(o,a.minHeight||0);var k=c!=this.options.width||o!=this.options.height;var l=h!=this.options.origin.x||f!=this.options.origin.y;if(l){this.setOrigin(h,f)}if(k){this.setDimensions(c,o)}},scaleContentToFit:function(d){var c=this.getContentBBox();if(!c.width||!c.height){return}d=d||{};_.defaults(d,{padding:0,preserveAspectRatio:true,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var m=d.padding;var f=d.minScaleX||d.minScale;var p=d.maxScaleX||d.maxScale;var b=d.minScaleY||d.minScale;var n=d.maxScaleY||d.maxScale;var r=d.fittingBBox||({x:this.options.origin.x,y:this.options.origin.y,width:this.options.width,height:this.options.height});r=g.rect(r).moveAndExpand({x:m,y:m,width:-2*m,height:-2*m});var l=V(this.viewport).scale();var q=r.width/c.width*l.sx;var o=r.height/c.height*l.sy;if(d.preserveAspectRatio){q=o=Math.min(q,o)}if(d.scaleGrid){var k=d.scaleGrid;q=k*Math.floor(q/k);o=k*Math.floor(o/k)}q=Math.min(p,Math.max(f,q));o=Math.min(n,Math.max(b,o));this.scale(q,o);var a=this.getContentBBox();var j=r.x-a.x;var h=r.y-a.y;this.setOrigin(j,h)},getContentBBox:function(){var b=this.viewport.getBoundingClientRect();var c=this.viewport.getScreenCTM();var a=this.viewport.getCTM();var d=g.rect({x:b.left-c.e+a.e,y:b.top-c.f+a.f,width:b.width,height:b.height});return d},createViewForModel:function(a){var b;var f=a.get("type");var d=f.split(".")[0];var c=f.split(".")[1];if(joint.shapes[d]&&joint.shapes[d][c+"View"]){b=new joint.shapes[d][c+"View"]({model:a,interactive:this.options.interactive})}else{if(a instanceof joint.dia.Element){b=new this.options.elementView({model:a,interactive:this.options.interactive})}else{b=new this.options.linkView({model:a,interactive:this.options.interactive})}}return b},onAddCell:function(a,c,b){if(this.options.async&&b.async!==false&&_.isNumber(b.position)){this._asyncCells=this._asyncCells||[];this._asyncCells.push(a);if(b.position==0){if(this._frameId){throw"another asynchronous rendering in progress"}this.asyncRenderCells(this._asyncCells);delete this._asyncCells}}else{this.addCell(a)}},addCell:function(a){var b=this.createViewForModel(a);V(this.viewport).append(b.el);b.paper=this;b.render();$(b.el).find("image").on("dragstart",function(){return false})},beforeRenderCells:function(a){a.sort(function(d,c){return d instanceof joint.dia.Link?1:-1});return a},afterRenderCells:function(){this.sortCells()},resetCells:function(a){$(this.viewport).empty();var b=a.models.slice();b=this.beforeRenderCells(b);if(this._frameId){joint.util.cancelFrame(this._frameId);delete this._frameId}if(this.options.async){this.asyncRenderCells(b)}else{_.each(b,this.addCell,this);this.sortCells()}},removeCells:function(){this.model.get("cells").each(function(a){var b=this.findViewByModel(a);b&&b.remove()},this)},asyncBatchAdded:_.identity,asyncRenderCells:function(b,c){var a=false;if(this._frameId){_.each(_.range(this.options.async&&this.options.async.batchSize||50),function(){var d=b.shift();a=!d;if(!a){this.addCell(d)}},this);this.asyncBatchAdded()}if(a){delete this._frameId;this.afterRenderCells();this.trigger("render:done",c)}else{this._frameId=joint.util.nextFrame(_.bind(function(){this.asyncRenderCells(b,c)},this))}},sortCells:function(){var a=$(this.viewport).children("[model-id]");var b=this.model.get("cells");this.sortElements(a,function(d,c){var h=b.get($(d).attr("model-id"));var f=b.get($(c).attr("model-id"));return(h.get("z")||0)>(f.get("z")||0)?1:-1})},sortElements:function(d,b){var c=$(d);var a=c.map(function(){var h=this;var f=h.parentNode;var j=f.insertBefore(document.createTextNode(""),h.nextSibling);return function(){if(f===this){throw new Error("You can't sort elements if any one is a descendant of another.")}f.insertBefore(this,j);f.removeChild(j)}});return Array.prototype.sort.call(c,b).each(function(f){a[f].call(this)})},scale:function(k,h,c,b){h=h||k;if(_.isUndefined(c)){c=0;b=0}V(this.viewport).attr("transform","");var a=this.options.origin.x;var j=this.options.origin.y;if(c||b||a||j){var f=a-c*(k-1);var d=j-b*(h-1);this.setOrigin(f,d)}V(this.viewport).scale(k,h);this.trigger("scale",k,h,c,b);return this},rotate:function(c,b,a){if(_.isUndefined(b)){var d=this.viewport.getBBox();b=d.width/2;a=d.height/2}V(this.viewport).rotate(c,b,a)},findView:function(b){var a=this.$(b);if(a.length===0||a[0]===this.el){return undefined}if(a.data("view")){return a.data("view")}return this.findView(a.parent())},findViewByModel:function(a){var c=_.isString(a)?a:a.id;var b=this.$('[model-id="'+c+'"]');if(b.length){return b.data("view")}return undefined},findViewsFromPoint:function(b){b=g.point(b);var a=_.map(this.model.getElements(),this.findViewByModel);return _.filter(a,function(c){return c&&g.rect(V(c.el).bbox(false,this.viewport)).containsPoint(b)},this)},findViewsInArea:function(b){b=g.rect(b);var a=_.map(this.model.getElements(),this.findViewByModel);return _.filter(a,function(c){return c&&b.intersect(g.rect(V(c.el).bbox(false,this.viewport)))},this)},getModelById:function(a){return this.model.getCell(a)},snapToGrid:function(b){var a=V(this.viewport).toLocalPoint(b.x,b.y);return{x:g.snapToGrid(a.x,this.options.gridSize),y:g.snapToGrid(a.y,this.options.gridSize)}},getDefaultLink:function(a,b){return _.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,a,b):this.options.defaultLink.clone()},onCellHighlight:function(b,a){V(a).addClass("highlighted")},onCellUnhighlight:function(b,a){V(a).removeClass("highlighted")},mousedblclick:function(b){b.preventDefault();b=joint.util.normalizeEvent(b);var a=this.findView(b.target);var c=this.snapToGrid({x:b.clientX,y:b.clientY});if(a){a.pointerdblclick(b,c.x,c.y)}else{this.trigger("blank:pointerdblclick",b,c.x,c.y)}},mouseclick:function(b){if(!this._mousemoved){b=joint.util.normalizeEvent(b);var a=this.findView(b.target);var c=this.snapToGrid({x:b.clientX,y:b.clientY});if(a){a.pointerclick(b,c.x,c.y)}else{this.trigger("blank:pointerclick",b,c.x,c.y)}}this._mousemoved=false},pointerdown:function(b){b=joint.util.normalizeEvent(b);var a=this.findView(b.target);var c=this.snapToGrid({x:b.clientX,y:b.clientY});if(a){this.sourceView=a;a.pointerdown(b,c.x,c.y)}else{this.trigger("blank:pointerdown",b,c.x,c.y)}},pointermove:function(a){a.preventDefault();a=joint.util.normalizeEvent(a);if(this.sourceView){this._mousemoved=true;var b=this.snapToGrid({x:a.clientX,y:a.clientY});this.sourceView.pointermove(a,b.x,b.y)}},pointerup:function(a){a=joint.util.normalizeEvent(a);var b=this.snapToGrid({x:a.clientX,y:a.clientY});if(this.sourceView){this.sourceView.pointerup(a,b.x,b.y);this.sourceView=null}else{this.trigger("blank:pointerup",a,b.x,b.y)}},cellMouseover:function(b){b=joint.util.normalizeEvent(b);var a=this.findView(b.target);if(a){a.mouseover(b)}},cellMouseout:function(b){b=joint.util.normalizeEvent(b);var a=this.findView(b.target);if(a){a.mouseout(b)}}});if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,ElementView:require("../src/joint.dia.element").ElementView}};var _=require("lodash")}joint.shapes.basic={};joint.shapes.basic.Generic=joint.dia.Element.extend({defaults:joint.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#FFFFFF",stroke:"none"}}},joint.dia.Element.prototype.defaults)});joint.shapes.basic.Rect=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Rect",attrs:{rect:{fill:"#FFFFFF",stroke:"black",width:100,height:60},text:{"font-size":14,text:"","ref-x":0.5,"ref-y":0.5,ref:"rect","y-alignment":"middle","x-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.TextView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:attrs",this.resize)}});joint.shapes.basic.Text=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><text/></g></g>',defaults:joint.util.deepSupplement({type:"basic.Text",attrs:{text:{"font-size":18,fill:"black"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Circle=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#FFFFFF",stroke:"black",r:30,transform:"translate(30, 30)"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":0.5,"ref-y":0.5,ref:"circle","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Image=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Image",attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":0.5,"ref-dy":20,ref:"image","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Path=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Path",size:{width:60,height:60},attrs:{path:{fill:"#FFFFFF",stroke:"black"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":0.5,"ref-dy":20,ref:"path","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Rhombus=joint.shapes.basic.Path.extend({defaults:joint.util.deepSupplement({type:"basic.Rhombus",attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":0.5}}},joint.shapes.basic.Path.prototype.defaults)});joint.shapes.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs();this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this);this.constructor.__super__.constructor.__super__.initialize.apply(this,arguments)},updatePortsAttrs:function(a){var c=this.get("attrs");_.each(this._portSelectors,function(d){if(c[d]){delete c[d]}});this._portSelectors=[];var b={};_.each(this.get("inPorts"),function(h,d,j){var f=this.getPortAttrs(h,d,j.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(_.keys(f));_.extend(b,f)},this);_.each(this.get("outPorts"),function(h,d,j){var f=this.getPortAttrs(h,d,j.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(_.keys(f));_.extend(b,f)},this);this.attr(b,{silent:true});this.processPorts();this.trigger("process:ports")},getPortSelector:function(c){var a=".inPorts";var b=this.get("inPorts").indexOf(c);if(b<0){a=".outPorts";b=this.get("outPorts").indexOf(c);if(b<0){throw new Error("getPortSelector(): Port doesn't exist.")}}return a+">g:nth-child("+(b+1)+")>circle"}};joint.shapes.basic.PortsViewInterface={initialize:function(){this.listenTo(this.model,"process:ports",this.update);joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){this.renderPorts();joint.dia.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var c=this.$(".inPorts").empty();var a=this.$(".outPorts").empty();var b=_.template(this.model.portMarkup);_.each(_.filter(this.model.ports,function(d){return d.type==="in"}),function(d,f){c.append(V(b({id:f,port:d})).node)});_.each(_.filter(this.model.ports,function(d){return d.type==="out"}),function(d,f){a.append(V(b({id:f,port:d})).node)})}};joint.shapes.basic.TextBlock=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable"><g class="scalable"><rect/></g><switch>','<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>',"</switch></g>"].join(""),defaults:joint.util.deepSupplement({type:"basic.TextBlock",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"",ref:"rect","ref-x":0.5,"ref-y":0.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){if(typeof SVGForeignObjectElement!=="undefined"){this.setForeignObjectSize(this,this.get("size"));this.setDivContent(this,this.get("content"));this.listenTo(this,"change:size",this.setForeignObjectSize);this.listenTo(this,"change:content",this.setDivContent)}joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},setForeignObjectSize:function(a,b){a.attr({".fobj":_.clone(b),div:{style:_.clone(b)}})},setDivContent:function(a,b){a.attr({div:{html:b}})}});joint.shapes.basic.TextBlockView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);if(typeof SVGForeignObjectElement==="undefined"){this.noSVGForeignObjectElement=true;this.listenTo(this.model,"change:content",function(a){this.updateContent(a)})}},update:function(a,d){if(this.noSVGForeignObjectElement){var c=this.model;var b=_.omit(d||c.get("attrs"),".content");joint.dia.ElementView.prototype.update.call(this,c,b);if(!d||_.has(d,".content")){this.updateContent(c,d)}}else{joint.dia.ElementView.prototype.update.call(this,c,d)}},updateContent:function(a,c){var d=_.merge({},(c||a.get("attrs"))[".content"]);delete d.text;var f=joint.util.breakText(a.get("content"),a.get("size"),d,{svgDocument:this.paper.svg});var b=joint.util.setByPath({},".content",d,"/");b[".content"].text=f;joint.dia.ElementView.prototype.update.call(this,a,b)}});if(typeof exports==="object"){module.exports=joint.shapes.basic}joint.routers.orthogonal=function(){var k={N:"S",S:"N",E:"W",W:"E"};var j={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function q(s,r){if(s.x==r.x){return s.y>r.y?"N":"S"}if(s.y==r.y){return s.x>r.x?"W":"E"}return null}function f(s,r){return s[r=="W"||r=="E"?"width":"height"]}function o(s,r){return g.rect(s).moveAndExpand({x:-r,y:-r,width:2*r,height:2*r})}function b(r){return g.rect(r.x,r.y,0,0)}function c(w,v){var s=Math.min(w.x,v.x);var u=Math.min(w.y,v.y);var r=Math.max(w.x+w.width,v.x+v.width);var t=Math.max(w.y+w.height,v.y+v.height);return g.rect(s,u,r-s,t-u)}function h(u,s,t){var r=g.point(u.x,s.y);if(t.containsPoint(r)){r=g.point(s.x,u.y)}return r}function n(w,x,v){var z=g.point(w.x,x.y);var y=g.point(x.x,w.y);var s=q(w,z);var r=q(w,y);var u=k[v];var t=(s==v||(s!=u&&(r==u||r!=v)))?z:y;return{points:[t],direction:q(t,x)}}function d(u,t,r){var s=h(u,t,r);return{points:[s],direction:q(s,t)}}function l(w,x,u,v){var y={};var B=[g.point(w.x,x.y),g.point(x.x,w.y)];var s=_.filter(B,function(C){return !u.containsPoint(C)});var t=_.filter(s,function(C){return q(C,w)!=v});var r;if(t.length>0){r=_.filter(t,function(C){return q(w,C)==v}).pop();r=r||t[0];y.points=[r];y.direction=q(r,x)}else{r=_.difference(B,s)[0];var z=g.point(x).move(r,-f(u,v)/2);var A=h(z,w,u);y.points=[A,z];y.direction=q(z,x)}return y}function m(x,y,t,s){var A=d(y,x,s);var C=A.points[0];if(t.containsPoint(C)){A=d(x,y,t);var B=A.points[0];if(s.containsPoint(B)){var z=g.point(x).move(B,-f(t,q(x,B))/2);var v=g.point(y).move(C,-f(s,q(y,C))/2);var w=g.line(z,v).midpoint();var r=d(x,w,t);var u=n(w,y,r.direction);A.points=[r.points[0],u.points[0]];A.direction=u.direction}}return A}function a(z,A,v,s,w){var B={};var x=o(c(v,s),1);var u=x.center().distance(A)>x.center().distance(z);var r=u?A:z;var t=u?z:A;var D,C,y;if(w){D=g.point.fromPolar(x.width+x.height,j[w],r);D=x.pointNearestToPoint(D).move(D,-1)}else{D=x.pointNearestToPoint(r).move(r,1)}C=h(D,t,x);if(D.round().equals(C.round())){C=g.point.fromPolar(x.width+x.height,g.toRad(D.theta(r))+Math.PI/2,t);C=x.pointNearestToPoint(C).move(t,1).round();y=h(D,C,x);B.points=u?[C,y,D]:[D,y,C]}else{B.points=u?[C,D]:[D,C]}B.direction=u?q(D,A):q(C,A);return B}function p(x,t,r){var z=t.elementPadding||20;var E=[];var F=o(r.sourceBBox,z);var u=o(r.targetBBox,z);x=_.map(x,g.point);x.unshift(F.center());x.push(u.center());var w;for(var v=0,y=x.length-1;v<y;v++){var D=null;var C=x[v];var B=x[v+1];var A=!!q(C,B);if(v==0){if(v+1==y){if(F.intersect(o(u,1))){D=a(C,B,F,u)}else{if(!A){D=m(C,B,F,u)}}}else{if(F.containsPoint(B)){D=a(C,B,F,o(b(B),z))}else{if(!A){D=d(C,B,F)}}}}else{if(v+1==y){var s=A&&q(B,C)==w;if(u.containsPoint(C)||s){D=a(C,B,o(b(C),z),u,w)}else{if(!A){D=l(C,B,u,w)}}}else{if(!A){D=n(C,B,w)}}}if(D){Array.prototype.push.apply(E,D.points);w=D.direction}else{w=q(C,B)}if(v+1<y){E.push(B)}}return E}return p}();joint.routers.manhattan=(function(){var c={step:10,perpendicular:true,mapGridSize:100,excludeEnds:[],excludeTypes:["basic.Text"],maximumLoops:500,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},maxAllowedDirectionChange:1,paddingBox:function(){var j=this.step;return{x:-j,y:-j,width:2*j,height:2*j}},directions:function(){var j=this.step;return[{offsetX:j,offsetY:0,cost:j},{offsetX:0,offsetY:j,cost:j},{offsetX:-j,offsetY:0,cost:j},{offsetX:0,offsetY:-j,cost:j}]},penalties:function(){return[0,this.step/2,this.step]},estimateCost:function(k,j){return k.manhattanDistance(j)},fallbackRoute:function(n,m,l){var k=l.prevDirIndexes||{};var j=(k[n]||0)%2?g.point(n.x,m.y):g.point(m.x,n.y);return[j,m]},draggingRoute:null};function h(m,j){var k=[];var l={x:0,y:0};var p=j;var n;while((n=m[p])){var o=n.difference(p);if(!o.equals(l)){k.unshift(p);l=o}p=n}k.unshift(p);return k}function d(o,n,l){var k=l.step;var j=o.center();var m=_.chain(l.directionMap).pick(n).map(function(r){var q=r.x*o.width/2;var s=r.y*o.height/2;var p=g.point(j).offset(q,s).snapToGrid(k);if(o.containsPoint(p)){p.offset(r.x*k,r.y*k)}return p}).value();return m}function f(n,j,m){var l=360/m;var k=Math.floor(n.theta(j)/l);return m-k}function b(G,z,J,A){var I=A.reversed?A.endDirections:A.startDirections;var q=A.reversed?A.startDirections:A.endDirections;var X=G instanceof g.rect?d(G,I,A):[G];var s=z instanceof g.rect?d(z,q,A):[z];var x=X.length>1?G.center():X[0];var B=s.length>1?z.center():s[0];var m=_.filter(s,function(Y){var Z=g.point(Y).snapToGrid(A.mapGridSize).toString();var aa=_.every(J[Z],function(ab){return !ab.containsPoint(Y)});return aa});if(m.length){var M=A.step;var P=A.penalties;var p=_.chain(m).invoke("snapToGrid",M).min(function(Y){return A.estimateCost(x,Y)}).value();var S={};var j={};var T={};var F=A.directions;var Q=F.length;var k=Q/2;var D=A.previousDirIndexes||{};var u={};var O={};var U=_.chain(X).invoke("snapToGrid",M).each(function(Y){var Z=Y.toString();j[Z]=0;T[Z]=A.estimateCost(Y,p);D[Z]=D[Z]||f(x,Y,Q);O[Z]=true}).map(function(Y){return Y.toString()}).sortBy(function(Y){return T[Y]}).value();var t=A.maximumLoops;var K=A.maxAllowedDirectionChange;while(U.length&&t--){var y=U[0];var n=g.point(y);if(p.equals(n)){A.previousDirIndexes=_.pick(D,y);return h(S,n)}U.splice(0,1);O[o]=null;u[o]=true;var C=D[y];var w=j[y];for(var v=0;v<Q;v++){var N=Math.abs(v-C);if(N>k){N=Q-N}if(N>K){continue}var W=F[v];var r=g.point(n).offset(W.offsetX,W.offsetY);var o=r.toString();if(u[o]){continue}var R=g.point(r).snapToGrid(A.mapGridSize).toString();var H=_.every(J[R],function(Y){return !Y.containsPoint(r)});if(!H){continue}var l=_.has(O,o);var L=w+W.cost;if(!l||L<j[o]){S[o]=n;D[o]=v;j[o]=L;T[o]=L+A.estimateCost(r,p)+P[N];if(!l){var E=_.sortedIndex(U,o,function(Y){return T[Y]});U.splice(E,0,o);O[o]=true}}}}}return A.fallbackRoute(x,B,A)}function a(y,j){j.directions=_.result(j,"directions");j.penalties=_.result(j,"penalties");j.paddingBox=_.result(j,"paddingBox");this.options.perpendicular=!!j.perpendicular;var w=j.reversed=(this.lastEndChange==="source");var p=w?g.rect(this.targetBBox):g.rect(this.sourceBBox);var x=w?g.rect(this.sourceBBox):g.rect(this.targetBBox);p.moveAndExpand(j.paddingBox);x.moveAndExpand(j.paddingBox);var o=this.model;var k=this.paper.model;var q=_.chain(j.excludeEnds).map(o.get,o).pluck("id").map(k.getCell,k).value();var D=j.mapGridSize;var B=_.chain(k.getElements()).difference(q).reject(function(E){return _.contains(j.excludeTypes,E.get("type"))}).invoke("getBBox").invoke("moveAndExpand",j.paddingBox).foldl(function(H,J){var F=J.origin().snapToGrid(D);var I=J.corner().snapToGrid(D);for(var E=F.x;E<=I.x;E+=D){for(var K=F.y;K<=I.y;K+=D){var G=E+"@"+K;H[G]=H[G]||[];H[G].push(J)}}return H},{}).value();var r=[];var t=_.map(y,g.point);var m=p.center();for(var u=0,v=t.length;u<=v;u++){var C=null;var s=l||p;var l=t[u];if(!l){l=x;var z=!this.model.get("source").id||!this.model.get("target").id;if(z&&_.isFunction(j.draggingRoute)){var A=s instanceof g.rect?s.center():s;C=j.draggingRoute(A,l.origin(),j)}}C=C||b(s,l,B,j);var n=_.first(C);if(n&&n.equals(m)){C.shift()}m=_.last(C)||m;r=r.concat(C)}return w?r.reverse():r}return function(j,k,l){return a.call(l,j,_.extend({},c,k))}})();joint.routers.metro=(function(){if(!_.isFunction(joint.routers.manhattan)){throw ("Metro requires the manhattan router.")}var a={diagonalCost:null,directions:function(){var c=this.step;var b=this.diagonalCost||Math.ceil(Math.sqrt(c*c<<1));return[{offsetX:c,offsetY:0,cost:c},{offsetX:c,offsetY:c,cost:b},{offsetX:0,offsetY:c,cost:c},{offsetX:-c,offsetY:c,cost:b},{offsetX:-c,offsetY:0,cost:c},{offsetX:-c,offsetY:-c,cost:b},{offsetX:0,offsetY:-c,cost:c},{offsetX:c,offsetY:-c,cost:b}]},fallbackRoute:function(n,o,c){var d=n.theta(o);var l={x:o.x,y:n.y};var k={x:n.x,y:o.y};if(d%180>90){var r=l;l=k;k=r}var q=(d%90)<45?l:k;var h=g.line(n,q);var j=90*Math.ceil(d/90);var p=g.point.fromPolar(h.squaredLength(),g.toRad(j+135),q);var f=g.line(o,p);var m=h.intersection(f);return m?[m.round(),o]:[o]}};return function(b,c,d){return joint.routers.manhattan(b,_.extend({},a,c),d)}})();joint.connectors.normal=function(b,f,a){var c=["M",b.x,b.y];_.each(a,function(d){c.push(d.x,d.y)});c.push(f.x,f.y);return c.join(" ")};joint.connectors.rounded=function(p,k,n,b){var h=b.radius||10;var l,j,c,a,f,m;var o=["M",p.x,p.y];_.each(n,function(q,d){f=n[d-1]||p;m=n[d+1]||k;c=a||g.point(q).distance(f)/2;a=g.point(q).distance(m)/2;l=g.point(q).move(f,-Math.min(h,c)).round();j=g.point(q).move(m,-Math.min(h,a)).round();o.push(l.x,l.y,"S",q.x,q.y,j.x,j.y,"L")});o.push(k.x,k.y);return o.join(" ")};joint.connectors.smooth=function(c,h,a){var f;if(a.length){f=g.bezier.curveThroughPoints([c].concat(a).concat([h]))}else{var b=(c.x<h.x)?h.x-((h.x-c.x)/2):c.x-((c.x-h.x)/2);f=["M",c.x,c.y,"C",b,c.y,b,h.y,h.x,h.y]}return f.join(" ")};if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,Link:require("../src/joint.dia.link").Link}}}joint.shapes.erd={};joint.shapes.erd.Entity=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Entity",size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,ref:".outer","ref-x":0.5,"ref-y":0.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.erd.WeakEntity=joint.shapes.erd.Entity.extend({defaults:joint.util.deepSupplement({type:"erd.WeakEntity",attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}},joint.shapes.erd.Entity.prototype.defaults)});joint.shapes.erd.Relationship=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Relationship",size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,ref:".","ref-x":0.5,"ref-y":0.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.erd.IdentifyingRelationship=joint.shapes.erd.Relationship.extend({defaults:joint.util.deepSupplement({type:"erd.IdentifyingRelationship",attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}},joint.shapes.erd.Relationship.prototype.defaults)});joint.shapes.erd.Attribute=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Attribute",size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,ref:".","ref-x":0.5,"ref-y":0.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.erd.Multivalued=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Multivalued",attrs:{".inner":{display:"block"},text:{text:"multivalued"}}},joint.shapes.erd.Attribute.prototype.defaults)});joint.shapes.erd.Derived=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Derived",attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}},joint.shapes.erd.Attribute.prototype.defaults)});joint.shapes.erd.Key=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Key",attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}},joint.shapes.erd.Attribute.prototype.defaults)});joint.shapes.erd.Normal=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Normal",attrs:{text:{text:"Normal"}}},joint.shapes.erd.Attribute.prototype.defaults)});joint.shapes.erd.ISA=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,ref:"polygon","ref-x":0.5,"ref-y":0.3,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.erd.Line=joint.dia.Link.extend({defaults:{type:"erd.Line"},cardinality:function(a){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:a}}}])}});if(typeof exports==="object"){module.exports=joint.shapes.erd}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{Element:require("../src/joint.dia.element").Element,Link:require("../src/joint.dia.link").Link}}}joint.shapes.fsa={};joint.shapes.fsa.State=joint.shapes.basic.Circle.extend({defaults:joint.util.deepSupplement({type:"fsa.State",attrs:{circle:{"stroke-width":3},text:{"font-weight":"800"}}},joint.shapes.basic.Circle.prototype.defaults)});joint.shapes.fsa.StartState=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g></g>',defaults:joint.util.deepSupplement({type:"fsa.StartState",size:{width:20,height:20},attrs:{circle:{transform:"translate(10, 10)",r:10,fill:"#000000"}}},joint.dia.Element.prototype.defaults)});joint.shapes.fsa.EndState=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>',defaults:joint.util.deepSupplement({type:"fsa.EndState",size:{width:20,height:20},attrs:{".outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#000000"},".inner":{transform:"translate(10, 10)",r:6,fill:"#000000"}}},joint.dia.Element.prototype.defaults)});joint.shapes.fsa.Arrow=joint.dia.Link.extend({defaults:joint.util.deepSupplement({type:"fsa.Arrow",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}},smooth:true},joint.dia.Link.prototype.defaults)});if(typeof exports==="object"){module.exports=joint.shapes.fsa}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,Link:require("../src/joint.dia.link").Link}}}joint.shapes.org={};joint.shapes.org.Member=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="card"/><image/></g><text class="rank"/><text class="name"/></g>',defaults:joint.util.deepSupplement({type:"org.Member",size:{width:180,height:70},attrs:{rect:{width:170,height:60},".card":{fill:"#FFFFFF",stroke:"#000000","stroke-width":2,"pointer-events":"visiblePainted",rx:10,ry:10},image:{width:48,height:48,ref:".card","ref-x":10,"ref-y":5},".rank":{"text-decoration":"underline",ref:".card","ref-x":0.9,"ref-y":0.2,"font-family":"Courier New","font-size":14,"text-anchor":"end"},".name":{"font-weight":"800",ref:".card","ref-x":0.9,"ref-y":0.6,"font-family":"Courier New","font-size":14,"text-anchor":"end"}}},joint.dia.Element.prototype.defaults)});joint.shapes.org.Arrow=joint.dia.Link.extend({defaults:{type:"org.Arrow",source:{selector:".card"},target:{selector:".card"},attrs:{".connection":{stroke:"#585858","stroke-width":3}},z:-1}});if(typeof exports==="object"){module.exports=joint.shapes.org}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{}}}joint.shapes.chess={};joint.shapes.chess.KingWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KingWhite",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.KingBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KingBlack",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.QueenWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.QueenWhite",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.QueenBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.QueenBlack",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.RookWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.RookWhite",size:{width:32,height:34}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.RookBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.RookBlack",size:{width:32,height:34}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.BishopWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.BishopWhite",size:{width:38,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.BishopBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.BishopBlack",size:{width:38,height:38}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.KnightWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KnightWhite",size:{width:38,height:37}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.KnightBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KnightBlack",size:{width:38,height:37}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.PawnWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>',defaults:joint.util.deepSupplement({type:"chess.PawnWhite",size:{width:28,height:33}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chess.PawnBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>',defaults:joint.util.deepSupplement({type:"chess.PawnBlack",size:{width:28,height:33}},joint.shapes.basic.Generic.prototype.defaults)});if(typeof exports==="object"){module.exports=joint.shapes.chess}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{ElementView:require("../src/joint.dia.element").ElementView,Link:require("../src/joint.dia.link").Link}}}joint.shapes.pn={};joint.shapes.pn.Place=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="root"/><g class="tokens" /></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"pn.Place",size:{width:50,height:50},attrs:{".root":{r:25,fill:"#ffffff",stroke:"#000000",transform:"translate(25, 25)"},".label":{"text-anchor":"middle","ref-x":0.5,"ref-y":-20,ref:".root",fill:"#000000","font-size":12},".tokens > circle":{fill:"#000000",r:5},".tokens.one > circle":{transform:"translate(25, 25)"},".tokens.two > circle:nth-child(1)":{transform:"translate(19, 25)"},".tokens.two > circle:nth-child(2)":{transform:"translate(31, 25)"},".tokens.three > circle:nth-child(1)":{transform:"translate(18, 29)"},".tokens.three > circle:nth-child(2)":{transform:"translate(25, 19)"},".tokens.three > circle:nth-child(3)":{transform:"translate(32, 29)"},".tokens.alot > text":{transform:"translate(25, 18)","text-anchor":"middle",fill:"#000000"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.pn.PlaceView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.model.on("change:tokens",function(){this.renderTokens();this.update()},this)},render:function(){joint.dia.ElementView.prototype.render.apply(this,arguments);this.renderTokens();this.update()},renderTokens:function(){var a=this.$(".tokens").empty();a[0].className.baseVal="tokens";var b=this.model.get("tokens");if(!b){return}switch(b){case 1:a[0].className.baseVal+=" one";a.append(V("<circle/>").node);break;case 2:a[0].className.baseVal+=" two";a.append(V("<circle/>").node,V("<circle/>").node);break;case 3:a[0].className.baseVal+=" three";a.append(V("<circle/>").node,V("<circle/>").node,V("<circle/>").node);break;default:a[0].className.baseVal+=" alot";a.append(V("<text/>").text(b+"").node);break}}});joint.shapes.pn.Transition=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="root"/></g></g><text class="label"/>',defaults:joint.util.deepSupplement({type:"pn.Transition",size:{width:12,height:50},attrs:{rect:{width:12,height:50,fill:"#000000",stroke:"#000000"},".label":{"text-anchor":"middle","ref-x":0.5,"ref-y":-20,ref:"rect",fill:"#000000","font-size":12}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.pn.Link=joint.dia.Link.extend({defaults:joint.util.deepSupplement({attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}},joint.dia.Link.prototype.defaults)});if(typeof exports==="object"){module.exports=joint.shapes.pn}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{ElementView:require("../src/joint.dia.element").ElementView,Link:require("../src/joint.dia.link").Link}};var _=require("lodash")}joint.shapes.devs={};joint.shapes.devs.Model=joint.shapes.basic.Generic.extend(_.extend({},joint.shapes.basic.PortsModelInterface,{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/></g>',portMarkup:'<g class="port port<%= id %>"><circle class="port-body"/><text class="port-label"/></g>',defaults:joint.util.deepSupplement({type:"devs.Model",size:{width:1,height:1},inPorts:[],outPorts:[],attrs:{".":{magnet:false},".body":{width:150,height:250,stroke:"#000000"},".port-body":{r:10,magnet:true,stroke:"#000000"},text:{"pointer-events":"none"},".label":{text:"Model","ref-x":0.5,"ref-y":10,ref:".body","text-anchor":"middle",fill:"#000000"},".inPorts .port-label":{x:-15,dy:4,"text-anchor":"end",fill:"#000000"},".outPorts .port-label":{x:15,dy:4,fill:"#000000"}}},joint.shapes.basic.Generic.prototype.defaults),getPortAttrs:function(d,h,k,c,j){var m={};var a="port"+h;var b=c+">."+a;var f=b+">.port-label";var l=b+">.port-body";m[f]={text:d};m[l]={port:{id:d||_.uniqueId(j),type:j}};m[b]={ref:".body","ref-y":(h+0.5)*(1/k)};if(c===".outPorts"){m[b]["ref-dx"]=0}return m}}));joint.shapes.devs.Atomic=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"devs.Atomic",size:{width:80,height:80},attrs:{".body":{fill:"salmon"},".label":{text:"Atomic"},".inPorts .port-body":{fill:"PaleGreen"},".outPorts .port-body":{fill:"Tomato"}}},joint.shapes.devs.Model.prototype.defaults)});joint.shapes.devs.Coupled=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"devs.Coupled",size:{width:200,height:300},attrs:{".body":{fill:"seaGreen"},".label":{text:"Coupled"},".inPorts .port-body":{fill:"PaleGreen"},".outPorts .port-body":{fill:"Tomato"}}},joint.shapes.devs.Model.prototype.defaults)});joint.shapes.devs.Link=joint.dia.Link.extend({defaults:{type:"devs.Link",attrs:{".connection":{"stroke-width":2}}}});joint.shapes.devs.ModelView=joint.dia.ElementView.extend(joint.shapes.basic.PortsViewInterface);joint.shapes.devs.AtomicView=joint.shapes.devs.ModelView;joint.shapes.devs.CoupledView=joint.shapes.devs.ModelView;if(typeof exports==="object"){module.exports=joint.shapes.devs}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{ElementView:require("../src/joint.dia.element").ElementView,Link:require("../src/joint.dia.link").Link}};var _=require("lodash")}joint.shapes.uml={};joint.shapes.uml.Class=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),defaults:joint.util.deepSupplement({type:"uml.Class",attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":0.5,"ref-x":0.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles();this.trigger("uml-update")},this);this.updateRectangles();joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var b=this.get("attrs");var a=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}];var c=0;_.each(a,function(h){var d=_.isArray(h.text)?h.text:[h.text];var f=d.length*20+20;b[".uml-class-"+h.type+"-text"].text=d.join("\n");b[".uml-class-"+h.type+"-rect"].height=f;b[".uml-class-"+h.type+"-rect"].transform="translate(0,"+c+")";c+=f})}});joint.shapes.uml.ClassView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"uml-update",function(){this.update();this.resize()})}});joint.shapes.uml.Abstract=joint.shapes.uml.Class.extend({defaults:joint.util.deepSupplement({type:"uml.Abstract",attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},joint.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Abstract>>",this.get("name")]}});joint.shapes.uml.AbstractView=joint.shapes.uml.ClassView;joint.shapes.uml.Interface=joint.shapes.uml.Class.extend({defaults:joint.util.deepSupplement({type:"uml.Interface",attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},joint.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Interface>>",this.get("name")]}});joint.shapes.uml.InterfaceView=joint.shapes.uml.ClassView;joint.shapes.uml.Generalization=joint.dia.Link.extend({defaults:{type:"uml.Generalization",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}});joint.shapes.uml.Implementation=joint.dia.Link.extend({defaults:{type:"uml.Implementation",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}});joint.shapes.uml.Aggregation=joint.dia.Link.extend({defaults:{type:"uml.Aggregation",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}});joint.shapes.uml.Composition=joint.dia.Link.extend({defaults:{type:"uml.Composition",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}});joint.shapes.uml.Association=joint.dia.Link.extend({defaults:{type:"uml.Association"}});joint.shapes.uml.State=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),defaults:joint.util.deepSupplement({type:"uml.State",attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":0.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this);this.updateName();this.updateEvents();this.updatePath();joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var a="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",a,{silent:true})}});joint.shapes.uml.StartState=joint.shapes.basic.Circle.extend({defaults:joint.util.deepSupplement({type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}},joint.shapes.basic.Circle.prototype.defaults)});joint.shapes.uml.EndState=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>',defaults:joint.util.deepSupplement({type:"uml.EndState",size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.uml.Transition=joint.dia.Link.extend({defaults:{type:"uml.Transition",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}}});if(typeof exports==="object"){module.exports=joint.shapes.uml}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{basic:require("./joint.shapes.basic")},dia:{Link:require("../src/joint.dia.link").Link}}}joint.shapes.logic={};joint.shapes.logic.Gate=joint.shapes.basic.Generic.extend({defaults:joint.util.deepSupplement({type:"logic.Gate",size:{width:80,height:40},attrs:{".":{magnet:false},".body":{width:100,height:50},circle:{r:7,stroke:"black",fill:"transparent","stroke-width":2}}},joint.shapes.basic.Generic.prototype.defaults),operation:function(){return true}});joint.shapes.logic.IO=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><path class="wire"/><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"logic.IO",size:{width:60,height:30},attrs:{".body":{fill:"white",stroke:"black","stroke-width":2},".wire":{ref:".body","ref-y":0.5,stroke:"black"},text:{fill:"black",ref:".body","ref-x":0.5,"ref-y":0.5,"y-alignment":"middle","text-anchor":"middle","font-weight":"bold","font-variant":"small-caps","text-transform":"capitalize","font-size":"14px"}}},joint.shapes.logic.Gate.prototype.defaults)});joint.shapes.logic.Input=joint.shapes.logic.IO.extend({defaults:joint.util.deepSupplement({type:"logic.Input",attrs:{".wire":{"ref-dx":0,d:"M 0 0 L 23 0"},circle:{ref:".body","ref-dx":30,"ref-y":0.5,magnet:true,"class":"output",port:"out"},text:{text:"input"}}},joint.shapes.logic.IO.prototype.defaults)});joint.shapes.logic.Output=joint.shapes.logic.IO.extend({defaults:joint.util.deepSupplement({type:"logic.Output",attrs:{".wire":{"ref-x":0,d:"M 0 0 L -23 0"},circle:{ref:".body","ref-x":-30,"ref-y":0.5,magnet:"passive","class":"input",port:"in"},text:{text:"output"}}},joint.shapes.logic.IO.prototype.defaults)});joint.shapes.logic.Gate11=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input"/><circle class="output"/></g>',defaults:joint.util.deepSupplement({type:"logic.Gate11",attrs:{".input":{ref:".body","ref-x":-2,"ref-y":0.5,magnet:"passive",port:"in"},".output":{ref:".body","ref-dx":2,"ref-y":0.5,magnet:true,port:"out"}}},joint.shapes.logic.Gate.prototype.defaults)});joint.shapes.logic.Gate21=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle class="output"/></g>',defaults:joint.util.deepSupplement({type:"logic.Gate21",attrs:{".input1":{ref:".body","ref-x":-2,"ref-y":0.3,magnet:"passive",port:"in1"},".input2":{ref:".body","ref-x":-2,"ref-y":0.7,magnet:"passive",port:"in2"},".output":{ref:".body","ref-dx":2,"ref-y":0.5,magnet:true,port:"out"}}},joint.shapes.logic.Gate.prototype.defaults)});joint.shapes.logic.Repeater=joint.shapes.logic.Gate11.extend({defaults:joint.util.deepSupplement({type:"logic.Repeater",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo="}}},joint.shapes.logic.Gate11.prototype.defaults),operation:function(a){return a}});joint.shapes.logic.Not=joint.shapes.logic.Gate11.extend({defaults:joint.util.deepSupplement({type:"logic.Not",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate11.prototype.defaults),operation:function(a){return !a}});joint.shapes.logic.Or=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Or",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return b||a}});joint.shapes.logic.And=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.And",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return b&&a}});joint.shapes.logic.Nor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Nor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return !(b||a)}});joint.shapes.logic.Nand=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Nand",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return !(b&&a)}});joint.shapes.logic.Xor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Xor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return(!b||a)&&(b||!a)}});joint.shapes.logic.Xnor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Xnor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(b,a){return(!b||!a)&&(b||a)}});joint.shapes.logic.Wire=joint.dia.Link.extend({arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',"</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<g class="marker-vertex-remove-group">','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>","</g>"].join(""),defaults:joint.util.deepSupplement({type:"logic.Wire",attrs:{".connection":{"stroke-width":2},".marker-vertex":{r:7}},router:{name:"orthogonal"},connector:{name:"rounded",args:{radius:10}}},joint.dia.Link.prototype.defaults)});if(typeof exports==="object"){module.exports=joint.shapes.logic}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element}};var _=require("lodash")}joint.shapes.chart={};joint.shapes.chart.Plot=joint.shapes.basic.Generic.extend({markup:['<clipPath class="clip"><rect/></clipPath>','<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="axis">','<g class="y-axis"><path/><g class="ticks"></g></g>','<g class="x-axis"><path/><g class="ticks"></g></g>','<g class="markings"></g>',"</g>",'<g class="data"><g class="series"></g></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>','<line class="guideline x-guideline" /><line class="guideline y-guideline" />',"</g>","</g>"].join(""),tickMarkup:'<g class="tick"><line/><text/></g>',pointMarkup:'<g class="point"><circle/><text/></g>',barMarkup:'<path class="bar"/>',markingMarkup:'<g class="marking"><rect/><text/></g>',serieMarkup:'<g><clipPath class="serie-clip"><rect/></clipPath><path/><g class="bars"></g><g class="points"></g></g>',legendItemMarkup:'<g class="legend-item"><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"chart.Plot",attrs:{".data path":{fill:"none",stroke:"black"},".data .bars rect":{fill:"none",stroke:"black"},".background rect":{fill:"white",stroke:"#e5e5e5",opacity:1},".background text":{fill:"black",text:"No data available.",ref:".","ref-x":0.5,"ref-y":0.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":0.5,"ref-y":10,"text-anchor":"middle","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":0.5,"ref-y":23,"text-anchor":"middle","y-alignment":"middle","font-size":10},".point":{display:"inline-block"},".point circle":{r:2,stroke:"black",fill:"black",opacity:0.3},".point text":{fill:"black","font-size":8,"text-anchor":"middle",display:"none"},".axis path":{fill:"none",stroke:"black"},".axis .tick":{fill:"none",stroke:"black"},".y-axis .tick line":{fill:"none",stroke:"black",x2:2,y2:0,opacity:1},".x-axis .tick line":{fill:"none",stroke:"black",x2:0,y2:-3,opacity:1},".y-axis .tick text":{fill:"black",stroke:"none","font-size":10,dy:"-.5em",x:-5,"text-anchor":"end"},".x-axis .tick text":{fill:"black",stroke:"none","font-size":10,dy:".5em",x:0,"text-anchor":"middle"},".axis .markings":{fill:"black",stroke:"none","fill-opacity":1},".axis .markings text":{fill:"black","text-anchor":"end","font-size":10,dy:-5,dx:-5},".guideline":{"pointer-events":"none",display:"none"},".x-guideline":{stroke:"black",visibility:"hidden"},".y-guideline":{stroke:"black",visibility:"hidden"},".legend":{ref:".background","ref-x":10,"ref-y":10},".legend-item text":{fill:"black",transform:"translate(14, 0)","font-size":11},".legend-item circle":{r:5,transform:"translate(5,5)"},".legend-item":{cursor:"pointer"},".legend-item.disabled circle":{fill:"gray"},".legend-item.disabled text":{opacity:0.5}}},joint.shapes.basic.Generic.prototype.defaults),legendPosition:function(d,b){b=b||{};this.trigger("batch:start");this.removeAttr([".legend/ref-x",".legend/ref-y",".legend/ref-dx",".legend/ref-dy",".legend/x-alignment",".legend/y-alignment"],{silent:true});var c=b.padding||10;var a={n:{".legend":{"ref-x":0.5,"x-alignment":-0.5,"ref-y":c}},ne:{".legend":{"ref-dx":-c,"x-alignment":-0.999,"ref-y":c}},e:{".legend":{"ref-dx":-c,"x-alignment":-0.999,"ref-y":0.5,"y-alignment":-0.5}},se:{".legend":{"ref-dx":-c,"ref-dy":-c,"x-alignment":-0.999,"y-alignment":-0.999}},s:{".legend":{"ref-x":0.5,"ref-dy":-c,"x-alignment":-0.5,"y-alignment":-0.999}},sw:{".legend":{"ref-x":c,"ref-dy":-c,"y-alignment":-0.999}},w:{".legend":{"ref-x":c,"ref-y":0.5,"y-alignment":-0.5}},nw:{".legend":{"ref-x":c,"ref-y":c}},nnw:{".legend":{"ref-x":c,"ref-y":-c,"y-alignment":-0.999}},nn:{".legend":{"ref-x":0.5,"ref-y":-c,"x-alignment":-0.5,"y-alignment":-0.999}},nne:{".legend":{"ref-dx":-c,"ref-y":-c,"x-alignment":-0.999,"y-alignment":-0.999}},nnee:{".legend":{"ref-dx":c,"ref-y":-c,"y-alignment":-0.999}},nee:{".legend":{"ref-y":c,"ref-dx":c}},ee:{".legend":{"ref-dx":c,"ref-y":0.5,"y-alignment":-0.5}},see:{".legend":{"ref-dx":c,"ref-dy":-c,"y-alignment":-0.999}},ssee:{".legend":{"ref-dx":c,"ref-dy":c}},sse:{".legend":{"ref-dx":-c,"ref-dy":c,"x-alignment":-0.999}},ss:{".legend":{"ref-x":0.5,"ref-dy":c,"x-alignment":-0.5}},ssw:{".legend":{"ref-x":c,"ref-dy":c}},ssww:{".legend":{"ref-x":-c,"ref-dy":c,"x-alignment":-0.999}},sww:{".legend":{"ref-x":-c,"ref-dy":-c,"x-alignment":-0.999,"y-alignment":-0.999}},ww:{".legend":{"ref-x":-c,"ref-y":0.5,"x-alignment":-0.999,"y-alignment":-0.5}},nww:{".legend":{"ref-x":-c,"ref-y":c,"x-alignment":-0.999}},nnww:{".legend":{"ref-x":-c,"ref-y":-c,"x-alignment":-0.999,"y-alignment":-0.999}}};if(a[d]){this.attr(a[d])}this.trigger("batch:stop")},addPoint:function(h,d,c){c=c||{};var b=this.get("series");var a=_.findIndex(b,{name:d});if(a===-1){throw new Error("Serie "+d+" was not found.")}var f=_.cloneDeep(b[a]);f.data.push(h);if(_.isFinite(c.maxLen)&&f.data.length>c.maxLen){f.data.shift()}b=b.slice();b[a]=f;this.set("series",b,c)},lastPoint:function(a){return _.last(_.findWhere(this.get("series"),{name:a}).data)},firstPoint:function(a){return _.first(_.findWhere(this.get("series"),{name:a}).data)}});joint.shapes.chart.PlotView=joint.dia.ElementView.extend({events:{mousemove:"onMouseMove",mouseout:"onMouseOut"},initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:series change:interpolate change:padding change:canvas change:markings change:axis",_.bind(function(){this.update()},this));this.on("cell:pointerdown",this.onPointerDown,this);this._disabledSeries=[]},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments);this.elDataClipPath=this.$(".clip")[0];this.elDataClipPathRect=this.elDataClipPath.firstChild;this.elBackgroundRect=this.$(".background rect")[0];this.elBackgroundText=this.$(".background text")[0];this.elForeground=this.$(".foreground")[0];this.elForegroundRect=this.$(".foreground rect")[0];this.elDataSeries=this.$(".data .series")[0];this.elYAxisPath=this.$(".y-axis path")[0];this.elYAxisTicks=this.$(".y-axis .ticks")[0];this.elXAxisPath=this.$(".x-axis path")[0];this.elXAxisTicks=this.$(".x-axis .ticks")[0];this.elMarkings=this.$(".axis .markings")[0];this.elXGuideline=this.$(".x-guideline")[0];this.elYGuideline=this.$(".y-guideline")[0];this.elLegend=this.$(".legend")[0];this.elLegendItems=this.$(".legend-items")[0];this.elTick=V(this.model.tickMarkup);this.elMarking=V(this.model.markingMarkup);this.elLegendItem=V(this.model.legendItemMarkup);this.elPoint=V(this.model.pointMarkup);this.elBar=V(this.model.barMarkup);this.elSerie=V(this.model.serieMarkup);this.elDataClipPath.id="clip_"+this.cid;V(this.$(".data")[0]).attr("clip-path","url(#"+this.elDataClipPath.id+")");V(this.elMarkings).attr("clip-path","url(#"+this.elDataClipPath.id+")")},update:function(f){f=this.filterSeries(f);this.calculateStats(f);var d=this.model.get("size");var h=d.width;var a=d.height;this.canvas=_.extend({x:0,y:0,width:h,height:a},this.model.get("canvas"));var k;var j={top:0,right:0,bottom:0,left:0};var c=this.model.get("padding");if(_.isObject(c)){k=_.extend({},j,c)}else{if(!_.isUndefined(c)){k={top:c,right:2*c,bottom:2*c,left:c}}else{k=j}}this.canvas=g.rect(this.canvas).moveAndExpand(g.rect(k.left,k.top,-k.right,-k.bottom));var b={x:0,y:0,width:h,height:a};V(this.elDataClipPathRect).attr(b);V(this.elBackgroundRect).attr(b);V(this.elForegroundRect).attr(b);this.updateAxis();this.updateMarkings();if(this.isEmpty()){$(this.elBackgroundText).show()}else{$(this.elBackgroundText).hide()}this.updateSeries(f);this.updateLegend();joint.dia.ElementView.prototype.update.apply(this,arguments)},calculateStats:function(f){f=f||this.model.get("series");var b=[];var k=[];var l={};var h={};var j={};_.each(f,function(p,m){var n=j[p.name||m]||(j[p.name||m]={});n.decreasingX=true;n.decreasingY=true;n.nonDecreasingX=true;n.nonDecreasingY=true;var o;_.each(p.data,function(q){n.minX=_.isUndefined(n.minX)?q.x:Math.min(n.minX,q.x);n.maxX=_.isUndefined(n.maxX)?q.x:Math.max(n.maxX,q.x);n.minY=_.isUndefined(n.minY)?q.y:Math.min(n.minY,q.y);n.maxY=_.isUndefined(n.maxY)?q.y:Math.max(n.maxY,q.y);if(o){n.decreasingX=n.decreasingX&&q.x<o.x;n.decreasingY=n.decreasingY&&q.y<o.y;n.nonDecreasingX=n.nonDecreasingX&&q.x>=o.x;n.nonDecreasingY=n.nonDecreasingY&&q.y>=o.y}if(!_.contains(b,q.x)){b.push(q.x)}if(!_.contains(k,q.y)){k.push(q.y)}(l[q.x]||(l[q.x]=[])).push({serie:p,x:q.x,y:q.y});(h[q.y]||(h[q.y]=[])).push({serie:p,x:q.x,y:q.y});o=q})});var d=this.model.get("axis")||{};var c=d["x-axis"]||{};var a=d["y-axis"]||{};this.stats={minX:_.isUndefined(c.min)?_.min(b):c.min,maxX:_.isUndefined(c.max)?_.max(b):c.max,minY:_.isUndefined(a.min)?_.min(k):a.min,maxY:_.isUndefined(a.max)?_.max(k):a.max,bySerie:j,xValues:b,yValues:k,xMap:l,yMap:h}},isEmpty:function(){return !this.stats.xValues.length},updateSeries:function(d){d=d||this.model.get("series");this.elDataSeries.textContent="";if(this.isEmpty()){return}var c=[this.stats.minX,this.stats.maxX];var f=[this.stats.minY,this.stats.maxY];var a=[this.canvas.x,this.canvas.x+this.canvas.width];var h=[this.canvas.y+this.canvas.height,this.canvas.y];var b=this.model.get("attrs");_.each(d,function(r,p){var s=r.data;var t=[];var l=this.elSerie.clone().attr("class",r.name||("serie-"+p));V(this.elDataSeries).append(l);_.each(s,function(w){var v=g.scale.linear(c,a,w.x);var z=g.scale.linear(f,h,w.y);t.push({x:v,y:z});if(b[".point"]&&b[".point"].display!=="none"){this.renderPoint(w,r)}if(r.bars){this.renderBar(w,r)}},this);var o=l.findOne(".serie-clip");var u=this.model.get("size");var q=this.stats.bySerie[r.name||p];var k=g.scale.linear(c,a,q.minX);var j=g.scale.linear(c,a,q.maxX);var n=o.findOne("rect");n.attr(g.rect(k,0,j-k,u.height));if(!r.bars){var m=l.findOne("path");m.attr({d:this.seriePathData(t,r,p),"clip-path":"url(#"+o.node.id+")"})}},this)},seriePathClipData:function(b,c){var h=10;var a=this.model.get("size");var k=_.first(b);var f=_.last(b);var j=["M",k.x,k.y,"V",a.height+h];return j.join(" ")},renderBar:function(l,m){var o=[this.stats.minX,this.stats.maxX];var n=[this.stats.minY,this.stats.maxY];var k=[this.canvas.x,this.canvas.x+this.canvas.width];var q=[this.canvas.y+this.canvas.height,this.canvas.y];var f=g.scale.linear(o,k,l.x);var c=g.scale.linear(n,q,l.y);var u=m.bars.barWidth||0.8;var j=u>1?u:(this.canvas.width/(this.stats.maxX-this.stats.minX))*u;var r=g.scale.linear(n,q,0)-c;var d=l["top-rx"]||m.bars["top-rx"];var b=l["top-ry"]||m.bars["top-ry"];var t=l["bottom-rx"]||m.bars["bottom-rx"];var s=l["bottom-ry"]||m.bars["bottom-ry"];var a=({left:f,middle:f-j/2,right:f-j})[m.bars.align||"middle"];var h=this.elBar.clone();h.attr({"data-serie":m.name,"data-x":l.x,"data-y":l.y,d:V.rectToPath({x:a,y:c,width:j,height:r,"top-rx":d,"top-ry":b,"bottom-rx":t,"bottom-ry":s})});var v=m.name||("serie-"+this.model.get("series").indexOf(m));V(this.elDataSeries).findOne("."+v+" .bars").append(h);return h.node},renderPoint:function(c,h){var k=[this.stats.minX,this.stats.maxX];var a=[this.stats.minY,this.stats.maxY];var b=[this.canvas.x,this.canvas.x+this.canvas.width];var f=[this.canvas.y+this.canvas.height,this.canvas.y];var m=g.scale.linear(k,b,c.x);var l=g.scale.linear(a,f,c.y);var j=this.elPoint.clone();j.attr({"data-serie":h.name,"data-x":c.x,"data-y":c.y});j.findOne("circle").attr({cx:m,cy:l});j.findOne("text").attr({x:m,dy:l}).text(this.pointLabel(c,h));var d=h.name||("serie-"+this.model.get("series").indexOf(h));V(this.elDataSeries).findOne("."+d+" .points").append(j);return j.node},seriePathData:function(h,j,a){var b=_.isUndefined(j.interpolate)?this.model.get("interpolate"):j.interpolate;var l;var c;var k;var f=h.length;switch(b){case"bezier":l=g.bezier.curveThroughPoints(h);break;case"step":k=h[0];l=["M",k.x,k.y];for(c=1;c<f;c++){l.push("H",(k.x+h[c].x)/2,"V",h[c].y);k=h[c]}break;case"stepBefore":l=["M",h[0].x,h[0].y];for(c=1;c<f;c++){l.push("V",h[c].y,"H",h[c].x)}break;case"stepAfter":l=["M",h[0].x,h[0].y];for(c=1;c<f;c++){l.push("H",h[c].x,"V",h[c].y)}break;default:l=["M"];for(c=0;c<f;c++){l.push(h[c].x,h[c].y)}break}l=this.fixPathForFill(l,h,j,a);return l.join(" ")},fixPathForFill:function(f,l,c,k){if(l.length===0){return f}var b=this.stats.bySerie[c.name||k];if(!b.nonDecreasingX){return f}var j=10;var n=this.model.get("size");var a=_.first(l);var h=_.last(l);var m=["M",h.x,n.height+j,"H",a.x-j,"V",a.y];f[0]="L";return m.concat(f)},updateAxis:function(){var t=this.model.get("size");var d=t.width;var s=t.height;var k=this.model.get("axis");var p=this.canvas.height/s;var j=this.canvas.width/d;V(this.elYAxisPath).attr("d",["M",0,0,"L",0,s].join(" "));V(this.elXAxisPath).attr("d",["M",0,s,"L",d,s].join(" "));this.elXAxisTicks.textContent="";this.elYAxisTicks.textContent="";if(this.isEmpty()){return}var n=[this.stats.minX,this.stats.maxX];var b=[this.stats.minY,this.stats.maxY];var a=[this.canvas.x,this.canvas.x+this.canvas.width];var m=[0,this.canvas.height];var l=n[1]-n[0];var h=b[1]-b[0];var c=k&&k["y-axis"]||{};var f=k&&k["x-axis"]||{};var r=(h)>0?(c.ticks-1||10):0;var o=(h/r)/p;var q=b[0];_.each(_.range(r+1),function(x){var v=g.scale.linear(b,m,q);var u=this.elTick.clone();u.translate(0,v);V(this.elYAxisTicks).append(u);var w=b[1]-(q-b[0]);w+=g.scale.linear(m,b,this.canvas.y)-b[0];u.findOne("text").text(this.tickLabel(w,c));q+=o},this);_.each(this.stats.xValues,function(v,y){if(y%(f.tickStep||1)!==0){return}var w=g.scale.linear(n,a,v);if(w>d){return}var u=this.elTick.clone();u.translate(w,s);V(this.elXAxisTicks).append(u);u.findOne("text").text(this.tickLabel(v,f))},this)},tickLabel:function(d,b){if(_.isFunction(b.tickFormat)){return b.tickFormat(d)}var c=b.tickFormat||".1f";var a=joint.util.format.number(c,d);return a+(_.isFunction(b.tickSuffix)?b.tickSuffix(d):(b.tickSuffix||""))},pointLabel:function(d,b){if(_.isFunction(b.pointFormat)){return b.pointFormat(d)}var c=b.pointFormat||".1f";var a=joint.util.format.number(c,d.y);return a+(b.pointSuffix||"")},updateMarkings:function(){this.elMarkings.textContent="";var f=this.model.get("markings");if(!f||f.length===0){return}var l=this.model.get("size");var c=l.width;var k=l.height;var j=[this.stats.minX,this.stats.maxX];var a=[this.stats.minY,this.stats.maxY];var b=[this.canvas.x,this.canvas.x+this.canvas.width];var d=[this.canvas.y,this.canvas.y+this.canvas.height];function h(n,m){return _.isUndefined(n)?m:n}_.each(f,function(F,z){var u=F.start||F.end;var t=F.end||F.start;var C=Math.min(h(u.x,this.stats.minX),h(t.x,this.stats.minX));var o=Math.max(h(u.x,this.stats.maxX),h(t.x,this.stats.maxX));var A=Math.min(h(u.y,this.stats.minY),h(t.y,this.stats.minY));var m=Math.max(h(u.y,this.stats.maxY),h(t.y,this.stats.maxY));var s=_.isUndefined(u.x)||_.isUndefined(t.x);var r=_.isUndefined(u.y)||_.isUndefined(t.y);if(s){b=[0,c]}if(r){d=[0,k]}var D=g.scale.linear(j,b,C);var p=g.scale.linear(j,b,o);var B=g.scale.linear(a,d,A);var n=g.scale.linear(a,d,m);var x=D;var w=d[1]-n+d[0];var y=p-D;var E=n-B;y=Math.max(y,1);E=Math.max(E,1);var v=this.elMarking.clone();v.findOne("rect").attr({x:x,y:w,width:y,height:E});v.findOne("text").text(F.label||"").attr({x:x+y,y:w});var q=v.attr("class")+" "+(F.name||("marking-"+z));v.attr(_.extend({"class":q},F.attrs));V(this.elMarkings).append(v)},this)},updateLegend:function(){var a=this.model.get("series");this.elLegendItems.textContent="";_.each(a,function(d,c){if(_.isFunction(d.showLegend)&&!d.showLegend(d,this.stats.bySerie[d.name||c])){return}else{if(d.showLegend===false){return}}var b=this.elLegendItem.clone();if(_.contains(this._disabledSeries,d.name)){b.addClass("disabled")}b.attr("data-serie",d.name);b.findOne("circle").attr({fill:this.getSerieColor(d.name)});b.findOne("text").text(d.label||d.name);b.translate(0,c*(d.legendLabelLineHeight||16));V(this.elLegendItems).append(b)},this)},getSerieColor:function(c){var b=this.model.get("attrs");var a=_.find(b,function(f,d){if(_.contains(d,c)){return true}});return a?a.stroke||a.fill:"black"},hideSerie:function(b){if(!_.contains(this._disabledSeries,b)){this._disabledSeries.push(b)}var a=this.filterSeries();this.update(a)},showSerie:function(b){this._disabledSeries=_.without(this._disabledSeries,b);var a=this.filterSeries();this.update(a)},filterSeries:function(a){a=a||this.model.get("series");a=_.reject(a,function(b){return _.contains(this._disabledSeries,b.name)},this);return a},onPointerDown:function(b,a,d){var c=$(b.target).closest(".legend-item")[0];if(c){V(c).toggleClass("disabled");if(V(c).hasClass("disabled")){this.hideSerie(V(c).attr("data-serie"))}else{this.showSerie(V(c).attr("data-serie"))}}},onMouseMove:function(a){this.showGuidelines(a.clientX,a.clientY,a)},onMouseOut:function(a){this.hideGuidelines();this.trigger("mouseout",a)},showGuidelines:function(c,b,o){var d=this.model.get("angle");var p=this.model.getBBox();var f=this.model.get("series");var q=g.point(V(this.paper.viewport).toLocalPoint(c,b)).rotate(p.center(),d);if(g.rect(p).containsPoint(q)){var r=this.model.get("size");var n=q.x-p.x;var m=q.y-p.y;V(this.elXGuideline).attr({x1:n,y1:0,x2:n,y2:r.height,visibility:"visible"});V(this.elYGuideline).attr({x1:0,y1:m,x2:r.width,y2:m,visibility:"visible"});var l=g.scale.linear([this.canvas.x,this.canvas.x+this.canvas.width],[this.stats.minX,this.stats.maxX],n);var k=g.scale.linear([this.canvas.y,this.canvas.y+this.canvas.height],[this.stats.minY,this.stats.maxY],m);var a={x:l,y:this.stats.minY+this.stats.maxY-k};var j={x:c,y:b};var h=this.closestPoints(l);this.trigger("mouseover",a,j,h,o)}},closestPoints:function(a){var f=_.sortedIndex(this.stats.xValues,a);var c=this.stats.xValues[f];var d=this.stats.xValues[f-1];var b=_.isUndefined(d)?c:(Math.abs(a-c)<Math.abs(a-d)?c:d);return this.stats.xMap[b]},hideGuidelines:function(){V(this.elXGuideline).attr("visibility","hidden");V(this.elYGuideline).attr("visibility","hidden")}});joint.shapes.chart.Pie=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="data"></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>',"</g>","</g>"].join(""),sliceMarkup:'<g class="slice"/>',sliceFillMarkup:'<path class="slice-fill"/>',sliceBorderMarkup:'<path class="slice-border"/>',sliceInnerLabelMarkup:'<text class="slice-inner-label"/>',legendSerieMarkup:'<g class="legend-serie"><text/></g>',legendSliceMarkup:'<g class="legend-slice"><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"chart.Pie",size:{width:200,height:200},pieHole:0,serieDefaults:{startAngle:0,degree:360,label:null,showLegend:true,labelLineHeight:6},sliceDefaults:{innerLabel:"{percentage:.0f}%",innerLabelMargin:6,legendLabel:"{label}: {value}",legendLabelLineHeight:6,legendLabelMargin:14,offset:0,onClickEffect:{type:"offset",offset:20},onHoverEffect:null},series:[],attrs:{".background > rect":{opacity:0},".background > text":{fill:"black",text:"No data available.",ref:".background > rect","ref-x":0.5,"ref-y":0.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":6,"text-anchor":"start","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":18,"text-anchor":"start","y-alignment":"middle","font-size":10},".data":{ref:".background","ref-x":0.5,"ref-y":0.5},".slice":{cursor:"pointer"},".slice > .slice-fill":{stroke:"#ffffff","stroke-width":1,"fill-opacity":1},".slice.hover > .slice-fill":{"fill-opacity":0.8},".slice > .slice-border":{"stroke-width":6,"stroke-opacity":0.4,"fill-opacity":1,fill:"none",display:"none"},".slice.hover > .slice-border":{display:"block"},".slice > .slice-inner-label":{"text-anchor":"middle","font-size":"12",stroke:"none","stroke-width":"0",fill:"#ffffff",dy:"-.5em"},".legend":{ref:".background","ref-dx":20,"ref-y":5},".legend-serie text":{fill:"grey",transform:"translate(2, 0)","font-size":13},".legend-slice":{cursor:"pointer"},".legend-slice text":{"font-weight":"normal",fill:"black","font-size":11},".legend-slice.hover text":{"font-weight":"bold"},".legend-slice circle":{r:5,transform:"translate(5,5)"}}},joint.shapes.basic.Generic.prototype.defaults),addSlice:function(f,a,c){c=c||{};a=a||0;var b=this.get("series");if(_.isUndefined(b[a])){b[a]={data:[]}}var d=_.cloneDeep(b[a]);d.data.push(f);b=b.slice();b[a]=d;c=d.data.length>1?_.extend(c,{changedSerieIndex:a}):c;this.set("series",b,c)},editSlice:function(h,f,a,c){c=c||{};a=a||0;var b=this.get("series");if(_.isUndefined(b[a])||_.isUndefined(b[a].data[f])){throw new Error("Slice "+f+" on serie "+a+" was not found.")}var d=_.cloneDeep(b[a]);d.data[f]=_.extend(d.data[f],h);b=b.slice();b[a]=d;this.set("series",b,_.extend(c,{changedSerieIndex:a}))}});joint.shapes.chart.PieView=joint.dia.ElementView.extend({events:{"mouseover .slice":"onMouseOverSlice","mouseout .slice":"onMouseOverSlice","mousemove .slice":"onMouseMoveSlice","mouseover .legend-slice":"onEventLegendItem","mouseout .legend-slice":"onEventLegendItem"},initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:series change:serieDefaults change:sliceDefaults change:pieHole",function(b,a,c){this.update(null,null,c.changedSerieIndex)});this.on("cell:pointerclick",this.onClickSlice,this);this.on("cell:pointerclick",this.onEventLegendItem,this)},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments);this.elBackgroundRect=this.$(".background rect")[0];this.elBackgroundText=this.$(".background text")[0];this.elForegroundRect=this.$(".foreground rect")[0];this.elLegendItems=this.$(".legend-items")[0];this.elPie=this.$(".data")[0];this.elSlice=V(this.model.sliceMarkup);this.elSliceFill=V(this.model.sliceFillMarkup);this.elSliceBorder=V(this.model.sliceBorderMarkup);this.elSliceInnerLabel=V(this.model.sliceInnerLabelMarkup);this.elLegendSerie=V(this.model.legendSerieMarkup);this.elLegendSlice=V(this.model.legendSliceMarkup)},update:function(a,f,b){var d=this.calculateSeries(b);if(b in d){$(this.elPie).find(".serie-"+b).remove()}else{$(this.elPie).empty()}var c=this.model.get("size");V(this.elBackgroundRect).attr(c);V(this.elForegroundRect).attr(c);if(!d.length){$(this.elBackgroundText).show()}else{$(this.elBackgroundText).hide()}_.each(d,function(j,h){if(!_.isUndefined(b)&&b!==h){return}_.each(j.data,function(k){this.updateSlice(k)},this)},this);this.updateLegend();joint.dia.ElementView.prototype.update.apply(this,arguments)},calculateSeries:function(k){var c=_.cloneDeep(this.model.get("series"));var a=this.model.get("serieDefaults");var h=this.model.get("sliceDefaults");var l=this.model.get("size");var j=(_.min([l.width,l.height])/2);var d=this.model.get("pieHole");d=d>1?d:j*d;var f=j;var b=(j-d)/c.length;this._series=_.map(c,function(q,m){if(!_.isUndefined(k)&&k!==m){return q}q=_.defaults(q,a);var n=q.startAngle;var p=_.reduce(q.data,function(s,t){return s+t.value},0);var r=q.degree/p||0;var o=100/p;q.data=_.map(q.data,function(u,s){u=_.defaults(u,_.omit(h,"offset","onClickEffect","onHoverEffect"));u.outerRadius=f;u.innerRadius=f-b;if(!m){u=_.defaults(u,_.pick(h,"offset","onClickEffect","onHoverEffect"));u.outer=true;u.offset=u.offset>1?u.offset:u.offset*u.outerRadius;u.onClickEffect.offset=u.onClickEffect.offset>1?u.onClickEffect.offset:u.onClickEffect.offset*u.outerRadius}u.serieIndex=m;u.sliceIndex=s;u.innerLabelMargin=(u.innerLabelMargin<-1||u.innerLabelMargin>1)?u.innerLabelMargin:u.innerLabelMargin*u.outerRadius;u.percentage=u.value*o;var t=u.value*r;u.degree={angle:t,start:n,end:t+n};u.rad={angle:g.toRad(u.degree.angle,true),start:g.toRad(u.degree.start,true),end:g.toRad(u.degree.end,true)};u.middleangle=(u.rad.start+u.rad.end)/2;n=u.degree.end;return u});f-=b;return q});return this._series},updateLegend:function(){var c=this._series;this.elLegendItems.textContent="";var b=0;var a=parseInt(this.model.attr(".legend-serie text/font-size"),10);var d=parseInt(this.model.attr(".legend-slice text/font-size"),10);_.each(c,function(j,f){if(!j.showLegend){return}if(j.label){var h=this.elLegendSerie.clone();if(j.name){h.addClass(j.name)}h.attr({"data-serie":f});h.findOne("text").text(j.label);h.translate(0,b);V(this.elLegendItems).append(h);b+=(a+j.labelLineHeight)}_.each(j.data,function(n,l){var k=this.elLegendSlice.clone();var m=this.getSliceFillColor(l,f);if(n.name){k.addClass(n.name)}k.attr({"data-serie":f,"data-slice":l});k.findOne("circle").attr({fill:m});k.findOne("text").text(joint.util.format.string(n.legendLabel,n));k.findOne("text").translate(n.legendLabelMargin);k.translate(0,b);b+=(d+n.legendLabelLineHeight);V(this.elLegendItems).append(k);if(_.isObject(m)){this.applyGradient("#"+k.findOne("circle").attr("id"),"fill",m)}},this)},this)},updateSlice:function(o){var j=this.elSlice.clone();V(this.elPie).append(j);var f=this.elSliceFill.clone();var d=this.getSliceFillColor(o.sliceIndex,o.serieIndex);f.attr({fill:d,d:this.drawSlice(o.innerRadius,o.outerRadius,o.rad.start,o.rad.end)});j.append(f);if(_.isObject(d)){this.applyGradient("#"+f.attr("id"),"fill",d)}var m=this.elSliceBorder.clone();var b=parseInt(this.model.attr(".slice > .slice-border/stroke-width"),10);var c=g.point.fromPolar(o.outerRadius+b/2,-o.rad.start,g.point(0,0));var n=g.point.fromPolar(o.outerRadius+b/2,-o.rad.end,g.point(0,0));m.attr({stroke:d,d:this.drawArc(c,n,o.outerRadius+b/2,o.rad.start,o.rad.end)});j.append(m);if(_.isObject(d)){this.applyGradient("#"+m.attr("id"),"stroke",d)}var a=this.elSliceInnerLabel.clone();a.text(joint.util.format.string(o.innerLabel,o));j.append(a);var k=a.bbox();var l=(o.outerRadius-k.width/2)-o.innerLabelMargin;a.translate((l*Math.cos(-o.middleangle)),(-l*Math.sin(-o.middleangle)));j.attr({"data-serie":o.serieIndex,"data-slice":o.sliceIndex,"data-value":o.value});var h=this._series[o.serieIndex].name;if(h){j.addClass(h)}if(o.name){j.addClass(o.name)}j.addClass("serie-"+o.serieIndex+" slice-"+o.sliceIndex);if(o.outer){j.addClass("outer");if(o.offset){j.addClass("clicked");this.effectOnSlice(j,o,{type:"offset",offset:o.offset})}}return j},getSliceFillColor:function(d,a){a=a||0;var c=this.model.get("attrs");var b=_.find(c,function(h,f){return f.indexOf(".serie-"+a+".slice-"+d+" > .slice-fill")>-1});return b?b.fill:this._series[a].data[d].fill},onMouseMoveSlice:function(c){var d=V(c.currentTarget);var a=d.attr("data-serie");var b=d.attr("data-slice");var f=this._series[a].data[b];this.trigger(c.type,f,c)},mouseOverSlice:function(c,a){a=a||0;var f=V(this.$('.slice[data-serie="'+a+'"][data-slice="'+c+'"]')[0]);var h=this._series[a].data[c];f.toggleClass("hover");if(h.outer&&!_.isEmpty(h.onHoverEffect)){this.effectOnSlice(f,h,h.onHoverEffect,f.hasClass("hover")?false:true)}var b=V(this.$('.legend-slice[data-serie="'+a+'"][data-slice="'+c+'"]')[0]);if(b){b.toggleClass("hover")}var d=_.filter(_.keys(this.model.get("attrs")),function(j){return(j.indexOf(".slice")>-1||j.indexOf(".legend-slice")>-1)});joint.dia.ElementView.prototype.update.call(this,this.model,_.pick(this.model.get("attrs"),d))},onMouseOverSlice:function(c){var d=V(c.currentTarget);var a=d.attr("data-serie");var b=d.attr("data-slice");this.mouseOverSlice(b,a);var f=this._series[a].data[b];this.trigger(c.type,f,c)},clickSlice:function(b,a){a=a||0;var c=V(this.$('.slice[data-serie="'+a+'"][data-slice="'+b+'"]')[0]);var d=this._series[a].data[b];if(!d.outer){return}if(!c.hasClass("clicked")){c.addClass("clicked");this.model.get("series")[a].data[b].offset=d.onClickEffect.offset;this.effectOnSlice(c,d,d.onClickEffect)}else{c.removeClass("clicked");this.model.get("series")[a].data[b].offset=0;this.effectOnSlice(c,d,d.onClickEffect,true)}},onClickSlice:function(c){var d=V($(c.target).closest(".slice.outer")[0]);if(d){var a=d.attr("data-serie");var b=d.attr("data-slice");this.clickSlice(b,a);var f=this._series[a].data[b];this.trigger(c.type,f,c)}},onEventLegendItem:function(d){var b=V($(d.target).closest(".legend-slice")[0]);if(b){var a=b.attr("data-serie");var c=b.attr("data-slice");switch(d.type){case"click":this.clickSlice(c,a);break;case"mouseover":case"mouseout":this.mouseOverSlice(c,a);break}}},effectOnSlice:function(c,d,b,a){a=a||false;switch(b.type){case"enlarge":if(!a){c.scale(b.scale||1.05)}else{c.scale(1)}break;case"offset":if(!a){c.translate(b.offset*Math.cos(-d.middleangle),-b.offset*Math.sin(-d.middleangle))}else{c.translate(0,0,{absolute:true})}break}},svgArcMax:2*Math.PI-0.000001,drawArc:function(h,d,a,c,b){var j=0;var f=1;var k=b-c;if(k>Math.PI){j=1;if(k>=this.svgArcMax){j=0;f=0}}return"M"+h.x+","+h.y+" A"+a+","+a+" 0 "+j+","+f+" "+d.x+","+d.y},drawSlice:function(m,k,l,c){var f=m;var d=k;var b=l;var a=c;var q=(a<b&&(q=b,b=a,a=q),a-b);var n=q<Math.PI?"0":"1";var j=Math.cos(b);var p=Math.sin(b);var h=Math.cos(a);var o=Math.sin(a);return q>=this.svgArcMax?(f?"M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"M0,"+f+"A"+f+","+f+" 0 1,0 0,"+(-f)+"A"+f+","+f+" 0 1,0 0,"+f+"Z":"M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"Z"):(f?"M"+d*j+","+d*p+"A"+d+","+d+" 0 "+n+",1 "+d*h+","+d*o+"L"+f*h+","+f*o+"A"+f+","+f+" 0 "+n+",0 "+f*j+","+f*p+"Z":"M"+d*j+","+d*p+"A"+d+","+d+" 0 "+n+",1 "+d*h+","+d*o+"L0,0Z")}});joint.shapes.chart.Knob=joint.shapes.chart.Pie.extend({defaults:joint.util.deepSupplement({type:"chart.Knob",sliceDefaults:{legendLabel:"{value:.0f}",outer:{offsetOnClick:0}},pieHole:0.7,value:0,attrs:{".legend":{"ref-x":0.5,"ref-y":0.5,"x-alignment":-0.9,"y-alignment":-0.4},".legend-slice text":{"font-size":30},".legend-slice circle":{display:"none"},".slice-inner-label":{display:"none"},".slice-fill":{stroke:"none"}}},joint.shapes.chart.Pie.prototype.defaults),initialize:function(){this.set("series",this.getKnobSeries(),{silent:true});joint.shapes.chart.Pie.prototype.initialize.apply(this,arguments);this.on("change:value change:min change:max change:fill",this.updateKnob,this)},getKnobSeries:function(){var a=_.isArray(this.get("value"))?this.get("value"):[this.get("value")];var f=_.isArray(this.get("fill"))?this.get("fill"):[this.get("fill")];var d=_.isArray(this.get("min"))?this.get("min"):[this.get("min")];var b=_.isArray(this.get("max"))?this.get("max"):[this.get("max")];var c=_.map(a,function(l,k){var j=_.isUndefined(d[k])?d[0]:d[k];var h=_.isUndefined(b[k])?b[0]:b[k];var m=_.isUndefined(f[k])?f[0]:f[k];return{degree:g.scale.linear([j,h],[0,360],l),data:[{value:l,fill:m}],showLegend:k>0?false:true}});return c},updateKnob:function(){this.set("series",this.getKnobSeries())}});joint.shapes.chart.KnobView=joint.shapes.chart.PieView;joint.shapes.chart.Matrix=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<g class="background"><rect/></g>','<g class="cells"/>','<g class="foreground"/>',"</g>",'<g class="labels">','<g class="rows"/>','<g class="columns"/>',"</g>","</g>"].join(""),cellMarkup:'<rect class="cell"/>',labelMarkup:'<text class="label"/>',gridLineMarkup:'<path class="grid-line"/>',defaults:joint.util.deepSupplement({type:"chart.Matrix",attrs:{".background rect":{fill:"#eeeeee"},".grid-line":{stroke:"white","stroke-width":2},".label":{fill:"black","alignment-baseline":"middle"},".labels .rows .label":{"text-anchor":"end"},".labels .columns .label":{"text-anchor":"start"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.chart.MatrixView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:size",_.bind(function(){this.renderLabels();this.update()},this));this.listenTo(this.model,"change:cells",_.bind(function(){this.renderMarkup();this.update()},this))},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments);this.elCells=this.$(".cells")[0];this.elRowLabels=this.$(".labels .rows")[0];this.elColumnLabels=this.$(".labels .columns")[0];this.elForeground=this.$(".foreground")[0];this.elCell=V(this.model.cellMarkup);this.elGridLine=V(this.model.gridLineMarkup);var n=this.model.get("cells")||[];var p=this.model.get("size");this.elBackgroundRect=this.$(".background rect")[0];V(this.elBackgroundRect).attr(p);var k=p.height/n.length;var b=p.width/n.length;var a=document.createDocumentFragment();this.elCells.textContent="";this.elForeground.textContent="";var h=document.createDocumentFragment();for(var f=0;f<n.length;f++){var c=this.elGridLine.clone();c.addClass("horizontal");c.attr("d","M 0 "+(f*k)+" "+p.width+" "+(f*k));h.appendChild(c.node);var o=n[f];for(var d=0;d<o.length;d++){if(f===0){var c=this.elGridLine.clone();c.addClass("vertical");c.attr("d","M "+(d*b)+" 0 "+(d*b)+" "+p.height);h.appendChild(c.node)}var m=o[d];if(m){var l=this.elCell.clone();l.attr(_.extend({x:d*b,y:f*k,width:b,height:k},m));a.appendChild(l.node)}}}this.elForeground.appendChild(h);this.elCells.appendChild(a);this.renderLabels()},renderLabels:function(){this.elLabel=V(this.model.labelMarkup);var r=this.model.get("cells")||[];var h=this.model.get("labels")||{};var m=h.rows||[];var b=h.columns||[];var s=this.model.get("size");var n=s.height/r.length;var a=s.width/r.length;this.elRowLabels.textContent="";this.elColumnLabels.textContent="";var l=document.createDocumentFragment();for(var f=0;f<m.length;f++){var q=h.rows[f];var k=this.elLabel.clone();k.text(q.text);k.attr(_.extend({x:-(h.padding||5),y:f*n+n/2,"text-anchor":"end","alignment-baseline":"middle","font-size":n,"data-row":f},_.omit(q,"text")));l.appendChild(k.node)}this.elRowLabels.appendChild(l);var d=document.createDocumentFragment();for(var c=0;c<b.length;c++){var q=h.columns[c];var k=this.elLabel.clone();k.text(q.text);var p=c*a+a/2;var o=-(h.padding||5);k.attr(_.extend({x:p,y:o,"text-anchor":"start","alignment-baseline":"middle","font-size":a,"data-column":c},_.omit(q,"text")));k.rotate(-90,p,o);d.appendChild(k.node)}this.elColumnLabels.appendChild(d)}});if(typeof exports==="object"){module.exports=joint.shapes.chart}if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,Link:require("../src/joint.dia.link").Link}}}joint.shapes.bpmn={};joint.shapes.bpmn.icons={none:"",message:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIGhlaWdodD0iNTEycHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iNTEycHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik00NzkuOTk4LDY0SDMyQzE0LjMyOSw2NCwwLDc4LjMxMiwwLDk2djMyMGMwLDE3LjY4OCwxNC4zMjksMzIsMzIsMzJoNDQ3Ljk5OEM0OTcuNjcxLDQ0OCw1MTIsNDMzLjY4OCw1MTIsNDE2Vjk2ICBDNTEyLDc4LjMxMiw0OTcuNjcxLDY0LDQ3OS45OTgsNjR6IE00MTYsMTI4TDI1NiwyNTZMOTYsMTI4SDQxNnogTTQ0OCwzODRINjRWMTYwbDE5MiwxNjBsMTkyLTE2MFYzODR6Ii8+PC9zdmc+",plus:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLjUsMTRIMTR2OC41YzAsMC4yNzYtMC4yMjQsMC41LTAuNSwwLjVoLTRDOS4yMjQsMjMsOSwyMi43NzYsOSwyMi41VjE0SDAuNSAgQzAuMjI0LDE0LDAsMTMuNzc2LDAsMTMuNXYtNEMwLDkuMjI0LDAuMjI0LDksMC41LDlIOVYwLjVDOSwwLjIyNCw5LjIyNCwwLDkuNSwwaDRDMTMuNzc2LDAsMTQsMC4yMjQsMTQsMC41VjloOC41ICBDMjIuNzc2LDksMjMsOS4yMjQsMjMsOS41djRDMjMsMTMuNzc2LDIyLjc3NiwxNCwyMi41LDE0eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",cross:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXoiLz48L3N2Zz4=",user:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLDIwLjk5OGgtMWMwLDAtMSwwLTEtMVYxNy41YzAtMC4yNzctMC4yMjQtMC41LTAuNS0wLjVTMTksMTcuMjIzLDE5LDE3LjUgIGwtMC4wMDgsNC4yOTVjMCwwLjYwOS0yLjAxLDIuMjA1LTYuNDkyLDIuMjA1cy02LjQ5Mi0xLjU5Ni02LjQ5Mi0yLjIwNUw2LDE3LjVDNiwxNy4yMjMsNS43NzYsMTcsNS41LDE3UzUsMTcuMjIzLDUsMTcuNXYyLjQ5OCAgYzAsMS0xLDEtMSwxSDNjMCwwLTEsMC0xLTFWMTUuNzVjMC0yLjkyMiwyLjg5Mi01LjQwMSw2LjkzLTYuMzQxYzAsMCwxLjIzNCwxLjEwNywzLjU3LDEuMTA3czMuNTctMS4xMDcsMy41Ny0xLjEwNyAgYzQuMDM4LDAuOTQsNi45MywzLjQxOSw2LjkzLDYuMzQxdjQuMjQ4QzIzLDIwLjk5OCwyMiwyMC45OTgsMjIsMjAuOTk4eiBNMTIuNDc3LDljLTIuNDg1LDAtNC41LTIuMDE1LTQuNS00LjVTOS45OTEsMCwxMi40NzcsMCAgczQuNSwyLjAxNSw0LjUsNC41UzE0Ljk2Miw5LDEyLjQ3Nyw5eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",circle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gULEBE3DEP64QAAAwlJREFUaN7dmktrU0EUx38ZmmBbfEIL2hSjkYKC1EW6EDFudC+404/gE6WKSvGxERQfIH4AX1T9EOKrCrYurVrbgsZWoaBVixDbpC6ci+Fyz9ybZG478cBs7syc+Z+5c86c+c8ksCPrgW1ADtgEbARafG1+AW+AYWAIGADGWUTZAJwHxoD5GssocA7ILiTwLcADoFQHcH8pAfeB7jiBtwO3gLJF4P5S1mO02wa/C5iMEbi/TAI7bYE/Y3m5VLOs+sLAJULqrgKHIxhZBp4DT4FX2jkLGoinq1M7fg7YDmwFVATd14CjFboiy5UIs/QBOAmka/izaeCU1hE2zuVqlZ8IUfgVOAA0WViiTcBBrdM0Zm9UhTuAOYOiRzXOeJh0Ak8M484B+TAlK4BPBiU3gWSMoTqpw6g0fgFYblJww9D5dojT25IEcMeA47rUsdsQLp9FmPmURSNSOqpJS2lzUKd+ocN3IBNx5mz+oXXADwHTXX/jjMFxjy1iwtgrYJoF1lY27BMafozZaaMspYKA7XRlw7f1xt4Y5biA7bXXIGv4TW0OGNCmsQRhzCidlwTJADDlgAFTwAuhLq+AHqHyMe6IhKVHAV1C5ZBDBkhYupThPPreIQNGJTJBGXKLLw4Z8NmQu/Fb8PCkQwakBIxFRWPLvAJmhMpWh4AuFb7PKGBaqFzjkAGrhe/TSjNrQZJ1yAAJy5gCRoTKnEMGSFhGFDBoOBu7IhKWQe8wLRFLHQ6A7zCcFNNK59vvAjoqYK8DBuwTCLBhTUD8Hweahj9S2jjU297VqzrU26BVmi2yEjXRKg1PbHnpqYla7AeWxAi+GbhHHdSit2mYyN2XQQ5kQTJ6Y6qL3PUkCr2+H7v0+jcs0eueRLngGNeKa9mxY73g8JzpEtHusorAQ/7e+e7WUWIl//jSVTrK7QEu6KgW9d7tYr3B44iBWPJfkZZ8pZ4r2VngkC0HywMTLNwN5YSBcKtZWoGzernEBbyox2iJc6Np2KcGfnHisYet1CDouc2yCjbhp07MrD+3+QNxi4JkAscRswAAAABJRU5ErkJggg=="};joint.shapes.bpmn.IconInterface={initialize:function(){this._parent=(this._parent||this).constructor.__super__;this._parent.initialize.apply(this,arguments);this.listenTo(this,"change:icon",this._onIconChange);this._onIconChange(this,this.get("icon")||"none")},_onIconChange:function(a,c){var b=joint.shapes.bpmn.icons;if(_.has(b,c)){a.attr("image/xlink:href",b[c])}else{throw"BPMN: Unknown icon: "+c}}};joint.shapes.bpmn.SubProcessInterface={initialize:function(){this._parent=(this._parent||this).constructor.__super__;this._parent.initialize.apply(this,arguments);this.listenTo(this,"change:subProcess",this._onSubProcessChange);this._onSubProcessChange(this,this.get("subProcess")||null)},_onSubProcessChange:function(a,b){a.attr({".sub-process":{visibility:b?"visible":"hidden","data-sub-process":b||""}})}};joint.shapes.bpmn.ActivityView=joint.shapes.basic.TextBlockView;joint.shapes.bpmn.Activity=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body outer"/><rect class="body inner"/></g>',"<switch>",'<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>','</switch><path class="sub-process"/><image class="icon"/></g>'].join(""),defaults:joint.util.deepSupplement({size:{width:100,height:100},type:"bpmn.Activity",attrs:{rect:{rx:8,ry:8,width:100,height:100},".body":{fill:"#ffffff",stroke:"#000000"},".inner":{transform:"scale(0.9,0.9) translate(5,5)"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".inner","ref-x":0.5,"ref-dy":-30,"x-alignment":"middle",stroke:"#000000",fill:"transparent"},image:{ref:".inner","ref-x":5,width:20,height:20}},activityType:"task",subProcess:null},joint.shapes.basic.TextBlock.prototype.defaults),initialize:function(){joint.shapes.basic.TextBlock.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:activityType",this.onActivityTypeChange);this.listenTo(this,"change:subProcess",this.onSubProcessChange);this.onSubProcessChange(this,this.get("subProcess"));this.onActivityTypeChange(this,this.get("activityType"))},onActivityTypeChange:function(a,b){switch(b){case"task":a.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;case"transaction":a.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".inner"},image:{ref:".inner"}});break;case"event-sub-process":a.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"1,2"},path:{ref:".outer"},image:{ref:".outer"}});break;case"call-activity":a.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;default:throw"BPMN: Unknown Activity Type: "+b;break}},onSubProcessChange:function(a,b){if(b){a.attr({".fobj div":{style:{verticalAlign:"baseline",paddingTop:10}},image:{"ref-dy":-25,"ref-y":""},text:{"ref-y":25}})}else{a.attr({".fobj div":{style:{verticalAlign:"middle",paddingTop:0}},image:{"ref-dy":"","ref-y":5},text:{"ref-y":0.5}})}}}).extend(joint.shapes.bpmn.IconInterface).extend(joint.shapes.bpmn.SubProcessInterface);joint.shapes.bpmn.AnnotationView=joint.shapes.basic.TextBlockView;joint.shapes.bpmn.Annotation=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',"<switch>",'<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>','</switch><path class="stroke"/></g>'].join(""),defaults:joint.util.deepSupplement({size:{width:100,height:100},type:"bpmn.Annotation",attrs:{rect:{width:100,height:100},".body":{"fill-opacity":0.1,fill:"#ffffff",stroke:"none"},".fobj div":{style:{textAlign:"left",paddingLeft:10}},".stroke":{stroke:"#000000",fill:"none","stroke-width":3}},wingLength:20},joint.shapes.basic.TextBlock.prototype.defaults),initialize:function(){joint.shapes.basic.TextBlock.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:size",this.onSizeChange);this.onSizeChange(this,this.get("size"))},onSizeChange:function(a,b){a.attr(".stroke",{d:a.getStrokePathData(b.width,b.height,a.get("wingLength"))})},getStrokePathData:function(c,a,b){b=Math.min(b,c);return["M",b,"0 L 0 0 0",a,b,a].join(" ")}});joint.shapes.bpmn.Gateway=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/><image/></g></g><text class="label"/>',defaults:joint.util.deepSupplement({type:"bpmn.Gateway",size:{width:80,height:80},attrs:{".body":{points:"40,0 80,40 40,80 0,40",fill:"#ffffff",stroke:"#000000"},".label":{text:"",ref:".body","ref-x":0.5,"ref-dy":20,"y-alignment":"middle","x-alignment":"middle","font-size":14,"font-family":"Arial, helvetica, sans-serif",fill:"#000000"},image:{width:40,height:40,"xlink:href":"",transform:"translate(20,20)"}}},joint.dia.Element.prototype.defaults)}).extend(joint.shapes.bpmn.IconInterface);joint.shapes.bpmn.Event=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="body outer"/><circle class="body inner"/><image/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Event",size:{width:60,height:60},attrs:{".body":{fill:"#ffffff",stroke:"#000000"},".outer":{"stroke-width":1,r:30,transform:"translate(30,30)"},".inner":{"stroke-width":1,r:26,transform:"translate(30,30)"},image:{width:40,height:40,"xlink:href":"",transform:"translate(10,10)"},".label":{text:"",fill:"#000000","font-family":"Arial","font-size":14,ref:".outer","ref-x":0.5,"ref-dy":20,"x-alignment":"middle","y-alignment":"middle"}},eventType:"start"},joint.dia.Element.prototype.defaults),initialize:function(){joint.dia.Element.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:eventType",this.onEventTypeChange);this.onEventTypeChange(this,this.get("eventType"))},onEventTypeChange:function(a,b){switch(b){case"start":a.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1}});break;case"end":a.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5}});break;case"intermediate":a.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1}});break;default:throw"BPMN: Unknown Event Type: "+b;break}}}).extend(joint.shapes.bpmn.IconInterface);joint.shapes.bpmn.Pool=joint.dia.Element.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>','<svg overflow="hidden" class="blackbox-wrap"><text class="blackbox-label"/></svg>','<rect class="header"/><text class="label"/>','<g class="lanes"/>',"</g>"].join(""),laneMarkup:'<g class="lane"><rect class="lane-body"/><rect class="lane-header"/><text class="lane-label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Pool",size:{width:600,height:300},attrs:{".body":{fill:"#ffffff",stroke:"#000000",width:500,height:200,"pointer-events":"stroke"},".header":{fill:"#ffffff",stroke:"#000000",width:20,ref:".body","ref-height":1,"pointer-events":"visiblePainted"},".label":{transform:"rotate(-90)",ref:".header","ref-x":10,"ref-y":0.5,"font-family":"Arial","font-size":14,"x-alignment":"middle","text-anchor":"middle"},".lane-body":{fill:"#ffffff",stroke:"#000000","pointer-events":"stroke"},".lane-header":{fill:"#ffffff",stroke:"#000000","pointer-events":"visiblePainted"},".lane-label":{transform:"rotate(-90)","text-anchor":"middle","font-family":"Arial","font-size":13},".blackbox-wrap":{ref:".body","ref-width":1,"ref-height":1},".blackbox-label":{text:"Black Box",dx:"50%",dy:"50%","text-anchor":"middle",transform:"translate(0,-7)"}}},joint.dia.Element.prototype.defaults)});joint.shapes.bpmn.PoolView=joint.dia.ElementView.extend({options:{headerWidth:20},initialize:function(){this.listenTo(this.model,"change:lanes",function(a,b){this.renderLanes(b)});joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){if(_.isUndefined(this.lanesAttrs)){return this.renderLanes(this.model.get("lanes"))}return joint.dia.ElementView.prototype.update.call(this,this.model,_.merge({},this.model.get("attrs"),this.lanesAttrs||{}))},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments);this.$lanes=this.$(".lanes");this.laneMarkup=V(this.model.laneMarkup)},renderLanes:function(a){a=a||{};this.index=0;this.lanesAttrs={".header":{width:this.options.headerWidth},".label":{text:a.label||""}};this.$lanes.empty();if(a.sublanes){this.renderSublanes(a.sublanes,0,0,1)}this.update(this.model,_.merge({},this.model.get("attrs"),this.lanesAttrs))},renderSublanes:function(b,h,f,d){var a=this.options.headerWidth;var c=1/b.length*d;_.each(b,function(k,m){var o="lane"+this.index;var l="."+o+" .lane-body";var n="."+o+" .lane-header";var q="."+o+" .lane-label";if(k.name){o+=" "+k.name}this.$lanes.append(this.laneMarkup.clone().addClass(o).node);var j=h+a;var p=f+c*m;this.lanesAttrs[l]={ref:".body","ref-height":c,"ref-width":-j,"ref-x":j,"ref-y":p};this.lanesAttrs[n]={width:a,ref:".body","ref-height":c,"ref-x":j,"ref-y":p};this.lanesAttrs[q]={text:k.label,ref:n,"ref-x":10,"ref-y":0.5,"x-alignment":"middle"};this.index++;if(k.sublanes){this.renderSublanes(k.sublanes,j,p,c)}},this)}});joint.shapes.bpmn.Group=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><rect class="label-rect"/><g class="label-group"><svg overflow="hidden" class="label-wrap"><text class="label"/></svg></g></g>',defaults:joint.util.deepSupplement({type:"bpmn.Group",size:{width:200,height:200},attrs:{".body":{width:200,height:200,stroke:"#000000","stroke-dasharray":"6,6","stroke-width":2,fill:"transparent",rx:15,ry:15,"pointer-events":"stroke"},".label-rect":{ref:".body","ref-width":0.6,"ref-x":0.4,"ref-y":-30,height:25,fill:"#ffffff",stroke:"#000000"},".label-group":{ref:".label-rect","ref-x":0,"ref-y":0},".label-wrap":{ref:".label-rect","ref-width":1,"ref-height":1},".label":{text:"",x:"50%",dy:5,"text-anchor":"middle","font-family":"Arial","font-size":14,fill:"#000000"}}},joint.dia.Element.prototype.defaults)});joint.shapes.bpmn.DataObject=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.DataObject",size:{width:60,height:80},attrs:{".body":{points:"20,0 60,0 60,80 0,80 0,20 20,0 20,20 0,20",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":0.5,"ref-dy":5,text:"","text-anchor":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.bpmn.Conversation=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/><path class="sub-process"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Conversation",size:{width:100,height:100},attrs:{".body":{points:"25,0 75,0 100,50 75,100 25,100 0,50",stroke:"#000000",fill:"#ffffff"},".label":{text:"",ref:".body","ref-x":0.5,"ref-dy":5,"text-anchor":"middle"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":0.5,"ref-dy":-30,"x-alignment":"middle",fill:"#ffffff",stroke:"#000000","fill-opacity":0}},conversationType:"conversation"},joint.dia.Element.prototype.defaults),initialize:function(){joint.dia.Element.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:conversationType",this.onConversationTypeChange);this.onConversationTypeChange(this,this.get("conversationType"))},onConversationTypeChange:function(a,b){switch(b){case"conversation":a.attr("polygon/stroke-width",1);break;case"call-conversation":a.attr("polygon/stroke-width",4);break;default:throw"BPMN: Unknown Conversation Type: "+b;break}}}).extend(joint.shapes.bpmn.SubProcessInterface);joint.shapes.bpmn.Choreography=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',"<switch>",'<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>',"</switch>",'<text class="label"/><path class="sub-process"/><g class="participants"/>',"</g>"].join(""),participantMarkup:'<g class="participant"><rect class="participant-rect"/><text class="participant-label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Choreography",size:{width:60,height:80},attrs:{rect:{},".body":{width:60,height:80,stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":0.5,"ref-dy":5,text:"","text-anchor":"middle"},".participant-rect":{stroke:"#000000",fill:"#aaaaaa",ref:".body","ref-width":1},".participant-label":{"text-anchor":"middle",ref:".participant_0 .participant-rect","ref-x":0.5,"ref-y":0.5,"y-alignment":"middle"},".sub-process":{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":0.5,"ref-dy":-30,"x-alignment":"middle",fill:"transparent",stroke:"#000000"}},participants:[],initiatingParticipant:0},joint.shapes.basic.TextBlock.prototype.defaults)}).extend(joint.shapes.bpmn.SubProcessInterface);joint.shapes.bpmn.ChoreographyView=joint.shapes.basic.TextBlockView.extend({options:{participantHeight:20},initialize:function(){this.listenTo(this.model,"change:participants",function(a,b){this.renderParticipants(b)});this.listenTo(this.model,"change:initiatingParticipant",this.layoutAndUpdate);joint.shapes.basic.TextBlockView.prototype.initialize.apply(this,arguments);if(this.noSVGForeignObjectElement){this.off(null,"change:content").listenTo(this.model,"change:content",function(a){this.updateContent(a,this.participantsAttrs)})}},update:function(){if(_.isUndefined(this.participantsAttrs)){return this.renderParticipants(this.model.get("participants"))}this.layoutAndUpdate();return this},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments);this.$participants=this.$(".participants");this.participantMarkup=V(this.model.participantMarkup)},renderParticipants:function(a){this.$participants.empty();this.participantsAttrs={};_.each(a,function(c,d){var f="participant_"+d;var b="."+f;this.participantsAttrs[b+" .participant-rect"]={height:this.options.participantHeight};this.participantsAttrs[b+" .participant-label"]={text:c};this.$participants.append(this.participantMarkup.clone().addClass(f).node)},this);this.layoutAndUpdate()},layoutAndUpdate:function(){var k=this.model.get("participants")||[];var l=k.length;var q=this.options.participantHeight;var o=this.model.get("size").height;var d=Math.max(0,o-(q*l));var h=0;var f=this.model.get("initiatingParticipant");var j=Math.max(_.isNumber(f)?Math.abs(f):k.indexOf(f),0);var n=Math.min(j,l-2);_.each(k,function(c,r){var b=".participant_"+r;this.participantsAttrs[b]={transform:"translate(0,"+h+")"};this.participantsAttrs[b+" .participant-rect"].fill=(j==r)?this.model.attr(".body/fill"):this.model.attr(".participant-rect/fill");this.participantsAttrs[b+" .participant-rect"].stroke=(j==r)?this.model.attr(".body/stroke"):this.model.attr(".participant-rect/stroke");h+=q+(n==r?d:0)},this);var a=l<2?0:n-l+1;this.participantsAttrs[".sub-process"]={"ref-dy":Math.max(-o,a*q-30)};var m=l<2?0:n+1;this.participantsAttrs[".fobj div"]={style:{height:d,paddingTop:q*m}};this.participantsAttrs[".content"]={"ref-y":q*m+d/2};var p=_.merge({},this.model.get("attrs"),this.participantsAttrs||{});joint.shapes.basic.TextBlockView.prototype.update.call(this,this.model,p)}});joint.shapes.bpmn.Message=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Message",size:{width:60,height:40},attrs:{".body":{points:"0,0 60,0 60,40 0,40 0,0 60,0 30,20 0,0",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":0.5,"ref-dy":5,text:"","text-anchor":"middle"}}},joint.dia.Element.prototype.defaults)});joint.shapes.bpmn.Flow=joint.dia.Link.extend({defaults:{type:"bpmn.Flow",attrs:{".marker-source":{d:"M 0 0"},".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#000000"},".connection":{"stroke-dasharray":" ","stroke-width":1},".connection-wrap":{style:"",onMouseOver:"",onMouseOut:""}},flowType:"normal"},initialize:function(){joint.dia.Link.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:flowType",this.onFlowTypeChange);this.onFlowTypeChange(this,this.get("flowType"))},onFlowTypeChange:function(a,c){var b;switch(c){case"default":b={".marker-source":{d:"M 0 5 L 20 5 M 20 0 L 10 10",fill:"none"}};break;case"conditional":b={".marker-source":{d:"M 20 8 L 10 0 L 0 8 L 10 16 z",fill:"#FFF"}};break;case"normal":b={};break;case"message":b={".marker-target":{fill:"#FFF"},".connection":{"stroke-dasharray":"4,4"}};break;case"association":b={".marker-target":{d:"M 0 0"},".connection":{"stroke-dasharray":"4,4"}};break;case"conversation":b={".marker-target":{d:"M 0 0"},".connection":{"stroke-width":"7px"},".connection-wrap":{style:"stroke: #fff; stroke-width: 5px; opacity: 1;",onMouseOver:"var s=this.style;s.stroke='#000';s.strokeWidth=15;s.opacity=.4",onMouseOut:"var s=this.style;s.stroke='#fff';s.strokeWidth=5;s.opacity=1"}};break;default:throw"BPMN: Unknown Flow Type: "+c}a.attr(_.merge({},this.defaults.attrs,b))}});joint.dia.CommandManager=Backbone.Model.extend({defaults:{cmdBeforeAdd:null,cmdNameRegex:/^(?:add|remove|change:\w+)$/},PREFIX_LENGTH:7,initialize:function(a){_.bindAll(this,"initBatchCommand","storeBatchCommand");this.graph=a.graph;this.reset();this.listen()},listen:function(){this.listenTo(this.graph,"all",this.addCommand,this);this.listenTo(this.graph,"batch:start",this.initBatchCommand,this);this.listenTo(this.graph,"batch:stop",this.storeBatchCommand,this)},createCommand:function(a){var b={action:undefined,data:{id:undefined,type:undefined,previous:{},next:{}},batch:a&&a.batch};return b},addCommand:function(d,a,f,c){if(!this.get("cmdNameRegex").test(d)){return}if(typeof this.get("cmdBeforeAdd")=="function"&&!this.get("cmdBeforeAdd").apply(this,arguments)){return}var b=_.bind(function(k){this.redoStack=[];if(!k.batch){this.undoStack.push(k);this.trigger("add",k)}else{this.lastCmdIndex=Math.max(this.lastCmdIndex,0);this.trigger("batch",k)}},this);var h=undefined;if(this.batchCommand){h=this.batchCommand[Math.max(this.lastCmdIndex,0)];if(this.lastCmdIndex>=0&&(h.data.id!==a.id||h.action!==d)){h=_.find(this.batchCommand,function(l,k){this.lastCmdIndex=k;return l.data.id===a.id&&l.action===d},this);if(!h){this.lastCmdIndex=this.batchCommand.push(this.createCommand({batch:true}))-1;h=_.last(this.batchCommand)}}}else{h=this.createCommand();h.batch=false}if(d==="add"||d==="remove"){h.action=d;h.data.id=a.id;h.data.type=a.attributes.type;h.data.attributes=_.merge({},a.toJSON());h.options=c||{};return b(h)}var j=d.substr(this.PREFIX_LENGTH);if(!h.batch||!h.action){h.action=d;h.data.id=a.id;h.data.type=a.attributes.type;h.data.previous[j]=_.clone(a.previous(j));h.options=c||{}}h.data.next[j]=_.clone(a.get(j));return b(h)},initBatchCommand:function(){if(!this.batchCommand){this.batchCommand=[this.createCommand({batch:true})];this.lastCmdIndex=-1;this.batchLevel=0}else{this.batchLevel++}},storeBatchCommand:function(){if(this.batchCommand&&this.batchLevel<=0){if(this.lastCmdIndex>=0){this.redoStack=[];this.undoStack.push(this.batchCommand);this.trigger("add",this.batchCommand)}delete this.batchCommand;delete this.lastCmdIndex;delete this.batchLevel}else{if(this.batchCommand&&this.batchLevel>0){this.batchLevel--}}},revertCommand:function(h){this.stopListening();var d;if(_.isArray(h)){d=h}else{d=[h]}for(var b=d.length-1;b>=0;b--){var f=d[b],a=this.graph.getCell(f.data.id);switch(f.action){case"add":a.remove();break;case"remove":this.graph.addCell(f.data.attributes);break;default:var c=f.action.substr(this.PREFIX_LENGTH);a.set(c,f.data.previous[c]);break}}this.listen()},applyCommand:function(h){this.stopListening();var d;if(_.isArray(h)){d=h}else{d=[h]}for(var b=0;b<d.length;b++){var f=d[b],a=this.graph.getCell(f.data.id);switch(f.action){case"add":this.graph.addCell(f.data.attributes);break;case"remove":a.remove();break;default:var c=f.action.substr(this.PREFIX_LENGTH);a.set(c,f.data.next[c]);break}}this.listen()},undo:function(){var a=this.undoStack.pop();if(a){this.revertCommand(a);this.redoStack.push(a)}},redo:function(){var a=this.redoStack.pop();if(a){this.applyCommand(a);this.undoStack.push(a)}},cancel:function(){if(this.hasUndo()){this.revertCommand(this.undoStack.pop());this.redoStack=[]}},reset:function(){this.undoStack=[];this.redoStack=[]},hasUndo:function(){return this.undoStack.length>0},hasRedo:function(){return this.redoStack.length>0}});joint.dia.Validator=Backbone.Model.extend({initialize:function(a){this._map={};this._commandManager=a.commandManager;this.listenTo(this._commandManager,"add",this._onCommand)},defaults:{cancelInvalid:true},_onCommand:function(a){return _.isArray(a)?_.find(a,function(b){return !this._validateCommand(b)},this):this._validateCommand(a)},_validateCommand:function(b){if(b.options&&b.options.validation===false){return true}var a;_.each(this._map[b.action],function(c){var d=0;function f(j){var h=c[d++];try{if(h){h(j,b,f)}else{a=j;return}}catch(j){f(j)}}f(a)});if(a){if(this.get("cancelInvalid")){this._commandManager.cancel()}this.trigger("invalid",a);return false}return true},validate:function(b){var a=_.rest(arguments);_.each(a,function(c){if(_.isFunction(c)){return}throw new Error(b+" requires callback functions.")});_.each(b.split(" "),function(c){(this._map[c]=this._map[c]||[]).push(a)},this);return this}});(function(){var b=joint.dia.Element.prototype.resize;joint.dia.Element.prototype.resize=a;function a(f,q,h){if(_.isUndefined(h)){return b.call(this,f,q)}h.direction=h.direction||"bottom-right";var j=g.normalizeAngle(this.get("angle")||0);var k={"top-right":0,"top-left":1,"bottom-left":2,"bottom-right":3}[h.direction];if(h.absolute){k+=Math.floor((j+45)/90);k%=4}var p=this.getBBox();var d=p[["bottomLeft","corner","topRight","origin"][k]]();var n=g.point(d).rotate(p.center(),-j);var m=Math.sqrt(f*f+q*q)/2;var l=k*Math.PI/2;l+=Math.atan(k%2==0?q/f:f/q);l-=g.toRad(j);var c=g.point.fromPolar(m,l,n);var o=g.point(c).offset(f/-2,q/-2);this.resize(f,q).position(o.x,o.y);return this}})();joint.dia.Graph.prototype.constructTree=function(d,c,a,f){f=f||[];var b=_.isFunction(c.children)?c.children(d):d[c.children||"children"];if(!a){a=c.makeElement(d);f.push(a)}_.each(b,function(k){var h=c.makeElement(k);var j=c.makeLink(a,h);f.push(h,j);this.constructTree(k,c,h,f)},this);return f};joint.dia.Graph.prototype.shortestPath=function(f,j,c){c=c||{};var a={};_.each(this.getLinks(),function(l){var m=l.get("source").id;var k=l.get("target").id;if(!a[m]){a[m]=[]}if(!a[k]){a[k]=[]}a[m].push(k);if(!c.directed){a[k].push(m)}});var d=joint.alg.Dijkstra(a,f.id||f,c.weight);var h=[];var b=j.id||j;if(d[b]){h.push(b)}while(b=d[b]){h.unshift(b)}return h};joint.ui.PaperScroller=Backbone.View.extend({className:"paper-scroller",events:{mousedown:"pointerdown",mousemove:"pointermove",touchmove:"pointermove",mouseout:"stopPanning"},options:{paper:undefined,padding:0,autoResizePaper:false,minWidth:undefined,minHeight:undefined},initialize:function(a){_.bindAll(this,"startPanning","stopPanning");this.options=_.extend({},_.result(this,"options"),a||{});var c=this.options.paper;var b=V(c.viewport).scale();this._sx=b.sx;this._sy=b.sy;this._baseWidth=c.options.width;this._baseHeight=c.options.height;this.$el.append(c.el);this.addPadding();this.listenTo(c,"scale",this.onScale);this.listenTo(c,"resize",this.onResize);if(this.options.autoResizePaper){this.listenTo(c.model,"change add remove reset",this.adjustPaper)}$(document.body).on("mouseup.stopPanning touchend.stopPanning",this.stopPanning)},onResize:function(){if(this._center){this.center(this._center.x,this._center.y)}},onScale:function(d,c,b,a){this._sx=d;this._sy=c;this.adjustPaper();if(b||a){this.center(b,a)}},beforePaperManipulation:function(){this.$el.css("visibility","hidden")},afterPaperManipulation:function(){this.$el.css("visibility","visible")},toLocalPoint:function(a,c){var b=this.options.paper.viewport.getCTM();a+=this.el.scrollLeft-this.padding.paddingLeft-b.e;a/=b.a;c+=this.el.scrollTop-this.padding.paddingTop-b.f;c/=b.d;return g.point(a,c)},adjustPaper:function(){this._center=this.toLocalPoint(this.el.clientWidth/2,this.el.clientHeight/2);var c=this._sx;var b=this._sy;var a={gridWidth:this._baseWidth*c,gridHeight:this._baseHeight*b,allowNewOrigin:"negative"};if(this.options.minWidth){a.minWidth=this.options.minWidth*c}if(this.options.minHeight){a.minHeight=this.options.minHeight*b}this.options.paper.fitToContent(a);return this},center:function(q,m){var k=this.options.paper.viewport.getCTM();var d=-k.e;var o=-k.f;var b=d+this.options.paper.options.width;var n=o+this.options.paper.options.height;if(_.isUndefined(q)||_.isUndefined(m)){q=(d+b)/2;m=(o+n)/2}else{q*=k.a;m*=k.d}var c=this.options.padding;var j=this.el.clientWidth/2;var h=this.el.clientHeight/2;var f=j-c-q+d;var r=j-c+q-b;var l=h-c-m+o;var a=h-c+m-n;this.addPadding(Math.max(f,0),Math.max(r,0),Math.max(l,0),Math.max(a,0));this.el.scrollLeft=q-j+k.e+this.padding.paddingLeft;this.el.scrollTop=m-h+k.f+this.padding.paddingTop;return this},centerContent:function(){var a=V(this.options.paper.viewport).bbox(true,this.options.paper.svg);this.center(a.x+a.width/2,a.y+a.height/2);return this},addPadding:function(j,b,h,a){var d=this.options.padding;var f=this.padding={paddingLeft:Math.round(d+(j||0)),paddingTop:Math.round(d+(h||0))};var c={marginBottom:Math.round(d+(a||0)),marginRight:Math.round(d+(b||0))};f.paddingLeft=Math.min(f.paddingLeft,this.el.clientWidth*0.9);f.paddingTop=Math.min(f.paddingTop,this.el.clientHeight*0.9);this.$el.css(f);this.options.paper.$el.css(c);return this},zoom:function(j,b){b=b||{};var a=this.toLocalPoint(this.el.clientWidth/2,this.el.clientHeight/2);var h=j;var f=j;var d;var c;if(!b.absolute){h+=this._sx;f+=this._sy}if(b.grid){h=Math.round(h/b.grid)*b.grid;f=Math.round(f/b.grid)*b.grid}if(b.max){h=Math.min(b.max,h);f=Math.min(b.max,f)}if(b.min){h=Math.max(b.min,h);f=Math.max(b.min,f)}if(_.isUndefined(b.ox)||_.isUndefined(b.oy)){d=a.x;c=a.y}else{var l=h/this._sx;var k=f/this._sy;d=b.ox-((b.ox-a.x)/l);c=b.oy-((b.oy-a.y)/k)}this.beforePaperManipulation();this.options.paper.scale(h,f);this.center(d,c);this.afterPaperManipulation();return this},zoomToFit:function(b){b=b||{};var c=this.options.paper;var a=_.clone(c.options.origin);b.fittingBBox=b.fittingBBox||_.extend({},g.point(a),{width:this.$el.width()+this.padding.paddingLeft,height:this.$el.height()+this.padding.paddingTop});this.beforePaperManipulation();c.scaleContentToFit(b);c.setOrigin(a.x,a.y);this.adjustPaper().centerContent();this.afterPaperManipulation();return this},startPanning:function(a){a=joint.util.normalizeEvent(a);this._panning=true;this._clientX=a.clientX;this._clientY=a.clientY},pan:function(b){if(!this._panning){return}b=joint.util.normalizeEvent(b);var c=b.clientX-this._clientX;var a=b.clientY-this._clientY;this.el.scrollTop-=a;this.el.scrollLeft-=c;this._clientX=b.clientX;this._clientY=b.clientY},stopPanning:function(){delete this._panning},pointerdown:function(a){if(a.target==this.el){this.options.paper.pointerdown.apply(this.options.paper,arguments)}},pointermove:function(a){this.pan.apply(this,arguments);if(a.target==this.el){this.options.paper.pointermove.apply(this.options.paper,arguments)}},remove:function(){Backbone.View.prototype.remove.apply(this,arguments);$(document.body).off(".stopPanning",this.stopPanning)}});joint.ui.SelectionView=Backbone.View.extend({options:{paper:undefined,graph:undefined,boxContent:function(b){var a=_.template("<%= length %> elements selected.");return a({length:this.model.length})},handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElements"}},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"}}],useModelGeometry:false},className:"selection",events:{"mousedown .selection-box":"startTranslatingSelection","touchstart .selection-box":"startTranslatingSelection","mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown"},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});_.bindAll(this,"startSelecting","stopSelecting","adjustSelection","pointerup");$(document.body).on("mousemove.selectionView touchmove.selectionView",this.adjustSelection);$(document).on("mouseup.selectionView touchend.selectionView",this.pointerup);this.listenTo(this.options.graph,"reset",this.cancelSelection);this.listenTo(this.options.paper,"scale translate",this.updateSelectionBoxes);this.listenTo(this.options.graph,"remove change",function(b,c){if(!c["selectionView_"+this.cid]){this.updateSelectionBoxes()}});this.options.paper.$el.append(this.$el);this._boxCount=0;this.createSelectionWrapper();this.handles=[];_.each(this.options.handles,this.addHandle,this)},addHandle:function(a){this.handles.push(a);var b=$("<div/>",{"class":"handle "+(a.position||"")+" "+(a.name||""),"data-action":a.name});if(a.icon){b.css("background-image","url("+a.icon+")")}b.html(a.content||"");this.$(".selection-wrapper").append(b);_.each(a.events,function(d,c){if(_.isString(d)){this.on("action:"+a.name+":"+c,this[d],this)}else{this.on("action:"+a.name+":"+c,d)}},this);return this},removeHandle:function(a){var c=_.findIndex(this.handles,{name:a});var b=this.handles[c];if(b){_.each(b.events,function(f,d){this.off("action:"+a+":"+d)},this);this.$(".handle."+a).remove();this.handles.splice(c,1)}return this},changeHandle:function(a,b){var c=_.findWhere(this.handles,{name:a});if(c){this.removeHandle(a);this.addHandle(_.merge({name:a},c,b))}return this},startTranslatingSelection:function(a){a.stopPropagation();a=joint.util.normalizeEvent(a);this._action="translating";this.options.graph.trigger("batch:start");var b=this.options.paper.snapToGrid(g.point(a.clientX,a.clientY));this._snappedClientX=b.x;this._snappedClientY=b.y;this.trigger("selection-box:pointerdown",a)},startSelecting:function(a){a=joint.util.normalizeEvent(a);this.cancelSelection();this._action="selecting";this._clientX=a.clientX;this._clientY=a.clientY;var d=a.target.parentElement||a.target.parentNode;var f=$(d).offset();var c=d.scrollLeft;var b=d.scrollTop;this._offsetX=a.offsetX===undefined?a.clientX-f.left+window.pageXOffset+c:a.offsetX;this._offsetY=a.offsetY===undefined?a.clientY-f.top+window.pageYOffset+b:a.offsetY;this.$el.css({width:1,height:1,left:this._offsetX,top:this._offsetY}).show()},adjustSelection:function(l){l=joint.util.normalizeEvent(l);var p;var o;switch(this._action){case"selecting":p=l.clientX-this._clientX;o=l.clientY-this._clientY;var a=this.$el.width();var m=this.$el.height();var b=parseInt(this.$el.css("left"),10);var h=parseInt(this.$el.css("top"),10);this.$el.css({left:p<0?this._offsetX+p:b,top:o<0?this._offsetY+o:h,width:Math.abs(p),height:Math.abs(o)});break;case"translating":var n=this.options.paper.snapToGrid(g.point(l.clientX,l.clientY));var k=n.x;var f=n.y;p=k-this._snappedClientX;o=f-this._snappedClientY;var d={};this.model.each(function(s){if(d[s.id]){return}var r={};r["selectionView_"+this.cid]=true;s.translate(p,o,r);_.each(s.getEmbeddedCells({deep:true}),function(t){d[t.id]=true});var q=this.options.graph.getConnectedLinks(s);_.each(q,function(t){if(d[t.id]){return}t.translate(p,o,r);d[t.id]=true})},this);if(p||o){var j=V(this.options.paper.viewport).scale();p*=j.sx;o*=j.sy;this.$(".selection-box").each(function(){var r=parseFloat($(this).css("left"),10);var q=parseFloat($(this).css("top"),10);$(this).css({left:r+p,top:q+o})});var c=this.$(".selection-wrapper");if(c.length){var b=parseFloat(c.css("left"),10);var h=parseFloat(c.css("top"),10);c.css({left:b+p,top:h+o})}this._snappedClientX=k;this._snappedClientY=f}this.trigger("selection-box:pointermove",l);break;default:if(this._action){this.pointermove(l)}break}},stopSelecting:function(b){switch(this._action){case"selecting":var k=this.$el.offset();var f=this.$el.width();var a=this.$el.height();var h=V(this.options.paper.viewport).toLocalPoint(k.left,k.top);h.x-=window.pageXOffset;h.y-=window.pageYOffset;var j=V(this.options.paper.viewport).scale();f/=j.sx;a/=j.sy;var c=this.options.paper.findViewsInArea(g.rect(h.x,h.y,f,a));var d=this.options.filter;if(_.isArray(d)){c=_.reject(c,function(l){if(_.contains(d,l.model)||_.contains(d,l.model.get("type"))){return true}})}else{if(_.isFunction(d)){c=_.reject(c,function(l){return d(l.model)})}}this.model.reset(_.pluck(c,"model"));if(c.length){_.each(c,this.createSelectionBox,this);this.$el.addClass("selected")}else{this.$el.hide()}break;case"translating":this.options.graph.trigger("batch:stop");this.trigger("selection-box:pointerup",b);break;default:if(!this._action){this.cancelSelection()}break}delete this._action},pointerup:function(a){if(!this._action){return}this.triggerAction(this._action,"pointerup",a);this.stopSelecting();delete this._action},cancelSelection:function(){this.$el.hide();this.$(".selection-box").remove();this.$el.removeClass("selected");this.model.reset([]);this._boxCount=0;this.updateSelectionWrapper()},destroySelectionBox:function(a){this.$('[data-model="'+a.model.get("id")+'"]').remove();if(this.$(".selection-box").length===0){this.$el.hide().removeClass("selected")}this._boxCount=Math.max(0,this._boxCount-1);this.updateSelectionWrapper()},createSelectionBox:function(c){var b=c.getBBox({useModelGeometry:this.options.useModelGeometry});var a=$("<div/>",{"class":"selection-box","data-model":c.model.get("id")});a.css({left:b.x,top:b.y,width:b.width,height:b.height});this.$el.append(a);this.$el.addClass("selected").show();this._boxCount++;this.updateSelectionWrapper()},createSelectionWrapper:function(){var a=$("<div/>",{"class":"selection-wrapper"});var b=$("<div/>",{"class":"box"});a.append(b);a.attr("data-selection-length",this.model.length);this.$el.prepend(a)},updateSelectionWrapper:function(){var a={x:Infinity,y:Infinity};var c={x:0,y:0};this.model.each(function(f){var h=this.options.paper.findViewByModel(f);if(h){var j=h.getBBox({useModelGeometry:this.options.useModelGeometry});a.x=Math.min(a.x,j.x);a.y=Math.min(a.y,j.y);c.x=Math.max(c.x,j.x+j.width);c.y=Math.max(c.y,j.y+j.height)}},this);this.$(".selection-wrapper").css({left:a.x,top:a.y,width:(c.x-a.x),height:(c.y-a.y)}).attr("data-selection-length",this.model.length);if(_.isFunction(this.options.boxContent)){var d=this.$(".box");var b=this.options.boxContent.call(this,d[0]);if(b){d.html(b)}}},updateSelectionBoxes:function(){if(!this._boxCount){return}this.$el.hide().removeClass("selected").find(".selection-box").each(_.bind(function(c,d){var b=$(d).remove().attr("data-model");var a=this.options.paper.findViewByModel(this.model.get(b));if(a){this.createSelectionBox(a)}},this));this.updateSelectionWrapper()},remove:function(){Backbone.View.prototype.remove.apply(this,arguments);$(document.body).off(".selectionView")},onHandlePointerDown:function(a){this._action=$(a.target).closest(".handle").attr("data-action");if(this._action){a.preventDefault();a.stopPropagation();a=joint.util.normalizeEvent(a);this._clientX=a.clientX;this._clientY=a.clientY;this._startClientX=this._clientX;this._startClientY=this._clientY;this.triggerAction(this._action,"pointerdown",a)}},pointermove:function(c){if(!this._action){return}var f=this.options.paper.snapToGrid({x:c.clientX,y:c.clientY});var b=this.options.paper.snapToGrid({x:this._clientX,y:this._clientY});var d=f.x-b.x;var a=f.y-b.y;this.triggerAction(this._action,"pointermove",c,d,a,c.clientX-this._startClientX,c.clientY-this._startClientY);this._clientX=c.clientX;this._clientY=c.clientY},triggerAction:function(d,b,a){var c=["action:"+d+":"+b].concat(_.rest(_.toArray(arguments),2));this.trigger.apply(this,c)},removeElements:function(a){var b=this.model.models;this.cancelSelection();this.options.graph.trigger("batch:start");_.invoke(b,"remove");this.options.graph.trigger("batch:stop")},startRotating:function(a){this.options.graph.trigger("batch:start");var c=this.options.graph.getBBox(this.model.models);this._center=c.center();if(typeof a.offsetX==="undefined"||typeof a.offsetY==="undefined"){var b=$(a.target).offset();a.offsetX=a.pageX-b.left;a.offsetY=a.pageY-b.top}this._rotationStart=g.point(a.offsetX+a.target.parentNode.offsetLeft,a.offsetY+a.target.parentNode.offsetTop+a.target.parentNode.offsetHeight);this._rotationStartAngle={};this.model.each(function(d){this._rotationStartAngle[d.id]=d.get("angle")||0},this)},doRotate:function(q,s,r,j,h){var d=g.point(this._rotationStart).offset(j,h);var o=d.distance(this._center);var n=this._center.distance(this._rotationStart);var m=this._rotationStart.distance(d);var f=(this._center.x-this._rotationStart.x)*(d.y-this._rotationStart.y)-(this._center.y-this._rotationStart.y)*(d.x-this._rotationStart.x);var k=Math.acos((o*o+n*n-m*m)/(2*o*n));if(f<=0){k=-k}var l=-g.toDeg(k);l=g.snapToGrid(l,15);this.model.each(function(a){a.rotate(l+this._rotationStartAngle[a.id],true,this._center)},this)},stopBatch:function(){this.options.graph.trigger("batch:stop")}});joint.ui.Clipboard=Backbone.Collection.extend({copyElements:function(d,j,c){c=c||{};var b=[];var h=[];var a={};d.each(function(m){var l=j.getConnectedLinks(m);b=b.concat(_.filter(l,function(n){if(d.get(n.get("source").id)&&d.get(n.get("target").id)){return true}return false}));var k=m.clone();if(c.translate){k.translate(c.translate.dx||20,c.translate.dy||20)}h.push(k);a[m.get("id")]=k.get("id")});var f=_.unique(b);b=_.map(f,function(k){var n=k.clone();var l=n.get("source");var m=n.get("target");l.id=a[l.id];m.id=a[m.id];n.set({source:_.clone(l),target:_.clone(m)});if(c.translate){_.each(n.get("vertices"),function(o){o.x+=c.translate.dx||20;o.y+=c.translate.dy||20})}return n});this.reset(h.concat(b));if(c.useLocalStorage&&window.localStorage){localStorage.setItem("joint.ui.Clipboard.cells",JSON.stringify(this.toJSON()))}return(d.models||[]).concat(f)},pasteCells:function(b,a){a=a||{};if(a.useLocalStorage&&this.length===0&&window.localStorage){this.reset(JSON.parse(localStorage.getItem("joint.ui.Clipboard.cells")))}b.trigger("batch:start");this.each(function(c){c.unset("z");if((c instanceof joint.dia.Link)&&a.link){c.set(a.link)}b.addCell(c.toJSON())});b.trigger("batch:stop")},clear:function(){this.reset([]);if(window.localStorage){localStorage.removeItem("joint.ui.Clipboard.cells")}}});var Handlebars={};(function(c,f){c.VERSION="1.0.0";c.COMPILER_REVISION=4;c.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};c.helpers={};c.partials={};var d=Object.prototype.toString,h="[object Function]",b="[object Object]";c.registerHelper=function(o,p,n){if(d.call(o)===b){if(n||p){throw new c.Exception("Arg not supported with multiple helpers")}c.Utils.extend(this.helpers,o)}else{if(n){p.not=n}this.helpers[o]=p}};c.registerPartial=function(n,o){if(d.call(n)===b){c.Utils.extend(this.partials,n)}else{this.partials[n]=o}};c.registerHelper("helperMissing",function(n){if(arguments.length===2){return f}else{throw new Error("Missing helper: '"+n+"'")}});c.registerHelper("blockHelperMissing",function(p,o){var n=o.inverse||function(){},r=o.fn;var q=d.call(p);if(q===h){p=p.call(this)}if(p===true){return r(this)}else{if(p===false||p==null){return n(this)}else{if(q==="[object Array]"){if(p.length>0){return c.helpers.each(p,o)}else{return n(this)}}else{return r(p)}}}});c.K=function(){};c.createFrame=Object.create||function(n){c.K.prototype=n;var o=new c.K();c.K.prototype=null;return o};c.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(p,n){if(c.logger.level<=p){var o=c.logger.methodMap[p];if(typeof console!=="undefined"&&console[o]){console[o].call(console,n)}}}};c.log=function(o,n){c.logger.log(o,n)};c.registerHelper("each",function(n,w){var u=w.fn,p=w.inverse;var r=0,s="",q;var t=d.call(n);if(t===h){n=n.call(this)}if(w.data){q=c.createFrame(w.data)}if(n&&typeof n==="object"){if(n instanceof Array){for(var o=n.length;r<o;r++){if(q){q.index=r}s=s+u(n[r],{data:q})}}else{for(var v in n){if(n.hasOwnProperty(v)){if(q){q.key=v}s=s+u(n[v],{data:q});r++}}}}if(r===0){s=p(this)}return s});c.registerHelper("if",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!o||c.Utils.isEmpty(o)){return n.inverse(this)}else{return n.fn(this)}});c.registerHelper("unless",function(o,n){return c.helpers["if"].call(this,o,{fn:n.inverse,inverse:n.fn})});c.registerHelper("with",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!c.Utils.isEmpty(o)){return n.fn(o)}});c.registerHelper("log",function(o,n){var p=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;c.log(p,o)});var l=["description","fileName","lineNumber","message","name","number","stack"];c.Exception=function(p){var o=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<l.length;n++){this[l[n]]=o[l[n]]}};c.Exception.prototype=new Error();c.SafeString=function(n){this.string=n};c.SafeString.prototype.toString=function(){return this.string.toString()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var a=/[&<>"'`]/g;var j=/[&<>"'`]/;var m=function(n){return k[n]||"&amp;"};c.Utils={extend:function(p,o){for(var n in o){if(o.hasOwnProperty(n)){p[n]=o[n]}}},escapeExpression:function(n){if(n instanceof c.SafeString){return n.toString()}else{if(n==null||n===false){return""}}n=n.toString();if(!j.test(n)){return n}return n.replace(a,m)},isEmpty:function(n){if(!n&&n!==0){return true}else{if(d.call(n)==="[object Array]"&&n.length===0){return true}else{return false}}}};c.VM={template:function(n){var o={escapeExpression:c.Utils.escapeExpression,invokePartial:c.VM.invokePartial,programs:[],program:function(q,r,s){var p=this.programs[q];if(s){p=c.VM.program(q,r,s)}else{if(!p){p=this.programs[q]=c.VM.program(q,r)}}return p},merge:function(r,q){var p=r||q;if(r&&q){p={};c.Utils.extend(p,q);c.Utils.extend(p,r)}return p},programWithDepth:c.VM.programWithDepth,noop:c.VM.noop,compilerInfo:null};return function(t,s){s=s||{};var q=n.call(o,c,t,s.helpers,s.partials,s.data);var u=o.compilerInfo||[],r=u[0]||1,w=c.COMPILER_REVISION;if(r!==w){if(r<w){var p=c.REVISION_CHANGES[w],v=c.REVISION_CHANGES[r];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+p+") or downgrade your runtime to an older version ("+v+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+u[1]+")."}}return q}},programWithDepth:function(p,q,r){var o=Array.prototype.slice.call(arguments,3);var n=function(t,s){s=s||{};return q.apply(this,[t,s.data||r].concat(o))};n.program=p;n.depth=o.length;return n},program:function(o,p,q){var n=function(s,r){r=r||{};return p(s,r.data||q)};n.program=o;n.depth=0;return n},noop:function(){return""},invokePartial:function(n,p,r,s,q,t){var o={helpers:s,partials:q,data:t};if(n===f){throw new c.Exception("The partial "+p+" could not be found")}else{if(n instanceof Function){return n(r,o)}else{if(!c.compile){throw new c.Exception("The partial "+p+" could not be compiled when running in runtime-only mode")}else{q[p]=c.compile(n,{data:t!==f});return q[p](r,o)}}}}};c.template=c.VM.template})(Handlebars);this["joint"]=this["joint"]||{};this["joint"]["templates"]=this["joint"]["templates"]||{};this["joint"]["templates"]["halo"]=this["joint"]["templates"]["halo"]||{};this["joint"]["templates"]["halo"]["box.html"]=Handlebars.template(function(d,f,b,a,c){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,d.helpers);c=c||{};return'<label class="box"></label>\n'});this["joint"]["templates"]["halo"]["handle.html"]=Handlebars.template(function(d,m,c,l,k){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,d.helpers);k=k||{};var h="",a,p,f="function",j=this.escapeExpression,o=this,n=c.blockHelperMissing;function b(s,r){var q="";q+='style="background-image: url('+j((typeof s===f?s.apply(s):s))+')"';return q}h+='<div class="handle ';if(a=c.position){a=a.call(m,{hash:{},data:k})}else{a=m.position;a=typeof a===f?a.apply(m):a}h+=j(a)+" ";if(a=c.name){a=a.call(m,{hash:{},data:k})}else{a=m.name;a=typeof a===f?a.apply(m):a}h+=j(a)+'" draggable="false" data-action="';if(a=c.name){a=a.call(m,{hash:{},data:k})}else{a=m.name;a=typeof a===f?a.apply(m):a}h+=j(a)+'" ';p={hash:{},inverse:o.noop,fn:o.program(1,b,k),data:k};if(a=c.icon){a=a.call(m,p)}else{a=m.icon;a=typeof a===f?a.apply(m):a}if(!c.icon){a=n.call(m,a,p)}if(a||a===0){h+=a}h+=">\n    ";if(a=c.content){a=a.call(m,{hash:{},data:k})}else{a=m.content;a=typeof a===f?a.apply(m):a}if(a||a===0){h+=a}h+="\n</div>\n\n";return h});joint.ui.Halo=Backbone.View.extend({className:"halo",events:{"mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown"},options:{tinyTreshold:40,smallTreshold:80,loopLinkPreferredSide:"top",loopLinkWidth:40,rotateAngleGrid:15,useModelGeometry:false,boxContent:function(c,b){var a=_.template("x: <%= x %>, y: <%= y %>, width: <%= width %>, height: <%= height %>, angle: <%= angle %>");var d=c.model.getBBox();return a({x:Math.floor(d.x),y:Math.floor(d.y),width:d.width,height:d.height,angle:Math.floor(c.model.get("angle")||0)})},linkAttributes:{},smoothLinks:undefined,handles:[{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"}},{name:"remove",position:"nw",events:{pointerdown:"removeElement"}},{name:"clone",position:"n",events:{pointerdown:"startCloning",pointermove:"doClone",pointerup:"stopCloning"}},{name:"link",position:"e",events:{pointerdown:"startLinking",pointermove:"doLink",pointerup:"stopLinking"}},{name:"fork",position:"ne",events:{pointerdown:"startForking",pointermove:"doFork",pointerup:"stopForking"}},{name:"unlink",position:"w",events:{pointerdown:"unlinkElement"}},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"}}]},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});_.defaults(this.options,{paper:this.options.cellView.paper,graph:this.options.cellView.paper.model});_.bindAll(this,"pointermove","pointerup","render","update","remove");joint.ui.Halo.clear(this.options.paper);this.handles=[];_.each(this.options.handles,this.addHandle,this);this.listenTo(this.options.graph,"reset",this.remove);this.listenTo(this.options.graph,"all",this.update);this.listenTo(this.options.paper,"blank:pointerdown halo:create",this.remove);this.listenTo(this.options.paper,"scale translate",this.update);$(document.body).on("mousemove touchmove",this.pointermove);$(document).on("mouseup touchend",this.pointerup);this.options.paper.$el.append(this.$el)},render:function(){this.options.cellView.model.on("remove",this.remove);this.$el.append(joint.templates.halo["box.html"]());this.renderMagnets();this.update();this.$el.addClass("animate");this.$el.attr("data-type",this.options.cellView.model.get("type"));this.toggleFork();return this},update:function(){if(this.options.cellView.model instanceof joint.dia.Link){return}if(_.isFunction(this.options.boxContent)){var b=this.$(".box");var a=this.options.boxContent.call(this,this.options.cellView,b[0]);if(a){b.html(a)}}var c=this.options.cellView.getBBox({useModelGeometry:this.options.useModelGeometry});this.$el.toggleClass("tiny",c.width<this.options.tinyTreshold&&c.height<this.options.tinyTreshold);this.$el.toggleClass("small",!this.$el.hasClass("tiny")&&(c.width<this.options.smallTreshold&&c.height<this.options.smallTreshold));this.$el.css({width:c.width,height:c.height,left:c.x,top:c.y}).show();this.updateMagnets();this.toggleUnlink()},addHandle:function(a){this.handles.push(a);this.$el.append(joint.templates.halo["handle.html"](a));_.each(a.events,function(c,b){if(_.isString(c)){this.on("action:"+a.name+":"+b,this[c],this)}else{this.on("action:"+a.name+":"+b,c)}},this);return this},removeHandle:function(a){var c=_.findIndex(this.handles,{name:a});var b=this.handles[c];if(b){_.each(b.events,function(f,d){this.off("action:"+a+":"+d)},this);this.$(".handle."+a).remove();this.handles.splice(c,1)}return this},changeHandle:function(a,b){var c=_.findWhere(this.handles,{name:a});if(c){this.removeHandle(a);this.addHandle(_.merge({name:a},c,b))}return this},onHandlePointerDown:function(a){this._action=$(a.target).closest(".handle").attr("data-action");if(this._action){a.preventDefault();a.stopPropagation();a=joint.util.normalizeEvent(a);this._clientX=a.clientX;this._clientY=a.clientY;this._startClientX=this._clientX;this._startClientY=this._clientY;this.triggerAction(this._action,"pointerdown",a)}},triggerAction:function(d,b,a){var c=["action:"+d+":"+b].concat(_.rest(_.toArray(arguments),2));this.trigger.apply(this,c)},startCloning:function(a){this.options.graph.trigger("batch:start");var b=this.options.cellView.model.clone();b.unset("z");this.options.graph.addCell(b,{halo:this.cid});this._cloneView=b.findView(this.options.paper);this._cloneView.pointerdown(a,this._clientX,this._clientY)},startLinking:function(b){this.options.graph.trigger("batch:start");var d=this.options.cellView;var a=$.data(b.target,"selector");var c=this.options.paper.getDefaultLink(d,a&&d.el.querySelector(a));c.set("source",{id:d.model.id,selector:a});c.set("target",{x:b.clientX,y:b.clientY});c.attr(this.options.linkAttributes);if(_.isBoolean(this.options.smoothLinks)){c.set("smooth",this.options.smoothLinks)}this.options.graph.addCell(c,{validation:false,halo:this.cid});c.set("target",this.options.paper.snapToGrid({x:b.clientX,y:b.clientY}));this._linkView=this.options.paper.findViewByModel(c);this._linkView.startArrowheadMove("target")},startForking:function(a){this.options.graph.trigger("batch:start");var c=this.options.cellView.model.clone();c.unset("z");this.options.graph.addCell(c,{halo:this.cid});var b=this.options.paper.getDefaultLink(this.options.cellView);b.set("source",{id:this.options.cellView.model.id});b.set("target",{id:c.id});b.attr(this.options.linkAttributes);if(_.isBoolean(this.options.smoothLinks)){b.set("smooth",this.options.smoothLinks)}this.options.graph.addCell(b,{halo:this.cid});this._cloneView=c.findView(this.options.paper);this._cloneView.pointerdown(a,this._clientX,this._clientY)},startResizing:function(a){this.options.graph.trigger("batch:start");this._flip=[1,0,0,1,1,0,0,1][Math.floor(g.normalizeAngle(this.options.cellView.model.get("angle"))/45)]},startRotating:function(a){this.options.graph.trigger("batch:start");var d=this.options.cellView.getBBox();this._center=g.rect(d).center();if(typeof a.offsetX==="undefined"||typeof a.offsetY==="undefined"){var c=$(a.target).offset();a.offsetX=a.pageX-c.left;a.offsetY=a.pageY-c.top}this._rotationStart=g.point(a.offsetX+a.target.parentNode.offsetLeft,a.offsetY+a.target.parentNode.offsetTop+a.target.parentNode.offsetHeight);var b=this.options.cellView.model.get("angle");this._rotationStartAngle=b||0},doResize:function(c,d,b){var f=this.options.cellView.model.get("size");var h=Math.max(f.width+((this._flip?d:b)),1);var a=Math.max(f.height+((this._flip?b:d)),1);this.options.cellView.model.resize(h,a,{absolute:true})},doRotate:function(q,s,r,j,h){var d=g.point(this._rotationStart).offset(j,h);var o=d.distance(this._center);var n=this._center.distance(this._rotationStart);var m=this._rotationStart.distance(d);var f=(this._center.x-this._rotationStart.x)*(d.y-this._rotationStart.y)-(this._center.y-this._rotationStart.y)*(d.x-this._rotationStart.x);var k=Math.acos((o*o+n*n-m*m)/(2*o*n));if(f<=0){k=-k}var l=-g.toDeg(k);l=g.snapToGrid(l,this.options.rotateAngleGrid);this.options.cellView.model.rotate(l+this._rotationStartAngle,true)},doClone:function(a){this._cloneView.pointermove(a,this._clientX,this._clientY)},doFork:function(a){this._cloneView.pointermove(a,this._clientX,this._clientY)},doLink:function(a){var b=this.options.paper.snapToGrid({x:a.clientX,y:a.clientY});this._linkView.pointermove(a,b.x,b.y)},stopLinking:function(a){this._linkView.pointerup(a);var c=this._linkView.model.get("source").id;var b=this._linkView.model.get("target").id;if(c&&b&&(c===b)){this.makeLoopLink(this._linkView.model)}this.stopBatch();this.triggerAction("link","add",this._linkView.model);delete this._linkView},stopForking:function(a){this._cloneView.pointerup(a,this._clientX,this._clientY);this.stopBatch()},stopCloning:function(a){this._cloneView.pointerup(a,this._clientX,this._clientY);this.stopBatch()},pointermove:function(c){if(!this._action){return}c.preventDefault();c.stopPropagation();c=joint.util.normalizeEvent(c);var f=this.options.paper.snapToGrid({x:c.clientX,y:c.clientY});var b=this.options.paper.snapToGrid({x:this._clientX,y:this._clientY});var d=f.x-b.x;var a=f.y-b.y;this.triggerAction(this._action,"pointermove",c,d,a,c.clientX-this._startClientX,c.clientY-this._startClientY);this._clientX=c.clientX;this._clientY=c.clientY},pointerup:function(a){if(!this._action){return}this.triggerAction(this._action,"pointerup",a);delete this._action},stopBatch:function(){this.options.graph.trigger("batch:stop")},remove:function(a){Backbone.View.prototype.remove.apply(this,arguments);$(document.body).off("mousemove touchmove",this.pointermove);$(document).off("mouseup touchend",this.pointerup)},removeElement:function(a){this.options.cellView.model.remove()},unlinkElement:function(a){this.options.graph.removeLinks(this.options.cellView.model)},toggleUnlink:function(){if(this.options.graph.getConnectedLinks(this.options.cellView.model).length>0){this.$(".unlink").show()}else{this.$(".unlink").hide()}},toggleFork:function(){var b=this.options.cellView.model.clone();var a=this.options.paper.createViewForModel(b);if(!this.options.paper.options.validateConnection(this.options.cellView,null,a,null,"target")){this.$(".fork").hide()}a.remove();b=null},makeLoopLink:function(f){var c=this.options.loopLinkWidth;var d=this.options.paper.options;var a=g.rect({x:0,y:0,width:d.width,height:d.height});var j=V(this.options.cellView.el).bbox(false,this.options.paper.viewport);var k,h;var b=_.uniq([this.options.loopLinkPreferredSide,"top","bottom","left","right"]);var l=_.find(b,function(o){var p,n=0,m=0;switch(o){case"top":p=g.point(j.x+j.width/2,j.y-c);n=c/2;break;case"bottom":p=g.point(j.x+j.width/2,j.y+j.height+c);n=c/2;break;case"left":p=g.point(j.x-c,j.y+j.height/2);m=c/2;break;case"right":p=g.point(j.x+j.width+c,j.y+j.height/2);m=c/2;break}k=g.point(p).offset(-n,-m);h=g.point(p).offset(n,m);return a.containsPoint(k)&&a.containsPoint(h)},this);if(l){f.set("vertices",[k,h])}},renderMagnets:function(){this._magnets=[];var b=this.$(".link");var d=this.options.cellView.$('[magnet="true"]');if(this.options.magnetFilter){if(_.isFunction(this.options.magnetFilter)){d=_.filter(d,this.options.magnetFilter)}else{d=d.filter(this.options.magnetFilter)}}if(b.length&&d.length){var c=b.width();var a=b.height();_.each(d,function(f){var j=f.getBoundingClientRect();var h=b.clone().addClass("halo-magnet").css({width:Math.min(j.width,c),height:Math.min(j.height,a),"background-size":"contain"}).data("selector",this.options.cellView.getSelector(f)).appendTo(this.$el);this._magnets.push({$halo:h,el:f})},this)}if(this.options.cellView.$el.attr("magnet")=="false"){b.hide();this.$(".fork").hide()}},updateMagnets:function(){if(this._magnets.length){var a=this.el.getBoundingClientRect();_.each(this._magnets,function(c){var b=c.el.getBoundingClientRect();c.$halo.css({left:b.left-a.left+(b.width-c.$halo.width())/2,top:b.top-a.top+(b.height-c.$halo.height())/2})},this)}}},{clear:function(a){a.trigger("halo:create")}});var Handlebars={};(function(c,f){c.VERSION="1.0.0";c.COMPILER_REVISION=4;c.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};c.helpers={};c.partials={};var d=Object.prototype.toString,h="[object Function]",b="[object Object]";c.registerHelper=function(o,p,n){if(d.call(o)===b){if(n||p){throw new c.Exception("Arg not supported with multiple helpers")}c.Utils.extend(this.helpers,o)}else{if(n){p.not=n}this.helpers[o]=p}};c.registerPartial=function(n,o){if(d.call(n)===b){c.Utils.extend(this.partials,n)}else{this.partials[n]=o}};c.registerHelper("helperMissing",function(n){if(arguments.length===2){return f}else{throw new Error("Missing helper: '"+n+"'")}});c.registerHelper("blockHelperMissing",function(p,o){var n=o.inverse||function(){},r=o.fn;var q=d.call(p);if(q===h){p=p.call(this)}if(p===true){return r(this)}else{if(p===false||p==null){return n(this)}else{if(q==="[object Array]"){if(p.length>0){return c.helpers.each(p,o)}else{return n(this)}}else{return r(p)}}}});c.K=function(){};c.createFrame=Object.create||function(n){c.K.prototype=n;var o=new c.K();c.K.prototype=null;return o};c.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(p,n){if(c.logger.level<=p){var o=c.logger.methodMap[p];if(typeof console!=="undefined"&&console[o]){console[o].call(console,n)}}}};c.log=function(o,n){c.logger.log(o,n)};c.registerHelper("each",function(n,w){var u=w.fn,p=w.inverse;var r=0,s="",q;var t=d.call(n);if(t===h){n=n.call(this)}if(w.data){q=c.createFrame(w.data)}if(n&&typeof n==="object"){if(n instanceof Array){for(var o=n.length;r<o;r++){if(q){q.index=r}s=s+u(n[r],{data:q})}}else{for(var v in n){if(n.hasOwnProperty(v)){if(q){q.key=v}s=s+u(n[v],{data:q});r++}}}}if(r===0){s=p(this)}return s});c.registerHelper("if",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!o||c.Utils.isEmpty(o)){return n.inverse(this)}else{return n.fn(this)}});c.registerHelper("unless",function(o,n){return c.helpers["if"].call(this,o,{fn:n.inverse,inverse:n.fn})});c.registerHelper("with",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!c.Utils.isEmpty(o)){return n.fn(o)}});c.registerHelper("log",function(o,n){var p=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;c.log(p,o)});var l=["description","fileName","lineNumber","message","name","number","stack"];c.Exception=function(p){var o=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<l.length;n++){this[l[n]]=o[l[n]]}};c.Exception.prototype=new Error();c.SafeString=function(n){this.string=n};c.SafeString.prototype.toString=function(){return this.string.toString()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var a=/[&<>"'`]/g;var j=/[&<>"'`]/;var m=function(n){return k[n]||"&amp;"};c.Utils={extend:function(p,o){for(var n in o){if(o.hasOwnProperty(n)){p[n]=o[n]}}},escapeExpression:function(n){if(n instanceof c.SafeString){return n.toString()}else{if(n==null||n===false){return""}}n=n.toString();if(!j.test(n)){return n}return n.replace(a,m)},isEmpty:function(n){if(!n&&n!==0){return true}else{if(d.call(n)==="[object Array]"&&n.length===0){return true}else{return false}}}};c.VM={template:function(n){var o={escapeExpression:c.Utils.escapeExpression,invokePartial:c.VM.invokePartial,programs:[],program:function(q,r,s){var p=this.programs[q];if(s){p=c.VM.program(q,r,s)}else{if(!p){p=this.programs[q]=c.VM.program(q,r)}}return p},merge:function(r,q){var p=r||q;if(r&&q){p={};c.Utils.extend(p,q);c.Utils.extend(p,r)}return p},programWithDepth:c.VM.programWithDepth,noop:c.VM.noop,compilerInfo:null};return function(t,s){s=s||{};var q=n.call(o,c,t,s.helpers,s.partials,s.data);var u=o.compilerInfo||[],r=u[0]||1,w=c.COMPILER_REVISION;if(r!==w){if(r<w){var p=c.REVISION_CHANGES[w],v=c.REVISION_CHANGES[r];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+p+") or downgrade your runtime to an older version ("+v+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+u[1]+")."}}return q}},programWithDepth:function(p,q,r){var o=Array.prototype.slice.call(arguments,3);var n=function(t,s){s=s||{};return q.apply(this,[t,s.data||r].concat(o))};n.program=p;n.depth=o.length;return n},program:function(o,p,q){var n=function(s,r){r=r||{};return p(s,r.data||q)};n.program=o;n.depth=0;return n},noop:function(){return""},invokePartial:function(n,p,r,s,q,t){var o={helpers:s,partials:q,data:t};if(n===f){throw new c.Exception("The partial "+p+" could not be found")}else{if(n instanceof Function){return n(r,o)}else{if(!c.compile){throw new c.Exception("The partial "+p+" could not be compiled when running in runtime-only mode")}else{q[p]=c.compile(n,{data:t!==f});return q[p](r,o)}}}}};c.template=c.VM.template})(Handlebars);this["joint"]=this["joint"]||{};this["joint"]["templates"]=this["joint"]["templates"]||{};this["joint"]["templates"]["stencil"]=this["joint"]["templates"]["stencil"]||{};this["joint"]["templates"]["stencil"]["elements.html"]=Handlebars.template(function(d,f,b,a,c){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,d.helpers);c=c||{};return'<div class="elements"></div>\n'});this["joint"]["templates"]["stencil"]["group.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+='<div class="group">\n    <h3 class="group-label">';if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+"</h3>\n</div>\n";return f});this["joint"]["templates"]["stencil"]["search.html"]=Handlebars.template(function(d,f,b,a,c){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,d.helpers);c=c||{};return'<input class="search" type="search" placeholder="Pesquisar"/>\n'});this["joint"]["templates"]["stencil"]["stencil.html"]=Handlebars.template(function(d,f,b,a,c){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,d.helpers);c=c||{};return'<div class="stencil-paper-drag"></div>\n<div class="content"></div>\n\n'});joint.ui.Stencil=Backbone.View.extend({className:"stencil",events:{"click .group-label":"onGroupLabelClick","touchstart .group-label":"onGroupLabelClick","input .search":"onSearch"},options:{width:200,height:800},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});this.graphs={};this.papers={};this.$groups={};_.bindAll(this,"onDrag","onDragEnd");$(document.body).on({"mousemove.stencil touchmove.stencil":this.onDrag,"mouseup.stencil touchend.stencil":this.onDragEnd});this.onSearch=_.debounce(this.onSearch,200)},render:function(){this.$el.html(joint.templates.stencil["stencil.html"](this.template));this.$content=this.$(".content");if(this.options.search){this.$el.addClass("searchable").prepend(joint.templates.stencil["search.html"]())}var b={width:this.options.width,height:this.options.height,interactive:false};if(this.options.groups){var a=_.sortBy(_.pairs(this.options.groups),function(f){return f[1].index});_.each(a,function(h){var f=h[0];var l=h[1];var j=$(joint.templates.stencil["group.html"]({label:l.label||f}));j.attr("data-name",f);if(l.closed){j.addClass("closed")}j.append($(joint.templates.stencil["elements.html"]()));this.$content.append(j);this.$groups[f]=j;var k=new joint.dia.Graph;this.graphs[f]=k;var m=new joint.dia.Paper(_.extend({},b,{el:j.find(".elements"),model:k,width:l.width||b.width,height:l.height||b.height}));this.papers[f]=m},this)}else{this.$content.append($(joint.templates.stencil["elements.html"]()));var c=new joint.dia.Graph;this.graphs.__default__=c;var d=new joint.dia.Paper(_.extend(b,{el:this.$(".elements"),model:c}));this.papers.__default__=d}this._graphDrag=new joint.dia.Graph;this._paperDrag=new joint.dia.Paper({el:this.$(".stencil-paper-drag"),width:1,height:1,model:this._graphDrag});_.each(this.papers,function(f){this.listenTo(f,"cell:pointerdown",this.onDragStart)},this);return this},load:function(a,c){var b=this.graphs[c||"__default__"];if(b){b.resetCells(a);var d=this.options.height;if(c&&this.options.groups[c]){d=this.options.groups[c].height}if(!d){this.papers[c||"__default__"].fitToContent(1,1,this.options.paperPadding||10)}}else{throw new Error("Stencil: group "+c+" does not exist.")}},getGraph:function(a){return this.graphs[a||"__default__"]},getPaper:function(a){return this.papers[a||"__default__"]},onDragStart:function(c,b){this.$el.addClass("dragging");this._paperDrag.$el.addClass("dragging");$(document.body).append(this._paperDrag.$el);this._clone=c.model.clone();this._cloneBbox=c.getBBox();var f=5;var a=g.point(this._cloneBbox.x-this._clone.get("position").x,this._cloneBbox.y-this._clone.get("position").y);this._clone.set("position",{x:-a.x+f,y:-a.y+f});this._graphDrag.addCell(this._clone);this._paperDrag.setDimensions(this._cloneBbox.width+2*f,this._cloneBbox.height+2*f);var d=document.body.scrollTop||document.documentElement.scrollTop;this._paperDrag.$el.offset({left:b.clientX-this._cloneBbox.width/2,top:b.clientY+d-this._cloneBbox.height/2})},onDrag:function(a){a=joint.util.normalizeEvent(a);if(this._clone){var b=document.body.scrollTop||document.documentElement.scrollTop;this._paperDrag.$el.offset({left:a.clientX-this._cloneBbox.width/2,top:a.clientY+b-this._cloneBbox.height/2})}},onDragEnd:function(a){a=joint.util.normalizeEvent(a);if(this._clone&&this._cloneBbox){this.drop(a,this._clone.clone(),this._cloneBbox);this.$el.append(this._paperDrag.$el);this.$el.removeClass("dragging");this._paperDrag.$el.removeClass("dragging");this._clone.remove();this._clone=undefined}},drop:function(m,n,l){var d=this.options.paper;var o=this.options.graph;var r=d.$el.offset();var c=document.body.scrollTop||document.documentElement.scrollTop;var h=document.body.scrollLeft||document.documentElement.scrollLeft;var j=g.rect(r.left+parseInt(d.$el.css("border-left-width"),10)-h,r.top+parseInt(d.$el.css("border-top-width"),10)-c,d.$el.innerWidth(),d.$el.innerHeight());var b=d.svg.createSVGPoint();b.x=m.clientX;b.y=m.clientY;if(j.containsPoint(b)){var k=V("rect",{width:d.options.width,height:d.options.height,x:0,y:0,opacity:0});V(d.svg).prepend(k);var f=$(d.svg).offset();k.remove();b.x+=h-f.left;b.y+=c-f.top;var q=b.matrixTransform(d.viewport.getCTM().inverse());var a=n.getBBox();q.x+=a.x-l.width/2;q.y+=a.y-l.height/2;n.set("position",{x:g.snapToGrid(q.x,d.options.gridSize),y:g.snapToGrid(q.y,d.options.gridSize)});n.unset("z");o.addCell(n,{stencil:this.cid})}},filter:function(a,d){var c=a.toLowerCase()==a;var b=_.reduce(this.papers,function(j,m,k){var l=m.model.get("cells").filter(function(n){var p=m.findViewByModel(n);var o=!a||_.some(d,function(s,r){if(r!="*"&&n.get("type")!=r){return false}var q=_.some(s,function(u){var t=joint.util.getByPath(n.attributes,u,"/");if(_.isUndefined(t)||_.isNull(t)){return false}t=t.toString();if(c){t=t.toLowerCase()}return t.indexOf(a)>=0});return q});V(p.el).toggleClass("unmatched",!o);return o},this);var h=!_.isEmpty(l);var f=(new joint.dia.Graph).resetCells(l);this.trigger("filter",f,k);if(this.$groups[k]){this.$groups[k].toggleClass("unmatched",!h)}m.fitToContent(1,1,this.options.paperPadding||10);return j||h},false,this);this.$el.toggleClass("not-found",!b)},onSearch:function(a){this.filter(a.target.value,this.options.search)},onGroupLabelClick:function(a){a.preventDefault();var b=$(a.target).closest(".group");this.toggleGroup(b.data("name"))},toggleGroup:function(a){this.$('.group[data-name="'+a+'"]').toggleClass("closed")},closeGroup:function(a){this.$('.group[data-name="'+a+'"]').addClass("closed")},openGroup:function(a){this.$('.group[data-name="'+a+'"]').removeClass("closed")},closeGroups:function(){this.$(".group").addClass("closed")},openGroups:function(){this.$(".group").removeClass("closed")},remove:function(){Backbone.View.prototype.remove.apply(this,arguments);$(document.body).off(".stencil",this.onDrag).off(".stencil",this.onDragEnd)}});var Handlebars={};(function(c,f){c.VERSION="1.0.0";c.COMPILER_REVISION=4;c.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};c.helpers={};c.partials={};var d=Object.prototype.toString,h="[object Function]",b="[object Object]";c.registerHelper=function(o,p,n){if(d.call(o)===b){if(n||p){throw new c.Exception("Arg not supported with multiple helpers")}c.Utils.extend(this.helpers,o)}else{if(n){p.not=n}this.helpers[o]=p}};c.registerPartial=function(n,o){if(d.call(n)===b){c.Utils.extend(this.partials,n)}else{this.partials[n]=o}};c.registerHelper("helperMissing",function(n){if(arguments.length===2){return f}else{throw new Error("Missing helper: '"+n+"'")}});c.registerHelper("blockHelperMissing",function(p,o){var n=o.inverse||function(){},r=o.fn;var q=d.call(p);if(q===h){p=p.call(this)}if(p===true){return r(this)}else{if(p===false||p==null){return n(this)}else{if(q==="[object Array]"){if(p.length>0){return c.helpers.each(p,o)}else{return n(this)}}else{return r(p)}}}});c.K=function(){};c.createFrame=Object.create||function(n){c.K.prototype=n;var o=new c.K();c.K.prototype=null;return o};c.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(p,n){if(c.logger.level<=p){var o=c.logger.methodMap[p];if(typeof console!=="undefined"&&console[o]){console[o].call(console,n)}}}};c.log=function(o,n){c.logger.log(o,n)};c.registerHelper("each",function(n,w){var u=w.fn,p=w.inverse;var r=0,s="",q;var t=d.call(n);if(t===h){n=n.call(this)}if(w.data){q=c.createFrame(w.data)}if(n&&typeof n==="object"){if(n instanceof Array){for(var o=n.length;r<o;r++){if(q){q.index=r}s=s+u(n[r],{data:q})}}else{for(var v in n){if(n.hasOwnProperty(v)){if(q){q.key=v}s=s+u(n[v],{data:q});r++}}}}if(r===0){s=p(this)}return s});c.registerHelper("if",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!o||c.Utils.isEmpty(o)){return n.inverse(this)}else{return n.fn(this)}});c.registerHelper("unless",function(o,n){return c.helpers["if"].call(this,o,{fn:n.inverse,inverse:n.fn})});c.registerHelper("with",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!c.Utils.isEmpty(o)){return n.fn(o)}});c.registerHelper("log",function(o,n){var p=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;c.log(p,o)});var l=["description","fileName","lineNumber","message","name","number","stack"];c.Exception=function(p){var o=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<l.length;n++){this[l[n]]=o[l[n]]}};c.Exception.prototype=new Error();c.SafeString=function(n){this.string=n};c.SafeString.prototype.toString=function(){return this.string.toString()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var a=/[&<>"'`]/g;var j=/[&<>"'`]/;var m=function(n){return k[n]||"&amp;"};c.Utils={extend:function(p,o){for(var n in o){if(o.hasOwnProperty(n)){p[n]=o[n]}}},escapeExpression:function(n){if(n instanceof c.SafeString){return n.toString()}else{if(n==null||n===false){return""}}n=n.toString();if(!j.test(n)){return n}return n.replace(a,m)},isEmpty:function(n){if(!n&&n!==0){return true}else{if(d.call(n)==="[object Array]"&&n.length===0){return true}else{return false}}}};c.VM={template:function(n){var o={escapeExpression:c.Utils.escapeExpression,invokePartial:c.VM.invokePartial,programs:[],program:function(q,r,s){var p=this.programs[q];if(s){p=c.VM.program(q,r,s)}else{if(!p){p=this.programs[q]=c.VM.program(q,r)}}return p},merge:function(r,q){var p=r||q;if(r&&q){p={};c.Utils.extend(p,q);c.Utils.extend(p,r)}return p},programWithDepth:c.VM.programWithDepth,noop:c.VM.noop,compilerInfo:null};return function(t,s){s=s||{};var q=n.call(o,c,t,s.helpers,s.partials,s.data);var u=o.compilerInfo||[],r=u[0]||1,w=c.COMPILER_REVISION;if(r!==w){if(r<w){var p=c.REVISION_CHANGES[w],v=c.REVISION_CHANGES[r];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+p+") or downgrade your runtime to an older version ("+v+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+u[1]+")."}}return q}},programWithDepth:function(p,q,r){var o=Array.prototype.slice.call(arguments,3);var n=function(t,s){s=s||{};return q.apply(this,[t,s.data||r].concat(o))};n.program=p;n.depth=o.length;return n},program:function(o,p,q){var n=function(s,r){r=r||{};return p(s,r.data||q)};n.program=o;n.depth=0;return n},noop:function(){return""},invokePartial:function(n,p,r,s,q,t){var o={helpers:s,partials:q,data:t};if(n===f){throw new c.Exception("The partial "+p+" could not be found")}else{if(n instanceof Function){return n(r,o)}else{if(!c.compile){throw new c.Exception("The partial "+p+" could not be compiled when running in runtime-only mode")}else{q[p]=c.compile(n,{data:t!==f});return q[p](r,o)}}}}};c.template=c.VM.template})(Handlebars);this["joint"]=this["joint"]||{};this["joint"]["templates"]=this["joint"]["templates"]||{};this["joint"]["templates"]["inspector"]=this["joint"]["templates"]["inspector"]||{};this["joint"]["templates"]["inspector"]["color.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<input type="color" class="color" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'" value="';if(a=b.value){a=a.call(l,{hash:{},data:j})}else{a=l.value;a=typeof a===d?a.apply(l):a}f+=h(a)+'" />\n';return f});this["joint"]["templates"]["inspector"]["group.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+='<div class="group">\n    <h3 class="group-label">';if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+"</h3>\n</div>\n";return f});this["joint"]["templates"]["inspector"]["list-item.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+='<div class="list-item" data-index="';if(a=b.index){a=a.call(l,{hash:{},data:j})}else{a=l.index;a=typeof a===d?a.apply(l):a}f+=h(a)+'">\n    <button class="btn-list-del">-</button>\n</div>\n';return f});this["joint"]["templates"]["inspector"]["list.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<div class="list" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'">\n    <button class="btn-list-add">+</button>\n    <div class="list-items">\n    </div>\n</div>\n';return f});this["joint"]["templates"]["inspector"]["number.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,m,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<input type="number" class="number" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'" min="'+h(((a=((a=l.options),a==null||a===false?a:a.min)),typeof a===d?a.apply(l):a))+'" max="'+h(((a=((a=l.options),a==null||a===false?a:a.max)),typeof a===d?a.apply(l):a))+'" step="'+h(((a=((a=l.options),a==null||a===false?a:a.step)),typeof a===d?a.apply(l):a))+'" value="';if(m=b.value){m=m.call(l,{hash:{},data:j})}else{m=l.value;m=typeof m===d?m.apply(l):m}f+=h(m)+'"/>\n';return f});this["joint"]["templates"]["inspector"]["object-property.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+='<div class="object-property" data-property="';if(a=b.property){a=a.call(l,{hash:{},data:j})}else{a=l.property;a=typeof a===d?a.apply(l):a}f+=h(a)+'">\n</div>\n';return f});this["joint"]["templates"]["inspector"]["object.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<div class="object" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'">\n    <div class="object-properties"></div>\n</div>\n';return f});this["joint"]["templates"]["inspector"]["range.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,m,d="function",h=this.escapeExpression;f+="<form onchange=\"$(this).find('output').text(range.value)\">\n    <label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+": (<output>";if(a=b.value){a=a.call(l,{hash:{},data:j})}else{a=l.value;a=typeof a===d?a.apply(l):a}f+=h(a)+"</output>"+h(((a=((a=l.options),a==null||a===false?a:a.unit)),typeof a===d?a.apply(l):a))+')</label>\n    <input type="range" class="range" name="range" data-type="';if(m=b.type){m=m.call(l,{hash:{},data:j})}else{m=l.type;m=typeof m===d?m.apply(l):m}f+=h(m)+'" data-attribute="';if(m=b.attribute){m=m.call(l,{hash:{},data:j})}else{m=l.attribute;m=typeof m===d?m.apply(l):m}f+=h(m)+'" min="'+h(((a=((a=l.options),a==null||a===false?a:a.min)),typeof a===d?a.apply(l):a))+'" max="'+h(((a=((a=l.options),a==null||a===false?a:a.max)),typeof a===d?a.apply(l):a))+'" step="'+h(((a=((a=l.options),a==null||a===false?a:a.step)),typeof a===d?a.apply(l):a))+'" value="';if(m=b.value){m=m.call(l,{hash:{},data:j})}else{m=l.value;m=typeof m===d?m.apply(l):m}f+=h(m)+'"/>\n</form>\n';return f});this["joint"]["templates"]["inspector"]["select.html"]=Handlebars.template(function(f,o,d,m,l){this.compilerInfo=[4,">= 1.0.0"];d=this.merge(d,f.helpers);l=l||{};var j="",b,r,h="function",k=this.escapeExpression,p=this,n=d.helperMissing;function c(v,u){var s="",t;s+=' multiple size="'+k(((t=((t=((t=v.options),t==null||t===false?t:t.options)),t==null||t===false?t:t.length)),typeof t===h?t.apply(v):t))+'" ';return s}function a(y,w,x){var s="",v,u,t;s+='\n    <option value="'+k(((v=y.value),typeof v===h?v.apply(y):v))+'" ';t={hash:{},inverse:p.noop,fn:p.program(4,q,w),data:w};u=((v=d["is-or-contains"]||y["is-or-contains"]),v?v.call(y,y.value,x.value,t):n.call(y,"is-or-contains",y.value,x.value,t));if(u||u===0){s+=u}s+=">"+k(((v=y.content),typeof v===h?v.apply(y):v))+"</option>\n    ";return s}function q(t,s){return" selected "}j+="<label>";if(b=d.label){b=b.call(o,{hash:{},data:l})}else{b=o.label;b=typeof b===h?b.apply(o):b}j+=k(b)+':</label>\n<select class="select" data-type="';if(b=d.type){b=b.call(o,{hash:{},data:l})}else{b=o.type;b=typeof b===h?b.apply(o):b}j+=k(b)+'" data-attribute="';if(b=d.attribute){b=b.call(o,{hash:{},data:l})}else{b=o.attribute;b=typeof b===h?b.apply(o):b}j+=k(b)+'" value="';if(b=d.value){b=b.call(o,{hash:{},data:l})}else{b=o.value;b=typeof b===h?b.apply(o):b}j+=k(b)+'" ';r=d["if"].call(o,((b=o.options),b==null||b===false?b:b.multiple),{hash:{},inverse:p.noop,fn:p.program(1,c,l),data:l});if(r||r===0){j+=r}j+=">\n    ";r=d.each.call(o,((b=o.options),b==null||b===false?b:b.items),{hash:{},inverse:p.noop,fn:p.programWithDepth(3,a,l,o),data:l});if(r||r===0){j+=r}j+="\n</select>\n";return j});this["joint"]["templates"]["inspector"]["text.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<input type="text" class="text" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'" value="';if(a=b.value){a=a.call(l,{hash:{},data:j})}else{a=l.value;a=typeof a===d?a.apply(l):a}f+=h(a)+'" />\n';return f});this["joint"]["templates"]["inspector"]["textarea.html"]=Handlebars.template(function(c,l,b,k,j){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,c.helpers);j=j||{};var f="",a,d="function",h=this.escapeExpression;f+="<label>";if(a=b.label){a=a.call(l,{hash:{},data:j})}else{a=l.label;a=typeof a===d?a.apply(l):a}f+=h(a)+':</label>\n<textarea class="textarea" data-type="';if(a=b.type){a=a.call(l,{hash:{},data:j})}else{a=l.type;a=typeof a===d?a.apply(l):a}f+=h(a)+'" data-attribute="';if(a=b.attribute){a=a.call(l,{hash:{},data:j})}else{a=l.attribute;a=typeof a===d?a.apply(l):a}f+=h(a)+'">';if(a=b.value){a=a.call(l,{hash:{},data:j})}else{a=l.value;a=typeof a===d?a.apply(l):a}f+=h(a)+"</textarea>\n";return f});this["joint"]["templates"]["inspector"]["toggle.html"]=Handlebars.template(function(d,m,c,l,k){this.compilerInfo=[4,">= 1.0.0"];c=this.merge(c,d.helpers);k=k||{};var h="",a,f="function",j=this.escapeExpression,n=this;function b(p,o){return" checked "}h+="<label>";if(a=c.label){a=a.call(m,{hash:{},data:k})}else{a=m.label;a=typeof a===f?a.apply(m):a}h+=j(a)+':</label>\n<div class="toggle">\n    <input type="checkbox" data-type="';if(a=c.type){a=a.call(m,{hash:{},data:k})}else{a=m.type;a=typeof a===f?a.apply(m):a}h+=j(a)+'" data-attribute="';if(a=c.attribute){a=a.call(m,{hash:{},data:k})}else{a=m.attribute;a=typeof a===f?a.apply(m):a}h+=j(a)+'" ';a=c["if"].call(m,m.value,{hash:{},inverse:n.noop,fn:n.program(1,b,k),data:k});if(a||a===0){h+=a}h+=" />\n    <span><i></i></span>\n</div>\n";return h});Handlebars.registerHelper("is",function(b,c,a){if(b==c){return a.fn(this)}return a.inverse(this)});Handlebars.registerHelper("is-or-contains",function(b,c,a){if(_.isArray(c)?_.contains(c,b):b==c){return a.fn(this)}return a.inverse(this)});Handlebars.registerPartial("list-item",joint.templates.inspector["list-item.html"]);joint.ui.Inspector=Backbone.View.extend({className:"inspector",options:{cellView:undefined,cell:undefined,live:true,validateInput:function(a,b){return a.validity.valid}},events:{mousedown:"startBatchCommand","change [data-attribute]":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem"},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});this.options.groups=this.options.groups||{};_.bindAll(this,"stopBatchCommand");$(document).on("mouseup",this.stopBatchCommand);this.flatAttributes=joint.util.flattenObject(this.options.inputs,"/",function(c){return c.type});this._when={};this._bound={};var b=_.map(this.flatAttributes,function(c,d){if(c.when){var f={expression:c.when,path:d};_.each(this.extractExpressionPaths(f.expression),function(h){(this._when[h]||(this._when[h]=[])).push(f)},this)}if(c.type=="select"&&_.isString(c.options)){this._bound[d]=c.options}c.path=d;return c},this);this.groupedFlatAttributes=_.sortBy(_.sortBy(b,"index"),function(d){var c=this.options.groups[d.group];return(c&&c.index)||Number.MAX_VALUE},this);this.on("render",function(){this._byPath={};_.each(this.$("[data-attribute]"),function(d){var c=$(d);this._byPath[c.attr("data-attribute")]=c},this)},this);this.listenTo(this.getModel(),"all",this.onCellChange,this)},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(b,a,f,c){c=c||{};if(c.inspector==this.cid){return}switch(b){case"remove":this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:var d="change:";if(b.slice(0,d.length)===d){this.render()}break}},render:function(){this.$el.empty();var b;var a=[];var c;_.each(this.groupedFlatAttributes,function(f){if(b!==f.group){var d=this.options.groups[f.group];var h=d?d.label||f.group:f.group;c=$(joint.templates.inspector["group.html"]({label:h}));c.attr("data-name",f.group);if(d&&d.closed){c.addClass("closed")}a.push(c)}this.renderTemplate(c,f,f.path);b=f.group},this);this.$el.append(a);this.trigger("render");return this},getCellAttributeValue:function(d,b){var a=this.getModel();var c=joint.util.getByPath(a.attributes,d,"/");if(!b){return c}if(_.isUndefined(c)&&!_.isUndefined(b.defaultValue)){c=b.defaultValue}if(b.valueRegExp){if(_.isUndefined(c)){throw new Error("Inspector: defaultValue must be present when valueRegExp is used.")}var f=c.match(new RegExp(b.valueRegExp));c=f&&f[2]}return c},resolveBindings:function(b){switch(b.type){case"select":var a=b.options||[];if(_.isString(a)){a=joint.util.getByPath(this.getModel().attributes,a,"/")||[]}if(!_.isObject(a[0])){a=_.map(a,function(c){return{value:c,content:c}})}b.items=a;break}},updateBindings:function(b){var a=_.reduce(this._bound,function(c,f,d){if(!b.indexOf(f)){c.push(d)}return c},[]);if(!_.isEmpty(a)){_.each(a,function(c){this.renderTemplate(null,this.flatAttributes[c],c,{replace:true})},this);this.trigger("render")}},renderTemplate:function(j,l,h,a){j=j||this.$el;a=a||{};this.resolveBindings(l);var d=$('<div class="field"></div>').attr("data-field",h);if(l.when&&!this.isExpressionValid(l.when)){d.addClass("hidden");if(l.when.otherwise){if(l.when.otherwise.unset){this.unsetProperty(h)}}}var f=this.getCellAttributeValue(h,l);var k=joint.templates.inspector[l.type+".html"]({options:l,type:l.type,label:l.label||h,attribute:h,value:f});var c=$(k);d.append(c);_.each(l.attrs,function(n,m){d.find(m).addBack().filter(m).attr(n)});if(l.type==="list"){_.each(f,function(o,m){var n=$(joint.templates.inspector["list-item.html"]({index:m}));this.renderTemplate(n,l.item,h+"/"+m);c.children(".list-items").append(n)},this)}else{if(l.type==="object"){l.flatAttributes=joint.util.flattenObject(l.properties,"/",function(m){return m.type});var b=_.map(l.flatAttributes,function(m,n){m.path=n;return m});b=_.sortBy(b,function(m){return m.index});_.each(b,function(m){var n=$(joint.templates.inspector["object-property.html"]({property:m.path}));this.renderTemplate(n,m,h+"/"+m.path);c.children(".object-properties").append(n)},this)}}if(a.replace){j.find('[data-field="'+h+'"]').replaceWith(d)}else{j.append(d)}},updateInputPosition:function(){var c=this._byPath["position/x"];var b=this._byPath["position/y"];var a=this.getModel().get("position");if(c){c.val(a.x)}if(b){b.val(a.y)}},updateInputSize:function(){var c=this._byPath["size/width"];var a=this._byPath["size/height"];var b=this.getModel().get("size");if(c){c.val(b.width)}if(a){a.val(b.height)}},updateInputAngle:function(){var a=this._byPath.angle;var b=this.getModel().get("angle");if(a){a.val(b)}},onChangeInput:function(b){var h=$(b.target);var f=h.attr("data-attribute");if(!this.options.validateInput(h[0],f)){return}if(this.options.live){this.updateCell(h,f)}var c=h.attr("data-type");var d=this.parse(c,h.val(),h[0]);var a=this._when[f];this.trigger("change:"+f,d,h[0]);if(a){_.each(a,function(n){var j=this._byPath[n.path];var k=j.closest(".field");var m=k.hasClass("hidden");var l=this.isExpressionValid(n.expression);k.toggleClass("hidden",!l);if(n.expression.otherwise){if(n.expression.otherwise.unset&&this.options.live){if(!l){this.unsetProperty(n.path);this.renderTemplate(null,this.flatAttributes[n.path],n.path,{replace:true});this.trigger("render")}else{if(m){this.updateCell(j,n.path)}}}}},this)}},unsetProperty:function(k,b){var a=this.getModel();var j=k.split("/");var h=_.first(j);var d=_.rest(j).join("/");b=b||{};b.inspector=this.cid;b["inspector_"+this.cid]=true;if(k=="attrs"){a.removeAttr(d,b)}else{if(k==h){a.unset(h,b)}else{var f=_.merge({},a.get(h));var c=joint.util.unsetByPath(f,d,"/");a.set(h,c,b)}}},getOptions:function(a){if(a.length===0){return undefined}var k=a.attr("data-attribute");var h=a.attr("data-type");var c=this.flatAttributes[k];if(!c){var d=a.parent().closest("[data-attribute]");var b=d.attr("data-attribute");c=this.getOptions(d);var j=k.replace(b+"/","");var f=c;c=f.item||f.flatAttributes[j];c.parent=f}return c},updateCell:function(b,d){var a=this.getModel();var c={};if(b){c[d]=b}else{c=this._byPath}this.startBatchCommand();this._tempListsByPath={};_.each(c,function(n,p){if(n.closest(".field").hasClass("hidden")){return}var m=n.attr("data-type");var o;var q;var k;switch(m){case"list":if(!c[p+"/0"]){this.setProperty(p,[],{rewrite:true})}else{this._tempListsByPath[p]=[]}break;case"object":break;default:if(!this.options.validateInput(n[0],p)){return}o=this.parse(m,n.val(),n[0]);q=this.getOptions(n);if(q.valueRegExp){var f=joint.util.getByPath(a.attributes,p,"/")||q.defaultValue;o=f.replace(new RegExp(q.valueRegExp),"$1"+o+"$3")}if(q.parent&&q.parent.type==="list"){var h=p.split("/");var j=_.initial(h).join("/");if(this._tempListsByPath[j]){var l=parseInt(_.last(h),10);this._tempListsByPath[j][l]=o;if(!c[j+"/"+(l+1)]){this.setProperty(j,this._tempListsByPath[j],{rewrite:true})}return}}this.setProperty(p,o);break}this.updateBindings(p)},this);this.stopBatchCommand()},setProperty:function(c,b,a){a=a||{};a.inspector=this.cid;a["inspector_"+this.cid]=true;joint.dia.Cell.prototype.prop.call(this.getModel(),c,b,a)},parse:function(b,c,a){switch(b){case"number":c=parseFloat(c);break;case"toggle":c=a.checked;break;default:c=c;break}return c},startBatchCommand:function(){this.getModel().trigger("batch:start")},stopBatchCommand:function(){this.getModel().trigger("batch:stop")},addListItem:function(j){var a=$(j.target);var h=a.closest("[data-attribute]");var k=h.attr("data-attribute");var l=this.getOptions(h);var b=h.children(".list-items").children(".list-item").last();var c=b.length===0?-1:parseInt(b.attr("data-index"),10);var d=c+1;var f=$(joint.templates.inspector["list-item.html"]({index:d}));this.renderTemplate(f,l.item,k+"/"+d);a.parent().children(".list-items").append(f);f.find("input:first").focus();this.trigger("render");if(this.options.live){this.updateCell()}},deleteListItem:function(a){var b=$(a.target).closest(".list-item");b.nextAll(".list-item").each(function(){var c=parseInt($(this).attr("data-index"),10);var d=c-1;$(this).find("[data-field]").each(function(){$(this).attr("data-field",$(this).attr("data-field").replace("/"+c,"/"+d))});$(this).find("[data-attribute]").each(function(){$(this).attr("data-attribute",$(this).attr("data-attribute").replace("/"+c,"/"+d))});$(this).attr("data-index",d)});b.remove();this.trigger("render");if(this.options.live){this.updateCell()}},remove:function(){$(document).off("mouseup",this.stopBatchCommand);return Backbone.View.prototype.remove.apply(this,arguments)},onGroupLabelClick:function(a){a.preventDefault();var b=$(a.target).closest(".group");this.toggleGroup(b.data("name"))},toggleGroup:function(a){this.$('.group[data-name="'+a+'"]').toggleClass("closed")},closeGroup:function(a){this.$('.group[data-name="'+a+'"]').addClass("closed")},openGroup:function(a){this.$('.group[data-name="'+a+'"]').removeClass("closed")},closeGroups:function(){this.$(".group").addClass("closed")},openGroups:function(){this.$(".group").removeClass("closed")},_isComposite:function(a){var b=_.pick(a,"not","and","or","nor");return _.some(b)},_isPrimitive:function(b){var a=_.pick(b,"eq","ne","regex","text","lt","lte","gt","gte","in","nin");return _.some(a)},_evalPrimitive:function(a){return _.reduce(a,function(c,d,b){return _.reduce(d,function(h,j,f){var k=this.getCellAttributeValue(f,this.flatAttributes[f]);switch(b){case"eq":return j==k;case"ne":return j!=k;case"regex":return(new RegExp(j)).test(k);case"text":return !j||(_.isString(k)&&k.toLowerCase().indexOf(j)>-1);case"lt":return k<j;case"lte":return k<=j;case"gt":return k>j;case"gte":return k>=j;case"in":return _.contains(j,k);case"nin":return !_.contains(j,k);default:return h}},false,this)},false,this)},_evalExpression:function(a){if(this._isPrimitive(a)){return this._evalPrimitive(a)}return _.reduce(a,function(d,f,c){if(c=="not"){return !this._evalExpression(f)}var b=_.map(f,this._evalExpression,this);switch(c){case"and":return _.every(b);case"or":return _.some(b);case"nor":return !_.some(b);default:return d}},false,this)},_extractVariables:function(a){if(_.isArray(a)||this._isComposite(a)){return _.reduce(a,function(b,c){return b.concat(this._extractVariables(c))},[],this)}return _.reduce(a,function(c,b){return _.keys(b)},[])},isExpressionValid:function(a){a=_.omit(a,"otherwise");return this._evalExpression(a)},extractExpressionPaths:function(a){a=_.omit(a,"otherwise");return _.uniq(this._extractVariables(a))}});var Handlebars={};(function(c,f){c.VERSION="1.0.0";c.COMPILER_REVISION=4;c.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};c.helpers={};c.partials={};var d=Object.prototype.toString,h="[object Function]",b="[object Object]";c.registerHelper=function(o,p,n){if(d.call(o)===b){if(n||p){throw new c.Exception("Arg not supported with multiple helpers")}c.Utils.extend(this.helpers,o)}else{if(n){p.not=n}this.helpers[o]=p}};c.registerPartial=function(n,o){if(d.call(n)===b){c.Utils.extend(this.partials,n)}else{this.partials[n]=o}};c.registerHelper("helperMissing",function(n){if(arguments.length===2){return f}else{throw new Error("Missing helper: '"+n+"'")}});c.registerHelper("blockHelperMissing",function(p,o){var n=o.inverse||function(){},r=o.fn;var q=d.call(p);if(q===h){p=p.call(this)}if(p===true){return r(this)}else{if(p===false||p==null){return n(this)}else{if(q==="[object Array]"){if(p.length>0){return c.helpers.each(p,o)}else{return n(this)}}else{return r(p)}}}});c.K=function(){};c.createFrame=Object.create||function(n){c.K.prototype=n;var o=new c.K();c.K.prototype=null;return o};c.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(p,n){if(c.logger.level<=p){var o=c.logger.methodMap[p];if(typeof console!=="undefined"&&console[o]){console[o].call(console,n)}}}};c.log=function(o,n){c.logger.log(o,n)};c.registerHelper("each",function(n,w){var u=w.fn,p=w.inverse;var r=0,s="",q;var t=d.call(n);if(t===h){n=n.call(this)}if(w.data){q=c.createFrame(w.data)}if(n&&typeof n==="object"){if(n instanceof Array){for(var o=n.length;r<o;r++){if(q){q.index=r}s=s+u(n[r],{data:q})}}else{for(var v in n){if(n.hasOwnProperty(v)){if(q){q.key=v}s=s+u(n[v],{data:q});r++}}}}if(r===0){s=p(this)}return s});c.registerHelper("if",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!o||c.Utils.isEmpty(o)){return n.inverse(this)}else{return n.fn(this)}});c.registerHelper("unless",function(o,n){return c.helpers["if"].call(this,o,{fn:n.inverse,inverse:n.fn})});c.registerHelper("with",function(o,n){var p=d.call(o);if(p===h){o=o.call(this)}if(!c.Utils.isEmpty(o)){return n.fn(o)}});c.registerHelper("log",function(o,n){var p=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;c.log(p,o)});var l=["description","fileName","lineNumber","message","name","number","stack"];c.Exception=function(p){var o=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<l.length;n++){this[l[n]]=o[l[n]]}};c.Exception.prototype=new Error();c.SafeString=function(n){this.string=n};c.SafeString.prototype.toString=function(){return this.string.toString()};var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var a=/[&<>"'`]/g;var j=/[&<>"'`]/;var m=function(n){return k[n]||"&amp;"};c.Utils={extend:function(p,o){for(var n in o){if(o.hasOwnProperty(n)){p[n]=o[n]}}},escapeExpression:function(n){if(n instanceof c.SafeString){return n.toString()}else{if(n==null||n===false){return""}}n=n.toString();if(!j.test(n)){return n}return n.replace(a,m)},isEmpty:function(n){if(!n&&n!==0){return true}else{if(d.call(n)==="[object Array]"&&n.length===0){return true}else{return false}}}};c.VM={template:function(n){var o={escapeExpression:c.Utils.escapeExpression,invokePartial:c.VM.invokePartial,programs:[],program:function(q,r,s){var p=this.programs[q];if(s){p=c.VM.program(q,r,s)}else{if(!p){p=this.programs[q]=c.VM.program(q,r)}}return p},merge:function(r,q){var p=r||q;if(r&&q){p={};c.Utils.extend(p,q);c.Utils.extend(p,r)}return p},programWithDepth:c.VM.programWithDepth,noop:c.VM.noop,compilerInfo:null};return function(t,s){s=s||{};var q=n.call(o,c,t,s.helpers,s.partials,s.data);var u=o.compilerInfo||[],r=u[0]||1,w=c.COMPILER_REVISION;if(r!==w){if(r<w){var p=c.REVISION_CHANGES[w],v=c.REVISION_CHANGES[r];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+p+") or downgrade your runtime to an older version ("+v+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+u[1]+")."}}return q}},programWithDepth:function(p,q,r){var o=Array.prototype.slice.call(arguments,3);var n=function(t,s){s=s||{};return q.apply(this,[t,s.data||r].concat(o))};n.program=p;n.depth=o.length;return n},program:function(o,p,q){var n=function(s,r){r=r||{};return p(s,r.data||q)};n.program=o;n.depth=0;return n},noop:function(){return""},invokePartial:function(n,p,r,s,q,t){var o={helpers:s,partials:q,data:t};if(n===f){throw new c.Exception("The partial "+p+" could not be found")}else{if(n instanceof Function){return n(r,o)}else{if(!c.compile){throw new c.Exception("The partial "+p+" could not be compiled when running in runtime-only mode")}else{q[p]=c.compile(n,{data:t!==f});return q[p](r,o)}}}}};c.template=c.VM.template})(Handlebars);this["joint"]=this["joint"]||{};this["joint"]["templates"]=this["joint"]["templates"]||{};this["joint"]["templates"]["freetransform.html"]=Handlebars.template(function(d,f,b,a,c){this.compilerInfo=[4,">= 1.0.0"];b=this.merge(b,d.helpers);c=c||{};return'<div class="resize" data-position="top-left" draggable="false"/>\n<div class="resize" data-position="top" draggable="false"/>\n<div class="resize" data-position="top-right" draggable="false"/>\n<div class="resize" data-position="right" draggable="false"/>\n<div class="resize" data-position="bottom-right" draggable="false"/>\n<div class="resize" data-position="bottom" draggable="false"/>\n<div class="resize" data-position="bottom-left" draggable="false"/>\n<div class="resize" data-position="left" draggable="false"/>\n<div class="rotate" draggable="false"/>\n\n'});joint.ui.FreeTransform=Backbone.View.extend({className:"free-transform",template:"freetransform",events:{"mousedown .resize":"startResizing","mousedown .rotate":"startRotating","touchstart .resize":"startResizing","touchstart .rotate":"startRotating"},options:{rotateAngleGrid:15,preventAspectRatio:false,directions:["nw","n","ne","e","se","s","sw","w"]},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});if(this.options.cellView){_.defaults(this.options,{cell:this.options.cellView.model,paper:this.options.cellView.paper,graph:this.options.cellView.paper.model})}_.bindAll(this,"update","remove","pointerup","pointermove");joint.ui.FreeTransform.clear(this.options.paper);$(document.body).on("mousemove touchmove",this.pointermove);$(document).on("mouseup touchend",this.pointerup);this.listenTo(this.options.graph,"all",this.update);this.listenTo(this.options.graph,"reset",this.remove);this.listenTo(this.options.cell,"remove",this.remove);this.listenTo(this.options.paper,"blank:pointerdown freetransform:create",this.remove);this.listenTo(this.options.paper,"scale translate",this.update);this.options.paper.$el.append(this.el)},render:function(){this.$el.html(joint.templates["freetransform.html"](this.template));this.$el.attr("data-type",this.options.cell.get("type"));this.$el.toggleClass("prevent-aspect-ratio",this.options.preventAspectRatio);this.update()},update:function(){var b=this.options.paper.viewport.getCTM();var f=this.options.cell.getBBox();f.x*=b.a;f.x+=b.e;f.y*=b.d;f.y+=b.f;f.width*=b.a;f.height*=b.d;var d=g.normalizeAngle(this.options.cell.get("angle")||0);var c="rotate("+d+"deg)";this.$el.css({width:f.width+4,height:f.height+4,left:f.x-3,top:f.y-3,transform:c,"-webkit-transform":c,"-ms-transform":c});var a=Math.floor(d*(this.options.directions.length/360));if(a!=this._previousDirectionsShift){var h=_.rest(this.options.directions,a).concat(_.first(this.options.directions,a));this.$(".resize").removeClass("nw n ne e se s sw w").each(function(j,k){$(k).addClass(h[j])});this._previousDirectionsShift=a}},startResizing:function(b){b.stopPropagation();this.options.graph.trigger("batch:start");var f=$(b.target).data("position");var d=0,c=0;_.each(f.split("-"),function(h){d={left:-1,right:1}[h]||d;c={top:-1,bottom:1}[h]||c});f={top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[f]||f;var a={"top-right":"bottomLeft","top-left":"corner","bottom-left":"topRight","bottom-right":"origin"}[f];this._initial={angle:g.normalizeAngle(this.options.cell.get("angle")||0),resizeX:d,resizeY:c,selector:a,direction:f};this._action="resize";this.startOp(b.target)},startRotating:function(b){b.stopPropagation();this.options.graph.trigger("batch:start");var a=this.options.cell.getBBox().center();var c=this.options.paper.snapToGrid({x:b.clientX,y:b.clientY});this._initial={centerRotation:a,modelAngle:g.normalizeAngle(this.options.cell.get("angle")||0),startAngle:g.point(c).theta(a)};this._action="rotate";this.startOp(b.target)},pointermove:function(n){if(!this._action){return}n=joint.util.normalizeEvent(n);var f=this.options.paper.snapToGrid({x:n.clientX,y:n.clientY});var d=this.options.paper.options.gridSize;var k=this.options.cell,j=this._initial;switch(this._action){case"resize":var l=k.getBBox();var h=g.point(f).rotate(l.center(),j.angle);var m=h.difference(l[j.selector]());var a=j.resizeX?m.x*j.resizeX:l.width;var o=j.resizeY?m.y*j.resizeY:l.height;if(this.options.preventAspectRatio){var c=l.width*o/l.height;var p=l.height*a/l.width;c>a?(o=p):(a=c)}a=a<d?d:g.snapToGrid(a,d);o=o<d?d:g.snapToGrid(o,d);if(l.width!=a||l.height!=o){k.resize(a,o,{direction:j.direction})}break;case"rotate":var b=j.startAngle-g.point(f).theta(j.centerRotation);k.rotate(g.snapToGrid(j.modelAngle+b,this.options.rotateAngleGrid),true);break}},pointerup:function(a){if(!this._action){return}this.stopOp();this.options.graph.trigger("batch:stop");delete this._action;delete this._initial},remove:function(a){Backbone.View.prototype.remove.apply(this,arguments);$("body").off("mousemove touchmove",this.pointermove);$(document).off("mouseup touchend",this.pointerup)},startOp:function(a){if(a){$(a).addClass("in-operation");this._elementOp=a}this.$el.addClass("in-operation")},stopOp:function(){if(this._elementOp){$(this._elementOp).removeClass("in-operation");delete this._elementOp}this.$el.removeClass("in-operation")}},{clear:function(a){a.trigger("freetransform:create")}});joint.ui.Tooltip=Backbone.View.extend({className:"tooltip",options:{left:undefined,right:undefined,top:undefined,bottom:undefined,padding:10,target:undefined,rootTarget:undefined},initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});_.bindAll(this,"render","hide","position");if(this.options.rootTarget){this.$rootTarget=$(this.options.rootTarget);this.$rootTarget.on("mouseover",this.options.target,this.render);this.$rootTarget.on("mouseout",this.options.target,this.hide);this.$rootTarget.on("mousedown",this.options.target,this.hide)}else{this.$target=$(this.options.target);this.$target.on("mouseover",this.render);this.$target.on("mouseout",this.hide);this.$target.on("mousedown",this.hide)}this.$el.addClass(this.options.direction)},remove:function(){this.$target.off("mouseover",this.render);this.$target.off("mouseout",this.hide);this.$target.off("mousedown",this.hide);Backbone.View.prototype.remove.apply(this,arguments)},hide:function(){Backbone.View.prototype.remove.apply(this,arguments)},render:function(a){var d;var b=!_.isUndefined(a.x)&&!_.isUndefined(a.y);if(b){d=a}else{this.$target=$(a.target).closest(this.options.target);d=this.$target[0]}this.$el.html(_.isFunction(this.options.content)?this.options.content(d):this.options.content);this.$el.hide();$(document.body).append(this.$el);var c=this.$("img");if(c.length){c.on("load",_.bind(function(){this.position(b?d:undefined)},this))}else{this.position(b?d:undefined)}},getElementBBox:function(c){var l=$(c);var f=l.offset();var k;var b=document.body.scrollTop||document.documentElement.scrollTop;var d=document.body.scrollLeft||document.documentElement.scrollLeft;f.top-=(b||0);f.left-=(d||0);if(c.ownerSVGElement){k=V(c).bbox();var a=c.getBoundingClientRect();var j=(a.width-k.width)/2;var h=(a.height-k.height)/2;k.x=f.left+j;k.y=f.top+h}else{k={x:f.left,y:f.top,width:l.outerWidth(),height:l.outerHeight()}}return k},position:function(a){var o;if(a){o={x:a.x,y:a.y,width:1,height:1}}else{o=this.getElementBBox(this.$target[0])}var m=this.options.padding;this.$el.show();var q=this.$el.outerHeight();var b=this.$el.outerWidth();if(this.options.left){var c=$(_.isFunction(this.options.left)?this.options.left(this.$target[0]):this.options.left);var l=this.getElementBBox(c[0]);this.$el.css({left:l.x+l.width+m,top:o.y+o.height/2-q/2})}else{if(this.options.right){var n=$(_.isFunction(this.options.right)?this.options.right(this.$target[0]):this.options.right);var h=this.getElementBBox(n[0]);this.$el.css({left:h.x-b-m,top:o.y+o.height/2-q/2})}else{if(this.options.top){var f=$(_.isFunction(this.options.top)?this.options.top(this.$target[0]):this.options.top);var j=this.getElementBBox(f[0]);this.$el.css({top:j.y+j.height+m,left:o.x+o.width/2-b/2})}else{if(this.options.bottom){var k=$(_.isFunction(this.options.bottom)?this.options.bottom(this.$target[0]):this.options.bottom);var d=this.getElementBBox(k[0]);this.$el.css({top:d.y-q-m,left:o.x+o.width/2-b/2})}else{this.$el.css({left:o.x+o.width+m,top:o.y+o.height/2-q/2})}}}}}});joint.ui.Snaplines=Backbone.View.extend({options:{paper:undefined,distance:10},className:"snaplines",initialize:function(a){this.options=_.extend({},_.result(this,"options"),a||{});this.$horizontal=$("<div>").addClass("snapline horizontal").appendTo(this.el);this.$vertical=$("<div>").addClass("snapline vertical").appendTo(this.el);this.$el.hide().appendTo(this.options.paper.el);this.startListening()},startListening:function(){this.stopListening();this.listenTo(this.options.paper,"cell:pointerdown",this.startSnapping);this.listenTo(this.options.paper,"cell:pointermove",this.snap);this.listenTo(this.options.paper,"cell:pointerup",this.hide);this.filterTypes={};this.filterCells={};this.filterFunction=undefined;if(_.isArray(this.options.filter)){_.each(this.options.filter,function(a){if(_.isString(a)){this.filterTypes[a]=true}else{this.filterCells[a.id]=true}},this)}else{if(_.isFunction(this.options.filter)){this.filterFunction=this.options.filter}}},startSnapping:function(d,c,b,f){if(d instanceof joint.dia.LinkView){return}var a=d.model.get("position");this._diffX=b-a.x;this._diffY=f-a.y},snap:function(a,o,n,l){if(a instanceof joint.dia.LinkView){return}var c=a.model;var t=g.rect(_.extend({x:n-this._diffX,y:l-this._diffY},c.get("size")));var k=t.center();var q=t.bbox(c.get("angle"));var b=q.origin();var p=q.corner();var h=this.options.distance;var d=null;var s=null;var j=0;var m=0;_.find(this.options.paper.model.getElements(),function(y){if(y===c||y.isEmbeddedIn(c)||this.filterTypes[y.get("type")]||this.filterCells[y.id]||(this.filterFunction&&this.filterFunction(y))){return false}var w=y.getBBox().bbox(y.get("angle"));var A=w.center();var x=w.origin();var z=w.corner();if(_.isNull(d)){if(Math.abs(A.x-k.x)<h){d=A.x;j=0.5}else{if(Math.abs(x.x-b.x)<h){d=x.x}else{if(Math.abs(x.x-p.x)<h){d=x.x;j=1}else{if(Math.abs(z.x-p.x)<h){d=z.x;j=1}else{if(Math.abs(z.x-b.x)<h){d=z.x}}}}}}if(_.isNull(s)){if(Math.abs(A.y-k.y)<h){s=A.y;m=0.5}else{if(Math.abs(x.y-b.y)<h){s=x.y}else{if(Math.abs(x.y-p.y)<h){s=x.y;m=1}else{if(Math.abs(z.y-p.y)<h){s=z.y;m=1}else{if(Math.abs(z.y-b.y)<h){s=z.y}}}}}}return _.isNumber(d)&&_.isNumber(s)},this);this.hide();if(_.isNumber(d)||_.isNumber(s)){if(_.isNumber(d)){q.x=d-j*q.width}if(_.isNumber(s)){q.y=s-m*q.height}var v=q.center();var u=v.x-t.width/2;var r=v.y-t.height/2;var f=c.get("position");c.translate(u-f.x,r-f.y);this.show({vertical:d,horizontal:s})}},show:function(b){b=b||{};var a=this.options.paper.viewport.getCTM();if(b.horizontal){this.$horizontal.css("top",b.horizontal*a.d+a.f).show()}else{this.$horizontal.hide()}if(b.vertical){this.$vertical.css("left",b.vertical*a.a+a.e).show()}else{this.$vertical.hide()}this.$el.show()},hide:function(){this.$el.hide()}});joint.ui.TextEditor=Backbone.View.extend({className:"text-editor",events:{"change textarea":"onDone","keyup textarea":"onInput"},initialize:function(a){_.bindAll(this,"onMousedown","onMousemove","onMouseup","onDoubleClick");this.options=_.extend({},_.result(this,"options"),a||{});var b=this.options.text;$(b).on("mousedown",this.onMousedown);$(b).on("mousemove",this.onMousemove);$(b).on("dblclick",this.onDoubleClick);$(document.body).on("mouseup",this.onMouseup)},render:function(a){this.$caret=$("<div>",{"class":"caret"});this.$selection=$("<div>");this.$selectionBox=$("<div>",{"class":"char-selection-box"});this.$el.append(this.$caret,this.$selection);this.$textareaContainer=$("<div>",{"class":"textarea-container"});this.textarea=$("<textarea>",{autocorrect:"off",autocomplete:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"})[0];this.textarea.value=this.getTextContent();this.$textareaContainer.append(this.textarea);this.$el.append(this.$textareaContainer);$(a||document.body).append(this.$el);var b=V(this.options.text).bbox();this.$textareaContainer.css({left:b.x,top:b.y});this.textarea.focus();V(this.options.text).attr("cursor","text");this.selectAll();return this},onInput:function(){var a=this.textarea.value;this.trigger("text:change",a);this.deselect();this.setCaret()},onMousedown:function(a){this._selectionStart=this.getCharNumFromEvent(a);this.deselect();this.setCaret(this._selectionStart);this.trigger("caret:change",this.textarea.selectionStart);a.preventDefault();a.stopPropagation()},onMousemove:function(a){if(typeof this._selectionStart!=="undefined"){this.hideCaret();this.deselect();var b=this.getCharNumFromEvent(a);if(this._selectionStart===b){this.setCaret(this._selectionStart);this.trigger("caret:change",this.textarea.selectionStart)}else{this.select(this._selectionStart,b);this.trigger("select:change",this.textarea.selectionStart,this.textarea.selectionEnd)}a.preventDefault();a.stopPropagation()}},onMouseup:function(a){if(typeof this._selectionStart!=="undefined"){this._selectionStart=undefined}},onDoubleClick:function(a){this.hideCaret();var b=this.getWordBoundary(this.getCharNumFromEvent(a));this.select(b[0],b[1]);this.trigger("select:change",this.textarea.selectionStart,this.textarea.selectionEnd);a.preventDefault();a.stopPropagation()},getTextContent:function(){var b=this.options.text;var a=V(b).find(".line");return a.length===0?b.textContent:_.reduce(a,function(f,j,h,c){var d=j.textContent;if(V(j).hasClass("empty-line")){d=""}return(h===c.length-1)?f+d:f+d+"\n"},"")},selectAll:function(){return this.select(0,this.getNumberOfChars())},select:function(h,k){if(h>k){var d=h;h=k;k=d}this.$selection.empty();var m=this.getFontSize();var l=this.getTextTransforms();var b=l.rotation;var j;for(var c=h;c<k;c++){var a=this.$selectionBox.clone();try{j=this.getCharBBox(c)}catch(f){this.trigger("select:out-of-range",h,k);break}a.css({left:j.x,top:j.y-m*l.scaleY,width:j.width,height:m*l.scaleY,"-webkit-transform":"rotate("+b+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+b+"deg)","-moz-transform-origin":"0% 100%"});this.$selection.append(a)}this.textarea.selectionStart=h;this.textarea.selectionEnd=k;if(j){this.$textareaContainer.css({left:j.x,top:j.y-m*l.scaleY})}this.textarea.focus();return this},deselect:function(){this.$selection.empty();return this},getWordBoundary:function(h){var d=this.textarea.value;var c=/\W/;var f=h;while(f){if(c.test(d[f])){f+=1;break}f-=1}var b=this.getNumberOfChars();var a=h;while(a<=b){if(c.test(d[a])){break}a+=1}return[f,a]},getCharBBox:function(p){if(this.isLineEnding(p)){var m=this.getCharBBox(p-1);m.x=m.x2;m.y=m.y2;m.width=this.options.newlineCharacterBBoxWidth||10;return m}var b=this.realToSvgCharNum(p);var l=this.options.text;var c=l.getStartPositionOfChar(b);var a=l.getEndPositionOfChar(b);var n=l.getExtentOfChar(b);c=this.localToScreenCoordinates(c);a=this.localToScreenCoordinates(a);var o=this.getTextTransforms();var j=c.x;var f=c.y;var k=n.width*o.scaleX;var d=n.height*o.scaleY;return{x:j,y:f,width:k,height:d,x2:a.x,y2:a.y}},realToSvgCharNum:function(c){var a=0;for(var b=0;b<=c;b++){if(this.isLineEnding(b)){a+=1}}return c-a},selectionStartToSvgCharNum:function(a){return a-this.nonEmptyLinesBefore(a)},isLineEnding:function(b){var a=this.textarea.value;if(a[b]==="\n"&&b>0&&a[b-1]!=="\n"){return true}return false},svgToRealCharNum:function(b){var d=this.textarea.value;var a=0;for(var c=0;c<=b+a;c++){if(this.isLineEnding(c)){a+=1}}return b+a},localToScreenCoordinates:function(b){b=V.createSVGPoint(b.x,b.y);var a=this.options.text.getCTM();return b.matrixTransform(a)},getNumberOfChars:function(){return this.getTextContent().length},getCharNumFromEvent:function(a){var d=this.options.text;var f=a.clientX;var c=a.clientY;var b=d.getCharNumAtPosition(V(d).toLocalPoint(f,c));if(b<0){return this.getNumberOfChars()}var h=this.getCharBBox(this.svgToRealCharNum(b));if(Math.abs(h.x-f)<Math.abs(h.x+h.width-f)){return this.svgToRealCharNum(b)}return this.svgToRealCharNum(b)+1},lineNumber:function(b){var c=this.textarea.value;var d=0;for(var a=0;a<b;a++){if(c[a]==="\n"){d+=1}}return d},emptyLinesBefore:function(d){var b=this.textarea.value.split("\n");var a=this.lineNumber(d);var f=0;for(var c=a-1;c>=0;c--){if(!b[c]){f+=1}}return f},nonEmptyLinesBefore:function(a){return this.lineNumber(a)-this.emptyLinesBefore(a)},isEmptyLine:function(a){var b=this.textarea.value.split("\n");return !b[a]},isEmptyLineUnderSelection:function(b){var a=this.lineNumber(b);return this.isEmptyLine(a)},getTextTransforms:function(){var a=this.options.text.getCTM();return V.decomposeMatrix(a)},getFontSize:function(){return parseInt(V(this.options.text).attr("font-size"),10)},setCaret:function(n){var h=this.options.text;var j=this.getNumberOfChars();var f=this.textarea.selectionStart;var k=this.textarea.value;if(typeof n!=="undefined"){f=this.textarea.selectionStart=this.textarea.selectionEnd=n}var d;try{if(!this.isEmptyLineUnderSelection(f)&&(this.isLineEnding(f)||k.length===f)){d=h.getEndPositionOfChar(this.selectionStartToSvgCharNum(f)-1)}else{d=h.getStartPositionOfChar(this.selectionStartToSvgCharNum(f))}}catch(c){this.trigger("caret:out-of-range",f);this.$caret.hide();return this}var a=this.localToScreenCoordinates(d);var m=this.getFontSize();var l=this.getTextTransforms();var b=l.rotation;this.$caret.css({left:a.x,top:a.y+(j?-m*l.scaleY:0),height:m*l.scaleY,"-webkit-transform":"rotate("+b+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+b+"deg)","-moz-transform-origin":"0% 100%"}).show();this.$textareaContainer.css({left:a.x,top:a.y+(j?-m*l.scaleY:0)});this.textarea.focus();return this},hideCaret:function(){this.$caret.hide();return this},remove:function(){var a=this.options.text;$(a).off("mousedown",this.onMousedown);$(a).off("mousemove",this.onMousemove);$(a).off("dblclick",this.onDoubleClick);$(document.body).off("mouseup",this.onMouseup);V(this.options.text).attr("cursor","");Backbone.View.prototype.remove.apply(this,arguments)},onDone:function(){this.$el.remove()}},{getTextElement:function(b){var a=b.tagName.toUpperCase();if(a==="TEXT"||a==="TSPAN"||a==="TEXTPATH"){if(a==="TEXT"){return b}return this.getTextElement(b.parentNode)}return undefined}});joint.ui.Dialog=Backbone.View.extend({className:"dialog",events:{"click .bg":"action","click .btn-close":"action","click .controls button":"action","mousedown .titlebar":"onDragStart","touchstart .titlebar":"onDragStart"},options:{draggable:false,closeButtonContent:"&times;",closeButton:true,inlined:false,modal:true},initialize:function(a){_.bindAll(this,"onDrag","onDragEnd");this.options=_.extend({},_.result(this,"options"),a||{})},render:function(){var d=$("<div/>",{"class":"bg","data-action":"close"});var b=$("<div/>",{"class":"fg"});var c=$("<div/>",{"class":"titlebar"});var f=$("<div/>",{"class":"body"});var h=$("<button/>",{"class":"btn-close","data-action":"close",html:this.options.closeButtonContent});var a=$("<div/>",{"class":"controls"});this.$el.toggleClass("draggable",!!this.options.draggable);if(this.options.type){this.$el.attr("data-type",this.options.type)}if(this.options.inlined){this.$el.addClass("inlined")}if(this.options.modal){this.$el.addClass("modal")}if(this.options.width){b.width(this.options.width)}if(this.options.title){c.append(this.options.title)}else{c.addClass("empty")}if(this.options.content){f.append(this.options.content)}if(this.options.buttons){_.each(this.options.buttons.reverse(),function(j){var k=$("<button/>",{"class":"control-button",html:j.content,"data-action":j.action});if(j.position){k.addClass(j.position)}a.append(k)})}b.append(c,f,a);if(this.options.closeButton){b.append(h)}this.$el.empty().append(d,b);return this},open:function(a){this.delegateEvents();this.on("action:close",this.close,this);$(document.body).on({"mousemove.dialog touchmove.dialog":this.onDrag,"mouseup.dialog touchend.dialog":this.onDragEnd});$(a||document.body).append(this.render().el);return this},close:function(){this.remove();return this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments);$(document.body).off(".dialog",this.onDrag).off(".dialog",this.onDragStart)},action:function(a){var c=$(a.target).closest("[data-action]");var b=c.attr("data-action");if(b){this.trigger("action:"+b)}},onDragStart:function(a){if(this.options.draggable){a=joint.util.normalizeEvent(a);this._dx=a.clientX;this._dy=a.clientY;this._dragging=true}},onDrag:function(b){if(this._dragging){b=joint.util.normalizeEvent(b);var a=this.$(".fg");var c=a.offset();a.css({top:c.top+(b.clientY-this._dy),left:c.left+(b.clientX-this._dx),margin:0});this._dx=b.clientX;this._dy=b.clientY}},onDragEnd:function(){this._dragging=false}});joint.ui.Navigator=Backbone.View.extend({className:"navigator",events:{"mousedown .paper":"scrollTo","touchstart .paper":"scrollTo",mousedown:"startAction",touchstart:"startAction"},options:{paperConstructor:joint.dia.Paper,paperOptions:{},zoomOptions:{min:0.1,max:10},width:300,height:200,padding:10},initialize:function(b){this.options=_.extend({},_.result(this,"options"),b||{});_.bindAll(this,"updateCurrentView","doAction","stopAction");this.updateCurrentView=_.debounce(this.updateCurrentView,0);var a=this.options.paperScroller;a.$el.on("scroll.navigator",this.updateCurrentView);var c=this.sourcePaper=a.options.paper;this.listenTo(c,"resize",this.updatePaper);var d=this.targetPaper=new this.options.paperConstructor(_.extend({model:c.model,interactive:false},this.options.paperOptions));$(document.body).on({"mousemove.navigator touchmove.navigator":this.doAction,"mouseup.navigator touchend.navigator":this.stopAction})},render:function(){this.targetPaper.$el.appendTo(this.el);this.sourcePaper.model.get("cells").each(this.targetPaper.addCell,this.targetPaper);this.$currentViewControl=$("<div>").addClass("current-view-control");this.$currentView=$("<div>").addClass("current-view").append(this.$currentViewControl);this.$el.append(this.$currentView).css({width:this.options.width,height:this.options.height,padding:this.options.padding});this.updatePaper(this.sourcePaper.options.width,this.sourcePaper.options.height);return this},updatePaper:function(c,l){var b=this.sourcePaper.options.origin;var f=V(this.sourcePaper.viewport).scale();var k=this.options.width-2*this.options.padding;var h=this.options.height-2*this.options.padding;c/=f.sx;l/=f.sy;var j=this.ratio=Math.min(k/c,h/l);var d=b.x*j/f.sx;var a=b.y*j/f.sy;c*=j;l*=j;this.targetPaper.setDimensions(c,l);this.targetPaper.setOrigin(d,a);this.targetPaper.scale(j,j);this.updateCurrentView()},updateCurrentView:function(){var d=this.ratio;var h=V(this.sourcePaper.viewport).scale();var c=this.options.paperScroller;var f=c.toLocalPoint(0,0);var b=this.targetPaper.$el.position();var a=V(this.targetPaper.viewport).translate();a.ty=a.ty||0;this.currentViewGeometry={top:b.top+f.y*d+a.ty,left:b.left+f.x*d+a.tx,width:c.$el.innerWidth()*d/h.sx,height:c.$el.innerHeight()*d/h.sy};this.$currentView.css(this.currentViewGeometry)},startAction:function(a){a=joint.util.normalizeEvent(a);this._action=$(a.target).hasClass("current-view-control")?"zooming":"panning";this._clientX=a.clientX;this._clientY=a.clientY},doAction:function(b){if(!this._action){return}b=joint.util.normalizeEvent(b);var f=V(this.sourcePaper.viewport).scale();var c=(b.clientX-this._clientX)*f.sx;var a=(b.clientY-this._clientY)*f.sy;switch(this._action){case"panning":this.options.paperScroller.el.scrollLeft+=c/this.ratio;this.options.paperScroller.el.scrollTop+=a/this.ratio;break;case"zooming":var d=-c/this.currentViewGeometry.width;this.options.paperScroller.zoom(d,this.options.zoomOptions);break}this._clientX=b.clientX;this._clientY=b.clientY},stopAction:function(){delete this._action},scrollTo:function(d){d=joint.util.normalizeEvent(d);var c=V(this.targetPaper.viewport).translate();c.ty=c.ty||0;var b,j;if(_.isUndefined(d.offsetX)){var f=this.targetPaper.$el.offset();b=d.pageX-f.left;j=d.pageY-f.top}else{b=d.offsetX;j=d.offsetY}var a=(b-c.tx)/this.ratio;var h=(j-c.ty)/this.ratio;this.options.paperScroller.center(a,h)},remove:function(){this.targetPaper.remove();this.options.paperScroller.$el.off(".navigator");$(document.body).off(".navigator");Backbone.View.prototype.remove.apply(this,arguments)}});joint.ui.TreeLayoutView=Backbone.View.extend({className:"tree-layout",options:{maxConnectionDistance:200,maxCalloutDistance:100,minCalloutDistance:1,mainRootReachDistance:100,xCoordinateOffset:20,previewAttrs:{child:{rx:"50%",ry:"50%"},parent:{rx:2,ry:2}},useModelGeometry:false},initialize:function(a){a=this.options=_.extend({},_.result(this,"options"),a||{});this.toggleDefaultInteraction(false);this.startListening();this.render()},render:function(){var a=this.options.paper;this.$activeBox=$("<div>").addClass("tree-layout-box active").hide().appendTo(this.el);this.$translateBox=$("<div>").addClass("tree-layout-box translate").hide().appendTo(this.el);this.svgViewport=V(a.viewport);this.svgPreviewChild=V("rect").attr(this.options.previewAttrs.child||{}).addClass("tree-layout-preview child");this.svgPreviewLink=V("path").attr(this.options.previewAttrs.link||{}).addClass("tree-layout-preview link");this.svgPreviewParent=V("rect").attr(this.options.previewAttrs.parent||{}).addClass("tree-layout-preview parent");this.svgCalloutLine=V("line").addClass("tree-layout-callout-line");this.svgPreview=V("g").addClass("tree-layout-preview-group").append([this.svgPreviewLink,this.svgPreviewParent,this.svgPreviewChild]);this.$el.appendTo(a.el);return this},remove:function(){this.svgCalloutLine.remove();this.svgPreview.remove();return Backbone.View.prototype.remove.apply(this,arguments)},startListening:function(){var a=this.options.paper;this.listenTo(a,"cell:pointerdown",this.onPointerdown);this.listenTo(a,"cell:pointermove",this.onPointermove);this.listenTo(a,"cell:pointerup",this.onPointerup)},toggleDefaultInteraction:function(a){var b=this.options.paper;b.options.interactive=a;_.chain(b.model.getElements()).map(b.findViewByModel,b).each(function(c){c&&(c.options.interactive=a)})},showChildPreview:function(h,d,b,c){var a=this.getChildPosition(d.id,b,c);var f=this.model.get("verticalGap")/2;this.svgPreviewChild.attr({x:a.x-(c==this.model.RANK_LEFT?9:0),y:a.y,width:f,height:f});this.svgPreviewParent.attr(d.getBBox());this.svgPreviewLink.attr("d",this.getChildPathData(d.id,a,c));this.svgViewport.append(this.svgPreview)},hideChildPreview:function(){this.svgPreview.remove()},showCalloutLine:function(c,a,f){var b=this.model.getGeometry(c);var d=this.model.getGeometry(this.model.getCallerOf(c));this.svgViewport.append(this.svgCalloutLine.attr({x1:a+b.width/2,y1:f+b.height/2,x2:d.cx,y2:d.cy}))},hideCalloutLine:function(){this.svgCalloutLine.remove()},getChildPosition:function(f,k,d){var o,n;var a=this.model.getChildrenOf(f,{rankDir:d});var h=this.model.get("verticalGap");var p=this.model.get("horizontalGap");if(!_.isEmpty(a)){var j=a[k];if(j){var c=this.model.getGeometry(j);o=c.x;n=c.y-h/4-h/2;if(d==this.model.RANK_LEFT){o+=c.width}}else{var m=this.model.getGeometry(a[k-1]);o=m.x;n=m.y+m.height+h/4;if(d==this.model.RANK_LEFT){o+=m.width}}}else{var b=this.model.getLayoutArea(f);var l;switch(d){case this.model.RANK_LEFT:l=-p;break;case this.model.RANK_RIGHT:l=b.width+p;break}o=b.x+l;n=b.y+(b.height-b.bottomPadding+b.topPadding)/2-h/4}return{x:o,y:n}},getChildPathData:function(j,f,h){var b=this.model.getGeometry(j);var d=b.x+(h==this.model.RANK_LEFT?0:b.width);var l=b.cy;var c=f.x;var k=f.y+this.model.get("verticalGap")/4;var a=d+(c-d)/2;return"M "+[d,l,a,l,a,k,c,k].join(" ")},isConnectionValid:function(h,c,a,b){if(c==h){return false}if(this.model.isDescendantOf(h,c)){return false}var f=this.model.getElement(c);if(f.parentId==h&&f.rankDir==b){var d=f.siblingRank-a;if(d===0||d===1){return false}}return true},isPointInExtendedArea:function(a,b,c){return g.rect(a).moveAndExpand(g.rect(-c,-c,2*c,2*c)).containsPoint(b)},transformCoordinates:function(c,a,b){c.x=(c.x>a)?Math.max(c.x-this.options.xCoordinateOffset,a+1):Math.min(c.x+this.options.xCoordinateOffset,a-1)},reconnectCell:function(a,d,b,c){a.set("siblingRank",b+0.5);_.each(this.model.getDescendantsOf(a.id,{includeCallouts:true}).concat(a.id),function(f){this.model.graph.getCell(f).set("rankDir",c)},this);this.model.connect(a.id,d.id,{ui:true,link:this.getDefaultLinkByCell(d)})},getDefaultLinkByCell:function(a){var b=a.findView(this.options.paper);return this.options.paper.getDefaultLink(b,b.el)},translateCell:function(b,a,c){b.position(a,c);if(this.model.getElement(b.id).parentLinkId){this.model.disconnect(b.id,{ui:true})}else{this.model.layout({ui:true,rootId:b.id})}},translateCallout:function(o,q,p){function f(t,s,r){return t>0?Math.max(s,Math.min(t,r)):Math.min(-s,Math.max(t,-r))}var d=this.model.getElement(o.id);var b=this.model.getLayoutArea(this.model.getCallerOf(d.id));var l=(b.height-b.topPadding-b.bottomPadding)/2+d.layoutArea.height/2;var j=d.cdy+p;if(d.cdy>0){j<0&&(j=-j<l?1:Math.min(-1,j+l+d.geometry.height))}else{j>0&&(j=j<l?-1:Math.max(1,j-l-d.geometry.height))}var m=this.options.maxCalloutDistance;var c=this.options.minCalloutDistance;var n=_.isNumber(m)?m:m.x||0;var h=_.isNumber(c)?c:c.x||0;var k=_.isNumber(m)?m:m.y||1;var a=_.isNumber(c)?c||1:c.y||1;o.set({calloutDx:Math.min(Math.max(h,d.cdx+q),n),calloutDy:f(j,a,k)});this.model.prepare().layout({ui:true,changedCalloutId:o.id})},getDeltaCoordinations:function(b,a,f,d,c){return{dx:c==this.model.RANK_RIGHT?b-a:a-b,dy:f-d}},onPointerdown:function(d,c,b,h){if(d.model.isLink()){return}var f=d.getBBox({useModelGeometry:this.options.useModelGeometry});this._x=b;this._y=h;this.ctm=this.options.paper.viewport.getCTM();var a=d.model.position();this._targetDx=b-a.x;this._targetDy=h-a.y;this.$activeBox.css({width:f.width,height:f.height,left:f.x,top:f.y}).show();this.$translateBox.css({width:f.width,height:f.height});this.rootId=this.model.getRootOf(d.model.id);this.mainRoot=this.model.mainRootId?this.model.getElement(this.model.mainRootId):null;this.isCallout=!!this.model.getCallerOf(d.model.id)},onPointermove:function(o,p,l,k){if(o.model.isLink()){return}var q=o.model;if(this.isCallout){var h=l-this._targetDx;var d=k-this._targetDy;this.$translateBox.css({left:h*this.ctm.a+this.ctm.e,top:d*this.ctm.d+this.ctm.f}).show();this.showCalloutLine(q.id,h,d);return}var n=g.point(l,k);if(this.options.xCoordinateOffset&&this.mainRoot){this.transformCoordinates(n,this.mainRoot.geometry.cx,this.options.xCoordinateOffset)}var b=this.model.getMinimalRootByPoint(n,{includeCallouts:true});if(!b&&this.mainRoot&&this.isPointInExtendedArea(this.mainRoot.geometry,n,this.options.mainRootReachDistance)){b=this.mainRoot.id}if(b){var c=this.model.getLayoutAreaByPoint(b,n)||this.mainRoot.layoutArea;var j=this.model.getGeometry(c.rootId);var m=j.cx-n.x;var f=this.rankDir=(c.rankDir==this.model.RANK_CENTER)?m<0?this.model.RANK_RIGHT:this.model.RANK_LEFT:c.rankDir;var a=this.model.getSiblingRankByPoint(c.rootId,n,{rankDir:f})}if(this.candidateView){this.candidateView=null;this.hideChildPreview()}if(b&&Math.abs(m)<this.options.maxConnectionDistance){this.$translateBox.hide();if(this.isConnectionValid(c.rootId,q.id,a,f)){this.candidateSiblingIndex=a;this.candidateView=this.options.paper.findViewByModel(c.rootId);this.showChildPreview(q,this.candidateView.model,a,f)}}else{this.$translateBox.css({left:l*this.ctm.a+this.ctm.e,top:k*this.ctm.d+this.ctm.f}).show()}},onPointerup:function(f,b,a,h){if(f.model.isLink()){return}if(this.candidateView){this.reconnectCell(f.model,this.candidateView.model,this.candidateSiblingIndex,this.rankDir);this.candidateView=null}if(this.$translateBox.is(":visible")){if(this.isCallout){var d=this.model.getElement(f.model.id).rankDir;var c=this.getDeltaCoordinations(a,this._x,h,this._y,d);this.translateCallout(f.model,c.dx,c.dy);this.hideCalloutLine()}else{this.translateCell(f.model,a,h)}}this.$activeBox.hide();this.$translateBox.hide();this.hideChildPreview()}});(function e(b,h,d){function c(m,k){if(!h[m]){if(!b[m]){var j=typeof require=="function"&&require;if(!k&&j){return j(m,!0)}if(a){return a(m,!0)}throw new Error("Cannot find module '"+m+"'")}var l=h[m]={exports:{}};b[m][0].call(l.exports,function(o){var p=b[m][1][o];return c(p?p:o)},l,l.exports,e,b,h,d)}return h[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,c,a){var d=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};d.dagre=b("./index")},{"./index":2}],2:[function(b,c,a){a.Digraph=b("graphlib").Digraph;a.Graph=b("graphlib").Graph;a.layout=b("./lib/layout");a.version=b("./lib/version")},{"./lib/layout":3,"./lib/version":18,graphlib:24}],3:[function(f,j,d){var c=f("./util"),k=f("./rank"),a=f("./order"),b=f("graphlib").CGraph,h=f("graphlib").CDigraph;j.exports=function(){var n={debugLevel:0,orderMaxSweeps:a.DEFAULT_MAX_SWEEPS,rankSimplex:false,rankDir:"TB"};var s=f("./position")();var t={};t.orderIters=c.propertyAccessor(t,n,"orderMaxSweeps");t.rankSimplex=c.propertyAccessor(t,n,"rankSimplex");t.nodeSep=l(s.nodeSep);t.edgeSep=l(s.edgeSep);t.universalSep=l(s.universalSep);t.rankSep=l(s.rankSep);t.rankDir=c.propertyAccessor(t,n,"rankDir");t.debugAlignment=l(s.debugAlignment);t.debugLevel=c.propertyAccessor(t,n,"debugLevel",function(v){c.log.level=v;s.debugLevel(v)});t.run=c.time("Total layout",p);t._normalize=r;return t;function m(w){var x=new h();w.eachNode(function(y,z){if(z===undefined){z={}}x.addNode(y,{width:z.width,height:z.height});if(z.hasOwnProperty("rank")){x.node(y).prefRank=z.rank}});if(w.parent){w.nodes().forEach(function(y){x.parent(y,w.parent(y))})}w.eachEdge(function(C,z,y,A){if(A===undefined){A={}}var B={e:C,minLen:A.minLen||1,width:A.width||0,height:A.height||0,points:[]};x.addEdge(null,z,y,B)});var v=w.graph()||{};x.graph({rankDir:v.rankDir||n.rankDir,orderRestarts:v.orderRestarts});return x}function p(v){var w=t.rankSep();var x;try{x=c.time("initLayoutGraph",m)(v);if(x.order()===0){return x}x.eachEdge(function(B,A,z,y){y.minLen*=2});t.rankSep(w/2);c.time("rank.run",k.run)(x,n.rankSimplex);c.time("normalize",r)(x);c.time("order",a)(x,n.orderMaxSweeps);c.time("position",s.run)(x);c.time("undoNormalize",u)(x);c.time("fixupEdgePoints",q)(x);c.time("rank.restoreEdges",k.restoreEdges)(x);return c.time("createFinalGraph",o)(x,v.isDirected())}finally{t.rankSep(w)}}function r(v){var w=0;v.eachEdge(function(B,H,G,C){var A=v.node(H).rank;var D=v.node(G).rank;if(A+1<D){for(var F=H,z=A+1,y=0;z<D;++z,++y){var E="_D"+(++w);var x={width:C.width,height:C.height,edge:{id:B,source:H,target:G,attrs:C},rank:z,dummy:true};if(y===0){x.index=0}else{if(z+1===D){x.index=1}}v.addNode(E,x);v.addEdge(null,F,E,{});F=E}v.addEdge(null,F,G,{});v.delEdge(B)}})}function u(v){v.eachNode(function(x,w){if(w.dummy){if("index" in w){var z=w.edge;if(!v.hasEdge(z.id)){v.addEdge(z.id,z.source,z.target,z.attrs)}var y=v.edge(z.id).points;y[w.index]={x:w.x,y:w.y,ul:w.ul,ur:w.ur,dl:w.dl,dr:w.dr}}v.delNode(x)}})}function q(v){v.eachEdge(function(z,y,x,w){if(w.reversed){w.points.reverse()}})}function o(x,v){var w=v?new h():new b();w.graph(x.graph());x.eachNode(function(A,B){w.addNode(A,B)});x.eachNode(function(A){w.parent(A,x.parent(A))});x.eachEdge(function(D,B,A,C){w.addEdge(C.e,B,A,C)});var z=0,y=0;x.eachNode(function(A,B){if(!x.children(A).length){z=Math.max(z,B.x+B.width/2);y=Math.max(y,B.y+B.height/2)}});x.eachEdge(function(E,C,B,D){var F=Math.max.apply(Math,D.points.map(function(G){return G.x}));var A=Math.max.apply(Math,D.points.map(function(G){return G.y}));z=Math.max(z,F+D.width/2);y=Math.max(y,A+D.height/2)});w.graph().width=z;w.graph().height=y;return w}function l(v){return function(){if(!arguments.length){return v()}v.apply(null,arguments);return t}}}},{"./order":4,"./position":9,"./rank":10,"./util":17,graphlib:24}],4:[function(f,c,j){var m=f("./util"),a=f("./order/crossCount"),q=f("./order/initLayerGraphs"),b=f("./order/initOrder"),l=f("./order/sortLayer");c.exports=d;var o=24;d.DEFAULT_MAX_SWEEPS=o;function d(z,y){if(arguments.length<2){y=o}var A=z.graph().orderRestarts||0;var u=q(z);u.forEach(function(F){F=F.filterNodes(function(G){return !z.children(G).length})});var E=0,B,C=Number.MAX_VALUE,s={};function D(){z.eachNode(function(F,G){s[F]=G.order})}for(var w=0;w<Number(A)+1&&C!==0;++w){B=Number.MAX_VALUE;b(z,A>0);m.log(2,"Order phase start cross count: "+z.graph().orderInitCC);var x,t,v;for(x=0,t=0;t<4&&x<y&&B>0;++x,++t,++E){r(z,u,x);v=a(z);if(v<B){t=0;B=v;if(v<C){D();C=v}}m.log(3,"Order phase start "+w+" iter "+x+" cross count: "+v)}}Object.keys(s).forEach(function(F){if(!z.children||!z.children(F).length){z.node(F).order=s[F]}});z.graph().orderCC=C;m.log(2,"Order iterations: "+E);m.log(2,"Order phase best cross count: "+z.graph().orderCC)}function k(u,s){var t={};s.forEach(function(v){t[v]=u.inEdges(v).map(function(w){return u.node(u.source(w)).order})});return t}function h(u,s){var t={};s.forEach(function(v){t[v]=u.outEdges(v).map(function(w){return u.node(u.target(w)).order})});return t}function r(u,t,s){if(s%2===0){n(u,t,s)}else{p(u,t,s)}}function n(u,s){var t;for(i=1;i<s.length;++i){t=l(s[i],t,k(u,s[i].nodes()))}}function p(u,s){var t;for(i=s.length-2;i>=0;--i){l(s[i],t,h(u,s[i].nodes()))}}},{"./order/crossCount":5,"./order/initLayerGraphs":6,"./order/initOrder":7,"./order/sortLayer":8,"./util":17}],5:[function(c,f,b){var a=c("../util");f.exports=h;function h(k){var m=0;var l=a.ordering(k);for(var j=1;j<l.length;++j){m+=d(k,l[j-1],l[j])}return m}function d(o,m,l){var q=[];m.forEach(function(s){var t=[];o.outEdges(s).forEach(function(u){t.push(o.node(o.target(u)).order)});t.sort(function(u,v){return u-v});q=q.concat(t)});var j=1;while(j<l.length){j<<=1}var p=2*j-1;j-=1;var r=[];for(var n=0;n<p;++n){r[n]=0}var k=0;q.forEach(function(s){var t=s+j;++r[t];while(t>0){if(t%2){k+=r[t+1]}t=(t-1)>>1;++r[t]}});return k}},{"../util":17}],6:[function(d,f,b){var c=d("graphlib").filter.nodesFromList,h=d("cp-data").Set;f.exports=a;function a(k){var m=[];function l(n){if(n===null){k.children(n).forEach(function(q){l(q)});return}var o=k.node(n);o.minRank=("rank" in o)?o.rank:Number.MAX_VALUE;o.maxRank=("rank" in o)?o.rank:Number.MIN_VALUE;var p=new h();k.children(n).forEach(function(r){var q=l(r);p=h.union([p,q]);o.minRank=Math.min(o.minRank,k.node(r).minRank);o.maxRank=Math.max(o.maxRank,k.node(r).maxRank)});if("rank" in o){p.add(o.rank)}p.keys().forEach(function(q){if(!(q in m)){m[q]=[]}m[q].push(n)});return p}l(null);var j=[];m.forEach(function(n,o){j[o]=k.filterNodes(c(n))});return j}},{"cp-data":19,graphlib:24}],7:[function(c,d,b){var h=c("./crossCount"),a=c("../util");d.exports=f;function f(k,j){var l=[];k.eachNode(function(n,p){var o=l[p.rank];if(k.children&&k.children(n).length>0){return}if(!o){o=l[p.rank]=[]}o.push(n)});l.forEach(function(n){if(j){a.shuffle(n)}n.forEach(function(o,p){k.node(o).order=p})});var m=h(k);k.graph().orderInitCC=m;k.graph().orderCC=Number.MAX_VALUE}},{"../util":17,"./crossCount":5}],8:[function(c,d,b){var a=c("../util");d.exports=f;function f(o,h,q){var k=[];var r={};o.eachNode(function(s,t){k[t.order]=s;var j=q[s];if(j.length){r[s]=a.sum(j)/j.length}});var p=o.nodes().filter(function(j){return r[j]!==undefined});p.sort(function(j,s){return r[j]-r[s]||o.node(j).order-o.node(s).order});for(var n=0,l=0,m=p.length;l<m;++n){if(r[k[n]]!==undefined){o.node(p[l++]).order=n}}}},{"../util":17}],9:[function(c,d,b){var a=c("./util");d.exports=function(){var z={nodeSep:50,edgeSep:10,universalSep:null,rankSep:30};var q={};q.nodeSep=a.propertyAccessor(q,z,"nodeSep");q.edgeSep=a.propertyAccessor(q,z,"edgeSep");q.universalSep=a.propertyAccessor(q,z,"universalSep");q.rankSep=a.propertyAccessor(q,z,"rankSep");q.debugLevel=a.propertyAccessor(q,z,"debugLevel");q.run=p;return q;function p(C){C=C.filterNodes(a.filterNonSubgraphs(C));var F=a.ordering(C);var B=x(C,F);var D={};["u","d"].forEach(function(I){if(I==="d"){F.reverse()}["l","r"].forEach(function(K){if(K==="r"){y(F)}var J=I+K;var L=h(C,F,B,I==="u"?"predecessors":"successors");D[J]=s(C,F,L.pos,L.root,L.align);if(z.debugLevel>=3){o(I+K,C,F,D[J])}if(K==="r"){w(D[J])}if(K==="r"){y(F)}});if(I==="d"){F.reverse()}});f(C,F,D);C.eachNode(function(I){var J=[];for(var L in D){var K=D[L][I];l(L,C,I,K);J.push(K)}J.sort(function(M,N){return M-N});k(C,I,(J[1]+J[2])/2)});var H=0,E=C.graph().rankDir==="BT"||C.graph().rankDir==="RL";F.forEach(function(I){var J=a.max(I.map(function(K){return r(C,K)}));H+=J/2;I.forEach(function(K){j(C,K,E?-H:H)});H+=J/2+z.rankSep});var A=a.min(C.nodes().map(function(I){return k(C,I)-u(C,I)/2}));var G=a.min(C.nodes().map(function(I){return j(C,I)-r(C,I)/2}));C.eachNode(function(I){k(C,I,k(C,I)-A);j(C,I,j(C,I)-G)})}function n(B,A){return B<A?B.toString().length+":"+B+"-"+A:A.toString().length+":"+A+"-"+B}function x(H,M){var A={},K={},C,N,J,F,I;if(M.length<=2){return A}function E(P){var O=K[P];if(O<J||O>I){A[n(N[F],P)]=true}}M[1].forEach(function(O,P){K[O]=P});for(var G=1;G<M.length-1;++G){C=M[G];N=M[G+1];J=0;F=0;for(var D=0;D<N.length;++D){var L=N[D];K[L]=D;I=undefined;if(H.node(L).dummy){var B=H.predecessors(L)[0];if(B!==undefined&&H.node(B).dummy){I=K[B]}}if(I===undefined&&D===N.length-1){I=C.length-1}if(I!==undefined){for(;F<=D;++F){H.predecessors(N[F]).forEach(E)}J=I}}}return A}function h(C,D,A,G){var F={},B={},E={};D.forEach(function(H){H.forEach(function(I,J){B[I]=I;E[I]=I;F[I]=J})});D.forEach(function(I){var H=-1;I.forEach(function(J){var L=C[G](J),K;if(L.length>0){L.sort(function(M,N){return F[M]-F[N]});K=(L.length-1)/2;L.slice(Math.floor(K),Math.ceil(K)+1).forEach(function(M){if(E[J]===J){if(!A[n(M,J)]&&H<F[M]){E[M]=J;E[J]=B[J]=B[M];H=F[M]}}})}})});return{pos:F,root:B,align:E}}function s(G,L,I,J,H){var K={},D={},E={},C={},F={};L.forEach(function(M){M.forEach(function(N,O){K[N]=N;D[N]={};if(O>0){C[N]=M[O-1]}})});function B(M,N,O){if(!(N in D[M])){D[M][N]=O}else{D[M][N]=Math.min(D[M][N],O)}}function A(N){if(!(N in F)){F[N]=0;var M=N;do{if(I[M]>0){var O=J[C[M]];A(O);if(K[N]===N){K[N]=K[O]}var P=t(G,C[M])+t(G,M);if(K[N]!==K[O]){B(K[O],K[N],F[N]-F[O]-P)}else{F[N]=Math.max(F[N],F[O]+P)}}M=H[M]}while(M!==N)}}a.values(J).forEach(function(M){A(M)});L.forEach(function(M){M.forEach(function(O){F[O]=F[J[O]];if(O===J[O]&&O===K[O]){var N=0;if(O in D&&Object.keys(D[O]).length>0){N=a.min(Object.keys(D[O]).map(function(P){return D[O][P]+(P in E?E[P]:0)}))}E[O]=N}})});L.forEach(function(M){M.forEach(function(N){F[N]+=E[K[J[N]]]||0})});return F}function m(B,C,A){return a.min(C.map(function(E){var D=E[0];return A[D]}))}function v(B,C,A){return a.max(C.map(function(E){var D=E[E.length-1];return A[D]}))}function f(F,L,A){var D={},I={},G,B={};function J(M){A[H][M]+=B[H]}var E=Number.POSITIVE_INFINITY;for(var H in A){var C=A[H];D[H]=m(F,L,C);I[H]=v(F,L,C);var K=I[H]-D[H];if(K<E){E=K;G=H}}["u","d"].forEach(function(M){["l","r"].forEach(function(N){var O=M+N;B[O]=N==="l"?D[G]-D[O]:I[G]-I[O]})});for(H in A){F.eachNode(J)}}function w(B){for(var A in B){B[A]=-B[A]}}function y(A){A.forEach(function(B){B.reverse()})}function u(B,A){switch(B.graph().rankDir){case"LR":return B.node(A).height;case"RL":return B.node(A).height;default:return B.node(A).width}}function r(B,A){switch(B.graph().rankDir){case"LR":return B.node(A).width;case"RL":return B.node(A).width;default:return B.node(A).height}}function t(D,B){if(z.universalSep!==null){return z.universalSep}var A=u(D,B);var C=D.node(B).dummy?z.edgeSep:z.nodeSep;return(A+C)/2}function k(C,B,A){if(C.graph().rankDir==="LR"||C.graph().rankDir==="RL"){if(arguments.length<3){return C.node(B).y}else{C.node(B).y=A}}else{if(arguments.length<3){return C.node(B).x}else{C.node(B).x=A}}}function l(C,D,B,A){if(D.graph().rankDir==="LR"||D.graph().rankDir==="RL"){if(arguments.length<3){return D.node(B)[C]}else{D.node(B)[C]=A}}else{if(arguments.length<3){return D.node(B)[C]}else{D.node(B)[C]=A}}}function j(B,A,C){if(B.graph().rankDir==="LR"||B.graph().rankDir==="RL"){if(arguments.length<3){return B.node(A).x}else{B.node(A).x=C}}else{if(arguments.length<3){return B.node(A).y}else{B.node(A).y=C}}}function o(D,B,C,A){C.forEach(function(G,F){var H,E;G.forEach(function(I){var K=A[I];if(H){var J=t(B,H)+t(B,I);if(K-E<J){console.log("Position phase: sep violation. Align: "+D+". Layer: "+F+". U: "+H+" V: "+I+". Actual sep: "+(K-E)+" Expected sep: "+J)}}H=I;E=K})})}}},{"./util":17}],10:[function(d,c,v){var b=d("./util"),o=d("./rank/acyclic"),s=d("./rank/initRank"),f=d("./rank/feasibleTree"),r=d("./rank/constraints"),h=d("./rank/simplex"),l=d("graphlib").alg.components,k=d("graphlib").filter;v.run=m;v.restoreEdges=p;function m(x,w){n(x);b.time("constraints.apply",r.apply)(x);j(x);b.time("acyclic",o)(x);var y=x.filterNodes(b.filterNonSubgraphs(x));s(y);l(y).forEach(function(A){var z=y.filterNodes(k.nodesFromList(A));t(z,w)});b.time("constraints.relax",r.relax(x));b.time("reorientEdges",a)(x)}function p(w){o.undo(w)}function n(w){w.eachEdge(function(E,D,C,B){if(D===C){var A=u(w,E,D,C,B,0,false),G=u(w,E,D,C,B,1,true),F=u(w,E,D,C,B,2,false);w.addEdge(null,A,D,{minLen:1,selfLoop:true});w.addEdge(null,A,G,{minLen:1,selfLoop:true});w.addEdge(null,D,F,{minLen:1,selfLoop:true});w.addEdge(null,G,F,{minLen:1,selfLoop:true});w.delEdge(E)}})}function j(w){w.eachEdge(function(C,z,y,x){if(z===y){var A=x.originalEdge,B=u(w,A.e,A.u,A.v,A.value,0,true);w.addEdge(null,z,B,{minLen:1});w.addEdge(null,B,y,{minLen:1});w.delEdge(C)}})}function u(B,C,z,x,w,y,A){return B.addNode(null,{width:A?w.width:0,height:A?w.height:0,edge:{id:C,source:z,target:x,attrs:w},dummy:true,index:y})}function a(w){w.eachEdge(function(A,y,x,z){if(w.node(y).rank>w.node(x).rank){w.delEdge(A);z.reversed=true;w.addEdge(A,x,y,z)}})}function t(x,w){var y=f(x);if(w){b.log(1,"Using network simplex for ranking");h(x,y)}q(x)}function q(x){var w=b.min(x.nodes().map(function(y){return x.node(y).rank}));x.eachNode(function(y,z){z.rank-=w})}},{"./rank/acyclic":11,"./rank/constraints":12,"./rank/feasibleTree":13,"./rank/initRank":14,"./rank/simplex":16,"./util":17,graphlib:24}],11:[function(d,f,c){var b=d("../util");f.exports=h;f.exports.undo=a;function h(m){var k={},j={},l=0;function n(o){if(o in j){return}j[o]=k[o]=true;m.outEdges(o).forEach(function(r){var p=m.target(r),q;if(o===p){console.error('Warning: found self loop "'+r+'" for node "'+o+'"')}else{if(p in k){q=m.edge(r);m.delEdge(r);q.reversed=true;++l;m.addEdge(r,p,o,q)}else{n(p)}}});delete k[o]}m.eachNode(function(o){n(o)});b.log(2,"Acyclic Phase: reversed "+l+" edge(s)");return l}function a(j){j.eachEdge(function(n,m,l,k){if(k.reversed){delete k.reversed;j.delEdge(n);j.addEdge(n,l,m,k)}})}},{"../util":17}],12:[function(c,f,b){b.apply=function(l){function m(n){var o={};l.children(n).forEach(function(q){if(l.children(q).length){m(q);return}var s=l.node(q),r=s.prefRank;if(r!==undefined){if(!h(r)){return}if(!(r in o)){o.prefRank=[q]}else{o.prefRank.push(q)}var p=o[r];if(p===undefined){p=o[r]=l.addNode(null,{originalNodes:[]});l.parent(p,n)}d(l,q,p,r==="min");k(l,q,p,r==="max");l.node(p).originalNodes.push({u:q,value:s,parent:n});l.delNode(q)}});j(l,n,o.min);a(l,n,o.max)}m(null)};function h(l){if(l!=="min"&&l!=="max"&&l.indexOf("same_")!==0){console.error("Unsupported rank type: "+l);return false}return true}function d(o,n,l,m){o.inEdges(n).forEach(function(r){var p=o.edge(r),q;if(p.originalEdge){q=p}else{q={originalEdge:{e:r,u:o.source(r),v:o.target(r),value:p},minLen:o.edge(r).minLen}}if(p.selfLoop){m=false}if(m){o.addEdge(null,l,o.source(r),q);q.reversed=true}else{o.addEdge(null,o.source(r),l,q)}})}function k(o,n,l,m){o.outEdges(n).forEach(function(r){var p=o.edge(r),q;if(p.originalEdge){q=p}else{q={originalEdge:{e:r,u:o.source(r),v:o.target(r),value:p},minLen:o.edge(r).minLen}}if(p.selfLoop){m=false}if(m){o.addEdge(null,o.target(r),l,q);q.reversed=true}else{o.addEdge(null,l,o.target(r),q)}})}function j(m,l,n){if(n!==undefined){m.children(l).forEach(function(o){if(o!==n&&!m.outEdges(n,o).length&&!m.node(o).dummy){m.addEdge(null,n,o,{minLen:0})}})}}function a(n,m,l){if(l!==undefined){n.children(m).forEach(function(o){if(o!==l&&!n.outEdges(o,l).length&&!n.node(o).dummy){n.addEdge(null,o,l,{minLen:0})}})}}b.relax=function(l){var m=[];l.eachEdge(function(r,o,n,q){var p=q.originalEdge;if(p){m.push(p)}});l.eachNode(function(n,p){var o=p.originalNodes;if(o){o.forEach(function(q){q.value.rank=p.rank;l.addNode(q.u,q.value);l.parent(q.u,q.parent)});l.delNode(n)}});m.forEach(function(n){l.addEdge(n.e,n.u,n.v,n.value)})}},{}],13:[function(d,f,c){var h=d("cp-data").Set,k=d("graphlib").Digraph,a=d("../util");f.exports=j;function j(o){var l=new h(o.nodes()),t=new k();if(l.size()===1){var p=o.nodes()[0];t.addNode(p,{});t.graph({root:p});return t}function s(u){var w=true;o.predecessors(u).forEach(function(v){if(l.has(v)&&!b(o,v,u)){if(l.has(u)){t.addNode(u,{});l.remove(u);t.graph({root:u})}t.addNode(v,{});t.addEdge(null,v,u,{reversed:true});l.remove(v);s(v);w=false}});o.successors(u).forEach(function(v){if(l.has(v)&&!b(o,u,v)){if(l.has(u)){t.addNode(u,{});l.remove(u);t.graph({root:u})}t.addNode(v,{});t.addEdge(null,u,v,{});l.remove(v);s(v);w=false}});return w}function r(){var u=Number.MAX_VALUE;l.keys().forEach(function(w){o.predecessors(w).forEach(function(v){if(!l.has(v)){var x=b(o,v,w);if(Math.abs(x)<Math.abs(u)){u=-x}}});o.successors(w).forEach(function(v){if(!l.has(v)){var x=b(o,w,v);if(Math.abs(x)<Math.abs(u)){u=x}}})});t.eachNode(function(v){o.node(v).rank-=u})}while(l.size()){var m=!t.order()?l.keys():t.nodes();for(var n=0,q=m.length;n<q&&s(m[n]);++n){}if(l.size()){r()}}return t}function b(o,n,m){var l=o.node(m).rank-o.node(n).rank;var p=a.max(o.outEdges(n,m).map(function(q){return o.edge(q).minLen}));return l-p}},{"../util":17,"cp-data":19,graphlib:24}],14:[function(d,h,c){var a=d("../util"),f=d("graphlib").alg.topsort;h.exports=b;function b(k){var j=f(k);j.forEach(function(l){var n=k.inEdges(l);if(n.length===0){k.node(l).rank=0;return}var m=n.map(function(o){return k.node(k.source(o)).rank+k.edge(o).minLen});k.node(l).rank=a.max(m)})}},{"../util":17,graphlib:24}],15:[function(c,d,b){d.exports={slack:a};function a(k,j,h,f){return Math.abs(k.node(j).rank-k.node(h).rank)-f}},{}],16:[function(f,c,j){var l=f("../util"),m=f("./rankUtil");c.exports=p;function p(u,s){r(u,s);while(true){var v=a(s);if(v===null){break}var t=k(u,s,v);n(u,s,v,t)}}function r(u,s){b(s);s.eachEdge(function(z,y,x,w){w.cutValue=0});function t(y){var v=s.successors(y);for(var x in v){var w=v[x];t(w)}if(y!==s.graph().root){h(u,s,y)}}t(s.graph().root)}function b(s){var t=0;function u(z){var w=s.successors(z);var v=t;for(var y in w){var x=w[y];u(x);v=Math.min(v,s.node(x).low)}s.node(z).low=v;s.node(z).lim=t++}u(s.graph().root)}function h(t,D,v){var P=D.inEdges(v)[0];var N=[];var M=D.outEdges(v);for(var C in M){N.push(D.target(M[C]))}var s=0;var B=0;var A=0;var y=0;var x=0;var z=t.outEdges(v);var O;for(var L in z){var w=t.target(z[L]);for(O in N){if(q(D,w,N[O])){B++}}if(!q(D,w,v)){y++}}var K=t.inEdges(v);for(var I in K){var Q=t.source(K[I]);for(O in N){if(q(D,Q,N[O])){A++}}if(!q(D,Q,v)){x++}}var J=0;for(O in N){var u=D.edge(M[O]).cutValue;if(!D.edge(M[O]).reversed){J+=u}else{J-=u}}if(!D.edge(P).reversed){s+=J-B+A-y+x}else{s-=J-B+A-y+x}D.edge(P).cutValue=s}function q(s,u,t){return(s.node(t).low<=s.node(u).lim&&s.node(u).lim<=s.node(t).lim)}function a(s){var u=s.edges();for(var w in u){var v=u[w];var t=s.edge(v);if(t.cutValue<0){return v}}return null}function k(B,C,w){var s=C.source(w);var x=C.target(w);var v=C.node(x).lim<C.node(s).lim?x:s;var t=!C.edge(w).reversed;var z=Number.POSITIVE_INFINITY;var A;if(t){B.eachEdge(function(H,F,E,G){if(H!==w&&q(C,F,v)&&!q(C,E,v)){var D=m.slack(B,F,E,G.minLen);if(D<z){z=D;A=H}}})}else{B.eachEdge(function(H,F,E,G){if(H!==w&&!q(C,F,v)&&q(C,E,v)){var D=m.slack(B,F,E,G.minLen);if(D<z){z=D;A=H}}})}if(A===undefined){var y=[];var u=[];B.eachNode(function(D){if(!q(C,D,v)){y.push(D)}else{u.push(D)}});throw new Error("No edge found from outside of tree to inside")}return A}function n(z,A,w,v){A.delEdge(w);var s=z.source(v);var x=z.target(v);function u(C){var B=A.inEdges(C);for(var E in B){var G=B[E];var D=A.source(G);var F=A.edge(G);u(D);A.delEdge(G);F.reversed=!F.reversed;A.addEdge(G,C,D,F)}}u(x);var y=s;var t=A.inEdges(y);while(t.length>0){y=A.source(t[0]);t=A.inEdges(y)}A.graph().root=y;A.addEdge(null,s,x,{cutValue:0});r(z,A);o(z,A)}function o(u,s){function t(w){var v=s.successors(w);v.forEach(function(y){var x=d(u,w,y);u.node(y).rank=u.node(w).rank+x;t(y)})}t(s.graph().root)}function d(w,t,s){var x=w.outEdges(t,s);if(x.length>0){return l.max(x.map(function(u){return w.edge(u).minLen}))}var y=w.inEdges(t,s);if(y.length>0){return -l.max(y.map(function(u){return w.edge(u).minLen}))}}},{"../util":17,"./rankUtil":15}],17:[function(b,c,a){a.min=function(h){return Math.min.apply(Math,h)};a.max=function(h){return Math.max.apply(Math,h)};a.all=function(h,k){for(var j=0;j<h.length;++j){if(!k(h[j])){return false}}return true};a.sum=function(h){return h.reduce(function(k,j){return k+j},0)};a.values=function(h){return Object.keys(h).map(function(j){return h[j]})};a.shuffle=function(l){for(i=l.length-1;i>0;--i){var h=Math.floor(Math.random()*(i+1));var k=l[h];l[h]=l[i];l[i]=k}};a.propertyAccessor=function(j,k,l,h){return function(m){if(!arguments.length){return k[l]}k[l]=m;if(h){h(m)}return j}};a.ordering=function(h){var j=[];h.eachNode(function(k,l){var m=j[l.rank]||(j[l.rank]=[]);m[l.order]=k});return j};a.filterNonSubgraphs=function(h){return function(j){return h.children(j).length===0}};function f(h,j){return function(){var k=new Date().getTime();try{return j.apply(null,arguments)}finally{d(1,h+" time: "+(new Date().getTime()-k)+"ms")}}}f.enabled=false;a.time=f;function d(h){if(d.level>=h){console.log.apply(console,Array.prototype.slice.call(arguments,1))}}d.level=0;a.log=d},{}],18:[function(b,c,a){c.exports="0.4.5"},{}],19:[function(b,c,a){a.Set=b("./lib/Set");a.PriorityQueue=b("./lib/PriorityQueue");a.version=b("./lib/version")},{"./lib/PriorityQueue":20,"./lib/Set":21,"./lib/version":23}],20:[function(b,c,a){c.exports=d;function d(){this._arr=[];this._keyIndices={}}d.prototype.size=function(){return this._arr.length};d.prototype.keys=function(){return this._arr.map(function(f){return f.key})};d.prototype.has=function(f){return f in this._keyIndices};d.prototype.priority=function(h){var f=this._keyIndices[h];if(f!==undefined){return this._arr[f].priority}};d.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow")}return this._arr[0].key};d.prototype.add=function(l,k){var j=this._keyIndices;if(!(l in j)){var f=this._arr;var h=f.length;j[l]=h;f.push({key:l,priority:k});this._decrease(h);return true}return false};d.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var f=this._arr.pop();delete this._keyIndices[f.key];this._heapify(0);return f.key};d.prototype.decrease=function(j,h){var f=this._keyIndices[j];if(h>this._arr[f].priority){throw new Error("New priority is greater than current priority. Key: "+j+" Old: "+this._arr[f].priority+" New: "+h)}this._arr[f].priority=h;this._decrease(f)};d.prototype._heapify=function(j){var f=this._arr;var h=2*j,k=h+1,m=j;if(h<f.length){m=f[h].priority<f[m].priority?h:m;if(k<f.length){m=f[k].priority<f[m].priority?k:m}if(m!==j){this._swap(j,m);this._heapify(m)}}};d.prototype._decrease=function(h){var f=this._arr;var j=f[h].priority;var k;while(h!==0){k=h>>1;if(f[k].priority<j){break}this._swap(h,k);h=k}};d.prototype._swap=function(n,m){var h=this._arr;var l=this._keyIndices;var k=h[n];var f=h[m];h[n]=f;h[m]=k;l[f.key]=n;l[k.key]=m}},{}],21:[function(d,f,c){var a=d("./util");f.exports=h;function h(l){this._size=0;this._keys={};if(l){for(var k=0,j=l.length;k<j;++k){this.add(l[k])}}}h.intersect=function(n){if(n.length===0){return new h()}var s=new h(!a.isArray(n[0])?n[0].keys():n[0]);for(var l=1,q=n.length;l<q;++l){var p=s.keys(),o=!a.isArray(n[l])?n[l]:new h(n[l]);for(var k=0,m=p.length;k<m;++k){var r=p[k];if(!o.has(r)){s.remove(r)}}}return s};h.union=function(r){var o=a.reduce(r,function(j,k){return j+(k.size?k.size():k.length)},0);var q=new Array(o);var l=0;for(var p=0,s=r.length;p<s;++p){var t=r[p],u=!a.isArray(t)?t.keys():t;for(var m=0,n=u.length;m<n;++m){q[l++]=u[m]}}return new h(q)};h.prototype.size=function(){return this._size};h.prototype.keys=function(){return b(this._keys)};h.prototype.has=function(j){return j in this._keys};h.prototype.add=function(j){if(!(j in this._keys)){this._keys[j]=j;++this._size;return true}return false};h.prototype.remove=function(j){if(j in this._keys){delete this._keys[j];--this._size;return true}return false};function b(m){var n=Object.keys(m),k=n.length,j=new Array(k),l;for(l=0;l<k;++l){j[l]=m[n[l]]}return j}},{"./util":22}],22:[function(b,c,a){if(!Array.isArray){a.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"}}else{a.isArray=Array.isArray}if("function"!==typeof Array.prototype.reduce){a.reduce=function(m,l,j){if(null===m||"undefined"===typeof m){throw new TypeError("Array.prototype.reduce called on null or undefined")}if("function"!==typeof l){throw new TypeError(l+" is not a function")}var d,h,f=m.length>>>0,k=false;if(1<arguments.length){h=j;k=true}for(d=0;f>d;++d){if(m.hasOwnProperty(d)){if(k){h=l(h,m[d],d,m)}else{h=m[d];k=true}}}if(!k){throw new TypeError("Reduce of empty array with no initial value")}return h}}else{a.reduce=function(h,f,d){return h.reduce(f,d)}}},{}],23:[function(b,c,a){c.exports="1.1.3"},{}],24:[function(b,c,a){a.Graph=b("./lib/Graph");a.Digraph=b("./lib/Digraph");a.CGraph=b("./lib/CGraph");a.CDigraph=b("./lib/CDigraph");b("./lib/graph-converters");a.alg={isAcyclic:b("./lib/alg/isAcyclic"),components:b("./lib/alg/components"),dijkstra:b("./lib/alg/dijkstra"),dijkstraAll:b("./lib/alg/dijkstraAll"),findCycles:b("./lib/alg/findCycles"),floydWarshall:b("./lib/alg/floydWarshall"),postorder:b("./lib/alg/postorder"),preorder:b("./lib/alg/preorder"),prim:b("./lib/alg/prim"),tarjan:b("./lib/alg/tarjan"),topsort:b("./lib/alg/topsort")};a.converter={json:b("./lib/converter/json.js")};var d=b("./lib/filter");a.filter={all:d.all,nodesFromList:d.nodesFromList};a.version=b("./lib/version")},{"./lib/CDigraph":26,"./lib/CGraph":27,"./lib/Digraph":28,"./lib/Graph":29,"./lib/alg/components":30,"./lib/alg/dijkstra":31,"./lib/alg/dijkstraAll":32,"./lib/alg/findCycles":33,"./lib/alg/floydWarshall":34,"./lib/alg/isAcyclic":35,"./lib/alg/postorder":36,"./lib/alg/preorder":37,"./lib/alg/prim":38,"./lib/alg/tarjan":39,"./lib/alg/topsort":40,"./lib/converter/json.js":42,"./lib/filter":43,"./lib/graph-converters":44,"./lib/version":46}],25:[function(b,d,a){var h=b("cp-data").Set;d.exports=c;function c(){this._value=undefined;this._nodes={};this._edges={};this._nextId=0}c.prototype.order=function(){return Object.keys(this._nodes).length};c.prototype.size=function(){return Object.keys(this._edges).length};c.prototype.graph=function(k){if(arguments.length===0){return this._value}this._value=k};c.prototype.hasNode=function(k){return k in this._nodes};c.prototype.node=function(k,m){var l=this._strictGetNode(k);if(arguments.length===1){return l.value}l.value=m};c.prototype.nodes=function(){var k=[];this.eachNode(function(l){k.push(l)});return k};c.prototype.eachNode=function(n){for(var l in this._nodes){var m=this._nodes[l];n(m.id,m.value)}};c.prototype.hasEdge=function(k){return k in this._edges};c.prototype.edge=function(m,l){var k=this._strictGetEdge(m);if(arguments.length===1){return k.value}k.value=l};c.prototype.edges=function(){var k=[];this.eachEdge(function(l){k.push(l)});return k};c.prototype.eachEdge=function(n){for(var l in this._edges){var m=this._edges[l];n(m.id,m.u,m.v,m.value)}};c.prototype.incidentNodes=function(l){var k=this._strictGetEdge(l);return[k.u,k.v]};c.prototype.addNode=function(k,l){if(k===undefined||k===null){do{k="_"+(++this._nextId)}while(this.hasNode(k))}else{if(this.hasNode(k)){throw new Error("Graph already has node '"+k+"'")}}this._nodes[k]={id:k,value:l};return k};c.prototype.delNode=function(k){this._strictGetNode(k);this.incidentEdges(k).forEach(function(l){this.delEdge(l)},this);delete this._nodes[k]};c.prototype._addEdge=function(p,l,k,o,n,m){this._strictGetNode(l);this._strictGetNode(k);if(p===undefined||p===null){do{p="_"+(++this._nextId)}while(this.hasEdge(p))}else{if(this.hasEdge(p)){throw new Error("Graph already has edge '"+p+"'")}}this._edges[p]={id:p,u:l,v:k,value:o};j(n[k],l,p);j(m[l],k,p);return p};c.prototype._delEdge=function(n,m,l){var k=this._strictGetEdge(n);f(m[k.v],k.u,n);f(l[k.u],k.v,n);delete this._edges[n]};c.prototype.copy=function(){var k=new this.constructor();k.graph(this.graph());this.eachNode(function(l,m){k.addNode(l,m)});this.eachEdge(function(o,m,l,n){k.addEdge(o,m,l,n)});k._nextId=this._nextId;return k};c.prototype.filterNodes=function(k){var l=new this.constructor();l.graph(this.graph());this.eachNode(function(m,n){if(k(m)){l.addNode(m,n)}});this.eachEdge(function(p,n,m,o){if(l.hasNode(n)&&l.hasNode(m)){l.addEdge(p,n,m,o)}});return l};c.prototype._strictGetNode=function(k){var l=this._nodes[k];if(l===undefined){throw new Error("Node '"+k+"' is not in graph")}return l};c.prototype._strictGetEdge=function(l){var k=this._edges[l];if(k===undefined){throw new Error("Edge '"+l+"' is not in graph")}return k};function j(m,k,l){(m[k]||(m[k]=new h())).add(l)}function f(n,k,m){var l=n[k];l.remove(m);if(l.size()===0){delete n[k]}}},{"cp-data":19}],26:[function(b,d,a){var h=b("./Digraph"),f=b("./compoundify");var c=f(h);d.exports=c;c.fromDigraph=function(l){var k=new c(),j=l.graph();if(j!==undefined){k.graph(j)}l.eachNode(function(m,n){if(n===undefined){k.addNode(m)}else{k.addNode(m,n)}});l.eachEdge(function(p,n,m,o){if(o===undefined){k.addEdge(null,n,m)}else{k.addEdge(null,n,m,o)}});return k};c.prototype.toString=function(){return"CDigraph "+JSON.stringify(this,null,2)}},{"./Digraph":28,"./compoundify":41}],27:[function(d,f,c){var b=d("./Graph"),h=d("./compoundify");var a=h(b);f.exports=a;a.fromGraph=function(l){var k=new a(),j=l.graph();if(j!==undefined){k.graph(j)}l.eachNode(function(m,n){if(n===undefined){k.addNode(m)}else{k.addNode(m,n)}});l.eachEdge(function(p,n,m,o){if(o===undefined){k.addEdge(null,n,m)}else{k.addEdge(null,n,m,o)}});return k};a.prototype.toString=function(){return"CGraph "+JSON.stringify(this,null,2)}},{"./Graph":29,"./compoundify":41}],28:[function(c,f,b){var a=c("./util"),d=c("./BaseGraph"),h=c("cp-data").Set;f.exports=j;function j(){d.call(this);
/*! Map of sourceId -> {targetId -> Set of edge ids} */
this._inEdges={};
/*! Map of targetId -> {sourceId -> Set of edge ids} */
this._outEdges={}}j.prototype=new d();j.prototype.constructor=j;j.prototype.isDirected=function(){return true};j.prototype.successors=function(k){this._strictGetNode(k);return Object.keys(this._outEdges[k]).map(function(l){return this._nodes[l].id},this)};j.prototype.predecessors=function(k){this._strictGetNode(k);return Object.keys(this._inEdges[k]).map(function(l){return this._nodes[l].id},this)};j.prototype.neighbors=function(k){return h.union([this.successors(k),this.predecessors(k)]).keys()};j.prototype.sources=function(){var k=this;return this._filterNodes(function(l){return k.inEdges(l).length===0})};j.prototype.sinks=function(){var k=this;return this._filterNodes(function(l){return k.outEdges(l).length===0})};j.prototype.source=function(k){return this._strictGetEdge(k).u};j.prototype.target=function(k){return this._strictGetEdge(k).v};j.prototype.inEdges=function(m,l){this._strictGetNode(m);var k=h.union(a.values(this._inEdges[m])).keys();if(arguments.length>1){this._strictGetNode(l);k=k.filter(function(n){return this.source(n)===l},this)}return k};j.prototype.outEdges=function(l,m){this._strictGetNode(l);var k=h.union(a.values(this._outEdges[l])).keys();if(arguments.length>1){this._strictGetNode(m);k=k.filter(function(n){return this.target(n)===m},this)}return k};j.prototype.incidentEdges=function(l,k){if(arguments.length>1){return h.union([this.outEdges(l,k),this.outEdges(k,l)]).keys()}else{return h.union([this.inEdges(l),this.outEdges(l)]).keys()}};j.prototype.toString=function(){return"Digraph "+JSON.stringify(this,null,2)};j.prototype.addNode=function(k,l){k=d.prototype.addNode.call(this,k,l);this._inEdges[k]={};this._outEdges[k]={};return k};j.prototype.delNode=function(k){d.prototype.delNode.call(this,k);delete this._inEdges[k];delete this._outEdges[k]};j.prototype.addEdge=function(n,l,m,k){return d.prototype._addEdge.call(this,n,l,m,k,this._inEdges,this._outEdges)};j.prototype.delEdge=function(k){d.prototype._delEdge.call(this,k,this._inEdges,this._outEdges)};j.prototype._filterNodes=function(k){var l=[];this.eachNode(function(m){if(k(m)){l.push(m)}});return l}},{"./BaseGraph":25,"./util":45,"cp-data":19}],29:[function(d,h,c){var a=d("./util"),f=d("./BaseGraph"),j=d("cp-data").Set;h.exports=b;function b(){f.call(this);
/*! Map of nodeId -> { otherNodeId -> Set of edge ids } */
this._incidentEdges={}}b.prototype=new f();b.prototype.constructor=b;b.prototype.isDirected=function(){return false};b.prototype.neighbors=function(k){this._strictGetNode(k);return Object.keys(this._incidentEdges[k]).map(function(l){return this._nodes[l].id},this)};b.prototype.incidentEdges=function(l,k){this._strictGetNode(l);if(arguments.length>1){this._strictGetNode(k);return k in this._incidentEdges[l]?this._incidentEdges[l][k].keys():[]}else{return j.union(a.values(this._incidentEdges[l])).keys()}};b.prototype.toString=function(){return"Graph "+JSON.stringify(this,null,2)};b.prototype.addNode=function(k,l){k=f.prototype.addNode.call(this,k,l);this._incidentEdges[k]={};return k};b.prototype.delNode=function(k){f.prototype.delNode.call(this,k);delete this._incidentEdges[k]};b.prototype.addEdge=function(n,l,k,m){return f.prototype._addEdge.call(this,n,l,k,m,this._incidentEdges,this._incidentEdges)};b.prototype.delEdge=function(k){f.prototype._delEdge.call(this,k,this._incidentEdges,this._incidentEdges)}},{"./BaseGraph":25,"./util":45,"cp-data":19}],30:[function(b,c,a){var f=b("cp-data").Set;c.exports=d;function d(k){var j=[];var h=new f();function l(m,n){if(!h.has(m)){h.add(m);n.push(m);k.neighbors(m).forEach(function(o){l(o,n)})}}k.nodes().forEach(function(m){var n=[];l(m,n);if(n.length>0){j.push(n)}});return j}},{"cp-data":19}],31:[function(b,c,a){var d=b("cp-data").PriorityQueue;c.exports=f;function f(o,h,j,l){var m={},k=new d();function p(w){var r=o.incidentNodes(w),s=r[0]!==q?r[0]:r[1],t=m[s],u=j(w),x=n.distance+u;if(u<0){throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+w+" Weight: "+u)}if(x<t.distance){t.distance=x;t.predecessor=q;k.decrease(s,x)}}j=j||function(){return 1};l=l||(o.isDirected()?function(r){return o.outEdges(r)}:function(r){return o.incidentEdges(r)});o.eachNode(function(r){var s=r===h?0:Number.POSITIVE_INFINITY;m[r]={distance:s};k.add(r,s)});var q,n;while(k.size()>0){q=k.removeMin();n=m[q];if(n.distance===Number.POSITIVE_INFINITY){break}l(q).forEach(p)}return m}},{"cp-data":19}],32:[function(b,c,a){var f=b("./dijkstra");c.exports=d;function d(j,l,k){var h={};j.eachNode(function(m){h[m]=f(j,m,l,k)});return h}},{"./dijkstra":31}],33:[function(b,c,a){var f=b("./tarjan");c.exports=d;function d(h){return f(h).filter(function(j){return j.length>1})}},{"./tarjan":39}],34:[function(b,c,a){c.exports=d;function d(j,l,k){var h={},f=j.nodes();l=l||function(){return 1};k=k||(j.isDirected()?function(m){return j.outEdges(m)}:function(m){return j.incidentEdges(m)});f.forEach(function(m){h[m]={};h[m][m]={distance:0};f.forEach(function(n){if(m!==n){h[m][n]={distance:Number.POSITIVE_INFINITY}}});k(m).forEach(function(p){var n=j.incidentNodes(p),o=n[0]!==m?n[0]:n[1],q=l(p);if(q<h[m][o].distance){h[m][o]={distance:q,predecessor:m}}})});f.forEach(function(m){var n=h[m];f.forEach(function(o){var p=h[o];f.forEach(function(s){var r=p[m];var u=n[s];var t=p[s];var q=r.distance+u.distance;if(q<t.distance){t.distance=q;t.predecessor=u.predecessor}})})});return h}},{}],35:[function(c,f,b){var d=c("./topsort");f.exports=a;function a(h){try{d(h)}catch(j){if(j instanceof d.CycleException){return false}throw j}return true}},{"./topsort":40}],36:[function(b,d,a){var f=b("cp-data").Set;d.exports=c;function c(k,j,m){var h=new f();if(k.isDirected()){throw new Error("This function only works for undirected graphs")}function l(n,o){if(h.has(n)){throw new Error("The input graph is not a tree: "+k)}h.add(n);k.neighbors(n).forEach(function(p){if(p!==o){l(p,n)}});m(n)}l(j)}},{"cp-data":19}],37:[function(b,c,a){var f=b("cp-data").Set;c.exports=d;function d(k,j,m){var h=new f();if(k.isDirected()){throw new Error("This function only works for undirected graphs")}function l(n,o){if(h.has(n)){throw new Error("The input graph is not a tree: "+k)}h.add(n);m(n);k.neighbors(n).forEach(function(p){if(p!==o){l(p,n)}})}l(j)}},{"cp-data":19}],38:[function(d,f,c){var b=d("../Graph"),h=d("cp-data").PriorityQueue;f.exports=a;function a(o,p){var k=new b(),n={},j=new h(),m;function l(w){var r=o.incidentNodes(w),s=r[0]!==m?r[0]:r[1],u=j.priority(s);if(u!==undefined){var t=p(w);if(t<u){n[s]=m;j.decrease(s,t)}}}if(o.order()===0){return k}o.eachNode(function(r){j.add(r,Number.POSITIVE_INFINITY);k.addNode(r)});j.decrease(o.nodes()[0],0);var q=false;while(j.size()>0){m=j.removeMin();if(m in n){k.addEdge(null,m,n[m])}else{if(q){throw new Error("Input graph is not connected: "+o)}else{q=true}}o.incidentEdges(m).forEach(l)}return k}},{"../Graph":29,"cp-data":19}],39:[function(b,c,a){c.exports=d;function d(l){if(!l.isDirected()){throw new Error("tarjan can only be applied to a directed graph. Bad input: "+l)}var j=0,f=[],h={},k=[];function m(p){var q=h[p]={onStack:true,lowlink:j,index:j++};f.push(p);l.successors(p).forEach(function(r){if(!(r in h)){m(r);q.lowlink=Math.min(q.lowlink,h[r].lowlink)}else{if(h[r].onStack){q.lowlink=Math.min(q.lowlink,h[r].index)}}});if(q.lowlink===q.index){var n=[],o;do{o=f.pop();h[o].onStack=false;n.push(o)}while(p!==o);k.push(n)}}l.nodes().forEach(function(n){if(!(n in h)){m(n)}});return k}},{}],40:[function(b,d,a){d.exports=c;c.CycleException=f;function c(n){if(!n.isDirected()){throw new Error("topsort can only be applied to a directed graph. Bad input: "+n)}var k={};var j={};var m=[];function l(o){if(o in j){throw new f()}if(!(o in k)){j[o]=true;k[o]=true;n.predecessors(o).forEach(function(p){l(p)});delete j[o];m.push(o)}}var h=n.sinks();if(n.order()!==0&&h.length===0){throw new f()}n.sinks().forEach(function(o){l(o)});return m}function f(){}f.prototype.toString=function(){return"Graph has at least one cycle"}},{}],41:[function(b,c,a){var d=b("cp-data").Set;c.exports=f;function f(h){function j(){h.call(this);this._parents={};this._children={};this._children[null]=new d()}j.prototype=new h();j.prototype.constructor=j;j.prototype.parent=function(k,l){this._strictGetNode(k);if(arguments.length<2){return this._parents[k]}if(k===l){throw new Error("Cannot make "+k+" a parent of itself")}if(l!==null){this._strictGetNode(l)}this._children[this._parents[k]].remove(k);this._parents[k]=l;this._children[l].add(k)};j.prototype.children=function(k){if(k!==null){this._strictGetNode(k)}return this._children[k].keys()};j.prototype.addNode=function(k,l){k=h.prototype.addNode.call(this,k,l);this._parents[k]=null;this._children[k]=new d();this._children[null].add(k);return k};j.prototype.delNode=function(k){var l=this.parent(k);this._children[k].keys().forEach(function(m){this.parent(m,l)},this);this._children[l].remove(k);delete this._parents[k];delete this._children[k];return h.prototype.delNode.call(this,k)};j.prototype.copy=function(){var k=h.prototype.copy.call(this);this.nodes().forEach(function(l){k.parent(l,this.parent(l))},this);return k};j.prototype.filterNodes=function(n){var k=this,o=h.prototype.filterNodes.call(this,n);var l={};function m(p){var q=k.parent(p);if(q===null||o.hasNode(q)){l[p]=q;return q}else{if(q in l){return l[q]}else{return m(q)}}}o.eachNode(function(p){o.parent(p,m(p))});return o};return j}},{"cp-data":19}],42:[function(d,j,c){var b=d("../Graph"),k=d("../Digraph"),a=d("../CGraph"),h=d("../CDigraph");c.decode=function(m,l,n){n=n||k;if(f(m)!=="Array"){throw new Error("nodes is not an Array")}if(f(l)!=="Array"){throw new Error("edges is not an Array")}if(typeof n==="string"){switch(n){case"graph":n=b;break;case"digraph":n=k;break;case"cgraph":n=a;break;case"cdigraph":n=h;break;default:throw new Error("Unrecognized graph type: "+n)}}var o=new n();m.forEach(function(p){o.addNode(p.id,p.value)});if(o.parent){m.forEach(function(p){if(p.children){p.children.forEach(function(q){o.parent(q,p.id)})}})}l.forEach(function(p){o.addEdge(p.id,p.u,p.v,p.value)});return o};c.encode=function(o){var m=[];var l=[];o.eachNode(function(p,s){var r={id:p,value:s};if(o.children){var q=o.children(p);if(q.length){r.children=q}}m.push(r)});o.eachEdge(function(s,q,p,r){l.push({id:s,u:q,v:p,value:r})});var n;if(o instanceof h){n="cdigraph"}else{if(o instanceof a){n="cgraph"}else{if(o instanceof k){n="digraph"}else{if(o instanceof b){n="graph"}else{throw new Error("Couldn't determine type of graph: "+o)}}}}return{nodes:m,edges:l,type:n}};function f(l){return Object.prototype.toString.call(l).slice(8,-1)}},{"../CDigraph":26,"../CGraph":27,"../Digraph":28,"../Graph":29}],43:[function(b,c,a){var d=b("cp-data").Set;a.all=function(){return function(){return true}};a.nodesFromList=function(f){var h=new d(f);return function(j){return h.has(j)}}},{"cp-data":19}],44:[function(c,d,b){var a=c("./Graph"),f=c("./Digraph");a.prototype.toDigraph=a.prototype.asDirected=function(){var h=new f();this.eachNode(function(j,k){h.addNode(j,k)});this.eachEdge(function(m,k,j,l){h.addEdge(null,k,j,l);h.addEdge(null,j,k,l)});return h};f.prototype.toGraph=f.prototype.asUndirected=function(){var h=new a();this.eachNode(function(j,k){h.addNode(j,k)});this.eachEdge(function(m,k,j,l){h.addEdge(m,k,j,l)});return h}},{"./Digraph":28,"./Graph":29}],45:[function(b,c,a){a.values=function(j){var k=Object.keys(j),f=k.length,d=new Array(f),h;for(h=0;h<f;++h){d[h]=j[k[h]]}return d}},{}],46:[function(b,c,a){c.exports="0.7.4"},{}]},{},[1]);joint.layout.DirectedGraph={layout:function(f,c){c=c||{};var a=this._prepareData(f);var d=dagre.layout();if(c.debugLevel){d.debugLevel(c.debugLevel)}if(c.rankDir){d.rankDir(c.rankDir)}if(c.rankSep){d.rankSep(c.rankSep)}if(c.edgeSep){d.edgeSep(c.edgeSep)}if(c.nodeSep){d.nodeSep(c.nodeSep)}var b=d.run(a);b.eachNode(function(j,k){if(!k.dummy){var h=f.getCell(j);c.setPosition?c.setPosition(h,k):f.get("cells").get(j).set("position",{x:k.x-k.width/2,y:k.y-k.height/2})}});if(c.setLinkVertices){b.eachEdge(function(m,j,h,l){var k=f.getCell(m);if(k){c.setVertices?c.setVertices(k,l.points):k.set("vertices",l.points)}})}return{width:b.graph().width,height:b.graph().height}},_prepareData:function(b){var a=new dagre.Digraph();_.each(b.getElements(),function(c){if(a.hasNode(c.id)){return}a.addNode(c.id,{width:c.get("size").width,height:c.get("size").height,rank:c.get("rank")})});_.each(b.getLinks(),function(c){if(a.hasEdge(c.id)){return}var f=c.get("source").id;var d=c.get("target").id;a.addEdge(c.id,f,d,{minLen:c.get("minLen")||1})});return a}};joint.layout.ForceDirected=Backbone.Model.extend({defaults:{linkDistance:10,linkStrength:1,charge:10},initialize:function(a){this.elements=this.get("graph").getElements();this.links=this.get("graph").getLinks();this.cells=this.get("graph").get("cells");this.width=this.get("width");this.height=this.get("height");this.gravityCenter=this.get("gravityCenter");this.t=1;this.energy=Infinity;this.progress=0},start:function(){var b=this.get("width");var d=this.get("height");var c=[];var a=[];_.each(this.elements,function(f){f.set("position",{x:Math.random()*b,y:Math.random()*d});f.charge=f.get("charge")||this.get("charge");f.weight=f.get("weight")||1;var h=f.get("position");f.x=h.x;f.y=h.y;f.px=f.x;f.py=f.y;f.fx=0;f.fy=0},this);_.each(this.links,function(f){f.strength=f.get("strength")||this.get("linkStrength");f.distance=f.get("distance")||this.get("linkDistance");f.source=this.cells.get(f.get("source").id);f.target=this.cells.get(f.get("target").id)},this)},step:function(){if((this.t*0.99)<0.005){return this.notifyEnd()}var A=this.width;var K=this.height;var n=0.1;var L=this.gravityCenter;var H=this.energy;this.energy=0;var m=0;var l=0;var f=0;var r=0;var J,I;var t=this.elements.length;var M=this.links.length;for(J=0;J<t-1;J++){var C=this.elements[J];m+=C.x;l+=C.y;for(I=J+1;I<t;I++){var D=this.elements[I];var B=D.x-C.x;var z=D.y-C.y;var E=B*B+z*z;var d=Math.sqrt(E);var p=this.t*C.charge/E;var c=p*B;var b=p*z;C.fx-=c;C.fy-=b;D.fx+=c;D.fy+=b;this.energy+=c*c+b*b}}m+=this.elements[t-1].x;l+=this.elements[t-1].y;for(J=0;J<M;J++){var s=this.links[J];var C=s.source;var D=s.target;var B=D.x-C.x;var z=D.y-C.y;var E=B*B+z*z;var d=Math.sqrt(E);var F=this.t*s.strength*(d-s.distance)/d;var c=F*B;var b=F*z;var G=C.weight/(C.weight+D.weight);C.x+=c*(1-G);C.y+=b*(1-G);D.x-=c*G;D.y-=b*G;this.energy+=c*c+b*b}for(J=0;J<t;J++){var a=this.elements[J];var o={x:a.x,y:a.y};if(L){o.x+=(L.x-o.x)*this.t*n;o.y+=(L.y-o.y)*this.t*n}o.x+=a.fx;o.y+=a.fy;o.x=Math.max(0,Math.min(A,o.x));o.y=Math.max(0,Math.min(K,o.y));var q=0.9;o.x+=(a.px-o.x)*q;o.y+=(a.py-o.y)*q;a.px=o.x;a.py=o.y;a.fx=a.fy=0;a.x=o.x;a.y=o.y;f+=a.x;r+=a.y;this.notify(a,J,o)}this.t=this.cool(this.t,this.energy,H);var y=m-f;var x=l-r;var N=Math.sqrt(y*y+x*x);if(N<1){this.notifyEnd()}},cool:function(a,c,b){if(c<b){this.progress+=1;if(this.progress>=5){this.progress=0;return a/0.99}}else{this.progress=0;return a*0.99}return a},notify:function(b,a,c){b.set("position",c)},notifyEnd:function(){this.trigger("end")}});joint.layout=joint.layout||{};joint.layout.GridLayout={layout:function(k,f){f=f||{};var a=k.getElements();var j=f.columns||1;var m=f.dx||0;var l=f.dy||0;var h=f.columnWidth||this._maxDim(a,"width")+m;var b=f.rowHeight||this._maxDim(a,"height")+l;var d=_.isUndefined(f.centre)||f.centre!==false;var c=!!f.resizeToFit;_.each(a,function(q,r){var p=0,o=0,v=q.get("size");if(c){var t=h-2*m;var s=b-2*l;var u=v.height*(v.width?t/v.width:1);var n=v.width*(v.height?s/v.height:1);if(u>b){t=n}else{s=u}v={width:t,height:s};q.set("size",v)}if(d){p=(h-v.width)/2;o=(b-v.height)/2}q.set("position",{x:(r%j)*h+m+p,y:Math.floor(r/j)*b+l+o})})},_maxDim:function(a,b){return _.reduce(a,function(c,d){return Math.max(d.get("size")[b],c)},0)}};joint.layout.TreeLayout=Backbone.Model.extend({RANK_LEFT:"L",RANK_RIGHT:"R",RANK_CENTER:"C",defaults:{verticalGap:10,horizontalGap:10,defaultRankDir:null,defaultLink:new joint.dia.Link,benchmark:false},initialize:function(){this.graph=this.get("graph");this.prepare()},layout:function(a){a=a||{};var b=a.rootId;if(!b){_.each(this.roots,function(c){this.layout(_.extend({rootId:c,partial:true},a))},this)}else{this.elements[b].layoutArea=this.benchmark("computeLayoutArea",b);this.benchmark("positionElements",b,true);this.benchmark("positionLinks",b)}!a.partial&&this.trigger("layout:done",a);return this},prepare:function(){var a=this.get("verticalGap");var c={};var b=[];this.get("graph").get("cells").each(function(d){if(d.isLink()){var l=d.get("source").id;var f=d.get("target").id;var k=(c[l]=c[l]||{});var m=(c[f]=c[f]||{});k.children=(k.children||[]).concat(f);m.parentId=l;m.parentLinkId=d.id;d.get("hidden")&&(k.containsHidden=true)}else{var j=(c[d.id]=c[d.id]||{});var h=d.get("size");j.id=d.id;j.geometry=_.clone(h);j.siblingRank=d.get("siblingRank")||Infinity;j.rankDir=d.get("rankDir")||null;j.hidden=d.get("hidden")||false;j.hiddenByRankDir={};j.offsetx=d.get("offsetX")||0;j.callerId=d.get("callout")||null;if(j.callerId){j.cdy=d.get("calloutDy")||a;j.cdx=d.get("calloutDx")||0;!j.hidden&&b.push(j.id)}}});this.elements=c;this.roots=[];this.mainRootId=null;this.calloutRoots=b;_.each(c,function(d){d.children=_.sortBy(d.children,function(f){return c[f].siblingRank});if(!d.parentId){if(d.callerId){c[d.callerId].callouts=(c[d.callerId].callouts||[]).concat(d.id)}else{this.roots.push(d.id);if(d.rankDir==this.RANK_CENTER){if(this.mainRootId){throw new Error("Too many central roots.")}this.mainRootId=d.id}}}},this);_.each(this.roots,function(d){this.updateRankDirAndLevel(d,0)},this);return this},applyOnDescendants:function(d,b,a){a=_.extend({includeInvisible:true,includeLinks:true},a);var c=a.deep?this.getDescendantsOf(d,a):this.getChildrenOf(d,a);_.each(c,function(f){if(a.includeLinks){var h=this.elements[f].parentLinkId;h&&b.call(this,h,a)}b.call(this,f,a)},this);(!a.applyOnly)&&this.prepare().layout(a)},connect:function(j,h,d){d=d||{};_.extend(d,{oldParentId:null,newParentId:h});var b=this.graph.getCell(j);var a=this.graph.getCell(this.elements[j]&&this.elements[j].parentLinkId);var f=this.isCollapsed(h);if(a){d.oldParentId=a.get("source").id;a.set({source:{id:h},hidden:f})}else{if(b.has("callout")){b.set("callout",h)}else{var c=d.link||this.get("defaultLink").clone();c.set({source:{id:h},target:{id:j},hidden:f});this.graph.addCell(c)}}b.set("hidden",f);d.connectOnly||this.prepare().layout(d);return this},disconnect:function(d,b){var a=this.graph.getCell(this.elements[d].parentLinkId);var c=this.elements[d].parentId;if(a){_.extend(b,{oldParentId:a.get("source").id,newParentId:null});a.remove();(!b||!b.disconnectOnly)&&this.prepare().layout(b)}return this},remove:function(j,f){f=_.extend({includeCallouts:true},f);if(f.deep){_.each(this.getDescendantsOf(j,f).concat(j),function(k){this.graph.getCell(k).remove()},this)}else{var d=this.elements[j];if(this.isCollapsed(j)){this.expand(j,{deep:!!f.deepExpand,expandOnly:true})}if(d.parentLinkId){var b=_.map(d.children,this.graph.getCell,this.graph);var c=_.map(d.children,function(k){return this.graph.getCell(this.elements[k].parentLinkId)},this);this.graph.getCell(d.parentLinkId).remove();var h=[0,c.length-1];var a=[d.siblingRank-0.5,d.siblingRank+0.5];_.each(c,function(l,k){l.set("source",{id:d.parentId});b[k].set("siblingRank",g.scale.linear(h,a,k))},this)}this.graph.getCell(j).remove()}(!f.removeOnly)&&this.prepare().layout(f)},clone:function(j,c){c=_.extend({includeCallouts:true,deep:true},c);c.includeLinks=false;var h=this.graph.getCell(j).clone().unset("rankDir");var b=[h];var f=[];var a={};a[j]=h.id;this.applyOnDescendants(j,_.bind(function(k){var m=this.elements[k];var n=this.graph.getCell(k).clone();a[k]=n.id;b.push(n);if(m.parentLinkId){var l=this.graph.getCell(m.parentLinkId).clone().set({source:{id:a[m.parentId]},target:{id:n.id}});f.push(l)}else{n.set("callout",a[n.get("callout")])}},this),c);var d=b.concat(f);if(c.includeCallouts){_.each(this.elements[j].callouts,function(k){var l=this.clone(k,c);l[0].set("callout",h.id);Array.prototype.push.apply(d,l)},this)}return d},collapse:function(b,a){a=a||{};this.applyOnDescendants(b,function(c){this.graph.getCell(c).set("hidden",true)},_.extend({deep:true,includeCallouts:true,applyOnly:!!a.collapseOnly},a))},expand:function(b,a){a=a||{};this.applyOnDescendants(b,function(c){this.graph.getCell(c).set("hidden",false)},_.extend({deep:true,includeCallouts:true,applyOnly:!!a.expandOnly},a))},getElement:function(a){return this.elements[a]},getGeometry:function(a){return this.elements[a].geometry},getLayoutArea:function(a){return this.elements[a].layoutArea},getChildrenOf:function(d,b){b=b||{};var c=[];var a=_.filter(this.elements[d].children,function(f){var h=this.elements[f];if(!b.includeInvisible&&!this.isVisible(f)){return false}if(b.rankDir&&b.rankDir!=h.rankDir){return false}if(b.includeCallouts&&!_.isEmpty(h.callouts)){Array.prototype.push.apply(c,this.getCalloutsOf(f))}return true},this);return a.concat(c)},getDescendantsOf:function(c,b){b=_.extend({includeInvisible:true},b);var a=this.getChildrenOf(c,b);return _.reduce(a,function(d,f){return d.concat(this.getDescendantsOf(f,b))},a||[],this)},getCalloutsOf:function(a){return _.reduce(this.elements[a].callouts,function(c,b){return c.concat(b,this.getCalloutsOf(b))},[],this)},getCallerOf:function(a){return this.elements[a].callerId},getLayoutAreaByPoint:function(c,b){var a=this.getLayoutArea(c);if(!g.rect(a).containsPoint(b)){return null}_.some(this.getChildrenOf(c),function(f){var d=this.getLayoutAreaByPoint(f,b);return d&&(a=d)},this);return a},getSiblingRankByPoint:function(j,f,c){var h=this.getChildrenOf(j,c)||[];for(var b=0,d=h.length;b<d;b++){var a=this.elements[h[b]].layoutArea;if(a.y+a.height/2>f.y){break}}return b},getRootOf:function(b){var a=b;while(a){b=a;a=this.elements[b].parentId}return b},getLocalRootsOf:function(a){var b=_.reject(a,function(c){return _.some(a,function(d){return this.isDescendantOf(c,d)},this)},this);return b},getMinimalRootByPoint:function(d,b){var a=this.roots;b=b||{};b.includeCallouts&&Array.prototype.push.apply(a,this.calloutRoots);var c=_.chain(a).map(this.getLayoutArea,this).filter(function(f){return g.rect(f).containsPoint(d)}).min(function(f){return f.width*f.height}).value();return c.rootId},isDescendantOf:function(d,c){d=this.elements[d].parentId||this.elements[d].callerId;while(d){if(d==c){return true}d=this.elements[d].parentId||this.elements[d].callerId}return false},isParentOf:function(d,c){return this.elements[c]&&this.elements[c].parentId==d},isVisible:function(a){return !this.elements[a].hidden},isCollapsed:function(c,b){var a=this.elements[c];return a&&a.containsHidden&&(!b||a.hiddenByRankDir[b])},updateRankDirAndLevel:function(j,h,f){var a=this.get("defaultRankDir")||this.RANK_RIGHT;var d=this.elements[j];var c=d.rankDir||a;h>1&&(c=f);h>0&&d.parentId&&d.hidden&&(this.elements[d.parentId].hiddenByRankDir[c]=true);d.rankDir=c;d.level=h++;var b=d.children;_.isEmpty(d.callouts)||(b=b.concat(d.callouts));_.each(b,function(k){this.updateRankDirAndLevel(k,h,c)},this)},computeLayoutAreaPadding:function(a){return _.transform(this.elements[a].callouts,function(d,b){var c=this.elements[b];c.cdy>0?(d.bottom=Math.max(d.bottom,c.cdy+c.layoutArea.height)):(d.top=Math.max(d.top,c.layoutArea.height-c.cdy))},{top:0,bottom:0},this)},computeLayoutArea:function(a){var h=this.get("verticalGap");var m=this.get("horizontalGap");var f=this.elements[a];var c={};var d={};_.each(f.callouts,this.computeLayoutArea,this);var k=this.computeLayoutAreaPadding(a);var b={rootId:a,width:f.geometry.width,height:k.top+f.geometry.height+k.bottom,dx:f.offsetx,dy:0,rankDir:f.rankDir,topPadding:k.top,bottomPadding:k.bottom};var j=_.map(this.getChildrenOf(a),this.computeLayoutArea,this);var l=_.groupBy(j,"rankDir");_.each(l,function(s,r){var p=k.top;var o=0;_.each(s,function(u){u.dy+=p;u.dx+=f.geometry.width+m;p+=u.height+h;o=Math.max(o,u.width+m)});p-=h;p+=k.bottom;var t=p-k.top-k.bottom;if(f.geometry.height>t){var q=(f.geometry.height-t)/2;_.each(s,function(u){u.dy+=q})}b.height=Math.max(b.height,p);b.width+=o;c[r]=p;d[r]=o});if(c.L>0&&c.R>0){var n=_.max(c);this.shiftLayoutAreas(l.L,(n-c.L)/2,"dy");this.shiftLayoutAreas(l.R,(n-c.R)/2,"dy")}if(d.L>0){this.shiftLayoutAreas(l.R,d.L,"dx");_.each(l.L,function(o){o.dx-=b.width-o.width-(d.R||0);o.dx*=-1})}b.leftRankWidth=d.L||0;b.rightRankWidth=d.R||0;f.layoutArea=b;return b},shiftLayoutAreas:function(c,b,a){b&&_.each(c,function(d){d[a]+=b})},positionElements:function(c,a){var b={L:0,R:0};a||this.setElementPosition(c);this.readElementPosition(c);this.positionCallouts(c);_.each(this.getChildrenOf(c),function(d){var f=this.elements[d];f.siblingRank=++b[f.rankDir];this.positionElements(d,false)},this)},positionLinks:function(b){var a=this.elements[b];_.each(this.getChildrenOf(b),function(c){var f=this.elements[c];var d=this.graph.getCell(f.parentLinkId);this.setVertices(d,a,f);this.positionLinks(c)},this)},positionCallouts:function(a){_.each(this.elements[a].callouts,function(b){this.setCalloutPosition(b);this.positionElements(b,true);this.positionLinks(b)},this)},setElementPosition:function(f){var c=this.elements[f];var d=this.elements[c.parentId].layoutArea;var b=c.layoutArea.height+c.layoutArea.topPadding-c.layoutArea.bottomPadding;var a={x:d.x+c.layoutArea.dx,y:d.y+c.layoutArea.dy+(b-c.geometry.height)/2};if(c.rankDir==this.RANK_LEFT){a.x+=c.layoutArea.width-c.geometry.width}this.graph.getCell(f).set({position:a,siblingRank:c.siblingRank})},readElementPosition:function(c){var b=this.elements[c];var a=this.graph.getCell(c).position();b.geometry.x=a.x;b.geometry.y=a.y;b.geometry.cx=a.x+b.geometry.width/2;b.geometry.cy=a.y+b.geometry.height/2;b.layoutArea.x=a.x-b.layoutArea.leftRankWidth;b.layoutArea.y=a.y-(b.layoutArea.height-b.layoutArea.bottomPadding+b.layoutArea.topPadding-b.geometry.height)/2},setCalloutPosition:function(f){var c=this.elements[f];var b=this.elements[c.callerId];var a=b.geometry.x;var d=b.layoutArea.y;a+=(b.rankDir==this.RANK_LEFT)?b.geometry.width-c.geometry.width-c.cdx:c.cdx;if(c.cdy>0){d+=b.layoutArea.height;d+=c.cdy+(c.layoutArea.height-c.geometry.height+c.layoutArea.topPadding-c.layoutArea.bottomPadding)/2;d-=b.layoutArea.bottomPadding}else{d+=b.layoutArea.topPadding;d+=c.cdy-(c.layoutArea.height+c.geometry.height-c.layoutArea.topPadding+c.layoutArea.bottomPadding)/2}this.graph.getCell(f).position(a,d)},setVertices:function(c,d,f){if(f.geometry.cy!=d.geometry.cy){var a=d.geometry.x;a+=(f.rankDir==this.RANK_LEFT)?f.geometry.x+f.geometry.width+f.offsetx:f.geometry.x+d.geometry.width-f.offsetx;a/=2;var b=[{x:a,y:d.geometry.cy},{x:a,y:f.geometry.cy}]}c.set("vertices",b||[])},benchmark:function(c){var b=new Date().getTime();var a=this[c].apply(this,_.rest(arguments));this.get("benchmark")&&console.log(c+" time",new Date().getTime()-b,"ms.");return a}});joint.format.gexf={};joint.format.gexf.toCellsArray=function(h,b,a){var k=new DOMParser();var j=k.parseFromString(h,"text/xml");if(j.documentElement.nodeName=="parsererror"){throw new Error("Error while parsing GEXF file.")}var d=j.documentElement.querySelectorAll("node");var c=j.documentElement.querySelectorAll("edge");var f=[];_.each(d,function(n){var m=parseFloat(n.querySelector("size").getAttribute("value"));var l=b({id:n.getAttribute("id"),width:m,height:m,label:n.getAttribute("label")});f.push(l)});_.each(c,function(m){var l=a({source:m.getAttribute("source"),target:m.getAttribute("target")});f.unshift(l)});return f};joint.dia.Paper.prototype.toSVG=function(n,a){a=a||{};var j=V(this.viewport).attr("transform");V(this.viewport).attr("transform","");var b=this.getContentBBox();var f=this.svg.cloneNode(true);V(this.viewport).attr("transform",j||"");f.removeAttribute("style");if(a.preserveDimensions){V(f).attr({width:b.width,height:b.height})}else{V(f).attr({width:"100%",height:"100%"})}V(f).attr("viewBox",b.x+" "+b.y+" "+b.width+" "+b.height);var o=document.styleSheets.length;var c=[];for(var h=o-1;h>=0;h--){c[h]=document.styleSheets[h];document.styleSheets[h].disabled=true}var d={};$(this.svg).find("*").each(function(q){var r=window.getComputedStyle(this,null);var s={};_.each(r,function(t){s[t]=r.getPropertyValue(t)});d[q]=s});if(o!=document.styleSheets.length){_.each(c,function(r,q){document.styleSheets[q]=r})}for(var h=0;h<o;h++){document.styleSheets[h].disabled=false}var m={};$(this.svg).find("*").each(function(q){var r=window.getComputedStyle(this,null);var t=d[q];var s={};_.each(r,function(u){if(r.getPropertyValue(u)!==t[u]){s[u]=r.getPropertyValue(u)}});m[q]=s});var l=[];$(f).find("*").each(function(q){$(this).css(m[q]);if(this.tagName.toLowerCase()==="image"){l.push(this)}});function p(){return(new XMLSerializer()).serializeToString(f)}if(a.convertImagesToDataUris&&l.length){function k(q){var s=V(l.shift());if(!s){return q()}var r=s.attr("xlink:href")||s.attr("href");joint.util.imageToDataUri(r,function(u,t){s.attr("xlink:href",t);k(q)})}k(function(){n(p())})}else{return n(p())}};joint.dia.Paper.prototype.openAsSVG=function(c){var a="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes";var b=_.uniqueId("svg_output");this.toSVG(function(f){var h=window.open("",b,a);var d="data:image/svg+xml,"+encodeURIComponent(f);h.document.write('<img src="'+d+'" style="max-height:100%" />')},_.extend({convertImagesToDataUris:true},c))};(function(){this.canvg=function(l,o,b){if(l==null&&o==null&&b==null){var f=document.querySelectorAll("svg");for(var j=0;j<f.length;j++){var h=f[j];var m=document.createElement("canvas");m.width=h.clientWidth;m.height=h.clientHeight;h.parentNode.insertBefore(m,h);h.parentNode.removeChild(h);var d=document.createElement("div");d.appendChild(h);canvg(m,d.innerHTML)}return}if(typeof l=="string"){l=document.getElementById(l)}if(l.svg!=null){l.svg.stop()}var k=a(b||{});if(!(l.childNodes.length==1&&l.childNodes[0].nodeName=="OBJECT")){l.svg=k}var n=l.getContext("2d");if(typeof(o.documentElement)!="undefined"){k.loadXmlDoc(n,o)}else{if(o.substr(0,1)=="<"){k.loadXml(n,o)}else{k.load(n,o)}}};function a(d){var c={opts:d};c.FRAMERATE=30;c.MAX_VIRTUAL_PIXELS=30000;c.log=function(f){};if(c.opts.log==true&&typeof(console)!="undefined"){c.log=function(f){console.log(f)}}c.init=function(f){var h=0;c.UniqueId=function(){h++;return"canvg"+h};c.Definitions={};c.Styles={};c.Animations=[];c.Images=[];c.ctx=f;c.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(k,j){this.viewPorts.push({width:k,height:j})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(j){if(j!=null&&typeof(j)=="number"){return j}if(j=="x"){return this.width()}if(j=="y"){return this.height()}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}})};c.init();c.ImagesLoaded=function(){for(var f=0;f<c.Images.length;f++){if(!c.Images[f].loaded){return false}}return true};c.trim=function(f){return f.replace(/^\s+|\s+$/g,"")};c.compressSpaces=function(f){return f.replace(/[\s\r\t\n]+/gm," ")};c.ajax=function(h){var f;if(window.XMLHttpRequest){f=new XMLHttpRequest()}else{f=new ActiveXObject("Microsoft.XMLHTTP")}if(f){f.open("GET",h,false);f.send(null);return f.responseText}return null};c.parseXml=function(f){if(typeof(Windows)!="undefined"&&typeof(Windows.Data)!="undefined"&&typeof(Windows.Data.Xml)!="undefined"){var j=new Windows.Data.Xml.Dom.XmlDocument();var h=new Windows.Data.Xml.Dom.XmlLoadSettings();h.prohibitDtd=false;j.loadXml(f,h);return j}else{if(window.DOMParser){var k=new DOMParser();return k.parseFromString(f,"text/xml")}else{f=f.replace(/<!DOCTYPE svg[^>]*>/,"");var j=new ActiveXObject("Microsoft.XMLDOM");j.async="false";j.loadXML(f);return j}}};c.Property=function(f,h){this.name=f;this.value=h};c.Property.prototype.getValue=function(){return this.value};c.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="")};c.Property.prototype.numValue=function(){if(!this.hasValue()){return 0}var f=parseFloat(this.value);if((this.value+"").match(/%$/)){f=f/100}return f};c.Property.prototype.valueOrDefault=function(f){if(this.hasValue()){return this.value}return f};c.Property.prototype.numValueOrDefault=function(f){if(this.hasValue()){return this.numValue()}return f};c.Property.prototype.addOpacity=function(j){var h=this.value;if(j.value!=null&&j.value!=""&&typeof(this.value)=="string"){var f=new RGBColor(this.value);if(f.ok){h="rgba("+f.r+", "+f.g+", "+f.b+", "+j.numValue()+")"}}return new c.Property(this.name,h)};c.Property.prototype.getDefinition=function(){var f=this.value.match(/#([^\)'"]+)/);if(f){f=f[1]}if(!f){f=this.value}return c.Definitions[f]};c.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};c.Property.prototype.getFillStyleDefinition=function(k,j){var f=this.getDefinition();if(f!=null&&f.createGradient){return f.createGradient(c.ctx,k,j)}if(f!=null&&f.createPattern){if(f.getHrefAttribute().hasValue()){var h=f.attribute("patternTransform");f=f.getHrefAttribute().getDefinition();if(h.hasValue()){f.attribute("patternTransform",true).value=h.value}}return f.createPattern(c.ctx,k)}return null};c.Property.prototype.getDPI=function(f){return 96};c.Property.prototype.getEM=function(j){var f=12;var h=new c.Property("fontSize",c.Font.Parse(c.ctx.font).fontSize);if(h.hasValue()){f=h.toPixels(j)}return f};c.Property.prototype.getUnits=function(){var f=this.value+"";return f.replace(/[0-9\.\-]/g,"")};c.Property.prototype.toPixels=function(j,f){if(!this.hasValue()){return 0}var h=this.value+"";if(h.match(/em$/)){return this.numValue()*this.getEM(j)}if(h.match(/ex$/)){return this.numValue()*this.getEM(j)/2}if(h.match(/px$/)){return this.numValue()}if(h.match(/pt$/)){return this.numValue()*this.getDPI(j)*(1/72)}if(h.match(/pc$/)){return this.numValue()*15}if(h.match(/cm$/)){return this.numValue()*this.getDPI(j)/2.54}if(h.match(/mm$/)){return this.numValue()*this.getDPI(j)/25.4}if(h.match(/in$/)){return this.numValue()*this.getDPI(j)}if(h.match(/%$/)){return this.numValue()*c.ViewPort.ComputeSize(j)}var k=this.numValue();if(f&&k<1){return k*c.ViewPort.ComputeSize(j)}return k};c.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0}var f=this.value+"";if(f.match(/s$/)){return this.numValue()*1000}if(f.match(/ms$/)){return this.numValue()}return this.numValue()};c.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0}var f=this.value+"";if(f.match(/deg$/)){return this.numValue()*(Math.PI/180)}if(f.match(/grad$/)){return this.numValue()*(Math.PI/200)}if(f.match(/rad$/)){return this.numValue()}return this.numValue()*(Math.PI/180)};var b={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};c.Property.prototype.toTextBaseline=function(){if(!this.hasValue()){return null}return b[this.value]};c.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(o,l,j,n,h,k){var m=k!=null?this.Parse(k):this.CreateFont("","","","","",c.ctx.font);return{fontFamily:h||m.fontFamily,fontSize:n||m.fontSize,fontStyle:o||m.fontStyle,fontWeight:j||m.fontWeight,fontVariant:l||m.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var f=this;this.Parse=function(k){var l={};var m=c.trim(c.compressSpaces(k||"")).split(" ");var n={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var h="";for(var j=0;j<m.length;j++){if(!n.fontStyle&&f.Styles.indexOf(m[j])!=-1){if(m[j]!="inherit"){l.fontStyle=m[j]}n.fontStyle=true}else{if(!n.fontVariant&&f.Variants.indexOf(m[j])!=-1){if(m[j]!="inherit"){l.fontVariant=m[j]}n.fontStyle=n.fontVariant=true}else{if(!n.fontWeight&&f.Weights.indexOf(m[j])!=-1){if(m[j]!="inherit"){l.fontWeight=m[j]}n.fontStyle=n.fontVariant=n.fontWeight=true}else{if(!n.fontSize){if(m[j]!="inherit"){l.fontSize=m[j].split("/")[0]}n.fontStyle=n.fontVariant=n.fontWeight=n.fontSize=true}else{if(m[j]!="inherit"){h+=m[j]}}}}}}if(h!=""){l.fontFamily=h}return l}});c.ToNumberArray=function(j){var f=c.trim(c.compressSpaces((j||"").replace(/,/g," "))).split(" ");for(var h=0;h<f.length;h++){f[h]=parseFloat(f[h])}return f};c.Point=function(f,h){this.x=f;this.y=h};c.Point.prototype.angleTo=function(f){return Math.atan2(f.y-this.y,f.x-this.x)};c.Point.prototype.applyTransform=function(f){var h=this.x*f[0]+this.y*f[2]+f[4];var j=this.x*f[1]+this.y*f[3]+f[5];this.x=h;this.y=j};c.CreatePoint=function(h){var f=c.ToNumberArray(h);return new c.Point(f[0],f[1])};c.CreatePath=function(j){var f=c.ToNumberArray(j);var k=[];for(var h=0;h<f.length;h+=2){k.push(new c.Point(f[h],f[h+1]))}return k};c.BoundingBox=function(h,k,f,j){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(l,m){if(l!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=l;this.x2=l}if(l<this.x1){this.x1=l}if(l>this.x2){this.x2=l}}if(m!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=m;this.y2=m}if(m<this.y1){this.y1=m}if(m>this.y2){this.y2=m}}};this.addX=function(l){this.addPoint(l,null)};this.addY=function(l){this.addPoint(null,l)};this.addBoundingBox=function(l){this.addPoint(l.x1,l.y1);this.addPoint(l.x2,l.y2)};this.addQuadraticCurve=function(q,p,m,l,s,r){var o=q+2/3*(m-q);var n=p+2/3*(l-p);var u=o+1/3*(s-q);var t=n+1/3*(r-p);this.addBezierCurve(q,p,o,u,n,t,s,r)};this.addBezierCurve=function(z,y,p,n,v,s,B,A){var q=[z,y],o=[p,n],m=[v,s],l=[B,A];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;i<=1;i++){var C=function(G){return Math.pow(1-G,3)*q[i]+3*Math.pow(1-G,2)*G*o[i]+3*(1-G)*Math.pow(G,2)*m[i]+Math.pow(G,3)*l[i]};var E=6*q[i]-12*o[i]+6*m[i];var F=-3*q[i]+9*o[i]-9*m[i]+3*l[i];var D=3*o[i]-3*q[i];if(F==0){if(E==0){continue}var x=-D/E;if(0<x&&x<1){if(i==0){this.addX(C(x))}if(i==1){this.addY(C(x))}}continue}var r=Math.pow(E,2)-4*D*F;if(r<0){continue}var w=(-E+Math.sqrt(r))/(2*F);if(0<w&&w<1){if(i==0){this.addX(C(w))}if(i==1){this.addY(C(w))}}var u=(-E-Math.sqrt(r))/(2*F);if(0<u&&u<1){if(i==0){this.addX(C(u))}if(i==1){this.addY(C(u))}}}};this.isPointInBox=function(l,m){return(this.x1<=l&&l<=this.x2&&this.y1<=m&&m<=this.y2)};this.addPoint(h,k);this.addPoint(f,j)};c.Transform=function(f){var m=this;this.Type={};this.Type.translate=function(o){this.p=c.CreatePoint(o);this.apply=function(p){p.translate(this.p.x||0,this.p.y||0)};this.unapply=function(p){p.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(q){q.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(p){var o=c.ToNumberArray(p);this.angle=new c.Property("angle",o[0]);this.cx=o[1]||0;this.cy=o[2]||0;this.apply=function(q){q.translate(this.cx,this.cy);q.rotate(this.angle.toRadians());q.translate(-this.cx,-this.cy)};this.unapply=function(q){q.translate(this.cx,this.cy);q.rotate(-1*this.angle.toRadians());q.translate(-this.cx,-this.cy)};this.applyToPoint=function(r){var q=this.angle.toRadians();r.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);r.applyTransform([Math.cos(q),Math.sin(q),-Math.sin(q),Math.cos(q),0,0]);r.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(o){this.p=c.CreatePoint(o);this.apply=function(p){p.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(p){p.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(q){q.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(o){this.m=c.ToNumberArray(o);this.apply=function(p){p.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(z){var y=this.m[0];var x=this.m[2];var w=this.m[4];var v=this.m[1];var u=this.m[3];var t=this.m[5];var r=0;var q=0;var p=1;var s=1/(y*(u*p-t*q)-x*(v*p-t*r)+w*(v*q-u*r));z.transform(s*(u*p-t*q),s*(t*r-v*p),s*(w*q-x*p),s*(y*p-w*r),s*(x*t-w*u),s*(w*v-y*t))};this.applyToPoint=function(q){q.applyTransform(this.m)}};this.Type.SkewBase=function(o){this.base=m.Type.matrix;this.base(o);this.angle=new c.Property("angle",o)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(o){this.base=m.Type.SkewBase;this.base(o);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(o){this.base=m.Type.SkewBase;this.base(o);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(o){for(var p=0;p<this.transforms.length;p++){this.transforms[p].apply(o)}};this.unapply=function(o){for(var p=this.transforms.length-1;p>=0;p--){this.transforms[p].unapply(o)}};this.applyToPoint=function(q){for(var o=0;o<this.transforms.length;o++){this.transforms[o].applyToPoint(q)}};var n=c.trim(c.compressSpaces(f)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var j=0;j<n.length;j++){var l=c.trim(n[j].split("(")[0]);var k=n[j].split("(")[1].replace(")","");var h=new this.Type[l](k);h.type=l;this.transforms.push(h)}};c.AspectRatio=function(w,u,h,o,v,f,l,k,t,s){u=c.compressSpaces(u);u=u.replace(/^defer\s/,"");var n=u.split(" ")[0]||"xMidYMid";var j=u.split(" ")[1]||"meet";var r=h/o;var q=v/f;var m=Math.min(r,q);var p=Math.max(r,q);if(j=="meet"){o*=m;f*=m}if(j=="slice"){o*=p;f*=p}t=new c.Property("refX",t);s=new c.Property("refY",s);if(t.hasValue()&&s.hasValue()){w.translate(-m*t.toPixels("x"),-m*s.toPixels("y"))}else{if(n.match(/^xMid/)&&((j=="meet"&&m==q)||(j=="slice"&&p==q))){w.translate(h/2-o/2,0)}if(n.match(/YMid$/)&&((j=="meet"&&m==r)||(j=="slice"&&p==r))){w.translate(0,v/2-f/2)}if(n.match(/^xMax/)&&((j=="meet"&&m==q)||(j=="slice"&&p==q))){w.translate(h-o,0)}if(n.match(/YMax$/)&&((j=="meet"&&m==r)||(j=="slice"&&p==r))){w.translate(0,v-f)}}if(n=="none"){w.scale(r,q)}else{if(j=="meet"){w.scale(m,m)}else{if(j=="slice"){w.scale(p,p)}}}w.translate(l==null?0:-l,k==null?0:-k)};c.Element={};c.EmptyProperty=new c.Property("EMPTY","");c.Element.ElementBase=function(m){this.attributes={};this.styles={};this.children=[];this.attribute=function(t,u){var j=this.attributes[t];if(j!=null){return j}if(u==true){j=new c.Property(t,"");this.attributes[t]=j}return j||c.EmptyProperty};this.getHrefAttribute=function(){for(var j in this.attributes){if(j.match(/:href$/)){return this.attributes[j]}}return c.EmptyProperty};this.style=function(u,y,j){var v=this.styles[u];if(v!=null){return v}var t=this.attribute(u);if(t!=null&&t.hasValue()){this.styles[u]=t;return t}if(j!=true){var w=this.parent;if(w!=null){var x=w.style(u);if(x!=null&&x.hasValue()){return x}}}if(y==true){v=new c.Property(u,"");this.styles[u]=v}return v||c.EmptyProperty};this.render=function(t){if(this.style("display").value=="none"){return}if(this.style("visibility").value=="hidden"){return}t.save();if(this.attribute("mask").hasValue()){var j=this.attribute("mask").getDefinition();if(j!=null){j.apply(t,this)}}else{if(this.style("filter").hasValue()){var u=this.style("filter").getDefinition();if(u!=null){u.apply(t,this)}}else{this.setContext(t);this.renderChildren(t);this.clearContext(t)}}t.restore()};this.setContext=function(j){};this.clearContext=function(j){};this.renderChildren=function(j){for(var t=0;t<this.children.length;t++){this.children[t].render(j)}};this.addChild=function(t,j){var u=t;if(j){u=c.CreateElement(t)}u.parent=this;if(u.type!="title"){this.children.push(u)}};if(m!=null&&m.nodeType==1){for(var p=0;p<m.attributes.length;p++){var l=m.attributes[p];this.attributes[l.nodeName]=new c.Property(l.nodeName,l.nodeValue)}var s=c.Styles[m.nodeName];if(s!=null){for(var k in s){this.styles[k]=s[k]}}if(this.attribute("class").hasValue()){var n=c.compressSpaces(this.attribute("class").value).split(" ");for(var o=0;o<n.length;o++){s=c.Styles["."+n[o]];if(s!=null){for(var k in s){this.styles[k]=s[k]}}s=c.Styles[m.nodeName+"."+n[o]];if(s!=null){for(var k in s){this.styles[k]=s[k]}}}}if(this.attribute("id").hasValue()){var s=c.Styles["#"+this.attribute("id").value];if(s!=null){for(var k in s){this.styles[k]=s[k]}}}if(this.attribute("style").hasValue()){var s=this.attribute("style").value.split(";");for(var p=0;p<s.length;p++){if(c.trim(s[p])!=""){var h=s[p].split(":");var k=c.trim(h[0]);var q=c.trim(h[1]);this.styles[k]=new c.Property(k,q)}}}if(this.attribute("id").hasValue()){if(c.Definitions[this.attribute("id").value]==null){c.Definitions[this.attribute("id").value]=this}}for(var p=0;p<m.childNodes.length;p++){var f=m.childNodes[p];if(f.nodeType==1){this.addChild(f,true)}if(this.captureTextNodes&&(f.nodeType==3||f.nodeType==4)){var r=f.nodeValue||f.text||"";if(c.trim(c.compressSpaces(r))!=""){this.addChild(new c.Element.tspan(f),false)}}}}};c.Element.RenderedElementBase=function(f){this.base=c.Element.ElementBase;this.base(f);this.setContext=function(q){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(n!=null){q.fillStyle=n}}else{if(this.style("fill").hasValue()){var p=this.style("fill");if(p.value=="currentColor"){p.value=this.style("color").value}q.fillStyle=(p.value=="none"?"rgba(0,0,0,0)":p.value)}}if(this.style("fill-opacity").hasValue()){var p=new c.Property("fill",q.fillStyle);p=p.addOpacity(this.style("fill-opacity"));q.fillStyle=p.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(n!=null){q.strokeStyle=n}}else{if(this.style("stroke").hasValue()){var o=this.style("stroke");if(o.value=="currentColor"){o.value=this.style("color").value}q.strokeStyle=(o.value=="none"?"rgba(0,0,0,0)":o.value)}}if(this.style("stroke-opacity").hasValue()){var o=new c.Property("stroke",q.strokeStyle);o=o.addOpacity(this.style("stroke-opacity"));q.strokeStyle=o.value}if(this.style("stroke-width").hasValue()){var m=this.style("stroke-width").toPixels();q.lineWidth=m==0?0.001:m}if(this.style("stroke-linecap").hasValue()){q.lineCap=this.style("stroke-linecap").value}if(this.style("stroke-linejoin").hasValue()){q.lineJoin=this.style("stroke-linejoin").value}if(this.style("stroke-miterlimit").hasValue()){q.miterLimit=this.style("stroke-miterlimit").value}if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var k=c.ToNumberArray(this.style("stroke-dasharray").value);if(typeof(q.setLineDash)!="undefined"){q.setLineDash(k)}else{if(typeof(q.webkitLineDash)!="undefined"){q.webkitLineDash=k}else{if(typeof(q.mozDash)!="undefined"&&!(k.length==1&&k[0]==0)){q.mozDash=k}}}var l=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof(q.lineDashOffset)!="undefined"){q.lineDashOffset=l}else{if(typeof(q.webkitLineDashOffset)!="undefined"){q.webkitLineDashOffset=l}else{if(typeof(q.mozDashOffset)!="undefined"){q.mozDashOffset=l}}}}if(typeof(q.font)!="undefined"){q.font=c.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()}if(this.attribute("transform").hasValue()){var h=new c.Transform(this.attribute("transform").value);h.apply(q)}if(this.style("clip-path",false,true).hasValue()){var j=this.style("clip-path",false,true).getDefinition();if(j!=null){j.apply(q)}}if(this.style("opacity").hasValue()){q.globalAlpha=this.style("opacity").numValue()}}};c.Element.RenderedElementBase.prototype=new c.Element.ElementBase;c.Element.PathElementBase=function(f){this.base=c.Element.RenderedElementBase;this.base(f);this.path=function(h){if(h!=null){h.beginPath()}return new c.BoundingBox()};this.renderChildren=function(j){this.path(j);c.Mouse.checkPath(this,j);if(j.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){j.fill(this.style("fill-rule").value)}else{j.fill()}}if(j.strokeStyle!=""){j.stroke()}var l=this.getMarkers();if(l!=null){if(this.style("marker-start").isUrlDefinition()){var h=this.style("marker-start").getDefinition();h.render(j,l[0][0],l[0][1])}if(this.style("marker-mid").isUrlDefinition()){var h=this.style("marker-mid").getDefinition();for(var k=1;k<l.length-1;k++){h.render(j,l[k][0],l[k][1])}}if(this.style("marker-end").isUrlDefinition()){var h=this.style("marker-end").getDefinition();h.render(j,l[l.length-1][0],l[l.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};c.Element.PathElementBase.prototype=new c.Element.RenderedElementBase;c.Element.svg=function(f){this.base=c.Element.RenderedElementBase;this.base(f);this.baseClearContext=this.clearContext;this.clearContext=function(h){this.baseClearContext(h);c.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(l){l.strokeStyle="rgba(0,0,0,0)";l.lineCap="butt";l.lineJoin="miter";l.miterLimit=4;if(typeof(l.font)!="undefined"&&typeof(window.getComputedStyle)!="undefined"){l.font=window.getComputedStyle(l.canvas).getPropertyValue("font")}this.baseSetContext(l);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0}l.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var m=c.ViewPort.width();var k=c.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%"}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%"}if(typeof(this.root)=="undefined"){m=this.attribute("width").toPixels("x");k=this.attribute("height").toPixels("y");var j=0;var p=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){j=-this.attribute("refX").toPixels("x");p=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){l.beginPath();l.moveTo(j,p);l.lineTo(m,p);l.lineTo(m,k);l.lineTo(j,k);l.closePath();l.clip()}}c.ViewPort.SetCurrent(m,k);if(this.attribute("viewBox").hasValue()){var n=c.ToNumberArray(this.attribute("viewBox").value);var h=n[0];var o=n[1];m=n[2];k=n[3];c.AspectRatio(l,this.attribute("preserveAspectRatio").value,c.ViewPort.width(),m,c.ViewPort.height(),k,h,o,this.attribute("refX").value,this.attribute("refY").value);c.ViewPort.RemoveCurrent();c.ViewPort.SetCurrent(n[2],n[3])}}};c.Element.svg.prototype=new c.Element.RenderedElementBase;c.Element.rect=function(f){this.base=c.Element.PathElementBase;this.base(f);this.path=function(k){var j=this.attribute("x").toPixels("x");var o=this.attribute("y").toPixels("y");var l=this.attribute("width").toPixels("x");var h=this.attribute("height").toPixels("y");var n=this.attribute("rx").toPixels("x");var m=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){m=n}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){n=m}n=Math.min(n,l/2);m=Math.min(m,h/2);if(k!=null){k.beginPath();k.moveTo(j+n,o);k.lineTo(j+l-n,o);k.quadraticCurveTo(j+l,o,j+l,o+m);k.lineTo(j+l,o+h-m);k.quadraticCurveTo(j+l,o+h,j+l-n,o+h);k.lineTo(j+n,o+h);k.quadraticCurveTo(j,o+h,j,o+h-m);k.lineTo(j,o+m);k.quadraticCurveTo(j,o,j+n,o);k.closePath()}return new c.BoundingBox(j,o,j+l,o+h)}};c.Element.rect.prototype=new c.Element.PathElementBase;c.Element.circle=function(f){this.base=c.Element.PathElementBase;this.base(f);this.path=function(j){var h=this.attribute("cx").toPixels("x");var l=this.attribute("cy").toPixels("y");var k=this.attribute("r").toPixels();if(j!=null){j.beginPath();j.arc(h,l,k,0,Math.PI*2,true);j.closePath()}return new c.BoundingBox(h-k,l-k,h+k,l+k)}};c.Element.circle.prototype=new c.Element.PathElementBase;c.Element.ellipse=function(f){this.base=c.Element.PathElementBase;this.base(f);this.path=function(j){var l=4*((Math.sqrt(2)-1)/3);var m=this.attribute("rx").toPixels("x");var k=this.attribute("ry").toPixels("y");var h=this.attribute("cx").toPixels("x");var n=this.attribute("cy").toPixels("y");if(j!=null){j.beginPath();j.moveTo(h,n-k);j.bezierCurveTo(h+(l*m),n-k,h+m,n-(l*k),h+m,n);j.bezierCurveTo(h+m,n+(l*k),h+(l*m),n+k,h,n+k);j.bezierCurveTo(h-(l*m),n+k,h-m,n+(l*k),h-m,n);j.bezierCurveTo(h-m,n-(l*k),h-(l*m),n-k,h,n-k);j.closePath()}return new c.BoundingBox(h-m,n-k,h+m,n+k)}};c.Element.ellipse.prototype=new c.Element.PathElementBase;c.Element.line=function(f){this.base=c.Element.PathElementBase;this.base(f);this.getPoints=function(){return[new c.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new c.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(h){var j=this.getPoints();if(h!=null){h.beginPath();h.moveTo(j[0].x,j[0].y);h.lineTo(j[1].x,j[1].y)}return new c.BoundingBox(j[0].x,j[0].y,j[1].x,j[1].y)};this.getMarkers=function(){var j=this.getPoints();var h=j[0].angleTo(j[1]);return[[j[0],h],[j[1],h]]}};c.Element.line.prototype=new c.Element.PathElementBase;c.Element.polyline=function(f){this.base=c.Element.PathElementBase;this.base(f);this.points=c.CreatePath(this.attribute("points").value);this.path=function(h){var k=new c.BoundingBox(this.points[0].x,this.points[0].y);if(h!=null){h.beginPath();h.moveTo(this.points[0].x,this.points[0].y)}for(var j=1;j<this.points.length;j++){k.addPoint(this.points[j].x,this.points[j].y);if(h!=null){h.lineTo(this.points[j].x,this.points[j].y)}}return k};this.getMarkers=function(){var j=[];for(var h=0;h<this.points.length-1;h++){j.push([this.points[h],this.points[h].angleTo(this.points[h+1])])}j.push([this.points[this.points.length-1],j[j.length-1][1]]);return j}};c.Element.polyline.prototype=new c.Element.PathElementBase;c.Element.polygon=function(f){this.base=c.Element.polyline;this.base(f);this.basePath=this.path;this.path=function(h){var j=this.basePath(h);if(h!=null){h.lineTo(this.points[0].x,this.points[0].y);h.closePath()}return j}};c.Element.polygon.prototype=new c.Element.polyline;c.Element.path=function(f){this.base=c.Element.PathElementBase;this.base(f);var h=this.attribute("d").value;h=h.replace(/,/gm," ");h=h.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");h=h.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");h=h.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");h=h.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");h=h.replace(/([0-9])([+\-])/gm,"$1 $2");h=h.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");h=h.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");h=c.compressSpaces(h);h=c.trim(h);this.PathParser=new (function(j){this.tokens=j.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new c.Point(0,0);this.control=new c.Point(0,0);this.current=new c.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var k=new c.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(k)};this.getAsControlPoint=function(){var k=this.getPoint();this.control=k;return k};this.getAsCurrentPoint=function(){var k=this.getPoint();this.current=k;return k};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var k=new c.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return k};this.makeAbsolute=function(k){if(this.isRelativeCommand()){k.x+=this.current.x;k.y+=this.current.y}return k};this.addMarker=function(l,m,k){if(k!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(k)}this.addMarkerAngle(l,m==null?null:m.angleTo(l))};this.addMarkerAngle=function(l,k){this.points.push(l);this.angles.push(k)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var l=0;l<this.angles.length;l++){if(this.angles[l]==null){for(var k=l+1;k<this.angles.length;k++){if(this.angles[k]!=null){this.angles[l]=this.angles[k];break}}}}return this.angles}})(h);this.path=function(M){var O=this.PathParser;O.reset();var z=new c.BoundingBox();if(M!=null){M.beginPath()}while(!O.isEnd()){O.nextCommand();switch(O.command){case"M":case"m":var J=O.getAsCurrentPoint();O.addMarker(J);z.addPoint(J.x,J.y);if(M!=null){M.moveTo(J.x,J.y)}O.start=O.current;while(!O.isCommandOrEnd()){var J=O.getAsCurrentPoint();O.addMarker(J,O.start);z.addPoint(J.x,J.y);if(M!=null){M.lineTo(J.x,J.y)}}break;case"L":case"l":while(!O.isCommandOrEnd()){var S=O.current;var J=O.getAsCurrentPoint();O.addMarker(J,S);z.addPoint(J.x,J.y);if(M!=null){M.lineTo(J.x,J.y)}}break;case"H":case"h":while(!O.isCommandOrEnd()){var n=new c.Point((O.isRelativeCommand()?O.current.x:0)+O.getScalar(),O.current.y);O.addMarker(n,O.current);O.current=n;z.addPoint(O.current.x,O.current.y);if(M!=null){M.lineTo(O.current.x,O.current.y)}}break;case"V":case"v":while(!O.isCommandOrEnd()){var n=new c.Point(O.current.x,(O.isRelativeCommand()?O.current.y:0)+O.getScalar());O.addMarker(n,O.current);O.current=n;z.addPoint(O.current.x,O.current.y);if(M!=null){M.lineTo(O.current.x,O.current.y)}}break;case"C":case"c":while(!O.isCommandOrEnd()){var Q=O.current;var q=O.getPoint();var t=O.getAsControlPoint();var B=O.getAsCurrentPoint();O.addMarker(B,t,q);z.addBezierCurve(Q.x,Q.y,q.x,q.y,t.x,t.y,B.x,B.y);if(M!=null){M.bezierCurveTo(q.x,q.y,t.x,t.y,B.x,B.y)}}break;case"S":case"s":while(!O.isCommandOrEnd()){var Q=O.current;var q=O.getReflectedControlPoint();var t=O.getAsControlPoint();var B=O.getAsCurrentPoint();O.addMarker(B,t,q);z.addBezierCurve(Q.x,Q.y,q.x,q.y,t.x,t.y,B.x,B.y);if(M!=null){M.bezierCurveTo(q.x,q.y,t.x,t.y,B.x,B.y)}}break;case"Q":case"q":while(!O.isCommandOrEnd()){var Q=O.current;var t=O.getAsControlPoint();var B=O.getAsCurrentPoint();O.addMarker(B,t,t);z.addQuadraticCurve(Q.x,Q.y,t.x,t.y,B.x,B.y);if(M!=null){M.quadraticCurveTo(t.x,t.y,B.x,B.y)}}break;case"T":case"t":while(!O.isCommandOrEnd()){var Q=O.current;var t=O.getReflectedControlPoint();O.control=t;var B=O.getAsCurrentPoint();O.addMarker(B,t,t);z.addQuadraticCurve(Q.x,Q.y,t.x,t.y,B.x,B.y);if(M!=null){M.quadraticCurveTo(t.x,t.y,B.x,B.y)}}break;case"A":case"a":while(!O.isCommandOrEnd()){var Q=O.current;var y=O.getScalar();var x=O.getScalar();var k=O.getScalar()*(Math.PI/180);var A=O.getScalar();var w=O.getScalar();var B=O.getAsCurrentPoint();var W=new c.Point(Math.cos(k)*(Q.x-B.x)/2+Math.sin(k)*(Q.y-B.y)/2,-Math.sin(k)*(Q.x-B.x)/2+Math.cos(k)*(Q.y-B.y)/2);var N=Math.pow(W.x,2)/Math.pow(y,2)+Math.pow(W.y,2)/Math.pow(x,2);if(N>1){y*=Math.sqrt(N);x*=Math.sqrt(N)}var F=(A==w?-1:1)*Math.sqrt(((Math.pow(y,2)*Math.pow(x,2))-(Math.pow(y,2)*Math.pow(W.y,2))-(Math.pow(x,2)*Math.pow(W.x,2)))/(Math.pow(y,2)*Math.pow(W.y,2)+Math.pow(x,2)*Math.pow(W.x,2)));if(isNaN(F)){F=0}var E=new c.Point(F*y*W.y/x,F*-x*W.x/y);var o=new c.Point((Q.x+B.x)/2+Math.cos(k)*E.x-Math.sin(k)*E.y,(Q.y+B.y)/2+Math.sin(k)*E.x+Math.cos(k)*E.y);var L=function(l){return Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2))};var H=function(m,l){return(m[0]*l[0]+m[1]*l[1])/(L(m)*L(l))};var T=function(m,l){return(m[0]*l[1]<m[1]*l[0]?-1:1)*Math.acos(H(m,l))};var U=T([1,0],[(W.x-E.x)/y,(W.y-E.y)/x]);var D=[(W.x-E.x)/y,(W.y-E.y)/x];var C=[(-W.x-E.x)/y,(-W.y-E.y)/x];var R=T(D,C);if(H(D,C)<=-1){R=Math.PI}if(H(D,C)>=1){R=0}var K=1-w?1:-1;var P=U+K*(R/2);var j=new c.Point(o.x+y*Math.cos(P),o.y+x*Math.sin(P));O.addMarkerAngle(j,P-K*Math.PI/2);O.addMarkerAngle(B,P-K*Math.PI);z.addPoint(B.x,B.y);if(M!=null){var H=y>x?y:x;var I=y>x?1:y/x;var G=y>x?x/y:1;M.translate(o.x,o.y);M.rotate(k);M.scale(I,G);M.arc(0,0,H,U,U+R,1-w);M.scale(1/I,1/G);M.rotate(-k);M.translate(-o.x,-o.y)}}break;case"Z":case"z":if(M!=null){M.closePath()}O.current=O.start}}return z};this.getMarkers=function(){var k=this.PathParser.getMarkerPoints();var m=this.PathParser.getMarkerAngles();var l=[];for(var j=0;j<k.length;j++){l.push([k[j],m[j]])}return l}};c.Element.path.prototype=new c.Element.PathElementBase;c.Element.pattern=function(f){this.base=c.Element.ElementBase;this.base(f);this.createPattern=function(r,k){var h=this.attribute("width").toPixels("x",true);var q=this.attribute("height").toPixels("y",true);var o=new c.Element.svg();o.attributes.viewBox=new c.Property("viewBox",this.attribute("viewBox").value);o.attributes.width=new c.Property("width",h+"px");o.attributes.height=new c.Property("height",q+"px");o.attributes.transform=new c.Property("transform",this.attribute("patternTransform").value);o.children=this.children;var m=document.createElement("canvas");m.width=h;m.height=q;var j=m.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){j.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var p=-1;p<=1;p++){for(var n=-1;n<=1;n++){j.save();j.translate(p*m.width,n*m.height);o.render(j);j.restore()}}var l=r.createPattern(m,"repeat");return l}};c.Element.pattern.prototype=new c.Element.ElementBase;c.Element.marker=function(f){this.base=c.Element.ElementBase;this.base(f);this.baseRender=this.render;this.render=function(j,h,l){j.translate(h.x,h.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){j.rotate(l)}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){j.scale(j.lineWidth,j.lineWidth)}j.save();var k=new c.Element.svg();k.attributes.viewBox=new c.Property("viewBox",this.attribute("viewBox").value);k.attributes.refX=new c.Property("refX",this.attribute("refX").value);k.attributes.refY=new c.Property("refY",this.attribute("refY").value);k.attributes.width=new c.Property("width",this.attribute("markerWidth").value);k.attributes.height=new c.Property("height",this.attribute("markerHeight").value);k.attributes.fill=new c.Property("fill",this.attribute("fill").valueOrDefault("black"));k.attributes.stroke=new c.Property("stroke",this.attribute("stroke").valueOrDefault("none"));k.children=this.children;k.render(j);j.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){j.scale(1/j.lineWidth,1/j.lineWidth)}if(this.attribute("orient").valueOrDefault("auto")=="auto"){j.rotate(-l)}j.translate(-h.x,-h.y)}};c.Element.marker.prototype=new c.Element.ElementBase;c.Element.defs=function(f){this.base=c.Element.ElementBase;this.base(f);this.render=function(h){}};c.Element.defs.prototype=new c.Element.ElementBase;c.Element.GradientBase=function(h){this.base=c.Element.ElementBase;this.base(h);this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox");this.stops=[];for(var f=0;f<this.children.length;f++){var j=this.children[f];if(j.type=="stop"){this.stops.push(j)}}this.getGradient=function(){};this.createGradient=function(w,n,k){var v=this;if(this.getHrefAttribute().hasValue()){v=this.getHrefAttribute().getDefinition()}var m=function(x){if(k.hasValue()){var y=new c.Property("color",x);return y.addOpacity(k).value}return x};var p=this.getGradient(w,n);if(p==null){return m(v.stops[v.stops.length-1].color)}for(var o=0;o<v.stops.length;o++){p.addColorStop(v.stops[o].offset,m(v.stops[o].color))}if(this.attribute("gradientTransform").hasValue()){var r=c.ViewPort.viewPorts[0];var s=new c.Element.rect();s.attributes.x=new c.Property("x",-c.MAX_VIRTUAL_PIXELS/3);s.attributes.y=new c.Property("y",-c.MAX_VIRTUAL_PIXELS/3);s.attributes.width=new c.Property("width",c.MAX_VIRTUAL_PIXELS);s.attributes.height=new c.Property("height",c.MAX_VIRTUAL_PIXELS);var u=new c.Element.g();u.attributes.transform=new c.Property("transform",this.attribute("gradientTransform").value);u.children=[s];var t=new c.Element.svg();t.attributes.x=new c.Property("x",0);t.attributes.y=new c.Property("y",0);t.attributes.width=new c.Property("width",r.width);t.attributes.height=new c.Property("height",r.height);t.children=[u];var q=document.createElement("canvas");q.width=r.width;q.height=r.height;var l=q.getContext("2d");l.fillStyle=p;t.render(l);return l.createPattern(q,"no-repeat")}return p}};c.Element.GradientBase.prototype=new c.Element.ElementBase;c.Element.linearGradient=function(f){this.base=c.Element.GradientBase;this.base(f);this.getGradient=function(h,m){var o=this.gradientUnits=="objectBoundingBox"?m.getBoundingBox():null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var k=(this.gradientUnits=="objectBoundingBox"?o.x()+o.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var n=(this.gradientUnits=="objectBoundingBox"?o.y()+o.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var j=(this.gradientUnits=="objectBoundingBox"?o.x()+o.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var l=(this.gradientUnits=="objectBoundingBox"?o.y()+o.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(k==j&&n==l){return null}return h.createLinearGradient(k,n,j,l)}};c.Element.linearGradient.prototype=new c.Element.GradientBase;c.Element.radialGradient=function(f){this.base=c.Element.GradientBase;this.base(f);this.getGradient=function(j,k){var o=k.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%"}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%"}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%"}var h=(this.gradientUnits=="objectBoundingBox"?o.x()+o.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var p=(this.gradientUnits=="objectBoundingBox"?o.y()+o.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var n=h;var l=p;if(this.attribute("fx").hasValue()){n=(this.gradientUnits=="objectBoundingBox"?o.x()+o.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"))}if(this.attribute("fy").hasValue()){l=(this.gradientUnits=="objectBoundingBox"?o.y()+o.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"))}var m=(this.gradientUnits=="objectBoundingBox"?(o.width()+o.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return j.createRadialGradient(n,l,0,h,p,m)}};c.Element.radialGradient.prototype=new c.Element.GradientBase;c.Element.stop=function(h){this.base=c.Element.ElementBase;this.base(h);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0}if(this.offset>1){this.offset=1}var f=this.style("stop-color");if(this.style("stop-opacity").hasValue()){f=f.addOpacity(this.style("stop-opacity"))}this.color=f.value};c.Element.stop.prototype=new c.Element.ElementBase;c.Element.AnimateBase=function(f){this.base=c.Element.ElementBase;this.base(f);c.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var j=this.attribute("attributeType").value;var h=this.attribute("attributeName").value;if(j=="CSS"){return this.parent.style(h,true)}return this.parent.attribute(h,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(l){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else{if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}}}return false}this.duration=this.duration+l;var h=false;if(this.begin<this.duration){var k=this.calcValue();if(this.attribute("type").hasValue()){var j=this.attribute("type").value;k=j+"("+k+")"}this.getProperty().value=k;h=true}return h};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";")}this.progress=function(){var j={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var l=j.progress*(this.values.value.length-1);var k=Math.floor(l),h=Math.ceil(l);j.from=new c.Property("from",parseFloat(this.values.value[k]));j.to=new c.Property("to",parseFloat(this.values.value[h]));j.progress=(l-k)/(h-k)}else{j.from=this.from;j.to=this.to}return j}};c.Element.AnimateBase.prototype=new c.Element.ElementBase;c.Element.animate=function(f){this.base=c.Element.AnimateBase;this.base(f);this.calcValue=function(){var j=this.progress();var h=j.from.numValue()+(j.to.numValue()-j.from.numValue())*j.progress;return h+this.initialUnits}};c.Element.animate.prototype=new c.Element.AnimateBase;c.Element.animateColor=function(f){this.base=c.Element.AnimateBase;this.base(f);this.calcValue=function(){var l=this.progress();var n=new RGBColor(l.from.value);var m=new RGBColor(l.to.value);if(n.ok&&m.ok){var k=n.r+(m.r-n.r)*l.progress;var j=n.g+(m.g-n.g)*l.progress;var h=n.b+(m.b-n.b)*l.progress;return"rgb("+parseInt(k,10)+","+parseInt(j,10)+","+parseInt(h,10)+")"}return this.attribute("from").value}};c.Element.animateColor.prototype=new c.Element.AnimateBase;c.Element.animateTransform=function(f){this.base=c.Element.AnimateBase;this.base(f);this.calcValue=function(){var k=this.progress();var m=c.ToNumberArray(k.from.value);var l=c.ToNumberArray(k.to.value);var j="";for(var h=0;h<m.length;h++){j+=m[h]+(l[h]-m[h])*k.progress+" "}return j}};c.Element.animateTransform.prototype=new c.Element.animate;c.Element.font=function(h){this.base=c.Element.ElementBase;this.base(h);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var f=0;f<this.children.length;f++){var j=this.children[f];if(j.type=="font-face"){this.fontFace=j;if(j.style("font-family").hasValue()){c.Definitions[j.style("font-family").value]=this}}else{if(j.type=="missing-glyph"){this.missingGlyph=j}else{if(j.type=="glyph"){if(j.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof(this.glyphs[j.unicode])=="undefined"){this.glyphs[j.unicode]=[]}this.glyphs[j.unicode][j.arabicForm]=j}else{this.glyphs[j.unicode]=j}}}}}};c.Element.font.prototype=new c.Element.ElementBase;c.Element.fontface=function(f){this.base=c.Element.ElementBase;this.base(f);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};c.Element.fontface.prototype=new c.Element.ElementBase;c.Element.missingglyph=function(f){this.base=c.Element.path;this.base(f);this.horizAdvX=0};c.Element.missingglyph.prototype=new c.Element.path;c.Element.glyph=function(f){this.base=c.Element.path;this.base(f);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};c.Element.glyph.prototype=new c.Element.path;c.Element.text=function(f){this.captureTextNodes=true;this.base=c.Element.RenderedElementBase;this.base(f);this.baseSetContext=this.setContext;this.setContext=function(h){this.baseSetContext(h);var j=this.style("dominant-baseline").toTextBaseline();if(j==null){j=this.style("alignment-baseline").toTextBaseline()}if(j!=null){h.textBaseline=j}};this.getBoundingBox=function(){var h=this.attribute("x").toPixels("x");var k=this.attribute("y").toPixels("y");var j=this.parent.style("font-size").numValueOrDefault(c.Font.Parse(c.ctx.font).fontSize);return new c.BoundingBox(h,k-j,h+Math.floor(j*2/3)*this.children[0].getText().length,k)};this.renderChildren=function(h){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.x+=this.getAnchorDelta(h,this,0);for(var j=0;j<this.children.length;j++){this.renderChild(h,this,j)}};this.getAnchorDelta=function(j,n,m){var h=this.style("text-anchor").valueOrDefault("start");if(h!="start"){var l=0;for(var k=m;k<n.children.length;k++){var o=n.children[k];if(k>m&&o.attribute("x").hasValue()){break}l+=o.measureTextRecursive(j)}return -1*(h=="end"?l:l/2)}return 0};this.renderChild=function(h,k,j){var l=k.children[j];if(l.attribute("x").hasValue()){l.x=l.attribute("x").toPixels("x")+this.getAnchorDelta(h,k,j);if(l.attribute("dx").hasValue()){l.x+=l.attribute("dx").toPixels("x")}}else{if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x")}if(l.attribute("dx").hasValue()){this.x+=l.attribute("dx").toPixels("x")}l.x=this.x}this.x=l.x+l.measureText(h);if(l.attribute("y").hasValue()){l.y=l.attribute("y").toPixels("y");if(l.attribute("dy").hasValue()){l.y+=l.attribute("dy").toPixels("y")}}else{if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y")}if(l.attribute("dy").hasValue()){this.y+=l.attribute("dy").toPixels("y")}l.y=this.y}this.y=l.y;l.render(h);for(var j=0;j<l.children.length;j++){this.renderChild(h,l,j)}}};c.Element.text.prototype=new c.Element.RenderedElementBase;c.Element.TextElementBase=function(f){this.base=c.Element.RenderedElementBase;this.base(f);this.getGlyph=function(h,m,j){var n=m[j];var k=null;if(h.isArabic){var l="isolated";if((j==0||m[j-1]==" ")&&j<m.length-2&&m[j+1]!=" "){l="terminal"}if(j>0&&m[j-1]!=" "&&j<m.length-2&&m[j+1]!=" "){l="medial"}if(j>0&&m[j-1]!=" "&&(j==m.length-1||m[j+1]==" ")){l="initial"}if(typeof(h.glyphs[n])!="undefined"){k=h.glyphs[n][l];if(k==null&&h.glyphs[n].type=="glyph"){k=h.glyphs[n]}}}else{k=h.glyphs[n]}if(k==null){k=h.missingGlyph}return k};this.renderChildren=function(p){var n=this.parent.style("font-family").getDefinition();if(n!=null){var q=this.parent.style("font-size").numValueOrDefault(c.Font.Parse(c.ctx.font).fontSize);var k=this.parent.style("font-style").valueOrDefault(c.Font.Parse(c.ctx.font).fontStyle);var o=this.getText();if(n.isRTL){o=o.split("").reverse().join("")}var r=c.ToNumberArray(this.parent.attribute("dx").value);for(var l=0;l<o.length;l++){var m=this.getGlyph(n,o,l);var j=q/n.fontFace.unitsPerEm;p.translate(this.x,this.y);p.scale(j,-j);var h=p.lineWidth;p.lineWidth=p.lineWidth*n.fontFace.unitsPerEm/q;if(k=="italic"){p.transform(1,0,0.4,1,0,0)}m.render(p);if(k=="italic"){p.transform(1,0,-0.4,1,0,0)}p.lineWidth=h;p.scale(1/j,-1/j);p.translate(-this.x,-this.y);this.x+=q*(m.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm;if(typeof(r[l])!="undefined"&&!isNaN(r[l])){this.x+=r[l]}}return}if(p.fillStyle!=""){p.fillText(c.compressSpaces(this.getText()),this.x,this.y)}if(p.strokeStyle!=""){p.strokeText(c.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(h){var k=this.measureText(h);for(var j=0;j<this.children.length;j++){k+=this.children[j].measureTextRecursive(h)}return k};this.measureText=function(p){var n=this.parent.style("font-family").getDefinition();if(n!=null){var q=this.parent.style("font-size").numValueOrDefault(c.Font.Parse(c.ctx.font).fontSize);var j=0;var o=this.getText();if(n.isRTL){o=o.split("").reverse().join("")}var r=c.ToNumberArray(this.parent.attribute("dx").value);for(var l=0;l<o.length;l++){var m=this.getGlyph(n,o,l);j+=(m.horizAdvX||n.horizAdvX)*q/n.fontFace.unitsPerEm;if(typeof(r[l])!="undefined"&&!isNaN(r[l])){j+=r[l]}}return j}var h=c.compressSpaces(this.getText());if(!p.measureText){return h.length*10}p.save();this.setContext(p);var k=p.measureText(h).width;p.restore();return k}};c.Element.TextElementBase.prototype=new c.Element.RenderedElementBase;c.Element.tspan=function(f){this.captureTextNodes=true;this.base=c.Element.TextElementBase;this.base(f);this.text=f.nodeValue||f.text||"";this.getText=function(){return this.text}};c.Element.tspan.prototype=new c.Element.TextElementBase;c.Element.tref=function(f){this.base=c.Element.TextElementBase;this.base(f);this.getText=function(){var h=this.getHrefAttribute().getDefinition();if(h!=null){return h.children[0].getText()}}};c.Element.tref.prototype=new c.Element.TextElementBase;c.Element.a=function(h){this.base=c.Element.TextElementBase;this.base(h);this.hasText=true;for(var f=0;f<h.childNodes.length;f++){if(h.childNodes[f].nodeType!=3){this.hasText=false}}this.text=this.hasText?h.childNodes[0].nodeValue:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(j){if(this.hasText){this.baseRenderChildren(j);var l=new c.Property("fontSize",c.Font.Parse(c.ctx.font).fontSize);c.Mouse.checkBoundingBox(this,new c.BoundingBox(this.x,this.y-l.toPixels("y"),this.x+this.measureText(j),this.y))}else{var k=new c.Element.g();k.children=this.children;k.parent=this;k.render(j)}};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){c.ctx.canvas.style.cursor="pointer"}};c.Element.a.prototype=new c.Element.TextElementBase;c.Element.image=function(j){this.base=c.Element.RenderedElementBase;this.base(j);var h=this.getHrefAttribute().value;if(h==""){return}var k=h.match(/\.svg$/);c.Images.push(this);this.loaded=false;if(!k){this.img=document.createElement("img");if(c.opts.useCORS==true){this.img.crossOrigin="Anonymous"}var f=this;this.img.onload=function(){f.loaded=true};this.img.onerror=function(){c.log('ERROR: image "'+h+'" not found');f.loaded=true};this.img.src=h}else{this.img=c.ajax(h);this.loaded=true}this.renderChildren=function(n){var m=this.attribute("x").toPixels("x");var p=this.attribute("y").toPixels("y");var o=this.attribute("width").toPixels("x");var l=this.attribute("height").toPixels("y");if(o==0||l==0){return}n.save();if(k){n.drawSvg(this.img,m,p,o,l)}else{n.translate(m,p);c.AspectRatio(n,this.attribute("preserveAspectRatio").value,o,this.img.width,l,this.img.height,0,0);n.drawImage(this.img,0,0)}n.restore()};this.getBoundingBox=function(){var m=this.attribute("x").toPixels("x");var o=this.attribute("y").toPixels("y");var n=this.attribute("width").toPixels("x");var l=this.attribute("height").toPixels("y");return new c.BoundingBox(m,o,m+n,o+l)}};c.Element.image.prototype=new c.Element.RenderedElementBase;c.Element.g=function(f){this.base=c.Element.RenderedElementBase;this.base(f);this.getBoundingBox=function(){var j=new c.BoundingBox();for(var h=0;h<this.children.length;h++){j.addBoundingBox(this.children[h].getBoundingBox())}return j}};c.Element.g.prototype=new c.Element.RenderedElementBase;c.Element.symbol=function(f){this.base=c.Element.RenderedElementBase;this.base(f);this.render=function(h){}};c.Element.symbol.prototype=new c.Element.RenderedElementBase;c.Element.style=function(A){this.base=c.Element.ElementBase;this.base(A);var w="";for(var D=0;D<A.childNodes.length;D++){w+=A.childNodes[D].nodeValue}w=w.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");w=c.compressSpaces(w);var v=w.split("}");for(var D=0;D<v.length;D++){if(c.trim(v[D])!=""){var H=v[D].split("{");var n=H[0].split(",");var h=H[1].split(";");for(var C=0;C<n.length;C++){var t=c.trim(n[C]);if(t!=""){var m={};for(var B=0;B<h.length;B++){var l=h[B].indexOf(":");var I=h[B].substr(0,l);var z=h[B].substr(l+1,h[B].length-l);if(I!=null&&z!=null){m[c.trim(I)]=new c.Property(c.trim(I),c.trim(z))}}c.Styles[t]=m;if(t=="@font-face"){var F=m["font-family"].value.replace(/"/g,"");var u=m.src.value.split(",");for(var x=0;x<u.length;x++){if(u[x].indexOf('format("svg")')>0){var q=u[x].indexOf("url");var p=u[x].indexOf(")",q);var o=u[x].substr(q+5,p-q-6);var G=c.parseXml(c.ajax(o));var r=G.getElementsByTagName("font");for(var E=0;E<r.length;E++){var y=c.CreateElement(r[E]);c.Definitions[F]=y}}}}}}}}};c.Element.style.prototype=new c.Element.ElementBase;c.Element.use=function(h){this.base=c.Element.RenderedElementBase;this.base(h);this.baseSetContext=this.setContext;this.setContext=function(j){this.baseSetContext(j);if(this.attribute("x").hasValue()){j.translate(this.attribute("x").toPixels("x"),0)}if(this.attribute("y").hasValue()){j.translate(0,this.attribute("y").toPixels("y"))}};var f=this.getHrefAttribute().getDefinition();this.path=function(j){if(f!=null){f.path(j)}};this.getBoundingBox=function(){if(f!=null){return f.getBoundingBox()}};this.renderChildren=function(j){if(f!=null){var l=f;if(f.type=="symbol"){l=new c.Element.svg();l.type="svg";l.attributes.viewBox=new c.Property("viewBox",f.attribute("viewBox").value);l.attributes.preserveAspectRatio=new c.Property("preserveAspectRatio",f.attribute("preserveAspectRatio").value);l.attributes.overflow=new c.Property("overflow",f.attribute("overflow").value);l.children=f.children}if(l.type=="svg"){if(this.attribute("width").hasValue()){l.attributes.width=new c.Property("width",this.attribute("width").value)}if(this.attribute("height").hasValue()){l.attributes.height=new c.Property("height",this.attribute("height").value)}}var k=l.parent;l.parent=null;l.render(j);l.parent=k}}};c.Element.use.prototype=new c.Element.RenderedElementBase;c.Element.mask=function(f){this.base=c.Element.ElementBase;this.base(f);this.apply=function(s,k){var q=this.attribute("x").toPixels("x");var p=this.attribute("y").toPixels("y");var h=this.attribute("width").toPixels("x");var r=this.attribute("height").toPixels("y");if(h==0&&r==0){var m=new c.BoundingBox();for(var l=0;l<this.children.length;l++){m.addBoundingBox(this.children[l].getBoundingBox())}var q=Math.floor(m.x1);var p=Math.floor(m.y1);var h=Math.floor(m.width());var r=Math.floor(m.height())}var u=k.attribute("mask").value;k.attribute("mask").value="";var o=document.createElement("canvas");o.width=q+h;o.height=p+r;var t=o.getContext("2d");this.renderChildren(t);var n=document.createElement("canvas");n.width=q+h;n.height=p+r;var j=n.getContext("2d");k.render(j);j.globalCompositeOperation="destination-in";j.fillStyle=t.createPattern(o,"no-repeat");j.fillRect(0,0,q+h,p+r);s.fillStyle=j.createPattern(n,"no-repeat");s.fillRect(0,0,q+h,p+r);k.attribute("mask").value=u};this.render=function(h){}};c.Element.mask.prototype=new c.Element.ElementBase;c.Element.clipPath=function(f){this.base=c.Element.ElementBase;this.base(f);this.apply=function(h){var m=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var l=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};m.call(h);for(var k=0;k<this.children.length;k++){var n=this.children[k];if(typeof(n.path)!="undefined"){var j=null;if(n.attribute("transform").hasValue()){j=new c.Transform(n.attribute("transform").value);j.apply(h)}n.path(h);CanvasRenderingContext2D.prototype.closePath=l;if(j){j.unapply(h)}}}l.call(h);h.clip();CanvasRenderingContext2D.prototype.beginPath=m;CanvasRenderingContext2D.prototype.closePath=l};this.render=function(h){}};c.Element.clipPath.prototype=new c.Element.ElementBase;c.Element.filter=function(f){this.base=c.Element.ElementBase;this.base(f);this.apply=function(v,n){var o=n.getBoundingBox();var s=Math.floor(o.x1);var q=Math.floor(o.y1);var j=Math.floor(o.width());var u=Math.floor(o.height());var k=n.style("filter").value;n.style("filter").value="";var t=0,r=0;for(var m=0;m<this.children.length;m++){var h=this.children[m].extraFilterDistance||0;t=Math.max(t,h);r=Math.max(r,h)}var p=document.createElement("canvas");p.width=j+2*t;p.height=u+2*r;var l=p.getContext("2d");l.translate(-s+t,-q+r);n.render(l);for(var m=0;m<this.children.length;m++){this.children[m].apply(l,0,0,j+2*t,u+2*r)}v.drawImage(p,0,0,j+2*t,u+2*r,s-t,q-r,j+2*t,u+2*r);n.style("filter",true).value=k};this.render=function(h){}};c.Element.filter.prototype=new c.Element.ElementBase;c.Element.feMorphology=function(f){this.base=c.Element.ElementBase;this.base(f);this.apply=function(k,j,m,l,h){}};c.Element.feMorphology.prototype=new c.Element.ElementBase;c.Element.feComposite=function(f){this.base=c.Element.ElementBase;this.base(f);this.apply=function(k,j,m,l,h){}};c.Element.feComposite.prototype=new c.Element.ElementBase;c.Element.feColorMatrix=function(o){this.base=c.Element.ElementBase;this.base(o);var k=c.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var n=k[0];k=[0.213+0.787*n,0.715-0.715*n,0.072-0.072*n,0,0,0.213-0.213*n,0.715+0.285*n,0.072-0.072*n,0,0,0.213-0.213*n,0.715-0.715*n,0.072+0.928*n,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var j=k[0]*Math.PI/180;var p=function(r,q,m){return r+Math.cos(j)*q+Math.sin(j)*m};k=[p(0.213,0.787,-0.213),p(0.715,-0.715,-0.715),p(0.072,-0.072,0.928),0,0,p(0.213,-0.213,0.143),p(0.715,0.285,0.14),p(0.072,-0.072,-0.283),0,0,p(0.213,-0.213,-0.787),p(0.715,-0.715,0.715),p(0.072,0.928,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break}function l(r,q,u,t,m,s){return r[u*t*4+q*4+s]}function h(r,q,v,t,m,s,u){r[v*t*4+q*4+s]=u}function f(r,q){var m=k[r];return m*(m<0?q-255:q)}this.apply=function(B,z,v,q,A){var t=B.getImageData(0,0,q,A);for(var v=0;v<A;v++){for(var z=0;z<q;z++){var m=l(t.data,z,v,q,A,0);var s=l(t.data,z,v,q,A,1);var u=l(t.data,z,v,q,A,2);var w=l(t.data,z,v,q,A,3);h(t.data,z,v,q,A,0,f(0,m)+f(1,s)+f(2,u)+f(3,w)+f(4,1));h(t.data,z,v,q,A,1,f(5,m)+f(6,s)+f(7,u)+f(8,w)+f(9,1));h(t.data,z,v,q,A,2,f(10,m)+f(11,s)+f(12,u)+f(13,w)+f(14,1));h(t.data,z,v,q,A,3,f(15,m)+f(16,s)+f(17,u)+f(18,w)+f(19,1))}}B.clearRect(0,0,q,A);B.putImageData(t,0,0)}};c.Element.feColorMatrix.prototype=new c.Element.ElementBase;c.Element.feGaussianBlur=function(f){this.base=c.Element.ElementBase;this.base(f);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(k,j,m,l,h){if(typeof(stackBlurCanvasRGBA)=="undefined"){c.log("ERROR: StackBlur.js must be included for blur to work");return}k.canvas.id=c.UniqueId();k.canvas.style.display="none";document.body.appendChild(k.canvas);stackBlurCanvasRGBA(k.canvas.id,j,m,l,h,this.blurRadius);document.body.removeChild(k.canvas)}};c.Element.feGaussianBlur.prototype=new c.Element.ElementBase;c.Element.title=function(f){};c.Element.title.prototype=new c.Element.ElementBase;c.Element.desc=function(f){};c.Element.desc.prototype=new c.Element.ElementBase;c.Element.MISSING=function(f){c.log("ERROR: Element '"+f.nodeName+"' not yet implemented.")};c.Element.MISSING.prototype=new c.Element.ElementBase;c.CreateElement=function(h){var f=h.nodeName.replace(/^[^:]+:/,"");f=f.replace(/\-/g,"");var j=null;if(typeof(c.Element[f])!="undefined"){j=new c.Element[f](h)}else{j=new c.Element.MISSING(h)}j.type=h.nodeName;return j};c.load=function(f,h){c.loadXml(f,c.ajax(h))};c.loadXml=function(f,h){c.loadXmlDoc(f,c.parseXml(h))};c.loadXmlDoc=function(k,n){c.init(k);var j=function(q){var o=k.canvas;while(o){q.x-=o.offsetLeft;q.y-=o.offsetTop;o=o.offsetParent}if(window.scrollX){q.x+=window.scrollX}if(window.scrollY){q.y+=window.scrollY}return q};if(c.opts.ignoreMouse!=true){k.canvas.onclick=function(q){var o=j(new c.Point(q!=null?q.clientX:event.clientX,q!=null?q.clientY:event.clientY));c.Mouse.onclick(o.x,o.y)};k.canvas.onmousemove=function(q){var o=j(new c.Point(q!=null?q.clientX:event.clientX,q!=null?q.clientY:event.clientY));c.Mouse.onmousemove(o.x,o.y)}}var m=c.CreateElement(n.documentElement);m.root=true;var l=true;var h=function(){c.ViewPort.Clear();if(k.canvas.parentNode){c.ViewPort.SetCurrent(k.canvas.parentNode.clientWidth,k.canvas.parentNode.clientHeight)}if(c.opts.ignoreDimensions!=true){if(m.style("width").hasValue()){k.canvas.width=m.style("width").toPixels("x");k.canvas.style.width=k.canvas.width+"px"}if(m.style("height").hasValue()){k.canvas.height=m.style("height").toPixels("y");k.canvas.style.height=k.canvas.height+"px"}}var q=k.canvas.clientWidth||k.canvas.width;var p=k.canvas.clientHeight||k.canvas.height;if(c.opts.ignoreDimensions==true&&m.style("width").hasValue()&&m.style("height").hasValue()){q=m.style("width").toPixels("x");p=m.style("height").toPixels("y")}c.ViewPort.SetCurrent(q,p);if(c.opts.offsetX!=null){m.attribute("x",true).value=c.opts.offsetX}if(c.opts.offsetY!=null){m.attribute("y",true).value=c.opts.offsetY}if(c.opts.scaleWidth!=null||c.opts.scaleHeight!=null){var r=null,o=null,s=c.ToNumberArray(m.attribute("viewBox").value);if(c.opts.scaleWidth!=null){if(m.attribute("width").hasValue()){r=m.attribute("width").toPixels("x")/c.opts.scaleWidth}else{if(!isNaN(s[2])){r=s[2]/c.opts.scaleWidth}}}if(c.opts.scaleHeight!=null){if(m.attribute("height").hasValue()){o=m.attribute("height").toPixels("y")/c.opts.scaleHeight}else{if(!isNaN(s[3])){o=s[3]/c.opts.scaleHeight}}}if(r==null){r=o}if(o==null){o=r}m.attribute("width",true).value=c.opts.scaleWidth;m.attribute("height",true).value=c.opts.scaleHeight;m.attribute("transform",true).value+=" scale("+(1/r)+","+(1/o)+")"}if(c.opts.ignoreClear!=true){k.clearRect(0,0,q,p)}m.render(k);if(l){l=false;if(typeof(c.opts.renderCallback)=="function"){c.opts.renderCallback(n)}}};var f=true;if(c.ImagesLoaded()){f=false;h()}c.intervalID=setInterval(function(){var p=false;if(f&&c.ImagesLoaded()){f=false;p=true}if(c.opts.ignoreMouse!=true){p=p|c.Mouse.hasEvents()}if(c.opts.ignoreAnimation!=true){for(var o=0;o<c.Animations.length;o++){p=p|c.Animations[o].update(1000/c.FRAMERATE)}}if(typeof(c.opts.forceRedraw)=="function"){if(c.opts.forceRedraw()==true){p=true}}if(p){h();c.Mouse.runEvents()}},1000/c.FRAMERATE)};c.stop=function(){if(c.intervalID){clearInterval(c.intervalID)}};c.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(f,h){this.events.push({type:"onclick",x:f,y:h,run:function(j){if(j.onclick){j.onclick()}}})};this.onmousemove=function(f,h){this.events.push({type:"onmousemove",x:f,y:h,run:function(j){if(j.onmousemove){j.onmousemove()}}})};this.eventElements=[];this.checkPath=function(j,f){for(var h=0;h<this.events.length;h++){var k=this.events[h];if(f.isPointInPath&&f.isPointInPath(k.x,k.y)){this.eventElements[h]=j}}};this.checkBoundingBox=function(h,k){for(var f=0;f<this.events.length;f++){var j=this.events[f];if(k.isPointInBox(j.x,j.y)){this.eventElements[f]=h}}};this.runEvents=function(){c.ctx.canvas.style.cursor="";for(var h=0;h<this.events.length;h++){var j=this.events[h];var f=this.eventElements[h];while(f){j.run(f);f=f.parent}}this.events=[];this.eventElements=[]}});return c}})();if(typeof(CanvasRenderingContext2D)!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(d,b,a,c,f){canvg(this.canvas,d,{ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:b,offsetY:a,scaleWidth:c,scaleHeight:f})}}function RGBColor(j){this.ok=false;if(j.charAt(0)=="#"){j=j.substr(1,6)}j=j.replace(/ /g,"");j=j.toLowerCase();var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in a){if(j==c){j=a[c]}}var k=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}];for(var b=0;b<k.length;b++){var f=k[b].re;var d=k[b].process;var h=f.exec(j);if(h){channels=d(h);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var n=this.r.toString(16);var m=this.g.toString(16);var l=this.b.toString(16);if(n.length==1){n="0"+n}if(m.length==1){m="0"+m}if(l.length==1){l="0"+l}return"#"+n+m+l};this.getHelpXML=function(){var n=new Array();for(var p=0;p<k.length;p++){var m=k[p].example;for(var o=0;o<m.length;o++){n[n.length]=m[o]}}for(var u in a){n[n.length]=u}var q=document.createElement("ul");q.setAttribute("id","rgbcolor-examples");for(var p=0;p<n.length;p++){try{var r=document.createElement("li");var t=new RGBColor(n[p]);var v=document.createElement("div");v.style.cssText="margin: 3px; border: 1px solid black; background:"+t.toHex()+"; color:"+t.toHex();v.appendChild(document.createTextNode("test"));var l=document.createTextNode(" "+n[p]+" -> "+t.toRGB()+" -> "+t.toHex());r.appendChild(v);r.appendChild(l);q.appendChild(r)}catch(s){}}return q}}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function stackBlurImage(l,j,k,a){var d=document.getElementById(l);var m=d.naturalWidth;var f=d.naturalHeight;var c=document.getElementById(j);c.style.width=m+"px";c.style.height=f+"px";c.width=m;c.height=f;var b=c.getContext("2d");b.clearRect(0,0,m,f);b.drawImage(d,0,0);if(isNaN(k)||k<1){return}if(a){stackBlurCanvasRGBA(j,0,0,m,f,k)}else{stackBlurCanvasRGB(j,0,0,m,f,k)}}function stackBlurCanvasRGBA(N,H,F,a,c,R){if(isNaN(R)||R<1){return}R|=0;var k=document.getElementById(N);var ac=k.getContext("2d");var X;try{try{X=ac.getImageData(H,F,a,c)}catch(ab){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");X=ac.getImageData(H,F,a,c)}catch(ab){alert("Cannot access local image");throw new Error("unable to access local image data: "+ab);return}}}catch(ab){alert("Cannot access image");throw new Error("unable to access image data: "+ab)}var j=X.data;var P,O,Z,W,t,w,o,f,h,E,U,s,G,C,b,K,Q,u,r,n,v,z,A,J;var aa=R+R+1;var L=a<<2;var q=a-1;var T=c-1;var m=R+1;var S=m*(m+1)/2;var I=new BlurStack();var D=I;for(Z=1;Z<aa;Z++){D=D.next=new BlurStack();if(Z==m){var l=D}}D.next=I;var Y=null;var M=null;o=w=0;var B=mul_table[R];var d=shg_table[R];for(O=0;O<c;O++){K=Q=u=r=f=h=E=U=0;s=m*(n=j[w]);G=m*(v=j[w+1]);C=m*(z=j[w+2]);b=m*(A=j[w+3]);f+=S*n;h+=S*v;E+=S*z;U+=S*A;D=I;for(Z=0;Z<m;Z++){D.r=n;D.g=v;D.b=z;D.a=A;D=D.next}for(Z=1;Z<m;Z++){W=w+((q<Z?q:Z)<<2);f+=(D.r=(n=j[W]))*(J=m-Z);h+=(D.g=(v=j[W+1]))*J;E+=(D.b=(z=j[W+2]))*J;U+=(D.a=(A=j[W+3]))*J;K+=n;Q+=v;u+=z;r+=A;D=D.next}Y=I;M=l;for(P=0;P<a;P++){j[w+3]=A=(U*B)>>d;if(A!=0){A=255/A;j[w]=((f*B)>>d)*A;j[w+1]=((h*B)>>d)*A;j[w+2]=((E*B)>>d)*A}else{j[w]=j[w+1]=j[w+2]=0}f-=s;h-=G;E-=C;U-=b;s-=Y.r;G-=Y.g;C-=Y.b;b-=Y.a;W=(o+((W=P+R+1)<q?W:q))<<2;K+=(Y.r=j[W]);Q+=(Y.g=j[W+1]);u+=(Y.b=j[W+2]);r+=(Y.a=j[W+3]);f+=K;h+=Q;E+=u;U+=r;Y=Y.next;s+=(n=M.r);G+=(v=M.g);C+=(z=M.b);b+=(A=M.a);K-=n;Q-=v;u-=z;r-=A;M=M.next;w+=4}o+=a}for(P=0;P<a;P++){Q=u=r=K=h=E=U=f=0;w=P<<2;s=m*(n=j[w]);G=m*(v=j[w+1]);C=m*(z=j[w+2]);b=m*(A=j[w+3]);f+=S*n;h+=S*v;E+=S*z;U+=S*A;D=I;for(Z=0;Z<m;Z++){D.r=n;D.g=v;D.b=z;D.a=A;D=D.next}t=a;for(Z=1;Z<=R;Z++){w=(t+P)<<2;f+=(D.r=(n=j[w]))*(J=m-Z);h+=(D.g=(v=j[w+1]))*J;E+=(D.b=(z=j[w+2]))*J;U+=(D.a=(A=j[w+3]))*J;K+=n;Q+=v;u+=z;r+=A;D=D.next;if(Z<T){t+=a}}w=P;Y=I;M=l;for(O=0;O<c;O++){W=w<<2;j[W+3]=A=(U*B)>>d;if(A>0){A=255/A;j[W]=((f*B)>>d)*A;j[W+1]=((h*B)>>d)*A;j[W+2]=((E*B)>>d)*A}else{j[W]=j[W+1]=j[W+2]=0}f-=s;h-=G;E-=C;U-=b;s-=Y.r;G-=Y.g;C-=Y.b;b-=Y.a;W=(P+(((W=O+m)<T?W:T)*a))<<2;f+=(K+=(Y.r=j[W]));h+=(Q+=(Y.g=j[W+1]));E+=(u+=(Y.b=j[W+2]));U+=(r+=(Y.a=j[W+3]));Y=Y.next;s+=(n=M.r);G+=(v=M.g);C+=(z=M.b);b+=(A=M.a);K-=n;Q-=v;u-=z;r-=A;M=M.next;w+=a}}ac.putImageData(X,H,F)}function stackBlurCanvasRGB(K,E,C,a,b,O){if(isNaN(O)||O<1){return}O|=0;var j=document.getElementById(K);var Y=j.getContext("2d");var S;try{try{S=Y.getImageData(E,C,a,b)}catch(X){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");S=Y.getImageData(E,C,a,b)}catch(X){alert("Cannot access local image");throw new Error("unable to access local image data: "+X);return}}}catch(X){alert("Cannot access image");throw new Error("unable to access image data: "+X)}var h=S.data;var M,L,U,R,r,u,n,d,f,B,o,D,z,H,N,s,m,t,v,G;var W=O+O+1;var I=a<<2;var q=a-1;var Q=b-1;var l=O+1;var P=l*(l+1)/2;var F=new BlurStack();var A=F;for(U=1;U<W;U++){A=A.next=new BlurStack();if(U==l){var k=A}}A.next=F;var T=null;var J=null;n=u=0;var w=mul_table[O];var c=shg_table[O];for(L=0;L<b;L++){H=N=s=d=f=B=0;o=l*(m=h[u]);D=l*(t=h[u+1]);z=l*(v=h[u+2]);d+=P*m;f+=P*t;B+=P*v;A=F;for(U=0;U<l;U++){A.r=m;A.g=t;A.b=v;A=A.next}for(U=1;U<l;U++){R=u+((q<U?q:U)<<2);d+=(A.r=(m=h[R]))*(G=l-U);f+=(A.g=(t=h[R+1]))*G;B+=(A.b=(v=h[R+2]))*G;H+=m;N+=t;s+=v;A=A.next}T=F;J=k;for(M=0;M<a;M++){h[u]=(d*w)>>c;h[u+1]=(f*w)>>c;h[u+2]=(B*w)>>c;d-=o;f-=D;B-=z;o-=T.r;D-=T.g;z-=T.b;R=(n+((R=M+O+1)<q?R:q))<<2;H+=(T.r=h[R]);N+=(T.g=h[R+1]);s+=(T.b=h[R+2]);d+=H;f+=N;B+=s;T=T.next;o+=(m=J.r);D+=(t=J.g);z+=(v=J.b);H-=m;N-=t;s-=v;J=J.next;u+=4}n+=a}for(M=0;M<a;M++){N=s=H=f=B=d=0;u=M<<2;o=l*(m=h[u]);D=l*(t=h[u+1]);z=l*(v=h[u+2]);d+=P*m;f+=P*t;B+=P*v;A=F;for(U=0;U<l;U++){A.r=m;A.g=t;A.b=v;A=A.next}r=a;for(U=1;U<=O;U++){u=(r+M)<<2;d+=(A.r=(m=h[u]))*(G=l-U);f+=(A.g=(t=h[u+1]))*G;B+=(A.b=(v=h[u+2]))*G;H+=m;N+=t;s+=v;A=A.next;if(U<Q){r+=a}}u=M;T=F;J=k;for(L=0;L<b;L++){R=u<<2;h[R]=(d*w)>>c;h[R+1]=(f*w)>>c;h[R+2]=(B*w)>>c;d-=o;f-=D;B-=z;o-=T.r;D-=T.g;z-=T.b;R=(M+(((R=L+l)<Q?R:Q)*a))<<2;d+=(H+=(T.r=h[R]));f+=(N+=(T.g=h[R+1]));B+=(s+=(T.b=h[R+2]));T=T.next;o+=(m=J.r);D+=(t=J.g);z+=(v=J.b);H-=m;N-=t;s-=v;J=J.next;u+=a}}Y.putImageData(S,E,C)}function BlurStack(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}joint.dia.Paper.prototype.toDataURL=function(l,m){if(typeof this.toSVG!=="function"){throw new Error("The joint.format.svg.js plugin must be loaded.")}m=m||{};var h,f,k,a,j=m.padding||0;if(!m.width||!m.height){var b=this.viewport.getBoundingClientRect();a=b.width||1;k=b.height||1;h=a+2*j;f=k+2*j}else{h=m.width;f=m.height;j=Math.min(j,h/2-1,f/2-1);a=h-2*j;k=f-2*j}var c=new Image();var d;c.onload=function(){var s,q,p;function n(){p=document.createElement("canvas");p.width=h;p.height=f;q=p.getContext("2d");q.fillStyle=m.backgroundColor||"white";q.fillRect(0,0,h,f)}n();try{q.drawImage(c,j,j,a,k);s=p.toDataURL(m.type,m.quality);l(s)}catch(r){if(typeof canvg==="undefined"){return console.error("Canvas tainted. Canvg library required.")}n();function o(u){return u.replace(/\<image[^>]*>/g,function(v){var y=v.match(/href="([^"]*)"/)[1];var w="data:image/svg+xml";if(y.substr(0,w.length)===w){var x=decodeURIComponent(y.substr(y.indexOf(",")+1));return x.substr(x.indexOf("<svg"))}return v})}var t={ignoreDimensions:true,ignoreClear:true,offsetX:j,offsetY:j,useCORS:true};canvg(p,d,_.extend({},t,{renderCallback:function(){try{s=p.toDataURL(m.type,m.quality);l(s)}catch(u){d=o(d);n();canvg(p,d,_.extend({},t,{renderCallback:function(){s=p.toDataURL(m.type,m.quality);l(s)}}))}}}));return}};this.toSVG(function(n){d=n=n.replace('width="100%"','width="'+a+'"').replace('height="100%"','height="'+k+'"');c.src="data:image/svg+xml,"+encodeURIComponent(n)},{convertImagesToDataUris:true})};joint.dia.Paper.prototype.toPNG=function(b,a){a=a||{};a.type="image/png";this.toDataURL(b,a)};joint.dia.Paper.prototype.toJPEG=function(b,a){a=a||{};a.type="image/jpeg";this.toDataURL(b,a)};joint.dia.Paper.prototype.openAsPNG=function(c){var a="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes";var b=_.uniqueId("png_output");this.toPNG(function(f){var d=window.open("",b,a);d.document.write('<img src="'+f+'"/>')},_.extend({padding:10},c))};(function(){var b="onbeforeprint" in window;function a(h,k){var d=V(this.svg);var f=h.paddingLeft||h.padding;var n=h.paddingRight||h.padding;var j=h.paddingTop||h.padding;var l=h.paddingBottom||h.padding;var m=this.getContentBBox().moveAndExpand({x:-f,y:-j,width:f+n,height:j+l});k.attrs={width:d.attr("width"),height:d.attr("height"),viewBox:d.attr("viewBox")};k.scrollLeft=this.el.scrollLeft;k.scrollTop=this.el.scrollTop;d.attr({width:"100%",height:"100%",viewBox:[m.x,m.y,m.width,m.height].join(" ")});this.$el.addClass("printarea").addClass(h.size);if(h.detachBody){k.$parent=this.$el.parent();k.index=k.$parent.children().index(this.$el);k.$content=$(document.body).children().detach();this.$el.appendTo(document.body)}}function c(h,j){var f=V(this.svg);var d=!!window.chrome&&!window.opera;var k=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if((d||k)&&!j.attrs.viewBox){f.node.removeAttributeNS(null,"viewBox");delete j.attrs.viewBox}f.attr(j.attrs);this.$el.removeClass("printarea").removeClass(h.size);if(h.detachBody){if(j.$parent.children().length){j.$parent.children().eq(j.index).before(this.$el)}else{this.$el.appendTo(j.$parent)}j.$content.appendTo(document.body)}this.el.scrollLeft=j.scrollLeft;this.el.scrollTop=j.scrollTop}joint.dia.Paper.prototype.print=function(h){h=h||{};_.defaults(h,{size:"a4",padding:5,detachBody:true});var k={};var f=_.bind(a,this,h,k);var j=_.bind(c,this,h,k);if(b){$(window).one("beforeprint",f);$(window).one("afterprint",j)}else{f()}window.print();if(!b){var d=_.once(j);$(document).one("mouseover",d);_.delay(d,1000)}}})();if(typeof exports==="object"){var joint={com:{},util:require("../../../src/core").util};var WebSocketServer=require("ws").Server;var WebSocket=require("ws");var _=require("lodash");var url=require("url");var Backbone=require("backbone")}joint.com=joint.com||{};joint.com.Channel=function(a){this.options=a;if(!this.options||!this.options.graph){throw new Error("Channel: missing a graph.")}this.options.ttl=this.options.ttl||60;this.options.healthCheckInterval=this.options.healthCheckInterval||(1000*60*60);this.options.reconnectInterval=this.options.reconnectInterval||10000;this.options.serverShouldSendGraph=_.isUndefined(this.options.serverShouldSendGraph)?true:this.options.serverShouldSendGraph;this._isClient=!!this.options.url;this._clients=[];this.messageQueue=[];this.id=this.options.id||(this._isClient?"c_":"s_")+joint.util.uuid();this.state={};this.state[this.id]=0;this.sites={};this.sites[this.id]={socket:undefined,outgoing:[],ttl:this.options.ttl};this.initialize()};_.extend(joint.com.Channel.prototype,Backbone.Events);joint.com.Channel.prototype.initialize=function(){this.options.graph.on("all",this.onGraphChange.bind(this));if(this._isClient){this.connectClient()}else{if(this.options.port){this.server=new WebSocketServer({port:this.options.port});this.server.on("connection",this.onConnection.bind(this))}}if(!this._isClient){this._healthCheckInterval=setInterval(this.healthCheck.bind(this),this.options.healthCheckInterval)}};joint.com.Channel.prototype.connectClient=function(){var b=this.options.url+"/?channelId="+this.id+"&state="+JSON.stringify(this.state)+(this.options.query?"&query="+JSON.stringify(this.options.query):"");if(this.options.debugLevel>0){this.log("connectClient",b)}var a=new WebSocket(b);a.onopen=this.onConnection.bind(this,a);a.onclose=this.onClose.bind(this,a)};joint.com.Channel.prototype.close=function(){if(this._reconnectTimeout){clearTimeout(this._reconnectTimeout)}if(this._healthCheckInterval){clearInterval(this._healthCheckInterval)}this._closed=true;_.each(this.sites,function(a){if(a.socket){a.socket.close()}});if(this.server){this.server.close()}};joint.com.Channel.prototype.healthCheck=function(){if(this.options.debugLevel>0){this.log("healthCheck",_.object(_.keys(this.sites),_.pluck(this.sites,"ttl")))}_.each(this.sites,function(a,b){if(b===this.id){return}if(!a.socket||a.socket.readyState!==1){a.ttl-=1}else{a.ttl=this.options.ttl}if(a.ttl<=0){delete this.sites[b];delete this.state[b]}},this)};joint.com.Channel.prototype.onConnection=function(a){this._clients.push(a);if(this._isClient){this.sites[this.id].socket=a;a.onmessage=function(f){this.onMessage(a,f.data)}.bind(this)}else{var b=url.parse(a.upgradeReq.url,true);var c=b.query.channelId;if(this.sites[c]){this.sites[c].socket=a}else{if(this.debugLevel>1){this.log("new_site",c)}this.sites[c]={socket:a,outgoing:[],ttl:this.options.ttl};this.state[c]=0;if(this.options.serverShouldSendGraph){var d={channelId:this.id,state:JSON.parse(JSON.stringify(this.state)),action:"graph",graph:this.options.graph.toJSON()};this.messageQueue.push({type:"op",data:d,source:this.id,target:[c]});this.send()}}a.on("message",this.onMessage.bind(this,a));a.on("close",this.onClose.bind(this,a))}};joint.com.Channel.prototype.onClose=function(a){var b=this._clients.indexOf(a);if(b!==-1){this._clients.splice(b,1)}if(this._isClient&&!this._closed){if(this._reconnectTimeout){clearTimeout(this._reconnectTimeout)}this._reconnectTimeout=setTimeout(this.connectClient.bind(this),this.options.reconnectInterval)}this.trigger("close",a)};joint.com.Channel.prototype.onMessage=function(b,f){this.trigger("message:received",f);if(this.options.debugLevel>1){this.log("message",f)}try{f=JSON.parse(f)}catch(d){return console.error("Channel: message parsing failed.",d)}if(f.type=="notification"){this.trigger(f.data.event,f.data.data);return this.sendNotification(f)}var h=f.data;if(this._isClient){var c=this.sites[this.id];h=this.receive(c,this.id,h)}else{var a=this.sites[h.channelId];h=this.receive(a,h.channelId,h);var c=this.sites[this.id];h=this.receive(c,this.id,h)}if(h.action==="graph"){this.state[h.channelId]=h.state[h.channelId]}else{this.state[h.channelId]=(this.state[h.channelId]||0)+1}if(this.options.debugLevel>1){this.log("new state",this.state)}this.execute(h);_.each(this.sites,function(j,k){if(k!==this.id&&k!==h.channelId){this.receive(j,k,h)}},this);if(!this._isClient){f.op=h;this.messageQueue.push(f);this.broadcast(f)}this.trigger("message:processed",f)};joint.com.Channel.prototype.receive=function(b,d,h){if(!b){return h}if(this.options.debugLevel>1){this.log("receive",d,h)}if(this.options.debugLevel>1){this.log("outgoing",b.outgoing)}b.outgoing=_.filter(b.outgoing,function(j){return j.state[j.channelId]>=(h.state[j.channelId]||0)});if(this.options.debugLevel>1){this.log("outgoing.length",b.outgoing.length)}for(var c=0;c<b.outgoing.length;c++){var f=b.outgoing[c];var a=this.transform(h,f);h=a[0];b.outgoing[c]=a[1]}return h};joint.com.Channel.prototype.transform=function(b,a){if(this.options.debugLevel>1){this.log("transform",b,a)}if(b.action==="change:target"&&a.action==="remove"){if(b.cell.target.id===a.cell.id){b.cell.target={x:0,y:0}}}if(b.action==="change:source"&&a.action==="remove"){if(b.cell.source.id===a.cell.id){b.cell.source={x:0,y:0}}}return[b,a]};joint.com.Channel.prototype.execute=function(c){var a;switch(c.action){case"add":this.options.graph.addCell(c.cell,{remote:true});break;case"remove":a=this.options.graph.getCell(c.cell.id);if(a){a.remove({remote:true,disconnectLinks:true})}break;case"graph":this.options.graph.fromJSON(c.graph);break;default:var b=c.action.substr("change:".length);a=this.options.graph.getCell(c.cell.id);if(a){a.set(b,c.cell[b],{remote:true})}break}};joint.com.Channel.prototype.broadcast=function(a){if(this._isClient){a.target=_.keys(this.sites)}else{a.target=_.keys(_.omit(this.sites,this.id,a.source))}this.send()};joint.com.Channel.prototype.send=function(){if(this._paused){return}var c=[];for(var b=0;b<this.messageQueue.length;b++){var a=this.messageQueue[b];if(this.sendMessage(a)){c.push(b)}}c.forEach(_.bind(function(d){this.messageQueue.splice(d,1)},this))};joint.com.Channel.prototype.sendMessage=function(a){if(this.debugLevel>1){this.log("sendMessage",a)}var b=[];a.target.forEach(function(f,c){var d=this.sites[f];if(!d){return b.push(c)}if(!d.socket){return}if(d.socket.readyState!==1){return}if(this.debugLevel>1){this.log("sendMessage",f,a)}d.socket.send(JSON.stringify(a));b.push(c)},this);b.forEach(function(c){a.target.splice(c,1)});if(!a.target.length){return true}return false};joint.com.Channel.prototype.log=function(a,b){var c="Channel ["+this.id+"] "+a.toUpperCase()+": ";console.log.apply(console,[c].concat(_.rest(_.toArray(arguments))))};joint.com.Channel.prototype.pause=function(){this._paused=true};joint.com.Channel.prototype.unpause=function(){this._paused=false;this.send()};joint.com.Channel.prototype.notify=function(b,c){var a={type:"notification",source:this.id,data:{event:b,data:c}};this.sendNotification(a)};joint.com.Channel.prototype.sendNotification=function(a){if(this._isClient){a.target=_.keys(this.sites)}else{a.target=_.keys(_.omit(this.sites,this.id,a.source))}this.sendMessage(a)};joint.com.Channel.prototype.onGraphChange=function(b,a,h,c){if(c&&c.remote){return}var f=b==="add"||b==="remove"||b.substr(0,"change:".length)==="change:";if(!f){return}var j={channelId:this.id,state:JSON.parse(JSON.stringify(this.state)),action:b,cell:a.toJSON()};var d={type:"op",data:j,source:this.id};if(this.options.debugLevel>1){this.log("generate",d)}this.messageQueue.push(d);this.broadcast(d);this.sites[this.id].outgoing.push(j);this.state[this.id]++};joint.com.ChannelHub=function(a){this.options=a;if(!this.options.port){throw new Error("ChannelHub: missing a port.")}this.initialize()};_.extend(joint.com.ChannelHub.prototype,Backbone.Events);joint.com.ChannelHub.prototype.initialize=function(){this.server=new WebSocketServer({port:this.options.port});this.server.on("connection",this.onConnection.bind(this))};joint.com.ChannelHub.prototype.onConnection=function(a){var b=url.parse(a.upgradeReq.url,true);var d={query:b.query};if(!this.router){throw new Error("ChannelHub: missing a router.")}var c=this.router(d);c.onConnection(a)};joint.com.ChannelHub.prototype.route=function(a){this.router=a};joint.com.ChannelHub.prototype.close=function(){this.server.close()};if(typeof exports==="object"){module.exports.Channel=joint.com.Channel;module.exports.ChannelHub=joint.com.ChannelHub}if(typeof exports==="object"){var joint={alg:{PriorityQueue:require("./joint.alg.PriorityQueue")}}}joint.alg=joint.alg||{};joint.alg.Dijkstra=function(l,a,f){f=f||function(q,p){return 1};var k={};k[a]=0;var j={};var h=new joint.alg.PriorityQueue;for(var m in l){if(m!==a){k[m]=Infinity}h.insert(k[m],m,m)}var o={};while(!h.isEmpty()){var n=h.remove();o[n]=true;var b=l[n]||[];for(var c=0;c<b.length;c++){var m=b[c];if(!o[m]){var d=k[n]+f(n,m);if(d<k[m]){k[m]=d;j[m]=n;h.updatePriority(m,d)}}}}return j};if(typeof exports==="object"){module.exports=joint.alg.Dijkstra}if(typeof exports==="object"){var joint={}}joint.alg=joint.alg||{};joint.alg.PriorityQueue=function(a){a=a||{};this.comparator=a.comparator||function(d,c){return d-c};this.index={};this.data=a.data||[];this.heapify()};joint.alg.PriorityQueue.prototype.isEmpty=function(){return this.data.length===0};joint.alg.PriorityQueue.prototype.insert=function(b,d,f){var c={priority:b,value:d};this.data.push(c);var a=this.data.length-1;if(f){c.id=f;this.index[f]=a}this.bubbleUp(a)};joint.alg.PriorityQueue.prototype.peek=function(){return this.data[0]&&this.data[0].value};joint.alg.PriorityQueue.prototype.peekPriority=function(){return this.data[0]&&this.data[0].priority};joint.alg.PriorityQueue.prototype.updatePriority=function(h,c){var b=this.index[h];if(typeof b==="undefined"){throw new Error("Node with id "+h+" was not found in the heap.")}var d=this.data;var f=d[b].priority;var a=this.comparator(c,f);if(a<0){d[b].priority=c;this.bubbleUp(b)}else{if(a>0){d[b].priority=c;this.bubbleDown(b)}}};joint.alg.PriorityQueue.prototype.remove=function(){var c=this.data;var a=c[0];var b=c.pop();delete this.index[c.length];if(c.length>0){c[0]=b;if(b.id){this.index[b.id]=0}this.bubbleDown(0)}return a&&a.value};joint.alg.PriorityQueue.prototype.heapify=function(){for(var a=0;a<this.data.length;a++){this.bubbleUp(a)}};joint.alg.PriorityQueue.prototype.bubbleUp=function(d){var b;var a;var c=this.data;while(d>0){b=(d-1)>>>1;if(this.comparator(c[d].priority,c[b].priority)<0){a=c[b];c[b]=c[d];if(c[d].id){this.index[c[d].id]=b}c[d]=a;if(c[d].id){this.index[c[d].id]=d}d=b}else{break}}};joint.alg.PriorityQueue.prototype.bubbleDown=function(j){var f=this.data;var d=f.length-1;while(true){var h=(j<<1)+1;var c=h+1;var b=j;if(h<=d&&this.comparator(f[h].priority,f[b].priority)<0){b=h}if(c<=d&&this.comparator(f[c].priority,f[b].priority)<0){b=c}if(b!==j){var a=f[b];f[b]=f[j];if(f[j].id){this.index[f[j].id]=b}f[j]=a;if(f[j].id){this.index[f[j].id]=j}j=b}else{break}}};if(typeof exports==="object"){module.exports=joint.alg.PriorityQueue}joint.storage=joint.storage||{};joint.storage.Local={prefix:"joint.storage",insert:function(c,b,f){var d=b.id||_.uniqueId("doc-");var a=this.loadIndex(c);a.keys.push(d);this.setItem(this.docKey(c,d),b);this.setItem(this.indexKey(c),a);this.callback(f,null,_.extend({},b,{id:d}))},find:function(f,b,h){var a=this.loadIndex(f);var d=[];if(_.isEmpty(b)){_.each(a.keys,function(k){var j=this.getItem(this.docKey(f,k));if(!j){this.callback(h,new Error("Storage incosistency. No document found for an ID "+k+" from index."))}d.push(j)},this);this.callback(h,null,d)}else{if(b.id){var c=this.getItem(this.docKey(f,b.id));this.callback(h,null,c?[c]:[])}else{this.callback(h,null,[])}}},remove:function(c,b,d){var a=this.loadIndex(c);if(_.isEmpty(b)){_.each(a.keys,function(f){localStorage.removeItem(this.docKey(c,f))},this);localStorage.removeItem(this.indexKey(c));this.callback(d,null)}else{if(b.id){_.remove(a.keys,function(f){return f===b.id});localStorage.removeItem(this.docKey(c,b.id));this.setItem(this.indexKey(c),a);this.callback(d,null)}}},callback:function(c,b,a){if(c){_.defer(function(){c(b,a)})}},setItem:function(a,b){localStorage.setItem(a,JSON.stringify(b))},getItem:function(a){var b=localStorage.getItem(a);return b?JSON.parse(b):b},loadIndex:function(b){var a=this.getItem(this.indexKey(b))||{};a.keys=a.keys||[];return a},docKey:function(a,b){return this.prefix+"."+a+".docs."+b},indexKey:function(a){return this.prefix+"."+a+".index"}};